import { createRequire } from 'module'; const require = createRequire(import.meta.url);
var XA=Object.create;var Wc=Object.defineProperty;var ZA=Object.getOwnPropertyDescriptor;var QA=Object.getOwnPropertyNames;var jA=Object.getPrototypeOf,e0=Object.prototype.hasOwnProperty;var X=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Xe=(t,e)=>()=>(t&&(e=t(t=0)),e);var z=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Jc=(t,e)=>{for(var n in e)Wc(t,n,{get:e[n],enumerable:!0})},t0=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of QA(e))!e0.call(t,i)&&i!==n&&Wc(t,i,{get:()=>e[i],enumerable:!(r=ZA(e,i))||r.enumerable});return t};var Zn=(t,e,n)=>(n=t!=null?XA(jA(t)):{},t0(e||!t||!t.__esModule?Wc(n,"default",{value:t,enumerable:!0}):n,t));var dd=z((mV,oy)=>{"use strict";var el=Object.prototype.hasOwnProperty,sy=Object.prototype.toString,jg=Object.defineProperty,ey=Object.getOwnPropertyDescriptor,ty=function(e){return typeof Array.isArray=="function"?Array.isArray(e):sy.call(e)==="[object Array]"},ny=function(e){if(!e||sy.call(e)!=="[object Object]")return!1;var n=el.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&el.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var i;for(i in e);return typeof i>"u"||el.call(e,i)},ry=function(e,n){jg&&n.name==="__proto__"?jg(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},iy=function(e,n){if(n==="__proto__")if(el.call(e,n)){if(ey)return ey(e,n).value}else return;return e[n]};oy.exports=function t(){var e,n,r,i,s,o,a=arguments[0],d=1,u=arguments.length,h=!1;for(typeof a=="boolean"&&(h=a,a=arguments[1]||{},d=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});d<u;++d)if(e=arguments[d],e!=null)for(n in e)r=iy(a,n),i=iy(e,n),a!==i&&(h&&i&&(ny(i)||(s=ty(i)))?(s?(s=!1,o=r&&ty(r)?r:[]):o=r&&ny(r)?r:{},ry(a,{name:n,newValue:t(h,o,i)})):typeof i<"u"&&ry(a,{name:n,newValue:i}));return a}});var ay=z((gV,mR)=>{mR.exports={name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}});var uy=z((yV,ly)=>{"use strict";var gR=ay();ly.exports={pkg:gR}});var pd=z(Yt=>{"use strict";var dy=Yt&&Yt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.GaxiosError=Yt.GAXIOS_ERROR_SYMBOL=void 0;Yt.defaultErrorRedactor=fy;var cy=dy(dd()),yR=dy(uy()),fd=yR.default.pkg;Yt.GAXIOS_ERROR_SYMBOL=Symbol.for(`${fd.name}-gaxios-error`);var hd=class t extends Error{config;response;code;status;error;[Yt.GAXIOS_ERROR_SYMBOL]=fd.version;static[Symbol.hasInstance](e){return e&&typeof e=="object"&&Yt.GAXIOS_ERROR_SYMBOL in e&&e[Yt.GAXIOS_ERROR_SYMBOL]===fd.version?!0:Function.prototype[Symbol.hasInstance].call(t,e)}constructor(e,n,r,i){if(super(e,{cause:i}),this.config=n,this.response=r,this.error=i instanceof Error?i:void 0,this.config=(0,cy.default)(!0,{},n),this.response&&(this.response.config=(0,cy.default)(!0,{},this.response.config)),this.response){try{this.response.data=_R(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}i instanceof DOMException?this.code=i.name:i&&typeof i=="object"&&"code"in i&&(typeof i.code=="string"||typeof i.code=="number")&&(this.code=i.code)}static extractAPIErrorFromResponse(e,n="The request failed"){let r=n;if(typeof e.data=="string"&&(r=e.data),e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&!e.ok){if(typeof e.data.error=="string")return{message:e.data.error,code:e.status,status:e.statusText};if(typeof e.data.error=="object"){r="message"in e.data.error&&typeof e.data.error.message=="string"?e.data.error.message:r;let i="status"in e.data.error&&typeof e.data.error.status=="string"?e.data.error.status:e.statusText,s="code"in e.data.error&&typeof e.data.error.code=="number"?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let o=[];for(let a of e.data.error.errors)typeof a=="object"&&"message"in a&&typeof a.message=="string"&&o.push(a.message);return Object.assign({message:o.join(`
`)||r,code:s,status:i},e.data.error)}return Object.assign({message:r,code:s,status:i},e.data.error)}}return{message:r,code:e.status,status:e.statusText}}};Yt.GaxiosError=hd;function _R(t,e){switch(t){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function fy(t){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function n(s){s&&s.forEach((o,a)=>{(/^authentication$/i.test(a)||/^authorization$/i.test(a)||/secret/i.test(a))&&s.set(a,e)})}function r(s,o){if(typeof s=="object"&&s!==null&&typeof s[o]=="string"){let a=s[o];(/grant_type=/i.test(a)||/assertion=/i.test(a)||/secret/i.test(a))&&(s[o]=e)}}function i(s){!s||typeof s!="object"||(s instanceof FormData||s instanceof URLSearchParams||"forEach"in s&&"set"in s?s.forEach((o,a)=>{(["grant_type","assertion"].includes(a)||/secret/.test(a))&&s.set(a,e)}):("grant_type"in s&&(s.grant_type=e),"assertion"in s&&(s.assertion=e),"client_secret"in s&&(s.client_secret=e)))}return t.config&&(n(t.config.headers),r(t.config,"data"),i(t.config.data),r(t.config,"body"),i(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",e),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",e)),t.response&&(fy({config:t.response.config}),n(t.response.headers),t.response.bodyUsed&&(r(t.response,"data"),i(t.response.data))),t}});var py=z(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.getRetryConfig=ER;async function ER(t){let e=hy(t);if(!t||!t.config||!e&&!t.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let n=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||n,t.config.retryConfig=e,!await(e.shouldRetry||vR)(t))return{shouldRetry:!1,config:t.config};let i=SR(e);t.config.retryConfig.currentRetryAttempt+=1;let s=e.retryBackoff?e.retryBackoff(t,i):new Promise(o=>{setTimeout(o,i)});return e.onRetryAttempt&&await e.onRetryAttempt(t),await s,{shouldRetry:!0,config:t.config}}function vR(t){let e=hy(t);if(t.config.signal?.aborted&&t.code!=="TimeoutError"||t.code==="AbortError"||!e||e.retry===0||!t.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(t.config.method?.toUpperCase()||"GET"))return!1;if(t.response&&t.response.status){let n=!1;for(let[r,i]of e.statusCodesToRetry){let s=t.response.status;if(s>=r&&s<=i){n=!0;break}}if(!n)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function hy(t){if(t&&t.config&&t.config.retryConfig)return t.config.retryConfig}function SR(t){let n=(t.currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,r=t.totalTimeout-(Date.now()-t.timeOfFirstRequest);return Math.min(n,r,t.maxRetryDelay)}});var yd=z(tl=>{"use strict";Object.defineProperty(tl,"__esModule",{value:!0});tl.GaxiosInterceptorManager=void 0;var gd=class extends Set{};tl.GaxiosInterceptorManager=gd});var gy=z((SV,my)=>{var cs=1e3,ds=cs*60,fs=ds*60,_i=fs*24,TR=_i*7,wR=_i*365.25;my.exports=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return CR(t);if(n==="number"&&isFinite(t))return e.long?bR(t):AR(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function CR(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*wR;case"weeks":case"week":case"w":return n*TR;case"days":case"day":case"d":return n*_i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*fs;case"minutes":case"minute":case"mins":case"min":case"m":return n*ds;case"seconds":case"second":case"secs":case"sec":case"s":return n*cs;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function AR(t){var e=Math.abs(t);return e>=_i?Math.round(t/_i)+"d":e>=fs?Math.round(t/fs)+"h":e>=ds?Math.round(t/ds)+"m":e>=cs?Math.round(t/cs)+"s":t+"ms"}function bR(t){var e=Math.abs(t);return e>=_i?nl(t,e,_i,"day"):e>=fs?nl(t,e,fs,"hour"):e>=ds?nl(t,e,ds,"minute"):e>=cs?nl(t,e,cs,"second"):t+" ms"}function nl(t,e,n,r){var i=e>=n*1.5;return Math.round(t/n)+" "+r+(i?"s":"")}});var _d=z((TV,yy)=>{function RR(t){n.debug=n,n.default=n,n.coerce=d,n.disable=o,n.enable=i,n.enabled=a,n.humanize=gy(),n.destroy=u,Object.keys(t).forEach(h=>{n[h]=t[h]}),n.names=[],n.skips=[],n.formatters={};function e(h){let m=0;for(let g=0;g<h.length;g++)m=(m<<5)-m+h.charCodeAt(g),m|=0;return n.colors[Math.abs(m)%n.colors.length]}n.selectColor=e;function n(h){let m,g=null,_,v;function w(...T){if(!w.enabled)return;let A=w,G=Number(new Date),F=G-(m||G);A.diff=F,A.prev=m,A.curr=G,m=G,T[0]=n.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let B=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(q,$)=>{if(q==="%%")return"%";B++;let Y=n.formatters[$];if(typeof Y=="function"){let L=T[B];q=Y.call(A,L),T.splice(B,1),B--}return q}),n.formatArgs.call(A,T),(A.log||n.log).apply(A,T)}return w.namespace=h,w.useColors=n.useColors(),w.color=n.selectColor(h),w.extend=r,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(_!==n.namespaces&&(_=n.namespaces,v=n.enabled(h)),v),set:T=>{g=T}}),typeof n.init=="function"&&n.init(w),w}function r(h,m){let g=n(this.namespace+(typeof m>"u"?":":m)+h);return g.log=this.log,g}function i(h){n.save(h),n.namespaces=h,n.names=[],n.skips=[];let m=(typeof h=="string"?h:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let g of m)g[0]==="-"?n.skips.push(g.slice(1)):n.names.push(g)}function s(h,m){let g=0,_=0,v=-1,w=0;for(;g<h.length;)if(_<m.length&&(m[_]===h[g]||m[_]==="*"))m[_]==="*"?(v=_,w=g,_++):(g++,_++);else if(v!==-1)_=v+1,w++,g=w;else return!1;for(;_<m.length&&m[_]==="*";)_++;return _===m.length}function o(){let h=[...n.names,...n.skips.map(m=>"-"+m)].join(",");return n.enable(""),h}function a(h){for(let m of n.skips)if(s(h,m))return!1;for(let m of n.names)if(s(h,m))return!0;return!1}function d(h){return h instanceof Error?h.stack||h.message:h}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}yy.exports=RR});var _y=z((Tt,rl)=>{Tt.formatArgs=PR;Tt.save=xR;Tt.load=kR;Tt.useColors=IR;Tt.storage=NR();Tt.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Tt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function IR(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function PR(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+rl.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(n++,i==="%c"&&(r=n))}),t.splice(r,0,e)}Tt.log=console.debug||console.log||(()=>{});function xR(t){try{t?Tt.storage.setItem("debug",t):Tt.storage.removeItem("debug")}catch{}}function kR(){let t;try{t=Tt.storage.getItem("debug")||Tt.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function NR(){try{return localStorage}catch{}}rl.exports=_d()(Tt);var{formatters:MR}=rl.exports;MR.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var vy=z((Ze,sl)=>{var OR=X("tty"),il=X("util");Ze.init=GR;Ze.log=FR;Ze.formatArgs=UR;Ze.save=qR;Ze.load=BR;Ze.useColors=DR;Ze.destroy=il.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ze.colors=[6,2,3,4,5,1];try{let t=X("supports-color");t&&(t.stderr||t).level>=2&&(Ze.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ze.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let n=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,s)=>s.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),t[n]=r,t},{});function DR(){return"colors"in Ze.inspectOpts?!!Ze.inspectOpts.colors:OR.isatty(process.stderr.fd)}function UR(t){let{namespace:e,useColors:n}=this;if(n){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),s=`  ${i};1m${e} \x1B[0m`;t[0]=s+t[0].split(`
`).join(`
`+s),t.push(i+"m+"+sl.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=LR()+e+" "+t[0]}function LR(){return Ze.inspectOpts.hideDate?"":new Date().toISOString()+" "}function FR(...t){return process.stderr.write(il.formatWithOptions(Ze.inspectOpts,...t)+`
`)}function qR(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function BR(){return process.env.DEBUG}function GR(t){t.inspectOpts={};let e=Object.keys(Ze.inspectOpts);for(let n=0;n<e.length;n++)t.inspectOpts[e[n]]=Ze.inspectOpts[e[n]]}sl.exports=_d()(Ze);var{formatters:Ey}=sl.exports;Ey.o=function(t){return this.inspectOpts.colors=this.useColors,il.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Ey.O=function(t){return this.inspectOpts.colors=this.useColors,il.inspect(t,this.inspectOpts)}});var vd=z((wV,Ed)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ed.exports=_y():Ed.exports=vy()});var wy=z(wt=>{"use strict";var HR=wt&&wt.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),VR=wt&&wt.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),Sy=wt&&wt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&HR(e,t,n);return VR(e,t),e};Object.defineProperty(wt,"__esModule",{value:!0});wt.req=wt.json=wt.toBuffer=void 0;var $R=Sy(X("http")),WR=Sy(X("https"));async function Ty(t){let e=0,n=[];for await(let r of t)e+=r.length,n.push(r);return Buffer.concat(n,e)}wt.toBuffer=Ty;async function JR(t){let n=(await Ty(t)).toString("utf8");try{return JSON.parse(n)}catch(r){let i=r;throw i.message+=` (input: ${n})`,i}}wt.json=JR;function zR(t,e={}){let r=((typeof t=="string"?t:t.href).startsWith("https:")?WR:$R).request(t,e),i=new Promise((s,o)=>{r.once("response",s).once("error",o).end()});return r.then=i.then.bind(i),r}wt.req=zR});var Ry=z(Mt=>{"use strict";var Ay=Mt&&Mt.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),KR=Mt&&Mt.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),by=Mt&&Mt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&Ay(e,t,n);return KR(e,t),e},YR=Mt&&Mt.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Ay(e,t,n)};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Agent=void 0;var XR=by(X("net")),Cy=by(X("http")),ZR=X("https");YR(wy(),Mt);var Nn=Symbol("AgentBaseInternalState"),Sd=class extends Cy.Agent{constructor(e){super(e),this[Nn]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let n=new XR.Socket({writable:!1});return this.sockets[e].push(n),this.totalSocketCount++,n}decrementSockets(e,n){if(!this.sockets[e]||n===null)return;let r=this.sockets[e],i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.totalSocketCount--,r.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?ZR.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,n,r){let i={...n,secureEndpoint:this.isSecureEndpoint(n)},s=this.getName(i),o=this.incrementSockets(s);Promise.resolve().then(()=>this.connect(e,i)).then(a=>{if(this.decrementSockets(s,o),a instanceof Cy.Agent)try{return a.addRequest(e,i)}catch(d){return r(d)}this[Nn].currentSocket=a,super.createSocket(e,n,r)},a=>{this.decrementSockets(s,o),r(a)})}createConnection(){let e=this[Nn].currentSocket;if(this[Nn].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[Nn].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[Nn]&&(this[Nn].defaultPort=e)}get protocol(){return this[Nn].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[Nn]&&(this[Nn].protocol=e)}};Mt.Agent=Sd});var Iy=z(hs=>{"use strict";var QR=hs&&hs.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(hs,"__esModule",{value:!0});hs.parseProxyResponse=void 0;var jR=QR(vd()),ol=(0,jR.default)("https-proxy-agent:parse-proxy-response");function eI(t){return new Promise((e,n)=>{let r=0,i=[];function s(){let h=t.read();h?u(h):t.once("readable",s)}function o(){t.removeListener("end",a),t.removeListener("error",d),t.removeListener("readable",s)}function a(){o(),ol("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function d(h){o(),ol("onerror %o",h),n(h)}function u(h){i.push(h),r+=h.length;let m=Buffer.concat(i,r),g=m.indexOf(`\r
\r
`);if(g===-1){ol("have not received end of HTTP headers yet..."),s();return}let _=m.slice(0,g).toString("ascii").split(`\r
`),v=_.shift();if(!v)return t.destroy(),n(new Error("No header received from proxy CONNECT response"));let w=v.split(" "),T=+w[1],A=w.slice(2).join(" "),G={};for(let F of _){if(!F)continue;let B=F.indexOf(":");if(B===-1)return t.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${F}"`));let H=F.slice(0,B).toLowerCase(),q=F.slice(B+1).trimStart(),$=G[H];typeof $=="string"?G[H]=[$,q]:Array.isArray($)?$.push(q):G[H]=q}ol("got proxy server response: %o %o",v,G),o(),e({connect:{statusCode:T,statusText:A,headers:G},buffered:m})}t.on("error",d),t.on("end",a),s()})}hs.parseProxyResponse=eI});var Oy=z(Xt=>{"use strict";var tI=Xt&&Xt.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),nI=Xt&&Xt.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),Ny=Xt&&Xt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&tI(e,t,n);return nI(e,t),e},My=Xt&&Xt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.HttpsProxyAgent=void 0;var al=Ny(X("net")),Py=Ny(X("tls")),rI=My(X("assert")),iI=My(vd()),sI=Ry(),oI=X("url"),aI=Iy(),_o=(0,iI.default)("https-proxy-agent"),xy=t=>t.servername===void 0&&t.host&&!al.isIP(t.host)?{...t,servername:t.host}:t,ll=class extends sI.Agent{constructor(e,n){super(n),this.options={path:void 0},this.proxy=typeof e=="string"?new oI.URL(e):e,this.proxyHeaders=n?.headers??{},_o("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?ky(n,"headers"):null,host:r,port:i}}async connect(e,n){let{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let i;r.protocol==="https:"?(_o("Creating `tls.Socket`: %o",this.connectOpts),i=Py.connect(xy(this.connectOpts))):(_o("Creating `net.Socket`: %o",this.connectOpts),i=al.connect(this.connectOpts));let s=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},o=al.isIPv6(n.host)?`[${n.host}]`:n.host,a=`CONNECT ${o}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){let g=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;s["Proxy-Authorization"]=`Basic ${Buffer.from(g).toString("base64")}`}s.Host=`${o}:${n.port}`,s["Proxy-Connection"]||(s["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let g of Object.keys(s))a+=`${g}: ${s[g]}\r
`;let d=(0,aI.parseProxyResponse)(i);i.write(`${a}\r
`);let{connect:u,buffered:h}=await d;if(e.emit("proxyConnect",u),this.emit("proxyConnect",u,e),u.statusCode===200)return e.once("socket",lI),n.secureEndpoint?(_o("Upgrading socket connection to TLS"),Py.connect({...ky(xy(n),"host","path","port"),socket:i})):i;i.destroy();let m=new al.Socket({writable:!1});return m.readable=!0,e.once("socket",g=>{_o("Replaying proxy buffer for failed request"),(0,rI.default)(g.listenerCount("data")>0),g.push(h),g.push(null)}),m}};ll.protocols=["http","https"];Xt.HttpsProxyAgent=ll;function lI(t){t.resume()}function ky(t,...e){let n={},r;for(r in t)e.includes(r)||(n[r]=t[r]);return n}});function uI(t){if(!/^data:/i.test(t))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');t=t.replace(/\r?\n/g,"");let e=t.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let n=t.substring(5,e).split(";"),r="",i=!1,s=n[0]||"text/plain",o=s;for(let h=1;h<n.length;h++)n[h]==="base64"?i=!0:n[h]&&(o+=`;${n[h]}`,n[h].indexOf("charset=")===0&&(r=n[h].substring(8)));!n[0]&&!r.length&&(o+=";charset=US-ASCII",r="US-ASCII");let a=i?"base64":"ascii",d=unescape(t.substring(e+1)),u=Buffer.from(d,a);return u.type=s,u.typeFull=o,u.charset=r,u}var Dy,Uy=Xe(()=>{Dy=uI});var Fy=z((ul,Ly)=>{(function(t,e){typeof ul=="object"&&typeof Ly<"u"?e(ul):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.WebStreamsPolyfill={}))})(ul,(function(t){"use strict";function e(){}function n(f){return typeof f=="object"&&f!==null||typeof f=="function"}let r=e;function i(f,p){try{Object.defineProperty(f,"name",{value:p,configurable:!0})}catch{}}let s=Promise,o=Promise.prototype.then,a=Promise.reject.bind(s);function d(f){return new s(f)}function u(f){return d(p=>p(f))}function h(f){return a(f)}function m(f,p,y){return o.call(f,p,y)}function g(f,p,y){m(m(f,p,y),void 0,r)}function _(f,p){g(f,p)}function v(f,p){g(f,void 0,p)}function w(f,p,y){return m(f,p,y)}function T(f){m(f,void 0,r)}let A=f=>{if(typeof queueMicrotask=="function")A=queueMicrotask;else{let p=u(void 0);A=y=>m(p,y)}return A(f)};function G(f,p,y){if(typeof f!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(f,p,y)}function F(f,p,y){try{return u(G(f,p,y))}catch(S){return h(S)}}let B=16384;class H{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(p){let y=this._back,S=y;y._elements.length===B-1&&(S={_elements:[],_next:void 0}),y._elements.push(p),S!==y&&(this._back=S,y._next=S),++this._size}shift(){let p=this._front,y=p,S=this._cursor,R=S+1,D=p._elements,V=D[S];return R===B&&(y=p._next,R=0),--this._size,this._cursor=R,p!==y&&(this._front=y),D[S]=void 0,V}forEach(p){let y=this._cursor,S=this._front,R=S._elements;for(;(y!==R.length||S._next!==void 0)&&!(y===R.length&&(S=S._next,R=S._elements,y=0,R.length===0));)p(R[y]),++y}peek(){let p=this._front,y=this._cursor;return p._elements[y]}}let q=Symbol("[[AbortSteps]]"),$=Symbol("[[ErrorSteps]]"),Y=Symbol("[[CancelSteps]]"),L=Symbol("[[PullSteps]]"),te=Symbol("[[ReleaseSteps]]");function oe(f,p){f._ownerReadableStream=p,p._reader=f,p._state==="readable"?Me(f):p._state==="closed"?Pe(f):Oe(f,p._storedError)}function fe(f,p){let y=f._ownerReadableStream;return an(y,p)}function le(f){let p=f._ownerReadableStream;p._state==="readable"?et(f,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):ut(f,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),p._readableStreamController[te](),p._reader=void 0,f._ownerReadableStream=void 0}function ve(f){return new TypeError("Cannot "+f+" a stream using a released reader")}function Me(f){f._closedPromise=d((p,y)=>{f._closedPromise_resolve=p,f._closedPromise_reject=y})}function Oe(f,p){Me(f),et(f,p)}function Pe(f){Me(f),Ui(f)}function et(f,p){f._closedPromise_reject!==void 0&&(T(f._closedPromise),f._closedPromise_reject(p),f._closedPromise_resolve=void 0,f._closedPromise_reject=void 0)}function ut(f,p){Oe(f,p)}function Ui(f){f._closedPromise_resolve!==void 0&&(f._closedPromise_resolve(void 0),f._closedPromise_resolve=void 0,f._closedPromise_reject=void 0)}let An=Number.isFinite||function(f){return typeof f=="number"&&isFinite(f)},eo=Math.trunc||function(f){return f<0?Math.ceil(f):Math.floor(f)};function K(f){return typeof f=="object"||typeof f=="function"}function _t(f,p){if(f!==void 0&&!K(f))throw new TypeError(`${p} is not an object.`)}function ct(f,p){if(typeof f!="function")throw new TypeError(`${p} is not a function.`)}function to(f){return typeof f=="object"&&f!==null||typeof f=="function"}function dt(f,p){if(!to(f))throw new TypeError(`${p} is not an object.`)}function ze(f,p,y){if(f===void 0)throw new TypeError(`Parameter ${p} is required in '${y}'.`)}function E(f,p,y){if(f===void 0)throw new TypeError(`${p} is required in '${y}'.`)}function C(f){return Number(f)}function b(f){return f===0?0:f}function M(f){return b(eo(f))}function P(f,p){let S=Number.MAX_SAFE_INTEGER,R=Number(f);if(R=b(R),!An(R))throw new TypeError(`${p} is not a finite number`);if(R=M(R),R<0||R>S)throw new TypeError(`${p} is outside the accepted range of 0 to ${S}, inclusive`);return!An(R)||R===0?0:R}function k(f,p){if(!Tr(f))throw new TypeError(`${p} is not a ReadableStream.`)}function U(f){return new W(f)}function I(f,p){f._reader._readRequests.push(p)}function x(f,p,y){let R=f._reader._readRequests.shift();y?R._closeSteps():R._chunkSteps(p)}function O(f){return f._reader._readRequests.length}function N(f){let p=f._reader;return!(p===void 0||!ne(p))}class W{constructor(p){if(ze(p,1,"ReadableStreamDefaultReader"),k(p,"First parameter"),wr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");oe(this,p),this._readRequests=new H}get closed(){return ne(this)?this._closedPromise:h(Ge("closed"))}cancel(p=void 0){return ne(this)?this._ownerReadableStream===void 0?h(ve("cancel")):fe(this,p):h(Ge("cancel"))}read(){if(!ne(this))return h(Ge("read"));if(this._ownerReadableStream===void 0)return h(ve("read from"));let p,y,S=d((D,V)=>{p=D,y=V});return se(this,{_chunkSteps:D=>p({value:D,done:!1}),_closeSteps:()=>p({value:void 0,done:!0}),_errorSteps:D=>y(D)}),S}releaseLock(){if(!ne(this))throw Ge("releaseLock");this._ownerReadableStream!==void 0&&Ie(this)}}Object.defineProperties(W.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(W.prototype.cancel,"cancel"),i(W.prototype.read,"read"),i(W.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(W.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function ne(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_readRequests")?!1:f instanceof W}function se(f,p){let y=f._ownerReadableStream;y._disturbed=!0,y._state==="closed"?p._closeSteps():y._state==="errored"?p._errorSteps(y._storedError):y._readableStreamController[L](p)}function Ie(f){le(f);let p=new TypeError("Reader was released");Be(f,p)}function Be(f,p){let y=f._readRequests;f._readRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function Ge(f){return new TypeError(`ReadableStreamDefaultReader.prototype.${f} can only be used on a ReadableStreamDefaultReader`)}let be=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Ne{constructor(p,y){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=p,this._preventCancel=y}next(){let p=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?w(this._ongoingPromise,p,p):p(),this._ongoingPromise}return(p){let y=()=>this._returnSteps(p);return this._ongoingPromise?w(this._ongoingPromise,y,y):y()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let p=this._reader,y,S,R=d((V,j)=>{y=V,S=j});return se(p,{_chunkSteps:V=>{this._ongoingPromise=void 0,A(()=>y({value:V,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,le(p),y({value:void 0,done:!0})},_errorSteps:V=>{this._ongoingPromise=void 0,this._isFinished=!0,le(p),S(V)}}),R}_returnSteps(p){if(this._isFinished)return Promise.resolve({value:p,done:!0});this._isFinished=!0;let y=this._reader;if(!this._preventCancel){let S=fe(y,p);return le(y),w(S,()=>({value:p,done:!0}))}return le(y),u({value:p,done:!0})}}let Ke={next(){return Fi(this)?this._asyncIteratorImpl.next():h(qi("next"))},return(f){return Fi(this)?this._asyncIteratorImpl.return(f):h(qi("return"))}};Object.setPrototypeOf(Ke,be);function Li(f,p){let y=U(f),S=new Ne(y,p),R=Object.create(Ke);return R._asyncIteratorImpl=S,R}function Fi(f){if(!n(f)||!Object.prototype.hasOwnProperty.call(f,"_asyncIteratorImpl"))return!1;try{return f._asyncIteratorImpl instanceof Ne}catch{return!1}}function qi(f){return new TypeError(`ReadableStreamAsyncIterator.${f} can only be used on a ReadableSteamAsyncIterator`)}let It=Number.isNaN||function(f){return f!==f};var $n,it,Ye;function De(f){return f.slice()}function sm(f,p,y,S,R){new Uint8Array(f).set(new Uint8Array(y,S,R),p)}let Wn=f=>(typeof f.transfer=="function"?Wn=p=>p.transfer():typeof structuredClone=="function"?Wn=p=>structuredClone(p,{transfer:[p]}):Wn=p=>p,Wn(f)),_r=f=>(typeof f.detached=="boolean"?_r=p=>p.detached:_r=p=>p.byteLength===0,_r(f));function om(f,p,y){if(f.slice)return f.slice(p,y);let S=y-p,R=new ArrayBuffer(S);return sm(R,0,f,p,S),R}function oa(f,p){let y=f[p];if(y!=null){if(typeof y!="function")throw new TypeError(`${String(p)} is not a function`);return y}}function mC(f){let p={[Symbol.iterator]:()=>f.iterator},y=(async function*(){return yield*p})(),S=y.next;return{iterator:y,nextMethod:S,done:!1}}let _c=(Ye=($n=Symbol.asyncIterator)!==null&&$n!==void 0?$n:(it=Symbol.for)===null||it===void 0?void 0:it.call(Symbol,"Symbol.asyncIterator"))!==null&&Ye!==void 0?Ye:"@@asyncIterator";function am(f,p="sync",y){if(y===void 0)if(p==="async"){if(y=oa(f,_c),y===void 0){let D=oa(f,Symbol.iterator),V=am(f,"sync",D);return mC(V)}}else y=oa(f,Symbol.iterator);if(y===void 0)throw new TypeError("The object is not iterable");let S=G(y,f,[]);if(!n(S))throw new TypeError("The iterator method must return an object");let R=S.next;return{iterator:S,nextMethod:R,done:!1}}function gC(f){let p=G(f.nextMethod,f.iterator,[]);if(!n(p))throw new TypeError("The iterator.next() method must return an object");return p}function yC(f){return!!f.done}function _C(f){return f.value}function EC(f){return!(typeof f!="number"||It(f)||f<0)}function lm(f){let p=om(f.buffer,f.byteOffset,f.byteOffset+f.byteLength);return new Uint8Array(p)}function Ec(f){let p=f._queue.shift();return f._queueTotalSize-=p.size,f._queueTotalSize<0&&(f._queueTotalSize=0),p.value}function vc(f,p,y){if(!EC(y)||y===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");f._queue.push({value:p,size:y}),f._queueTotalSize+=y}function vC(f){return f._queue.peek().value}function Er(f){f._queue=new H,f._queueTotalSize=0}function um(f){return f===DataView}function SC(f){return um(f.constructor)}function TC(f){return um(f)?1:f.BYTES_PER_ELEMENT}class Jr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Sc(this))throw bc("view");return this._view}respond(p){if(!Sc(this))throw bc("respond");if(ze(p,1,"respond"),p=P(p,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");ca(this._associatedReadableByteStreamController,p)}respondWithNewView(p){if(!Sc(this))throw bc("respondWithNewView");if(ze(p,1,"respondWithNewView"),!ArrayBuffer.isView(p))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(p.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");da(this._associatedReadableByteStreamController,p)}}Object.defineProperties(Jr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(Jr.prototype.respond,"respond"),i(Jr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Jr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Jn{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!zr(this))throw ro("byobRequest");return Ac(this)}get desiredSize(){if(!zr(this))throw ro("desiredSize");return Em(this)}close(){if(!zr(this))throw ro("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let p=this._controlledReadableByteStream._state;if(p!=="readable")throw new TypeError(`The stream (in ${p} state) is not in the readable state and cannot be closed`);no(this)}enqueue(p){if(!zr(this))throw ro("enqueue");if(ze(p,1,"enqueue"),!ArrayBuffer.isView(p))throw new TypeError("chunk must be an array buffer view");if(p.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(p.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let y=this._controlledReadableByteStream._state;if(y!=="readable")throw new TypeError(`The stream (in ${y} state) is not in the readable state and cannot be enqueued to`);ua(this,p)}error(p=void 0){if(!zr(this))throw ro("error");Vt(this,p)}[Y](p){cm(this),Er(this);let y=this._cancelAlgorithm(p);return la(this),y}[L](p){let y=this._controlledReadableByteStream;if(this._queueTotalSize>0){_m(this,p);return}let S=this._autoAllocateChunkSize;if(S!==void 0){let R;try{R=new ArrayBuffer(S)}catch(V){p._errorSteps(V);return}let D={buffer:R,bufferByteLength:S,byteOffset:0,byteLength:S,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(D)}I(y,p),Kr(this)}[te](){if(this._pendingPullIntos.length>0){let p=this._pendingPullIntos.peek();p.readerType="none",this._pendingPullIntos=new H,this._pendingPullIntos.push(p)}}}Object.defineProperties(Jn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Jn.prototype.close,"close"),i(Jn.prototype.enqueue,"enqueue"),i(Jn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Jn.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function zr(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_controlledReadableByteStream")?!1:f instanceof Jn}function Sc(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_associatedReadableByteStreamController")?!1:f instanceof Jr}function Kr(f){if(!RC(f))return;if(f._pulling){f._pullAgain=!0;return}f._pulling=!0;let y=f._pullAlgorithm();g(y,()=>(f._pulling=!1,f._pullAgain&&(f._pullAgain=!1,Kr(f)),null),S=>(Vt(f,S),null))}function cm(f){wc(f),f._pendingPullIntos=new H}function Tc(f,p){let y=!1;f._state==="closed"&&(y=!0);let S=dm(p);p.readerType==="default"?x(f,S,y):MC(f,S,y)}function dm(f){let p=f.bytesFilled,y=f.elementSize;return new f.viewConstructor(f.buffer,f.byteOffset,p/y)}function aa(f,p,y,S){f._queue.push({buffer:p,byteOffset:y,byteLength:S}),f._queueTotalSize+=S}function fm(f,p,y,S){let R;try{R=om(p,y,y+S)}catch(D){throw Vt(f,D),D}aa(f,R,0,S)}function hm(f,p){p.bytesFilled>0&&fm(f,p.buffer,p.byteOffset,p.bytesFilled),Bi(f)}function pm(f,p){let y=Math.min(f._queueTotalSize,p.byteLength-p.bytesFilled),S=p.bytesFilled+y,R=y,D=!1,V=S%p.elementSize,j=S-V;j>=p.minimumFill&&(R=j-p.bytesFilled,D=!0);let me=f._queue;for(;R>0;){let ae=me.peek(),ye=Math.min(R,ae.byteLength),we=p.byteOffset+p.bytesFilled;sm(p.buffer,we,ae.buffer,ae.byteOffset,ye),ae.byteLength===ye?me.shift():(ae.byteOffset+=ye,ae.byteLength-=ye),f._queueTotalSize-=ye,mm(f,ye,p),R-=ye}return D}function mm(f,p,y){y.bytesFilled+=p}function gm(f){f._queueTotalSize===0&&f._closeRequested?(la(f),uo(f._controlledReadableByteStream)):Kr(f)}function wc(f){f._byobRequest!==null&&(f._byobRequest._associatedReadableByteStreamController=void 0,f._byobRequest._view=null,f._byobRequest=null)}function Cc(f){for(;f._pendingPullIntos.length>0;){if(f._queueTotalSize===0)return;let p=f._pendingPullIntos.peek();pm(f,p)&&(Bi(f),Tc(f._controlledReadableByteStream,p))}}function wC(f){let p=f._controlledReadableByteStream._reader;for(;p._readRequests.length>0;){if(f._queueTotalSize===0)return;let y=p._readRequests.shift();_m(f,y)}}function CC(f,p,y,S){let R=f._controlledReadableByteStream,D=p.constructor,V=TC(D),{byteOffset:j,byteLength:me}=p,ae=y*V,ye;try{ye=Wn(p.buffer)}catch(Le){S._errorSteps(Le);return}let we={buffer:ye,bufferByteLength:ye.byteLength,byteOffset:j,byteLength:me,bytesFilled:0,minimumFill:ae,elementSize:V,viewConstructor:D,readerType:"byob"};if(f._pendingPullIntos.length>0){f._pendingPullIntos.push(we),Tm(R,S);return}if(R._state==="closed"){let Le=new D(we.buffer,we.byteOffset,0);S._closeSteps(Le);return}if(f._queueTotalSize>0){if(pm(f,we)){let Le=dm(we);gm(f),S._chunkSteps(Le);return}if(f._closeRequested){let Le=new TypeError("Insufficient bytes to fill elements in the given buffer");Vt(f,Le),S._errorSteps(Le);return}}f._pendingPullIntos.push(we),Tm(R,S),Kr(f)}function AC(f,p){p.readerType==="none"&&Bi(f);let y=f._controlledReadableByteStream;if(Rc(y))for(;wm(y)>0;){let S=Bi(f);Tc(y,S)}}function bC(f,p,y){if(mm(f,p,y),y.readerType==="none"){hm(f,y),Cc(f);return}if(y.bytesFilled<y.minimumFill)return;Bi(f);let S=y.bytesFilled%y.elementSize;if(S>0){let R=y.byteOffset+y.bytesFilled;fm(f,y.buffer,R-S,S)}y.bytesFilled-=S,Tc(f._controlledReadableByteStream,y),Cc(f)}function ym(f,p){let y=f._pendingPullIntos.peek();wc(f),f._controlledReadableByteStream._state==="closed"?AC(f,y):bC(f,p,y),Kr(f)}function Bi(f){return f._pendingPullIntos.shift()}function RC(f){let p=f._controlledReadableByteStream;return p._state!=="readable"||f._closeRequested||!f._started?!1:!!(N(p)&&O(p)>0||Rc(p)&&wm(p)>0||Em(f)>0)}function la(f){f._pullAlgorithm=void 0,f._cancelAlgorithm=void 0}function no(f){let p=f._controlledReadableByteStream;if(!(f._closeRequested||p._state!=="readable")){if(f._queueTotalSize>0){f._closeRequested=!0;return}if(f._pendingPullIntos.length>0){let y=f._pendingPullIntos.peek();if(y.bytesFilled%y.elementSize!==0){let S=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Vt(f,S),S}}la(f),uo(p)}}function ua(f,p){let y=f._controlledReadableByteStream;if(f._closeRequested||y._state!=="readable")return;let{buffer:S,byteOffset:R,byteLength:D}=p;if(_r(S))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let V=Wn(S);if(f._pendingPullIntos.length>0){let j=f._pendingPullIntos.peek();if(_r(j.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");wc(f),j.buffer=Wn(j.buffer),j.readerType==="none"&&hm(f,j)}if(N(y))if(wC(f),O(y)===0)aa(f,V,R,D);else{f._pendingPullIntos.length>0&&Bi(f);let j=new Uint8Array(V,R,D);x(y,j,!1)}else Rc(y)?(aa(f,V,R,D),Cc(f)):aa(f,V,R,D);Kr(f)}function Vt(f,p){let y=f._controlledReadableByteStream;y._state==="readable"&&(cm(f),Er(f),la(f),zm(y,p))}function _m(f,p){let y=f._queue.shift();f._queueTotalSize-=y.byteLength,gm(f);let S=new Uint8Array(y.buffer,y.byteOffset,y.byteLength);p._chunkSteps(S)}function Ac(f){if(f._byobRequest===null&&f._pendingPullIntos.length>0){let p=f._pendingPullIntos.peek(),y=new Uint8Array(p.buffer,p.byteOffset+p.bytesFilled,p.byteLength-p.bytesFilled),S=Object.create(Jr.prototype);PC(S,f,y),f._byobRequest=S}return f._byobRequest}function Em(f){let p=f._controlledReadableByteStream._state;return p==="errored"?null:p==="closed"?0:f._strategyHWM-f._queueTotalSize}function ca(f,p){let y=f._pendingPullIntos.peek();if(f._controlledReadableByteStream._state==="closed"){if(p!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(p===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(y.bytesFilled+p>y.byteLength)throw new RangeError("bytesWritten out of range")}y.buffer=Wn(y.buffer),ym(f,p)}function da(f,p){let y=f._pendingPullIntos.peek();if(f._controlledReadableByteStream._state==="closed"){if(p.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(p.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(y.byteOffset+y.bytesFilled!==p.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(y.bufferByteLength!==p.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(y.bytesFilled+p.byteLength>y.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let R=p.byteLength;y.buffer=Wn(p.buffer),ym(f,R)}function vm(f,p,y,S,R,D,V){p._controlledReadableByteStream=f,p._pullAgain=!1,p._pulling=!1,p._byobRequest=null,p._queue=p._queueTotalSize=void 0,Er(p),p._closeRequested=!1,p._started=!1,p._strategyHWM=D,p._pullAlgorithm=S,p._cancelAlgorithm=R,p._autoAllocateChunkSize=V,p._pendingPullIntos=new H,f._readableStreamController=p;let j=y();g(u(j),()=>(p._started=!0,Kr(p),null),me=>(Vt(p,me),null))}function IC(f,p,y){let S=Object.create(Jn.prototype),R,D,V;p.start!==void 0?R=()=>p.start(S):R=()=>{},p.pull!==void 0?D=()=>p.pull(S):D=()=>u(void 0),p.cancel!==void 0?V=me=>p.cancel(me):V=()=>u(void 0);let j=p.autoAllocateChunkSize;if(j===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");vm(f,S,R,D,V,y,j)}function PC(f,p,y){f._associatedReadableByteStreamController=p,f._view=y}function bc(f){return new TypeError(`ReadableStreamBYOBRequest.prototype.${f} can only be used on a ReadableStreamBYOBRequest`)}function ro(f){return new TypeError(`ReadableByteStreamController.prototype.${f} can only be used on a ReadableByteStreamController`)}function xC(f,p){_t(f,p);let y=f?.mode;return{mode:y===void 0?void 0:kC(y,`${p} has member 'mode' that`)}}function kC(f,p){if(f=`${f}`,f!=="byob")throw new TypeError(`${p} '${f}' is not a valid enumeration value for ReadableStreamReaderMode`);return f}function NC(f,p){var y;_t(f,p);let S=(y=f?.min)!==null&&y!==void 0?y:1;return{min:P(S,`${p} has member 'min' that`)}}function Sm(f){return new vr(f)}function Tm(f,p){f._reader._readIntoRequests.push(p)}function MC(f,p,y){let R=f._reader._readIntoRequests.shift();y?R._closeSteps(p):R._chunkSteps(p)}function wm(f){return f._reader._readIntoRequests.length}function Rc(f){let p=f._reader;return!(p===void 0||!Yr(p))}class vr{constructor(p){if(ze(p,1,"ReadableStreamBYOBReader"),k(p,"First parameter"),wr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!zr(p._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");oe(this,p),this._readIntoRequests=new H}get closed(){return Yr(this)?this._closedPromise:h(fa("closed"))}cancel(p=void 0){return Yr(this)?this._ownerReadableStream===void 0?h(ve("cancel")):fe(this,p):h(fa("cancel"))}read(p,y={}){if(!Yr(this))return h(fa("read"));if(!ArrayBuffer.isView(p))return h(new TypeError("view must be an array buffer view"));if(p.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(p.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(_r(p.buffer))return h(new TypeError("view's buffer has been detached"));let S;try{S=NC(y,"options")}catch(ae){return h(ae)}let R=S.min;if(R===0)return h(new TypeError("options.min must be greater than 0"));if(SC(p)){if(R>p.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(R>p.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(ve("read from"));let D,V,j=d((ae,ye)=>{D=ae,V=ye});return Cm(this,p,R,{_chunkSteps:ae=>D({value:ae,done:!1}),_closeSteps:ae=>D({value:ae,done:!0}),_errorSteps:ae=>V(ae)}),j}releaseLock(){if(!Yr(this))throw fa("releaseLock");this._ownerReadableStream!==void 0&&OC(this)}}Object.defineProperties(vr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(vr.prototype.cancel,"cancel"),i(vr.prototype.read,"read"),i(vr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Yr(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_readIntoRequests")?!1:f instanceof vr}function Cm(f,p,y,S){let R=f._ownerReadableStream;R._disturbed=!0,R._state==="errored"?S._errorSteps(R._storedError):CC(R._readableStreamController,p,y,S)}function OC(f){le(f);let p=new TypeError("Reader was released");Am(f,p)}function Am(f,p){let y=f._readIntoRequests;f._readIntoRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function fa(f){return new TypeError(`ReadableStreamBYOBReader.prototype.${f} can only be used on a ReadableStreamBYOBReader`)}function io(f,p){let{highWaterMark:y}=f;if(y===void 0)return p;if(It(y)||y<0)throw new RangeError("Invalid highWaterMark");return y}function ha(f){let{size:p}=f;return p||(()=>1)}function pa(f,p){_t(f,p);let y=f?.highWaterMark,S=f?.size;return{highWaterMark:y===void 0?void 0:C(y),size:S===void 0?void 0:DC(S,`${p} has member 'size' that`)}}function DC(f,p){return ct(f,p),y=>C(f(y))}function UC(f,p){_t(f,p);let y=f?.abort,S=f?.close,R=f?.start,D=f?.type,V=f?.write;return{abort:y===void 0?void 0:LC(y,f,`${p} has member 'abort' that`),close:S===void 0?void 0:FC(S,f,`${p} has member 'close' that`),start:R===void 0?void 0:qC(R,f,`${p} has member 'start' that`),write:V===void 0?void 0:BC(V,f,`${p} has member 'write' that`),type:D}}function LC(f,p,y){return ct(f,y),S=>F(f,p,[S])}function FC(f,p,y){return ct(f,y),()=>F(f,p,[])}function qC(f,p,y){return ct(f,y),S=>G(f,p,[S])}function BC(f,p,y){return ct(f,y),(S,R)=>F(f,p,[S,R])}function bm(f,p){if(!Gi(f))throw new TypeError(`${p} is not a WritableStream.`)}function GC(f){if(typeof f!="object"||f===null)return!1;try{return typeof f.aborted=="boolean"}catch{return!1}}let HC=typeof AbortController=="function";function VC(){if(HC)return new AbortController}class Sr{constructor(p={},y={}){p===void 0?p=null:dt(p,"First parameter");let S=pa(y,"Second parameter"),R=UC(p,"First parameter");if(Im(this),R.type!==void 0)throw new RangeError("Invalid type is specified");let V=ha(S),j=io(S,1);rA(this,R,j,V)}get locked(){if(!Gi(this))throw Ea("locked");return Hi(this)}abort(p=void 0){return Gi(this)?Hi(this)?h(new TypeError("Cannot abort a stream that already has a writer")):ma(this,p):h(Ea("abort"))}close(){return Gi(this)?Hi(this)?h(new TypeError("Cannot close a stream that already has a writer")):bn(this)?h(new TypeError("Cannot close an already-closing stream")):Pm(this):h(Ea("close"))}getWriter(){if(!Gi(this))throw Ea("getWriter");return Rm(this)}}Object.defineProperties(Sr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(Sr.prototype.abort,"abort"),i(Sr.prototype.close,"close"),i(Sr.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Sr.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Rm(f){return new zn(f)}function $C(f,p,y,S,R=1,D=()=>1){let V=Object.create(Sr.prototype);Im(V);let j=Object.create(Vi.prototype);return Dm(V,j,f,p,y,S,R,D),V}function Im(f){f._state="writable",f._storedError=void 0,f._writer=void 0,f._writableStreamController=void 0,f._writeRequests=new H,f._inFlightWriteRequest=void 0,f._closeRequest=void 0,f._inFlightCloseRequest=void 0,f._pendingAbortRequest=void 0,f._backpressure=!1}function Gi(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_writableStreamController")?!1:f instanceof Sr}function Hi(f){return f._writer!==void 0}function ma(f,p){var y;if(f._state==="closed"||f._state==="errored")return u(void 0);f._writableStreamController._abortReason=p,(y=f._writableStreamController._abortController)===null||y===void 0||y.abort(p);let S=f._state;if(S==="closed"||S==="errored")return u(void 0);if(f._pendingAbortRequest!==void 0)return f._pendingAbortRequest._promise;let R=!1;S==="erroring"&&(R=!0,p=void 0);let D=d((V,j)=>{f._pendingAbortRequest={_promise:void 0,_resolve:V,_reject:j,_reason:p,_wasAlreadyErroring:R}});return f._pendingAbortRequest._promise=D,R||Pc(f,p),D}function Pm(f){let p=f._state;if(p==="closed"||p==="errored")return h(new TypeError(`The stream (in ${p} state) is not in the writable state and cannot be closed`));let y=d((R,D)=>{let V={_resolve:R,_reject:D};f._closeRequest=V}),S=f._writer;return S!==void 0&&f._backpressure&&p==="writable"&&Lc(S),iA(f._writableStreamController),y}function WC(f){return d((y,S)=>{let R={_resolve:y,_reject:S};f._writeRequests.push(R)})}function Ic(f,p){if(f._state==="writable"){Pc(f,p);return}xc(f)}function Pc(f,p){let y=f._writableStreamController;f._state="erroring",f._storedError=p;let S=f._writer;S!==void 0&&km(S,p),!XC(f)&&y._started&&xc(f)}function xc(f){f._state="errored",f._writableStreamController[$]();let p=f._storedError;if(f._writeRequests.forEach(R=>{R._reject(p)}),f._writeRequests=new H,f._pendingAbortRequest===void 0){ga(f);return}let y=f._pendingAbortRequest;if(f._pendingAbortRequest=void 0,y._wasAlreadyErroring){y._reject(p),ga(f);return}let S=f._writableStreamController[q](y._reason);g(S,()=>(y._resolve(),ga(f),null),R=>(y._reject(R),ga(f),null))}function JC(f){f._inFlightWriteRequest._resolve(void 0),f._inFlightWriteRequest=void 0}function zC(f,p){f._inFlightWriteRequest._reject(p),f._inFlightWriteRequest=void 0,Ic(f,p)}function KC(f){f._inFlightCloseRequest._resolve(void 0),f._inFlightCloseRequest=void 0,f._state==="erroring"&&(f._storedError=void 0,f._pendingAbortRequest!==void 0&&(f._pendingAbortRequest._resolve(),f._pendingAbortRequest=void 0)),f._state="closed";let y=f._writer;y!==void 0&&qm(y)}function YC(f,p){f._inFlightCloseRequest._reject(p),f._inFlightCloseRequest=void 0,f._pendingAbortRequest!==void 0&&(f._pendingAbortRequest._reject(p),f._pendingAbortRequest=void 0),Ic(f,p)}function bn(f){return!(f._closeRequest===void 0&&f._inFlightCloseRequest===void 0)}function XC(f){return!(f._inFlightWriteRequest===void 0&&f._inFlightCloseRequest===void 0)}function ZC(f){f._inFlightCloseRequest=f._closeRequest,f._closeRequest=void 0}function QC(f){f._inFlightWriteRequest=f._writeRequests.shift()}function ga(f){f._closeRequest!==void 0&&(f._closeRequest._reject(f._storedError),f._closeRequest=void 0);let p=f._writer;p!==void 0&&Dc(p,f._storedError)}function kc(f,p){let y=f._writer;y!==void 0&&p!==f._backpressure&&(p?dA(y):Lc(y)),f._backpressure=p}class zn{constructor(p){if(ze(p,1,"WritableStreamDefaultWriter"),bm(p,"First parameter"),Hi(p))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=p,p._writer=this;let y=p._state;if(y==="writable")!bn(p)&&p._backpressure?Sa(this):Bm(this),va(this);else if(y==="erroring")Uc(this,p._storedError),va(this);else if(y==="closed")Bm(this),uA(this);else{let S=p._storedError;Uc(this,S),Fm(this,S)}}get closed(){return Xr(this)?this._closedPromise:h(Zr("closed"))}get desiredSize(){if(!Xr(this))throw Zr("desiredSize");if(this._ownerWritableStream===void 0)throw oo("desiredSize");return nA(this)}get ready(){return Xr(this)?this._readyPromise:h(Zr("ready"))}abort(p=void 0){return Xr(this)?this._ownerWritableStream===void 0?h(oo("abort")):jC(this,p):h(Zr("abort"))}close(){if(!Xr(this))return h(Zr("close"));let p=this._ownerWritableStream;return p===void 0?h(oo("close")):bn(p)?h(new TypeError("Cannot close an already-closing stream")):xm(this)}releaseLock(){if(!Xr(this))throw Zr("releaseLock");this._ownerWritableStream!==void 0&&Nm(this)}write(p=void 0){return Xr(this)?this._ownerWritableStream===void 0?h(oo("write to")):Mm(this,p):h(Zr("write"))}}Object.defineProperties(zn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(zn.prototype.abort,"abort"),i(zn.prototype.close,"close"),i(zn.prototype.releaseLock,"releaseLock"),i(zn.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(zn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Xr(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_ownerWritableStream")?!1:f instanceof zn}function jC(f,p){let y=f._ownerWritableStream;return ma(y,p)}function xm(f){let p=f._ownerWritableStream;return Pm(p)}function eA(f){let p=f._ownerWritableStream,y=p._state;return bn(p)||y==="closed"?u(void 0):y==="errored"?h(p._storedError):xm(f)}function tA(f,p){f._closedPromiseState==="pending"?Dc(f,p):cA(f,p)}function km(f,p){f._readyPromiseState==="pending"?Gm(f,p):fA(f,p)}function nA(f){let p=f._ownerWritableStream,y=p._state;return y==="errored"||y==="erroring"?null:y==="closed"?0:Um(p._writableStreamController)}function Nm(f){let p=f._ownerWritableStream,y=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");km(f,y),tA(f,y),p._writer=void 0,f._ownerWritableStream=void 0}function Mm(f,p){let y=f._ownerWritableStream,S=y._writableStreamController,R=sA(S,p);if(y!==f._ownerWritableStream)return h(oo("write to"));let D=y._state;if(D==="errored")return h(y._storedError);if(bn(y)||D==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(D==="erroring")return h(y._storedError);let V=WC(y);return oA(S,p,R),V}let Om={};class Vi{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Nc(this))throw Oc("abortReason");return this._abortReason}get signal(){if(!Nc(this))throw Oc("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(p=void 0){if(!Nc(this))throw Oc("error");this._controlledWritableStream._state==="writable"&&Lm(this,p)}[q](p){let y=this._abortAlgorithm(p);return ya(this),y}[$](){Er(this)}}Object.defineProperties(Vi.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Vi.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Nc(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_controlledWritableStream")?!1:f instanceof Vi}function Dm(f,p,y,S,R,D,V,j){p._controlledWritableStream=f,f._writableStreamController=p,p._queue=void 0,p._queueTotalSize=void 0,Er(p),p._abortReason=void 0,p._abortController=VC(),p._started=!1,p._strategySizeAlgorithm=j,p._strategyHWM=V,p._writeAlgorithm=S,p._closeAlgorithm=R,p._abortAlgorithm=D;let me=Mc(p);kc(f,me);let ae=y(),ye=u(ae);g(ye,()=>(p._started=!0,_a(p),null),we=>(p._started=!0,Ic(f,we),null))}function rA(f,p,y,S){let R=Object.create(Vi.prototype),D,V,j,me;p.start!==void 0?D=()=>p.start(R):D=()=>{},p.write!==void 0?V=ae=>p.write(ae,R):V=()=>u(void 0),p.close!==void 0?j=()=>p.close():j=()=>u(void 0),p.abort!==void 0?me=ae=>p.abort(ae):me=()=>u(void 0),Dm(f,R,D,V,j,me,y,S)}function ya(f){f._writeAlgorithm=void 0,f._closeAlgorithm=void 0,f._abortAlgorithm=void 0,f._strategySizeAlgorithm=void 0}function iA(f){vc(f,Om,0),_a(f)}function sA(f,p){try{return f._strategySizeAlgorithm(p)}catch(y){return so(f,y),1}}function Um(f){return f._strategyHWM-f._queueTotalSize}function oA(f,p,y){try{vc(f,p,y)}catch(R){so(f,R);return}let S=f._controlledWritableStream;if(!bn(S)&&S._state==="writable"){let R=Mc(f);kc(S,R)}_a(f)}function _a(f){let p=f._controlledWritableStream;if(!f._started||p._inFlightWriteRequest!==void 0)return;if(p._state==="erroring"){xc(p);return}if(f._queue.length===0)return;let S=vC(f);S===Om?aA(f):lA(f,S)}function so(f,p){f._controlledWritableStream._state==="writable"&&Lm(f,p)}function aA(f){let p=f._controlledWritableStream;ZC(p),Ec(f);let y=f._closeAlgorithm();ya(f),g(y,()=>(KC(p),null),S=>(YC(p,S),null))}function lA(f,p){let y=f._controlledWritableStream;QC(y);let S=f._writeAlgorithm(p);g(S,()=>{JC(y);let R=y._state;if(Ec(f),!bn(y)&&R==="writable"){let D=Mc(f);kc(y,D)}return _a(f),null},R=>(y._state==="writable"&&ya(f),zC(y,R),null))}function Mc(f){return Um(f)<=0}function Lm(f,p){let y=f._controlledWritableStream;ya(f),Pc(y,p)}function Ea(f){return new TypeError(`WritableStream.prototype.${f} can only be used on a WritableStream`)}function Oc(f){return new TypeError(`WritableStreamDefaultController.prototype.${f} can only be used on a WritableStreamDefaultController`)}function Zr(f){return new TypeError(`WritableStreamDefaultWriter.prototype.${f} can only be used on a WritableStreamDefaultWriter`)}function oo(f){return new TypeError("Cannot "+f+" a stream using a released writer")}function va(f){f._closedPromise=d((p,y)=>{f._closedPromise_resolve=p,f._closedPromise_reject=y,f._closedPromiseState="pending"})}function Fm(f,p){va(f),Dc(f,p)}function uA(f){va(f),qm(f)}function Dc(f,p){f._closedPromise_reject!==void 0&&(T(f._closedPromise),f._closedPromise_reject(p),f._closedPromise_resolve=void 0,f._closedPromise_reject=void 0,f._closedPromiseState="rejected")}function cA(f,p){Fm(f,p)}function qm(f){f._closedPromise_resolve!==void 0&&(f._closedPromise_resolve(void 0),f._closedPromise_resolve=void 0,f._closedPromise_reject=void 0,f._closedPromiseState="resolved")}function Sa(f){f._readyPromise=d((p,y)=>{f._readyPromise_resolve=p,f._readyPromise_reject=y}),f._readyPromiseState="pending"}function Uc(f,p){Sa(f),Gm(f,p)}function Bm(f){Sa(f),Lc(f)}function Gm(f,p){f._readyPromise_reject!==void 0&&(T(f._readyPromise),f._readyPromise_reject(p),f._readyPromise_resolve=void 0,f._readyPromise_reject=void 0,f._readyPromiseState="rejected")}function dA(f){Sa(f)}function fA(f,p){Uc(f,p)}function Lc(f){f._readyPromise_resolve!==void 0&&(f._readyPromise_resolve(void 0),f._readyPromise_resolve=void 0,f._readyPromise_reject=void 0,f._readyPromiseState="fulfilled")}function hA(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Fc=hA();function pA(f){if(!(typeof f=="function"||typeof f=="object")||f.name!=="DOMException")return!1;try{return new f,!0}catch{return!1}}function mA(){let f=Fc?.DOMException;return pA(f)?f:void 0}function gA(){let f=function(y,S){this.message=y||"",this.name=S||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return i(f,"DOMException"),f.prototype=Object.create(Error.prototype),Object.defineProperty(f.prototype,"constructor",{value:f,writable:!0,configurable:!0}),f}let yA=mA()||gA();function Hm(f,p,y,S,R,D){let V=U(f),j=Rm(p);f._disturbed=!0;let me=!1,ae=u(void 0);return d((ye,we)=>{let Le;if(D!==void 0){if(Le=()=>{let ue=D.reason!==void 0?D.reason:new yA("Aborted","AbortError"),Ae=[];S||Ae.push(()=>p._state==="writable"?ma(p,ue):u(void 0)),R||Ae.push(()=>f._state==="readable"?an(f,ue):u(void 0)),Et(()=>Promise.all(Ae.map(Fe=>Fe())),!0,ue)},D.aborted){Le();return}D.addEventListener("abort",Le)}function ln(){return d((ue,Ae)=>{function Fe(Pt){Pt?ue():m(zi(),Fe,Ae)}Fe(!1)})}function zi(){return me?u(!0):m(j._readyPromise,()=>d((ue,Ae)=>{se(V,{_chunkSteps:Fe=>{ae=m(Mm(j,Fe),void 0,e),ue(!1)},_closeSteps:()=>ue(!0),_errorSteps:Ae})}))}if(Yn(f,V._closedPromise,ue=>(S?$t(!0,ue):Et(()=>ma(p,ue),!0,ue),null)),Yn(p,j._closedPromise,ue=>(R?$t(!0,ue):Et(()=>an(f,ue),!0,ue),null)),ft(f,V._closedPromise,()=>(y?$t():Et(()=>eA(j)),null)),bn(p)||p._state==="closed"){let ue=new TypeError("the destination writable stream closed before all data could be piped to it");R?$t(!0,ue):Et(()=>an(f,ue),!0,ue)}T(ln());function Ar(){let ue=ae;return m(ae,()=>ue!==ae?Ar():void 0)}function Yn(ue,Ae,Fe){ue._state==="errored"?Fe(ue._storedError):v(Ae,Fe)}function ft(ue,Ae,Fe){ue._state==="closed"?Fe():_(Ae,Fe)}function Et(ue,Ae,Fe){if(me)return;me=!0,p._state==="writable"&&!bn(p)?_(Ar(),Pt):Pt();function Pt(){return g(ue(),()=>Xn(Ae,Fe),Ki=>Xn(!0,Ki)),null}}function $t(ue,Ae){me||(me=!0,p._state==="writable"&&!bn(p)?_(Ar(),()=>Xn(ue,Ae)):Xn(ue,Ae))}function Xn(ue,Ae){return Nm(j),le(V),D!==void 0&&D.removeEventListener("abort",Le),ue?we(Ae):ye(void 0),null}})}class Kn{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ta(this))throw Ca("desiredSize");return qc(this)}close(){if(!Ta(this))throw Ca("close");if(!Wi(this))throw new TypeError("The stream is not in a state that permits close");Qr(this)}enqueue(p=void 0){if(!Ta(this))throw Ca("enqueue");if(!Wi(this))throw new TypeError("The stream is not in a state that permits enqueue");return $i(this,p)}error(p=void 0){if(!Ta(this))throw Ca("error");on(this,p)}[Y](p){Er(this);let y=this._cancelAlgorithm(p);return wa(this),y}[L](p){let y=this._controlledReadableStream;if(this._queue.length>0){let S=Ec(this);this._closeRequested&&this._queue.length===0?(wa(this),uo(y)):ao(this),p._chunkSteps(S)}else I(y,p),ao(this)}[te](){}}Object.defineProperties(Kn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Kn.prototype.close,"close"),i(Kn.prototype.enqueue,"enqueue"),i(Kn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Kn.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Ta(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_controlledReadableStream")?!1:f instanceof Kn}function ao(f){if(!Vm(f))return;if(f._pulling){f._pullAgain=!0;return}f._pulling=!0;let y=f._pullAlgorithm();g(y,()=>(f._pulling=!1,f._pullAgain&&(f._pullAgain=!1,ao(f)),null),S=>(on(f,S),null))}function Vm(f){let p=f._controlledReadableStream;return!Wi(f)||!f._started?!1:!!(wr(p)&&O(p)>0||qc(f)>0)}function wa(f){f._pullAlgorithm=void 0,f._cancelAlgorithm=void 0,f._strategySizeAlgorithm=void 0}function Qr(f){if(!Wi(f))return;let p=f._controlledReadableStream;f._closeRequested=!0,f._queue.length===0&&(wa(f),uo(p))}function $i(f,p){if(!Wi(f))return;let y=f._controlledReadableStream;if(wr(y)&&O(y)>0)x(y,p,!1);else{let S;try{S=f._strategySizeAlgorithm(p)}catch(R){throw on(f,R),R}try{vc(f,p,S)}catch(R){throw on(f,R),R}}ao(f)}function on(f,p){let y=f._controlledReadableStream;y._state==="readable"&&(Er(f),wa(f),zm(y,p))}function qc(f){let p=f._controlledReadableStream._state;return p==="errored"?null:p==="closed"?0:f._strategyHWM-f._queueTotalSize}function _A(f){return!Vm(f)}function Wi(f){let p=f._controlledReadableStream._state;return!f._closeRequested&&p==="readable"}function $m(f,p,y,S,R,D,V){p._controlledReadableStream=f,p._queue=void 0,p._queueTotalSize=void 0,Er(p),p._started=!1,p._closeRequested=!1,p._pullAgain=!1,p._pulling=!1,p._strategySizeAlgorithm=V,p._strategyHWM=D,p._pullAlgorithm=S,p._cancelAlgorithm=R,f._readableStreamController=p;let j=y();g(u(j),()=>(p._started=!0,ao(p),null),me=>(on(p,me),null))}function EA(f,p,y,S){let R=Object.create(Kn.prototype),D,V,j;p.start!==void 0?D=()=>p.start(R):D=()=>{},p.pull!==void 0?V=()=>p.pull(R):V=()=>u(void 0),p.cancel!==void 0?j=me=>p.cancel(me):j=()=>u(void 0),$m(f,R,D,V,j,y,S)}function Ca(f){return new TypeError(`ReadableStreamDefaultController.prototype.${f} can only be used on a ReadableStreamDefaultController`)}function vA(f,p){return zr(f._readableStreamController)?TA(f):SA(f)}function SA(f,p){let y=U(f),S=!1,R=!1,D=!1,V=!1,j,me,ae,ye,we,Le=d(ft=>{we=ft});function ln(){return S?(R=!0,u(void 0)):(S=!0,se(y,{_chunkSteps:Et=>{A(()=>{R=!1;let $t=Et,Xn=Et;D||$i(ae._readableStreamController,$t),V||$i(ye._readableStreamController,Xn),S=!1,R&&ln()})},_closeSteps:()=>{S=!1,D||Qr(ae._readableStreamController),V||Qr(ye._readableStreamController),(!D||!V)&&we(void 0)},_errorSteps:()=>{S=!1}}),u(void 0))}function zi(ft){if(D=!0,j=ft,V){let Et=De([j,me]),$t=an(f,Et);we($t)}return Le}function Ar(ft){if(V=!0,me=ft,D){let Et=De([j,me]),$t=an(f,Et);we($t)}return Le}function Yn(){}return ae=lo(Yn,ln,zi),ye=lo(Yn,ln,Ar),v(y._closedPromise,ft=>(on(ae._readableStreamController,ft),on(ye._readableStreamController,ft),(!D||!V)&&we(void 0),null)),[ae,ye]}function TA(f){let p=U(f),y=!1,S=!1,R=!1,D=!1,V=!1,j,me,ae,ye,we,Le=d(ue=>{we=ue});function ln(ue){v(ue._closedPromise,Ae=>(ue!==p||(Vt(ae._readableStreamController,Ae),Vt(ye._readableStreamController,Ae),(!D||!V)&&we(void 0)),null))}function zi(){Yr(p)&&(le(p),p=U(f),ln(p)),se(p,{_chunkSteps:Ae=>{A(()=>{S=!1,R=!1;let Fe=Ae,Pt=Ae;if(!D&&!V)try{Pt=lm(Ae)}catch(Ki){Vt(ae._readableStreamController,Ki),Vt(ye._readableStreamController,Ki),we(an(f,Ki));return}D||ua(ae._readableStreamController,Fe),V||ua(ye._readableStreamController,Pt),y=!1,S?Yn():R&&ft()})},_closeSteps:()=>{y=!1,D||no(ae._readableStreamController),V||no(ye._readableStreamController),ae._readableStreamController._pendingPullIntos.length>0&&ca(ae._readableStreamController,0),ye._readableStreamController._pendingPullIntos.length>0&&ca(ye._readableStreamController,0),(!D||!V)&&we(void 0)},_errorSteps:()=>{y=!1}})}function Ar(ue,Ae){ne(p)&&(le(p),p=Sm(f),ln(p));let Fe=Ae?ye:ae,Pt=Ae?ae:ye;Cm(p,ue,1,{_chunkSteps:Yi=>{A(()=>{S=!1,R=!1;let Xi=Ae?V:D;if(Ae?D:V)Xi||da(Fe._readableStreamController,Yi);else{let og;try{og=lm(Yi)}catch($c){Vt(Fe._readableStreamController,$c),Vt(Pt._readableStreamController,$c),we(an(f,$c));return}Xi||da(Fe._readableStreamController,Yi),ua(Pt._readableStreamController,og)}y=!1,S?Yn():R&&ft()})},_closeSteps:Yi=>{y=!1;let Xi=Ae?V:D,Na=Ae?D:V;Xi||no(Fe._readableStreamController),Na||no(Pt._readableStreamController),Yi!==void 0&&(Xi||da(Fe._readableStreamController,Yi),!Na&&Pt._readableStreamController._pendingPullIntos.length>0&&ca(Pt._readableStreamController,0)),(!Xi||!Na)&&we(void 0)},_errorSteps:()=>{y=!1}})}function Yn(){if(y)return S=!0,u(void 0);y=!0;let ue=Ac(ae._readableStreamController);return ue===null?zi():Ar(ue._view,!1),u(void 0)}function ft(){if(y)return R=!0,u(void 0);y=!0;let ue=Ac(ye._readableStreamController);return ue===null?zi():Ar(ue._view,!0),u(void 0)}function Et(ue){if(D=!0,j=ue,V){let Ae=De([j,me]),Fe=an(f,Ae);we(Fe)}return Le}function $t(ue){if(V=!0,me=ue,D){let Ae=De([j,me]),Fe=an(f,Ae);we(Fe)}return Le}function Xn(){}return ae=Jm(Xn,Yn,Et),ye=Jm(Xn,ft,$t),ln(p),[ae,ye]}function wA(f){return n(f)&&typeof f.getReader<"u"}function CA(f){return wA(f)?bA(f.getReader()):AA(f)}function AA(f){let p,y=am(f,"async"),S=e;function R(){let V;try{V=gC(y)}catch(me){return h(me)}let j=u(V);return w(j,me=>{if(!n(me))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(yC(me))Qr(p._readableStreamController);else{let ye=_C(me);$i(p._readableStreamController,ye)}})}function D(V){let j=y.iterator,me;try{me=oa(j,"return")}catch(we){return h(we)}if(me===void 0)return u(void 0);let ae;try{ae=G(me,j,[V])}catch(we){return h(we)}let ye=u(ae);return w(ye,we=>{if(!n(we))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return p=lo(S,R,D,0),p}function bA(f){let p,y=e;function S(){let D;try{D=f.read()}catch(V){return h(V)}return w(D,V=>{if(!n(V))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(V.done)Qr(p._readableStreamController);else{let j=V.value;$i(p._readableStreamController,j)}})}function R(D){try{return u(f.cancel(D))}catch(V){return h(V)}}return p=lo(y,S,R,0),p}function RA(f,p){_t(f,p);let y=f,S=y?.autoAllocateChunkSize,R=y?.cancel,D=y?.pull,V=y?.start,j=y?.type;return{autoAllocateChunkSize:S===void 0?void 0:P(S,`${p} has member 'autoAllocateChunkSize' that`),cancel:R===void 0?void 0:IA(R,y,`${p} has member 'cancel' that`),pull:D===void 0?void 0:PA(D,y,`${p} has member 'pull' that`),start:V===void 0?void 0:xA(V,y,`${p} has member 'start' that`),type:j===void 0?void 0:kA(j,`${p} has member 'type' that`)}}function IA(f,p,y){return ct(f,y),S=>F(f,p,[S])}function PA(f,p,y){return ct(f,y),S=>F(f,p,[S])}function xA(f,p,y){return ct(f,y),S=>G(f,p,[S])}function kA(f,p){if(f=`${f}`,f!=="bytes")throw new TypeError(`${p} '${f}' is not a valid enumeration value for ReadableStreamType`);return f}function NA(f,p){return _t(f,p),{preventCancel:!!f?.preventCancel}}function Wm(f,p){_t(f,p);let y=f?.preventAbort,S=f?.preventCancel,R=f?.preventClose,D=f?.signal;return D!==void 0&&MA(D,`${p} has member 'signal' that`),{preventAbort:!!y,preventCancel:!!S,preventClose:!!R,signal:D}}function MA(f,p){if(!GC(f))throw new TypeError(`${p} is not an AbortSignal.`)}function OA(f,p){_t(f,p);let y=f?.readable;E(y,"readable","ReadableWritablePair"),k(y,`${p} has member 'readable' that`);let S=f?.writable;return E(S,"writable","ReadableWritablePair"),bm(S,`${p} has member 'writable' that`),{readable:y,writable:S}}class st{constructor(p={},y={}){p===void 0?p=null:dt(p,"First parameter");let S=pa(y,"Second parameter"),R=RA(p,"First parameter");if(Bc(this),R.type==="bytes"){if(S.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let D=io(S,0);IC(this,R,D)}else{let D=ha(S),V=io(S,1);EA(this,R,V,D)}}get locked(){if(!Tr(this))throw jr("locked");return wr(this)}cancel(p=void 0){return Tr(this)?wr(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):an(this,p):h(jr("cancel"))}getReader(p=void 0){if(!Tr(this))throw jr("getReader");return xC(p,"First parameter").mode===void 0?U(this):Sm(this)}pipeThrough(p,y={}){if(!Tr(this))throw jr("pipeThrough");ze(p,1,"pipeThrough");let S=OA(p,"First parameter"),R=Wm(y,"Second parameter");if(wr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Hi(S.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let D=Hm(this,S.writable,R.preventClose,R.preventAbort,R.preventCancel,R.signal);return T(D),S.readable}pipeTo(p,y={}){if(!Tr(this))return h(jr("pipeTo"));if(p===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!Gi(p))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let S;try{S=Wm(y,"Second parameter")}catch(R){return h(R)}return wr(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Hi(p)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Hm(this,p,S.preventClose,S.preventAbort,S.preventCancel,S.signal)}tee(){if(!Tr(this))throw jr("tee");let p=vA(this);return De(p)}values(p=void 0){if(!Tr(this))throw jr("values");let y=NA(p,"First parameter");return Li(this,y.preventCancel)}[_c](p){return this.values(p)}static from(p){return CA(p)}}Object.defineProperties(st,{from:{enumerable:!0}}),Object.defineProperties(st.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(st.from,"from"),i(st.prototype.cancel,"cancel"),i(st.prototype.getReader,"getReader"),i(st.prototype.pipeThrough,"pipeThrough"),i(st.prototype.pipeTo,"pipeTo"),i(st.prototype.tee,"tee"),i(st.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(st.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(st.prototype,_c,{value:st.prototype.values,writable:!0,configurable:!0});function lo(f,p,y,S=1,R=()=>1){let D=Object.create(st.prototype);Bc(D);let V=Object.create(Kn.prototype);return $m(D,V,f,p,y,S,R),D}function Jm(f,p,y){let S=Object.create(st.prototype);Bc(S);let R=Object.create(Jn.prototype);return vm(S,R,f,p,y,0,void 0),S}function Bc(f){f._state="readable",f._reader=void 0,f._storedError=void 0,f._disturbed=!1}function Tr(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_readableStreamController")?!1:f instanceof st}function wr(f){return f._reader!==void 0}function an(f,p){if(f._disturbed=!0,f._state==="closed")return u(void 0);if(f._state==="errored")return h(f._storedError);uo(f);let y=f._reader;if(y!==void 0&&Yr(y)){let R=y._readIntoRequests;y._readIntoRequests=new H,R.forEach(D=>{D._closeSteps(void 0)})}let S=f._readableStreamController[Y](p);return w(S,e)}function uo(f){f._state="closed";let p=f._reader;if(p!==void 0&&(Ui(p),ne(p))){let y=p._readRequests;p._readRequests=new H,y.forEach(S=>{S._closeSteps()})}}function zm(f,p){f._state="errored",f._storedError=p;let y=f._reader;y!==void 0&&(et(y,p),ne(y)?Be(y,p):Am(y,p))}function jr(f){return new TypeError(`ReadableStream.prototype.${f} can only be used on a ReadableStream`)}function Km(f,p){_t(f,p);let y=f?.highWaterMark;return E(y,"highWaterMark","QueuingStrategyInit"),{highWaterMark:C(y)}}let Ym=f=>f.byteLength;i(Ym,"size");class Aa{constructor(p){ze(p,1,"ByteLengthQueuingStrategy"),p=Km(p,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!Zm(this))throw Xm("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Zm(this))throw Xm("size");return Ym}}Object.defineProperties(Aa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Aa.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Xm(f){return new TypeError(`ByteLengthQueuingStrategy.prototype.${f} can only be used on a ByteLengthQueuingStrategy`)}function Zm(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_byteLengthQueuingStrategyHighWaterMark")?!1:f instanceof Aa}let Qm=()=>1;i(Qm,"size");class ba{constructor(p){ze(p,1,"CountQueuingStrategy"),p=Km(p,"First parameter"),this._countQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!eg(this))throw jm("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!eg(this))throw jm("size");return Qm}}Object.defineProperties(ba.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ba.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function jm(f){return new TypeError(`CountQueuingStrategy.prototype.${f} can only be used on a CountQueuingStrategy`)}function eg(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_countQueuingStrategyHighWaterMark")?!1:f instanceof ba}function DA(f,p){_t(f,p);let y=f?.cancel,S=f?.flush,R=f?.readableType,D=f?.start,V=f?.transform,j=f?.writableType;return{cancel:y===void 0?void 0:qA(y,f,`${p} has member 'cancel' that`),flush:S===void 0?void 0:UA(S,f,`${p} has member 'flush' that`),readableType:R,start:D===void 0?void 0:LA(D,f,`${p} has member 'start' that`),transform:V===void 0?void 0:FA(V,f,`${p} has member 'transform' that`),writableType:j}}function UA(f,p,y){return ct(f,y),S=>F(f,p,[S])}function LA(f,p,y){return ct(f,y),S=>G(f,p,[S])}function FA(f,p,y){return ct(f,y),(S,R)=>F(f,p,[S,R])}function qA(f,p,y){return ct(f,y),S=>F(f,p,[S])}class Ra{constructor(p={},y={},S={}){p===void 0&&(p=null);let R=pa(y,"Second parameter"),D=pa(S,"Third parameter"),V=DA(p,"First parameter");if(V.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(V.writableType!==void 0)throw new RangeError("Invalid writableType specified");let j=io(D,0),me=ha(D),ae=io(R,1),ye=ha(R),we,Le=d(ln=>{we=ln});BA(this,Le,ae,ye,j,me),HA(this,V),V.start!==void 0?we(V.start(this._transformStreamController)):we(void 0)}get readable(){if(!tg(this))throw sg("readable");return this._readable}get writable(){if(!tg(this))throw sg("writable");return this._writable}}Object.defineProperties(Ra.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ra.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function BA(f,p,y,S,R,D){function V(){return p}function j(Le){return WA(f,Le)}function me(Le){return JA(f,Le)}function ae(){return zA(f)}f._writable=$C(V,j,ae,me,y,S);function ye(){return KA(f)}function we(Le){return YA(f,Le)}f._readable=lo(V,ye,we,R,D),f._backpressure=void 0,f._backpressureChangePromise=void 0,f._backpressureChangePromise_resolve=void 0,Ia(f,!0),f._transformStreamController=void 0}function tg(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_transformStreamController")?!1:f instanceof Ra}function ng(f,p){on(f._readable._readableStreamController,p),Gc(f,p)}function Gc(f,p){xa(f._transformStreamController),so(f._writable._writableStreamController,p),Hc(f)}function Hc(f){f._backpressure&&Ia(f,!1)}function Ia(f,p){f._backpressureChangePromise!==void 0&&f._backpressureChangePromise_resolve(),f._backpressureChangePromise=d(y=>{f._backpressureChangePromise_resolve=y}),f._backpressure=p}class Cr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Pa(this))throw ka("desiredSize");let p=this._controlledTransformStream._readable._readableStreamController;return qc(p)}enqueue(p=void 0){if(!Pa(this))throw ka("enqueue");rg(this,p)}error(p=void 0){if(!Pa(this))throw ka("error");VA(this,p)}terminate(){if(!Pa(this))throw ka("terminate");$A(this)}}Object.defineProperties(Cr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Cr.prototype.enqueue,"enqueue"),i(Cr.prototype.error,"error"),i(Cr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Cr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Pa(f){return!n(f)||!Object.prototype.hasOwnProperty.call(f,"_controlledTransformStream")?!1:f instanceof Cr}function GA(f,p,y,S,R){p._controlledTransformStream=f,f._transformStreamController=p,p._transformAlgorithm=y,p._flushAlgorithm=S,p._cancelAlgorithm=R,p._finishPromise=void 0,p._finishPromise_resolve=void 0,p._finishPromise_reject=void 0}function HA(f,p){let y=Object.create(Cr.prototype),S,R,D;p.transform!==void 0?S=V=>p.transform(V,y):S=V=>{try{return rg(y,V),u(void 0)}catch(j){return h(j)}},p.flush!==void 0?R=()=>p.flush(y):R=()=>u(void 0),p.cancel!==void 0?D=V=>p.cancel(V):D=()=>u(void 0),GA(f,y,S,R,D)}function xa(f){f._transformAlgorithm=void 0,f._flushAlgorithm=void 0,f._cancelAlgorithm=void 0}function rg(f,p){let y=f._controlledTransformStream,S=y._readable._readableStreamController;if(!Wi(S))throw new TypeError("Readable side is not in a state that permits enqueue");try{$i(S,p)}catch(D){throw Gc(y,D),y._readable._storedError}_A(S)!==y._backpressure&&Ia(y,!0)}function VA(f,p){ng(f._controlledTransformStream,p)}function ig(f,p){let y=f._transformAlgorithm(p);return w(y,void 0,S=>{throw ng(f._controlledTransformStream,S),S})}function $A(f){let p=f._controlledTransformStream,y=p._readable._readableStreamController;Qr(y);let S=new TypeError("TransformStream terminated");Gc(p,S)}function WA(f,p){let y=f._transformStreamController;if(f._backpressure){let S=f._backpressureChangePromise;return w(S,()=>{let R=f._writable;if(R._state==="erroring")throw R._storedError;return ig(y,p)})}return ig(y,p)}function JA(f,p){let y=f._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=f._readable;y._finishPromise=d((D,V)=>{y._finishPromise_resolve=D,y._finishPromise_reject=V});let R=y._cancelAlgorithm(p);return xa(y),g(R,()=>(S._state==="errored"?Ji(y,S._storedError):(on(S._readableStreamController,p),Vc(y)),null),D=>(on(S._readableStreamController,D),Ji(y,D),null)),y._finishPromise}function zA(f){let p=f._transformStreamController;if(p._finishPromise!==void 0)return p._finishPromise;let y=f._readable;p._finishPromise=d((R,D)=>{p._finishPromise_resolve=R,p._finishPromise_reject=D});let S=p._flushAlgorithm();return xa(p),g(S,()=>(y._state==="errored"?Ji(p,y._storedError):(Qr(y._readableStreamController),Vc(p)),null),R=>(on(y._readableStreamController,R),Ji(p,R),null)),p._finishPromise}function KA(f){return Ia(f,!1),f._backpressureChangePromise}function YA(f,p){let y=f._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=f._writable;y._finishPromise=d((D,V)=>{y._finishPromise_resolve=D,y._finishPromise_reject=V});let R=y._cancelAlgorithm(p);return xa(y),g(R,()=>(S._state==="errored"?Ji(y,S._storedError):(so(S._writableStreamController,p),Hc(f),Vc(y)),null),D=>(so(S._writableStreamController,D),Hc(f),Ji(y,D),null)),y._finishPromise}function ka(f){return new TypeError(`TransformStreamDefaultController.prototype.${f} can only be used on a TransformStreamDefaultController`)}function Vc(f){f._finishPromise_resolve!==void 0&&(f._finishPromise_resolve(),f._finishPromise_resolve=void 0,f._finishPromise_reject=void 0)}function Ji(f,p){f._finishPromise_reject!==void 0&&(T(f._finishPromise),f._finishPromise_reject(p),f._finishPromise_resolve=void 0,f._finishPromise_reject=void 0)}function sg(f){return new TypeError(`TransformStream.prototype.${f} can only be used on a TransformStream`)}t.ByteLengthQueuingStrategy=Aa,t.CountQueuingStrategy=ba,t.ReadableByteStreamController=Jn,t.ReadableStream=st,t.ReadableStreamBYOBReader=vr,t.ReadableStreamBYOBRequest=Jr,t.ReadableStreamDefaultController=Kn,t.ReadableStreamDefaultReader=W,t.TransformStream=Ra,t.TransformStreamDefaultController=Cr,t.WritableStream=Sr,t.WritableStreamDefaultController=Vi,t.WritableStreamDefaultWriter=zn}))});var qy=z(()=>{if(!globalThis.ReadableStream)try{let t=X("node:process"),{emitWarning:e}=t;try{t.emitWarning=()=>{},Object.assign(globalThis,X("node:stream/web")),t.emitWarning=e}catch(n){throw t.emitWarning=e,n}}catch{Object.assign(globalThis,Fy())}try{let{Blob:t}=X("buffer");t&&!t.prototype.stream&&(t.prototype.stream=function(n){let r=0,i=this;return new ReadableStream({type:"bytes",async pull(s){let a=await i.slice(r,Math.min(i.size,r+65536)).arrayBuffer();r+=a.byteLength,s.enqueue(new Uint8Array(a)),r===i.size&&s.close()}})})}catch{}});async function*Td(t,e=!0){for(let n of t)if("stream"in n)yield*n.stream();else if(ArrayBuffer.isView(n))if(e){let r=n.byteOffset,i=n.byteOffset+n.byteLength;for(;r!==i;){let s=Math.min(i-r,By),o=n.buffer.slice(r,r+s);r+=o.byteLength,yield new Uint8Array(o)}}else yield n;else{let r=0,i=n;for(;r!==i.size;){let o=await i.slice(r,Math.min(i.size,r+By)).arrayBuffer();r+=o.byteLength,yield new Uint8Array(o)}}}var kV,By,Gy,cI,dn,Eo=Xe(()=>{kV=Zn(qy(),1);By=65536;Gy=class wd{#e=[];#t="";#n=0;#s="transparent";constructor(e=[],n={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof n!="object"&&typeof n!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");n===null&&(n={});let r=new TextEncoder;for(let s of e){let o;ArrayBuffer.isView(s)?o=new Uint8Array(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)):s instanceof ArrayBuffer?o=new Uint8Array(s.slice(0)):s instanceof wd?o=s:o=r.encode(`${s}`),this.#n+=ArrayBuffer.isView(o)?o.byteLength:o.size,this.#e.push(o)}this.#s=`${n.endings===void 0?"transparent":n.endings}`;let i=n.type===void 0?"":String(n.type);this.#t=/^[\x20-\x7E]*$/.test(i)?i:""}get size(){return this.#n}get type(){return this.#t}async text(){let e=new TextDecoder,n="";for await(let r of Td(this.#e,!1))n+=e.decode(r,{stream:!0});return n+=e.decode(),n}async arrayBuffer(){let e=new Uint8Array(this.size),n=0;for await(let r of Td(this.#e,!1))e.set(r,n),n+=r.length;return e.buffer}stream(){let e=Td(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(n){let r=await e.next();r.done?n.close():n.enqueue(r.value)},async cancel(){await e.return()}})}slice(e=0,n=this.size,r=""){let{size:i}=this,s=e<0?Math.max(i+e,0):Math.min(e,i),o=n<0?Math.max(i+n,0):Math.min(n,i),a=Math.max(o-s,0),d=this.#e,u=[],h=0;for(let g of d){if(h>=a)break;let _=ArrayBuffer.isView(g)?g.byteLength:g.size;if(s&&_<=s)s-=_,o-=_;else{let v;ArrayBuffer.isView(g)?(v=g.subarray(s,Math.min(_,o)),h+=v.byteLength):(v=g.slice(s,Math.min(_,o)),h+=v.size),o-=_,u.push(v),s=0}}let m=new wd([],{type:String(r).toLowerCase()});return m.#n=a,m.#e=u,m}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Gy.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});cI=Gy,dn=cI});var dI,fI,Nr,Cd=Xe(()=>{Eo();dI=class extends dn{#e=0;#t="";constructor(e,n,r={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),r===null&&(r={});let i=r.lastModified===void 0?Date.now():Number(r.lastModified);Number.isNaN(i)||(this.#e=i),this.#t=String(n)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof dn&&/^(File)$/.test(e[Symbol.toStringTag])}},fI=dI,Nr=fI});function $y(t,e=dn){var n=`${Hy()}${Hy()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),r=[],i=`--${n}\r
Content-Disposition: form-data; name="`;return t.forEach((s,o)=>typeof s=="string"?r.push(i+Ad(o)+`"\r
\r
${s.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):r.push(i+Ad(o)+`"; filename="${Ad(s.name,1)}"\r
Content-Type: ${s.type||"application/octet-stream"}\r
\r
`,s,`\r
`)),r.push(`--${n}--`),new e(r,{type:"multipart/form-data; boundary="+n})}var vo,hI,pI,Hy,mI,Vy,Ad,Ei,Mr,cl=Xe(()=>{Eo();Cd();({toStringTag:vo,iterator:hI,hasInstance:pI}=Symbol),Hy=Math.random,mI="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Vy=(t,e,n)=>(t+="",/^(Blob|File)$/.test(e&&e[vo])?[(n=n!==void 0?n+"":e[vo]=="File"?e.name:"blob",t),e.name!==n||e[vo]=="blob"?new Nr([e],n,e):e]:[t,e+""]),Ad=(t,e)=>(e?t:t.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Ei=(t,e,n)=>{if(e.length<n)throw new TypeError(`Failed to execute '${t}' on 'FormData': ${n} arguments required, but only ${e.length} present.`)},Mr=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[vo](){return"FormData"}[hI](){return this.entries()}static[pI](e){return e&&typeof e=="object"&&e[vo]==="FormData"&&!mI.some(n=>typeof e[n]!="function")}append(...e){Ei("append",arguments,2),this.#e.push(Vy(...e))}delete(e){Ei("delete",arguments,1),e+="",this.#e=this.#e.filter(([n])=>n!==e)}get(e){Ei("get",arguments,1),e+="";for(var n=this.#e,r=n.length,i=0;i<r;i++)if(n[i][0]===e)return n[i][1];return null}getAll(e,n){return Ei("getAll",arguments,1),n=[],e+="",this.#e.forEach(r=>r[0]===e&&n.push(r[1])),n}has(e){return Ei("has",arguments,1),e+="",this.#e.some(n=>n[0]===e)}forEach(e,n){Ei("forEach",arguments,1);for(var[r,i]of this)e.call(n,i,r,this)}set(...e){Ei("set",arguments,2);var n=[],r=!0;e=Vy(...e),this.#e.forEach(i=>{i[0]===e[0]?r&&(r=!n.push(e)):n.push(i)}),r&&n.push(e),this.#e=n}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var or,dl=Xe(()=>{or=class extends Error{constructor(e,n){super(e),Error.captureStackTrace(this,this.constructor),this.type=n}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var mt,bd=Xe(()=>{dl();mt=class extends or{constructor(e,n,r){super(e,n),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}});var fl,Rd,So,Wy,Jy,zy,hl=Xe(()=>{fl=Symbol.toStringTag,Rd=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[fl]==="URLSearchParams",So=t=>t&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[fl]),Wy=t=>typeof t=="object"&&(t[fl]==="AbortSignal"||t[fl]==="EventTarget"),Jy=(t,e)=>{let n=new URL(e).hostname,r=new URL(t).hostname;return n===r||n.endsWith(`.${r}`)},zy=(t,e)=>{let n=new URL(e).protocol,r=new URL(t).protocol;return n===r}});var Yy=z(($V,Ky)=>{if(!globalThis.DOMException)try{let{MessageChannel:t}=X("worker_threads"),e=new t().port1,n=new ArrayBuffer;e.postMessage(n,[n,n])}catch(t){t.constructor.name==="DOMException"&&(globalThis.DOMException=t.constructor)}Ky.exports=globalThis.DOMException});import{statSync as Xy,createReadStream as gI,promises as yI}from"node:fs";import{basename as _I}from"node:path";var Zy,Id,Qy,jy,e_,t_,n_,r_,pl,Pd=Xe(()=>{Zy=Zn(Yy(),1);Cd();Eo();({stat:Id}=yI),Qy=(t,e)=>n_(Xy(t),t,e),jy=(t,e)=>Id(t).then(n=>n_(n,t,e)),e_=(t,e)=>Id(t).then(n=>r_(n,t,e)),t_=(t,e)=>r_(Xy(t),t,e),n_=(t,e,n="")=>new dn([new pl({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],{type:n}),r_=(t,e,n="")=>new Nr([new pl({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],_I(e),{type:n,lastModified:t.mtimeMs}),pl=class t{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,n){return new t({path:this.#e,lastModified:this.lastModified,size:n-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await Id(this.#e);if(e>this.lastModified)throw new Zy.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*gI(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var s_={};Jc(s_,{toFormData:()=>AI});function CI(t){let e=t.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let n=e[2]||e[3]||"",r=n.slice(n.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,(i,s)=>String.fromCharCode(s)),r}async function AI(t,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let n=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");let r=new xd(n[1]||n[2]),i,s,o,a,d,u,h=[],m=new Mr,g=A=>{o+=T.decode(A,{stream:!0})},_=A=>{h.push(A)},v=()=>{let A=new Nr(h,u,{type:d});m.append(a,A)},w=()=>{m.append(a,o)},T=new TextDecoder("utf-8");T.decode(),r.onPartBegin=function(){r.onPartData=g,r.onPartEnd=w,i="",s="",o="",a="",d="",u=null,h.length=0},r.onHeaderField=function(A){i+=T.decode(A,{stream:!0})},r.onHeaderValue=function(A){s+=T.decode(A,{stream:!0})},r.onHeaderEnd=function(){if(s+=T.decode(),i=i.toLowerCase(),i==="content-disposition"){let A=s.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);A&&(a=A[2]||A[3]||""),u=CI(s),u&&(r.onPartData=_,r.onPartEnd=v)}else i==="content-type"&&(d=s);s="",i=""};for await(let A of t)r.write(A);return r.end(),m}var Mn,qe,i_,Or,ml,gl,EI,To,vI,SI,TI,wI,vi,xd,o_=Xe(()=>{Pd();cl();Mn=0,qe={START_BOUNDARY:Mn++,HEADER_FIELD_START:Mn++,HEADER_FIELD:Mn++,HEADER_VALUE_START:Mn++,HEADER_VALUE:Mn++,HEADER_VALUE_ALMOST_DONE:Mn++,HEADERS_ALMOST_DONE:Mn++,PART_DATA_START:Mn++,PART_DATA:Mn++,END:Mn++},i_=1,Or={PART_BOUNDARY:i_,LAST_BOUNDARY:i_*=2},ml=10,gl=13,EI=32,To=45,vI=58,SI=97,TI=122,wI=t=>t|32,vi=()=>{},xd=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=vi,this.onHeaderField=vi,this.onHeadersEnd=vi,this.onHeaderValue=vi,this.onPartBegin=vi,this.onPartData=vi,this.onPartEnd=vi,this.boundaryChars={},e=`\r
--`+e;let n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r),this.boundaryChars[n[r]]=!0;this.boundary=n,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=qe.START_BOUNDARY}write(e){let n=0,r=e.length,i=this.index,{lookbehind:s,boundary:o,boundaryChars:a,index:d,state:u,flags:h}=this,m=this.boundary.length,g=m-1,_=e.length,v,w,T=B=>{this[B+"Mark"]=n},A=B=>{delete this[B+"Mark"]},G=(B,H,q,$)=>{(H===void 0||H!==q)&&this[B]($&&$.subarray(H,q))},F=(B,H)=>{let q=B+"Mark";q in this&&(H?(G(B,this[q],n,e),delete this[q]):(G(B,this[q],e.length,e),this[q]=0))};for(n=0;n<r;n++)switch(v=e[n],u){case qe.START_BOUNDARY:if(d===o.length-2){if(v===To)h|=Or.LAST_BOUNDARY;else if(v!==gl)return;d++;break}else if(d-1===o.length-2){if(h&Or.LAST_BOUNDARY&&v===To)u=qe.END,h=0;else if(!(h&Or.LAST_BOUNDARY)&&v===ml)d=0,G("onPartBegin"),u=qe.HEADER_FIELD_START;else return;break}v!==o[d+2]&&(d=-2),v===o[d+2]&&d++;break;case qe.HEADER_FIELD_START:u=qe.HEADER_FIELD,T("onHeaderField"),d=0;case qe.HEADER_FIELD:if(v===gl){A("onHeaderField"),u=qe.HEADERS_ALMOST_DONE;break}if(d++,v===To)break;if(v===vI){if(d===1)return;F("onHeaderField",!0),u=qe.HEADER_VALUE_START;break}if(w=wI(v),w<SI||w>TI)return;break;case qe.HEADER_VALUE_START:if(v===EI)break;T("onHeaderValue"),u=qe.HEADER_VALUE;case qe.HEADER_VALUE:v===gl&&(F("onHeaderValue",!0),G("onHeaderEnd"),u=qe.HEADER_VALUE_ALMOST_DONE);break;case qe.HEADER_VALUE_ALMOST_DONE:if(v!==ml)return;u=qe.HEADER_FIELD_START;break;case qe.HEADERS_ALMOST_DONE:if(v!==ml)return;G("onHeadersEnd"),u=qe.PART_DATA_START;break;case qe.PART_DATA_START:u=qe.PART_DATA,T("onPartData");case qe.PART_DATA:if(i=d,d===0){for(n+=g;n<_&&!(e[n]in a);)n+=m;n-=g,v=e[n]}if(d<o.length)o[d]===v?(d===0&&F("onPartData",!0),d++):d=0;else if(d===o.length)d++,v===gl?h|=Or.PART_BOUNDARY:v===To?h|=Or.LAST_BOUNDARY:d=0;else if(d-1===o.length)if(h&Or.PART_BOUNDARY){if(d=0,v===ml){h&=~Or.PART_BOUNDARY,G("onPartEnd"),G("onPartBegin"),u=qe.HEADER_FIELD_START;break}}else h&Or.LAST_BOUNDARY&&v===To?(G("onPartEnd"),u=qe.END,h=0):d=0;if(d>0)s[d-1]=v;else if(i>0){let B=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);G("onPartData",0,i,B),i=0,T("onPartData"),n--}break;case qe.END:break;default:throw new Error(`Unexpected state entered: ${u}`)}F("onHeaderField"),F("onHeaderValue"),F("onPartData"),this.index=d,this.state=u,this.flags=h}end(){if(this.state===qe.HEADER_FIELD_START&&this.index===0||this.state===qe.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==qe.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});import Dr,{PassThrough as a_}from"node:stream";import{types as l_,deprecate as Nd,promisify as bI}from"node:util";import{Buffer as Zt}from"node:buffer";async function kd(t){if(t[Ct].disturbed)throw new TypeError(`body used already for: ${t.url}`);if(t[Ct].disturbed=!0,t[Ct].error)throw t[Ct].error;let{body:e}=t;if(e===null)return Zt.alloc(0);if(!(e instanceof Dr))return Zt.alloc(0);let n=[],r=0;try{for await(let i of e){if(t.size>0&&r+i.length>t.size){let s=new mt(`content size at ${t.url} over limit: ${t.size}`,"max-size");throw e.destroy(s),s}r+=i.length,n.push(i)}}catch(i){throw i instanceof or?i:new mt(`Invalid response body while trying to fetch ${t.url}: ${i.message}`,"system",i)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return n.every(i=>typeof i=="string")?Zt.from(n.join("")):Zt.concat(n,r)}catch(i){throw new mt(`Could not create Buffer from response body for ${t.url}: ${i.message}`,"system",i)}else throw new mt(`Premature close of server response while trying to fetch ${t.url}`)}var RI,Ct,On,ps,II,yl,u_,c_,_l=Xe(()=>{Eo();cl();bd();dl();hl();RI=bI(Dr.pipeline),Ct=Symbol("Body internals"),On=class{constructor(e,{size:n=0}={}){let r=null;e===null?e=null:Rd(e)?e=Zt.from(e.toString()):So(e)||Zt.isBuffer(e)||(l_.isAnyArrayBuffer(e)?e=Zt.from(e):ArrayBuffer.isView(e)?e=Zt.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Dr||(e instanceof Mr?(e=$y(e),r=e.type.split("=")[1]):e=Zt.from(String(e))));let i=e;Zt.isBuffer(e)?i=Dr.Readable.from(e):So(e)&&(i=Dr.Readable.from(e.stream())),this[Ct]={body:e,stream:i,boundary:r,disturbed:!1,error:null},this.size=n,e instanceof Dr&&e.on("error",s=>{let o=s instanceof or?s:new mt(`Invalid response body while trying to fetch ${this.url}: ${s.message}`,"system",s);this[Ct].error=o})}get body(){return this[Ct].stream}get bodyUsed(){return this[Ct].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:n,byteLength:r}=await kd(this);return e.slice(n,n+r)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let r=new Mr,i=new URLSearchParams(await this.text());for(let[s,o]of i)r.append(s,o);return r}let{toFormData:n}=await Promise.resolve().then(()=>(o_(),s_));return n(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[Ct].body&&this[Ct].body.type||"",n=await this.arrayBuffer();return new dn([n],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await kd(this);return new TextDecoder().decode(e)}buffer(){return kd(this)}};On.prototype.buffer=Nd(On.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(On.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:Nd(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});ps=(t,e)=>{let n,r,{body:i}=t[Ct];if(t.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof Dr&&typeof i.getBoundary!="function"&&(n=new a_({highWaterMark:e}),r=new a_({highWaterMark:e}),i.pipe(n),i.pipe(r),t[Ct].stream=n,i=r),i},II=Nd(t=>t.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),yl=(t,e)=>t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":Rd(t)?"application/x-www-form-urlencoded;charset=UTF-8":So(t)?t.type||null:Zt.isBuffer(t)||l_.isAnyArrayBuffer(t)||ArrayBuffer.isView(t)?null:t instanceof Mr?`multipart/form-data; boundary=${e[Ct].boundary}`:t&&typeof t.getBoundary=="function"?`multipart/form-data;boundary=${II(t)}`:t instanceof Dr?null:"text/plain;charset=UTF-8",u_=t=>{let{body:e}=t[Ct];return e===null?0:So(e)?e.size:Zt.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},c_=async(t,{body:e})=>{e===null?t.end():await RI(e,t)}});import{types as d_}from"node:util";import vl from"node:http";function f_(t=[]){return new At(t.reduce((e,n,r,i)=>(r%2===0&&e.push(i.slice(r,r+2)),e),[]).filter(([e,n])=>{try{return El(e),Md(e,String(n)),!0}catch{return!1}}))}var El,Md,At,Sl=Xe(()=>{El=typeof vl.validateHeaderName=="function"?vl.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){let e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},Md=typeof vl.validateHeaderValue=="function"?vl.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let n=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_CHAR"}),n}},At=class t extends URLSearchParams{constructor(e){let n=[];if(e instanceof t){let r=e.raw();for(let[i,s]of Object.entries(r))n.push(...s.map(o=>[i,o]))}else if(e!=null)if(typeof e=="object"&&!d_.isBoxedPrimitive(e)){let r=e[Symbol.iterator];if(r==null)n.push(...Object.entries(e));else{if(typeof r!="function")throw new TypeError("Header pairs must be iterable");n=[...e].map(i=>{if(typeof i!="object"||d_.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return n=n.length>0?n.map(([r,i])=>(El(r),Md(r,String(i)),[String(r).toLowerCase(),String(i)])):void 0,super(n),new Proxy(this,{get(r,i,s){switch(i){case"append":case"set":return(o,a)=>(El(o),Md(o,String(a)),URLSearchParams.prototype[i].call(r,String(o).toLowerCase(),String(a)));case"delete":case"has":case"getAll":return o=>(El(o),URLSearchParams.prototype[i].call(r,String(o).toLowerCase()));case"keys":return()=>(r.sort(),new Set(URLSearchParams.prototype.keys.call(r)).keys());default:return Reflect.get(r,i,s)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let n=this.getAll(e);if(n.length===0)return null;let r=n.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,n=void 0){for(let r of this.keys())Reflect.apply(e,n,[this.get(r),r,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,n)=>(e[n]=this.getAll(n),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,n)=>{let r=this.getAll(n);return n==="host"?e[n]=r[0]:e[n]=r.length>1?r:r[0],e},{})}};Object.defineProperties(At.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}))});var PI,wo,Od=Xe(()=>{PI=new Set([301,302,303,307,308]),wo=t=>PI.has(t)});var fn,Ot,h_=Xe(()=>{Sl();_l();Od();fn=Symbol("Response internals"),Ot=class t extends On{constructor(e=null,n={}){super(e,n);let r=n.status!=null?n.status:200,i=new At(n.headers);if(e!==null&&!i.has("Content-Type")){let s=yl(e,this);s&&i.append("Content-Type",s)}this[fn]={type:"default",url:n.url,status:r,statusText:n.statusText||"",headers:i,counter:n.counter,highWaterMark:n.highWaterMark}}get type(){return this[fn].type}get url(){return this[fn].url||""}get status(){return this[fn].status}get ok(){return this[fn].status>=200&&this[fn].status<300}get redirected(){return this[fn].counter>0}get statusText(){return this[fn].statusText}get headers(){return this[fn].headers}get highWaterMark(){return this[fn].highWaterMark}clone(){return new t(ps(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,n=302){if(!wo(n))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new t(null,{headers:{location:new URL(e).toString()},status:n})}static error(){let e=new t(null,{status:0,statusText:""});return e[fn].type="error",e}static json(e=void 0,n={}){let r=JSON.stringify(e);if(r===void 0)throw new TypeError("data is not JSON serializable");let i=new At(n&&n.headers);return i.has("content-type")||i.set("content-type","application/json"),new t(r,{...n,headers:i})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(Ot.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var p_,m_=Xe(()=>{p_=t=>{if(t.search)return t.search;let e=t.href.length-1,n=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-n.length]==="?"?"?":""}});import{isIP as xI}from"node:net";function g_(t,e=!1){return t==null||(t=new URL(t),/^(about|blob|data):$/.test(t.protocol))?"no-referrer":(t.username="",t.password="",t.hash="",e&&(t.pathname="",t.search=""),t)}function E_(t){if(!y_.has(t))throw new TypeError(`Invalid referrerPolicy: ${t}`);return t}function kI(t){if(/^(http|ws)s:$/.test(t.protocol))return!0;let e=t.host.replace(/(^\[)|(]$)/g,""),n=xI(e);return n===4&&/^127\./.test(e)||n===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:t.host==="localhost"||t.host.endsWith(".localhost")?!1:t.protocol==="file:"}function ms(t){return/^about:(blank|srcdoc)$/.test(t)||t.protocol==="data:"||/^(blob|filesystem):$/.test(t.protocol)?!0:kI(t)}function v_(t,{referrerURLCallback:e,referrerOriginCallback:n}={}){if(t.referrer==="no-referrer"||t.referrerPolicy==="")return null;let r=t.referrerPolicy;if(t.referrer==="about:client")return"no-referrer";let i=t.referrer,s=g_(i),o=g_(i,!0);s.toString().length>4096&&(s=o),e&&(s=e(s)),n&&(o=n(o));let a=new URL(t.url);switch(r){case"no-referrer":return"no-referrer";case"origin":return o;case"unsafe-url":return s;case"strict-origin":return ms(s)&&!ms(a)?"no-referrer":o.toString();case"strict-origin-when-cross-origin":return s.origin===a.origin?s:ms(s)&&!ms(a)?"no-referrer":o;case"same-origin":return s.origin===a.origin?s:"no-referrer";case"origin-when-cross-origin":return s.origin===a.origin?s:o;case"no-referrer-when-downgrade":return ms(s)&&!ms(a)?"no-referrer":s;default:throw new TypeError(`Invalid referrerPolicy: ${r}`)}}function S_(t){let e=(t.get("referrer-policy")||"").split(/[,\s]+/),n="";for(let r of e)r&&y_.has(r)&&(n=r);return n}var y_,__,Dd=Xe(()=>{y_=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),__="strict-origin-when-cross-origin"});import{format as NI}from"node:url";import{deprecate as MI}from"node:util";var Qe,Co,OI,Ur,T_,w_=Xe(()=>{Sl();_l();hl();m_();Dd();Qe=Symbol("Request internals"),Co=t=>typeof t=="object"&&typeof t[Qe]=="object",OI=MI(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Ur=class t extends On{constructor(e,n={}){let r;if(Co(e)?r=new URL(e.url):(r=new URL(e),e={}),r.username!==""||r.password!=="")throw new TypeError(`${r} is an url with embedded credentials.`);let i=n.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(i)&&(i=i.toUpperCase()),!Co(n)&&"data"in n&&OI(),(n.body!=null||Co(e)&&e.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let s=n.body?n.body:Co(e)&&e.body!==null?ps(e):null;super(s,{size:n.size||e.size||0});let o=new At(n.headers||e.headers||{});if(s!==null&&!o.has("Content-Type")){let u=yl(s,this);u&&o.set("Content-Type",u)}let a=Co(e)?e.signal:null;if("signal"in n&&(a=n.signal),a!=null&&!Wy(a))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let d=n.referrer==null?e.referrer:n.referrer;if(d==="")d="no-referrer";else if(d){let u=new URL(d);d=/^about:(\/\/)?client$/.test(u)?"client":u}else d=void 0;this[Qe]={method:i,redirect:n.redirect||e.redirect||"follow",headers:o,parsedURL:r,signal:a,referrer:d},this.follow=n.follow===void 0?e.follow===void 0?20:e.follow:n.follow,this.compress=n.compress===void 0?e.compress===void 0?!0:e.compress:n.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent,this.highWaterMark=n.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=n.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=n.referrerPolicy||e.referrerPolicy||""}get method(){return this[Qe].method}get url(){return NI(this[Qe].parsedURL)}get headers(){return this[Qe].headers}get redirect(){return this[Qe].redirect}get signal(){return this[Qe].signal}get referrer(){if(this[Qe].referrer==="no-referrer")return"";if(this[Qe].referrer==="client")return"about:client";if(this[Qe].referrer)return this[Qe].referrer.toString()}get referrerPolicy(){return this[Qe].referrerPolicy}set referrerPolicy(e){this[Qe].referrerPolicy=E_(e)}clone(){return new t(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Ur.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});T_=t=>{let{parsedURL:e}=t[Qe],n=new At(t[Qe].headers);n.has("Accept")||n.set("Accept","*/*");let r=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(r="0"),t.body!==null){let a=u_(t);typeof a=="number"&&!Number.isNaN(a)&&(r=String(a))}r&&n.set("Content-Length",r),t.referrerPolicy===""&&(t.referrerPolicy=__),t.referrer&&t.referrer!=="no-referrer"?t[Qe].referrer=v_(t):t[Qe].referrer="no-referrer",t[Qe].referrer instanceof URL&&n.set("Referer",t.referrer),n.has("User-Agent")||n.set("User-Agent","node-fetch"),t.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip, deflate, br");let{agent:i}=t;typeof i=="function"&&(i=i(e));let s=p_(e),o={path:e.pathname+s,method:t.method,headers:n[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:i};return{parsedURL:e,options:o}}});var Ao,C_=Xe(()=>{dl();Ao=class extends or{constructor(e,n="aborted"){super(e,n)}}});var R_={};Jc(R_,{AbortError:()=>Ao,Blob:()=>dn,FetchError:()=>mt,File:()=>Nr,FormData:()=>Mr,Headers:()=>At,Request:()=>Ur,Response:()=>Ot,blobFrom:()=>jy,blobFromSync:()=>Qy,default:()=>Ud,fileFrom:()=>e_,fileFromSync:()=>t_,isRedirect:()=>wo});import DI from"node:http";import UI from"node:https";import gs from"node:zlib";import A_,{PassThrough as b_,pipeline as ys}from"node:stream";import{Buffer as Tl}from"node:buffer";async function Ud(t,e){return new Promise((n,r)=>{let i=new Ur(t,e),{parsedURL:s,options:o}=T_(i);if(!LI.has(s.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${s.protocol.replace(/:$/,"")}" is not supported.`);if(s.protocol==="data:"){let v=Dy(i.url),w=new Ot(v,{headers:{"Content-Type":v.typeFull}});n(w);return}let a=(s.protocol==="https:"?UI:DI).request,{signal:d}=i,u=null,h=()=>{let v=new Ao("The operation was aborted.");r(v),i.body&&i.body instanceof A_.Readable&&i.body.destroy(v),!(!u||!u.body)&&u.body.emit("error",v)};if(d&&d.aborted){h();return}let m=()=>{h(),_()},g=a(s.toString(),o);d&&d.addEventListener("abort",m);let _=()=>{g.abort(),d&&d.removeEventListener("abort",m)};g.on("error",v=>{r(new mt(`request to ${i.url} failed, reason: ${v.message}`,"system",v)),_()}),FI(g,v=>{u&&u.body&&u.body.destroy(v)}),process.version<"v14"&&g.on("socket",v=>{let w;v.prependListener("end",()=>{w=v._eventsCount}),v.prependListener("close",T=>{if(u&&w<v._eventsCount&&!T){let A=new Error("Premature close");A.code="ERR_STREAM_PREMATURE_CLOSE",u.body.emit("error",A)}})}),g.on("response",v=>{g.setTimeout(0);let w=f_(v.rawHeaders);if(wo(v.statusCode)){let B=w.get("Location"),H=null;try{H=B===null?null:new URL(B,i.url)}catch{if(i.redirect!=="manual"){r(new mt(`uri requested responds with an invalid redirect URL: ${B}`,"invalid-redirect")),_();return}}switch(i.redirect){case"error":r(new mt(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),_();return;case"manual":break;case"follow":{if(H===null)break;if(i.counter>=i.follow){r(new mt(`maximum redirect reached at: ${i.url}`,"max-redirect")),_();return}let q={headers:new At(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:ps(i),signal:i.signal,size:i.size,referrer:i.referrer,referrerPolicy:i.referrerPolicy};if(!Jy(i.url,H)||!zy(i.url,H))for(let Y of["authorization","www-authenticate","cookie","cookie2"])q.headers.delete(Y);if(v.statusCode!==303&&i.body&&e.body instanceof A_.Readable){r(new mt("Cannot follow redirect with body being a readable stream","unsupported-redirect")),_();return}(v.statusCode===303||(v.statusCode===301||v.statusCode===302)&&i.method==="POST")&&(q.method="GET",q.body=void 0,q.headers.delete("content-length"));let $=S_(w);$&&(q.referrerPolicy=$),n(Ud(new Ur(H,q))),_();return}default:return r(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}d&&v.once("end",()=>{d.removeEventListener("abort",m)});let T=ys(v,new b_,B=>{B&&r(B)});process.version<"v12.10"&&v.on("aborted",m);let A={url:i.url,status:v.statusCode,statusText:v.statusMessage,headers:w,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},G=w.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||G===null||v.statusCode===204||v.statusCode===304){u=new Ot(T,A),n(u);return}let F={flush:gs.Z_SYNC_FLUSH,finishFlush:gs.Z_SYNC_FLUSH};if(G==="gzip"||G==="x-gzip"){T=ys(T,gs.createGunzip(F),B=>{B&&r(B)}),u=new Ot(T,A),n(u);return}if(G==="deflate"||G==="x-deflate"){let B=ys(v,new b_,H=>{H&&r(H)});B.once("data",H=>{(H[0]&15)===8?T=ys(T,gs.createInflate(),q=>{q&&r(q)}):T=ys(T,gs.createInflateRaw(),q=>{q&&r(q)}),u=new Ot(T,A),n(u)}),B.once("end",()=>{u||(u=new Ot(T,A),n(u))});return}if(G==="br"){T=ys(T,gs.createBrotliDecompress(),B=>{B&&r(B)}),u=new Ot(T,A),n(u);return}u=new Ot(T,A),n(u)}),c_(g,i).catch(r)})}function FI(t,e){let n=Tl.from(`0\r
\r
`),r=!1,i=!1,s;t.on("response",o=>{let{headers:a}=o;r=a["transfer-encoding"]==="chunked"&&!a["content-length"]}),t.on("socket",o=>{let a=()=>{if(r&&!i){let u=new Error("Premature close");u.code="ERR_STREAM_PREMATURE_CLOSE",e(u)}},d=u=>{i=Tl.compare(u.slice(-5),n)===0,!i&&s&&(i=Tl.compare(s.slice(-3),n.slice(0,3))===0&&Tl.compare(u.slice(-2),n.slice(3))===0),s=u};o.prependListener("close",a),o.on("data",d),t.on("close",()=>{o.removeListener("close",a),o.removeListener("data",d)})})}var LI,I_=Xe(()=>{Uy();_l();h_();Sl();w_();bd();C_();Od();cl();hl();Dd();Pd();LI=new Set(["data:","http:","https:"])});var k_=z(Es=>{"use strict";var qI=Es&&Es.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},_s;Object.defineProperty(Es,"__esModule",{value:!0});Es.Gaxios=void 0;var BI=qI(dd()),GI=X("https"),Si=pd(),HI=py(),P_=X("stream"),x_=yd(),VI=async()=>globalThis.crypto?.randomUUID()||(await import("crypto")).randomUUID(),$I=204,wl=class{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new x_.GaxiosInterceptorManager,response:new x_.GaxiosInterceptorManager}}fetch(...e){let n=e[0],r=e[1],i,s=new Headers;return typeof n=="string"?i=new URL(n):n instanceof URL?i=n:n&&n.url&&(i=new URL(n.url)),n&&typeof n=="object"&&"headers"in n&&_s.mergeHeaders(s,n.headers),r&&_s.mergeHeaders(s,new Headers(r.headers)),typeof n=="object"&&!(n instanceof URL)?this.request({...r,...n,headers:s,url:i}):this.request({...r,headers:s,url:i})}async request(e={}){let n=await this.#s(e);return n=await this.#t(n),this.#n(this._request(n))}async _defaultAdapter(e){let n=e.fetchImplementation||this.defaults.fetchImplementation||await _s.#l(),r={...e};delete r.data;let i=await n(e.url,r),s=await this.getResponseData(e,i);return Object.getOwnPropertyDescriptor(i,"data")?.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:s}}),Object.assign(i,{config:e,data:s})}async _request(e){try{let n;if(e.adapter?n=await e.adapter(e,this._defaultAdapter.bind(this)):n=await this._defaultAdapter(e),!e.validateStatus(n.status)){if(e.responseType==="stream"){let i=[];for await(let s of n.data)i.push(s);n.data=i.toString()}let r=Si.GaxiosError.extractAPIErrorFromResponse(n,`Request failed with status code ${n.status}`);throw new Si.GaxiosError(r?.message,e,n,r)}return n}catch(n){let r;n instanceof Si.GaxiosError?r=n:n instanceof Error?r=new Si.GaxiosError(n.message,e,void 0,n):r=new Si.GaxiosError("Unexpected Gaxios Error",e,void 0,n);let{shouldRetry:i,config:s}=await(0,HI.getRetryConfig)(r);if(i&&s)return r.config.retryConfig.currentRetryAttempt=s.retryConfig.currentRetryAttempt,e.retryConfig=r.config?.retryConfig,this.#r(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(r),r}}async getResponseData(e,n){if(n.status===$I)return"";if(e.maxContentLength&&n.headers.has("content-length")&&e.maxContentLength<Number.parseInt(n.headers?.get("content-length")||""))throw new Si.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(n,{config:e}));switch(e.responseType){case"stream":return n.body;case"json":{let r=await n.text();try{return JSON.parse(r)}catch{return r}}case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"text":return n.text();default:return this.getResponseDataFromContentType(n)}}#e(e,n=[]){let r=new URL(e),i=[...n],s=(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[];for(let o of s)i.push(o.trim());for(let o of i)if(o instanceof RegExp){if(o.test(r.toString()))return!1}else if(o instanceof URL){if(o.origin===r.origin)return!1}else if(o.startsWith("*.")||o.startsWith(".")){let a=o.replace(/^\*\./,".");if(r.hostname.endsWith(a))return!1}else if(o===r.origin||o===r.hostname||o===r.href)return!1;return!0}async#t(e){let n=Promise.resolve(e);for(let r of this.interceptors.request.values())r&&(n=n.then(r.resolved,r.rejected));return n}async#n(e){let n=Promise.resolve(e);for(let r of this.interceptors.response.values())r&&(n=n.then(r.resolved,r.rejected));return n}async#s(e){let n=new Headers(this.defaults.headers);_s.mergeHeaders(n,e.headers);let r=(0,BI.default)(!0,{},this.defaults,e);if(!r.url)throw new Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params)if(r.paramsSerializer){let o=r.paramsSerializer(r.params);o.startsWith("?")&&(o=o.slice(1));let a=r.url.toString().includes("?")?"&":"?";r.url=r.url+a+o}else{let o=r.url instanceof URL?r.url:new URL(r.url);for(let[a,d]of new URLSearchParams(r.params))o.searchParams.append(a,d);r.url=o}typeof e.maxContentLength=="number"&&(r.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(r.follow=e.maxRedirects);let i=typeof r.data=="string"||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof P_.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(r.data?.constructor?.name||"");if(r.multipart?.length){let o=await VI();n.set("content-type",`multipart/related; boundary=${o}`),r.body=P_.Readable.from(this.getMultipartRequest(r.multipart,o))}else i?r.body=r.data:typeof r.data=="object"?n.get("Content-Type")==="application/x-www-form-urlencoded"?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(n.has("content-type")||n.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",!n.has("accept")&&r.responseType==="json"&&n.set("accept","application/json");let s=r.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(!r.agent)if(s&&this.#e(r.url,r.noProxy)){let o=await _s.#a();this.agentCache.has(s)?r.agent=this.agentCache.get(s):(r.agent=new o(s,{cert:r.cert,key:r.key}),this.agentCache.set(s,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new GI.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return typeof r.errorRedactor!="function"&&r.errorRedactor!==!1&&(r.errorRedactor=Si.defaultErrorRedactor),r.body&&!("duplex"in r)&&(r.duplex="half"),this.#r(r),Object.assign(r,{headers:n,url:r.url instanceof URL?r.url:new URL(r.url)})}#r(e){if(e.timeout){let n=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,n]):e.signal=n}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let n=e.headers.get("Content-Type");if(n===null)return e.text();if(n=n.toLowerCase(),n.includes("application/json")){let r=await e.text();try{r=JSON.parse(r)}catch{}return r}else return n.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,n){let r=`--${n}--`;for(let i of e){let s=i.headers.get("Content-Type")||"application/octet-stream";yield`--${n}\r
Content-Type: ${s}\r
\r
`,typeof i.content=="string"?yield i.content:yield*i.content,yield`\r
`}yield r}static#i;static#o;static async#a(){return this.#i||=(await Promise.resolve().then(()=>Zn(Oy()))).HttpsProxyAgent,this.#i}static async#l(){let e=typeof window<"u"&&!!window;return this.#o||=e?window.fetch:(await Promise.resolve().then(()=>(I_(),R_))).default,this.#o}static mergeHeaders(e,...n){e=e instanceof Headers?e:new Headers(e);for(let r of n)(r instanceof Headers?r:new Headers(r)).forEach((s,o)=>{o==="set-cookie"?e.append(o,s):e.set(o,s)});return e}};Es.Gaxios=wl;_s=wl});var rt=z(gt=>{"use strict";var WI=gt&&gt.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),JI=gt&&gt.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&WI(e,t,n)};Object.defineProperty(gt,"__esModule",{value:!0});gt.instance=gt.Gaxios=gt.GaxiosError=void 0;gt.request=KI;var N_=k_();Object.defineProperty(gt,"Gaxios",{enumerable:!0,get:function(){return N_.Gaxios}});var zI=pd();Object.defineProperty(gt,"GaxiosError",{enumerable:!0,get:function(){return zI.GaxiosError}});JI(yd(),gt);gt.instance=new N_.Gaxios;async function KI(t){return gt.instance.request(t)}});var Ld=z((M_,Cl)=>{(function(t){"use strict";var e,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,s="[BigNumber Error] ",o=s+"Number primitive has more than 15 significant digits: ",a=1e14,d=14,u=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,g=1e9;function _(H){var q,$,Y,L=K.prototype={constructor:K,toString:null,valueOf:null},te=new K(1),oe=20,fe=4,le=-7,ve=21,Me=-1e7,Oe=1e7,Pe=!1,et=1,ut=0,Ui={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},An="0123456789abcdefghijklmnopqrstuvwxyz",eo=!0;function K(E,C){var b,M,P,k,U,I,x,O,N=this;if(!(N instanceof K))return new K(E,C);if(C==null){if(E&&E._isBigNumber===!0){N.s=E.s,!E.c||E.e>Oe?N.c=N.e=null:E.e<Me?N.c=[N.e=0]:(N.e=E.e,N.c=E.c.slice());return}if((I=typeof E=="number")&&E*0==0){if(N.s=1/E<0?(E=-E,-1):1,E===~~E){for(k=0,U=E;U>=10;U/=10,k++);k>Oe?N.c=N.e=null:(N.e=k,N.c=[E]);return}O=String(E)}else{if(!n.test(O=String(E)))return Y(N,O,I);N.s=O.charCodeAt(0)==45?(O=O.slice(1),-1):1}(k=O.indexOf("."))>-1&&(O=O.replace(".","")),(U=O.search(/e/i))>0?(k<0&&(k=U),k+=+O.slice(U+1),O=O.substring(0,U)):k<0&&(k=O.length)}else{if(A(C,2,An.length,"Base"),C==10&&eo)return N=new K(E),dt(N,oe+N.e+1,fe);if(O=String(E),I=typeof E=="number"){if(E*0!=0)return Y(N,O,I,C);if(N.s=1/E<0?(O=O.slice(1),-1):1,K.DEBUG&&O.replace(/^0\.0*|\./,"").length>15)throw Error(o+E)}else N.s=O.charCodeAt(0)===45?(O=O.slice(1),-1):1;for(b=An.slice(0,C),k=U=0,x=O.length;U<x;U++)if(b.indexOf(M=O.charAt(U))<0){if(M=="."){if(U>k){k=x;continue}}else if(!P&&(O==O.toUpperCase()&&(O=O.toLowerCase())||O==O.toLowerCase()&&(O=O.toUpperCase()))){P=!0,U=-1,k=0;continue}return Y(N,String(E),I,C)}I=!1,O=$(O,C,10,N.s),(k=O.indexOf("."))>-1?O=O.replace(".",""):k=O.length}for(U=0;O.charCodeAt(U)===48;U++);for(x=O.length;O.charCodeAt(--x)===48;);if(O=O.slice(U,++x)){if(x-=U,I&&K.DEBUG&&x>15&&(E>u||E!==i(E)))throw Error(o+N.s*E);if((k=k-U-1)>Oe)N.c=N.e=null;else if(k<Me)N.c=[N.e=0];else{if(N.e=k,N.c=[],U=(k+1)%d,k<0&&(U+=d),U<x){for(U&&N.c.push(+O.slice(0,U)),x-=d;U<x;)N.c.push(+O.slice(U,U+=d));U=d-(O=O.slice(U)).length}else U-=x;for(;U--;O+="0");N.c.push(+O)}}else N.c=[N.e=0]}K.clone=_,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(E){var C,b;if(E!=null)if(typeof E=="object"){if(E.hasOwnProperty(C="DECIMAL_PLACES")&&(b=E[C],A(b,0,g,C),oe=b),E.hasOwnProperty(C="ROUNDING_MODE")&&(b=E[C],A(b,0,8,C),fe=b),E.hasOwnProperty(C="EXPONENTIAL_AT")&&(b=E[C],b&&b.pop?(A(b[0],-g,0,C),A(b[1],0,g,C),le=b[0],ve=b[1]):(A(b,-g,g,C),le=-(ve=b<0?-b:b))),E.hasOwnProperty(C="RANGE"))if(b=E[C],b&&b.pop)A(b[0],-g,-1,C),A(b[1],1,g,C),Me=b[0],Oe=b[1];else if(A(b,-g,g,C),b)Me=-(Oe=b<0?-b:b);else throw Error(s+C+" cannot be zero: "+b);if(E.hasOwnProperty(C="CRYPTO"))if(b=E[C],b===!!b)if(b)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Pe=b;else throw Pe=!b,Error(s+"crypto unavailable");else Pe=b;else throw Error(s+C+" not true or false: "+b);if(E.hasOwnProperty(C="MODULO_MODE")&&(b=E[C],A(b,0,9,C),et=b),E.hasOwnProperty(C="POW_PRECISION")&&(b=E[C],A(b,0,g,C),ut=b),E.hasOwnProperty(C="FORMAT"))if(b=E[C],typeof b=="object")Ui=b;else throw Error(s+C+" not an object: "+b);if(E.hasOwnProperty(C="ALPHABET"))if(b=E[C],typeof b=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(b))eo=b.slice(0,10)=="0123456789",An=b;else throw Error(s+C+" invalid: "+b)}else throw Error(s+"Object expected: "+E);return{DECIMAL_PLACES:oe,ROUNDING_MODE:fe,EXPONENTIAL_AT:[le,ve],RANGE:[Me,Oe],CRYPTO:Pe,MODULO_MODE:et,POW_PRECISION:ut,FORMAT:Ui,ALPHABET:An}},K.isBigNumber=function(E){if(!E||E._isBigNumber!==!0)return!1;if(!K.DEBUG)return!0;var C,b,M=E.c,P=E.e,k=E.s;e:if({}.toString.call(M)=="[object Array]"){if((k===1||k===-1)&&P>=-g&&P<=g&&P===i(P)){if(M[0]===0){if(P===0&&M.length===1)return!0;break e}if(C=(P+1)%d,C<1&&(C+=d),String(M[0]).length==C){for(C=0;C<M.length;C++)if(b=M[C],b<0||b>=a||b!==i(b))break e;if(b!==0)return!0}}}else if(M===null&&P===null&&(k===null||k===1||k===-1))return!0;throw Error(s+"Invalid BigNumber: "+E)},K.maximum=K.max=function(){return ct(arguments,-1)},K.minimum=K.min=function(){return ct(arguments,1)},K.random=(function(){var E=9007199254740992,C=Math.random()*E&2097151?function(){return i(Math.random()*E)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(b){var M,P,k,U,I,x=0,O=[],N=new K(te);if(b==null?b=oe:A(b,0,g),U=r(b/d),Pe)if(crypto.getRandomValues){for(M=crypto.getRandomValues(new Uint32Array(U*=2));x<U;)I=M[x]*131072+(M[x+1]>>>11),I>=9e15?(P=crypto.getRandomValues(new Uint32Array(2)),M[x]=P[0],M[x+1]=P[1]):(O.push(I%1e14),x+=2);x=U/2}else if(crypto.randomBytes){for(M=crypto.randomBytes(U*=7);x<U;)I=(M[x]&31)*281474976710656+M[x+1]*1099511627776+M[x+2]*4294967296+M[x+3]*16777216+(M[x+4]<<16)+(M[x+5]<<8)+M[x+6],I>=9e15?crypto.randomBytes(7).copy(M,x):(O.push(I%1e14),x+=7);x=U/7}else throw Pe=!1,Error(s+"crypto unavailable");if(!Pe)for(;x<U;)I=C(),I<9e15&&(O[x++]=I%1e14);for(U=O[--x],b%=d,U&&b&&(I=h[d-b],O[x]=i(U/I)*I);O[x]===0;O.pop(),x--);if(x<0)O=[k=0];else{for(k=-1;O[0]===0;O.splice(0,1),k-=d);for(x=1,I=O[0];I>=10;I/=10,x++);x<d&&(k-=d-x)}return N.e=k,N.c=O,N}})(),K.sum=function(){for(var E=1,C=arguments,b=new K(C[0]);E<C.length;)b=b.plus(C[E++]);return b},$=(function(){var E="0123456789";function C(b,M,P,k){for(var U,I=[0],x,O=0,N=b.length;O<N;){for(x=I.length;x--;I[x]*=M);for(I[0]+=k.indexOf(b.charAt(O++)),U=0;U<I.length;U++)I[U]>P-1&&(I[U+1]==null&&(I[U+1]=0),I[U+1]+=I[U]/P|0,I[U]%=P)}return I.reverse()}return function(b,M,P,k,U){var I,x,O,N,W,ne,se,Ie,Be=b.indexOf("."),Ge=oe,be=fe;for(Be>=0&&(N=ut,ut=0,b=b.replace(".",""),Ie=new K(M),ne=Ie.pow(b.length-Be),ut=N,Ie.c=C(B(w(ne.c),ne.e,"0"),10,P,E),Ie.e=Ie.c.length),se=C(b,M,P,U?(I=An,E):(I=E,An)),O=N=se.length;se[--N]==0;se.pop());if(!se[0])return I.charAt(0);if(Be<0?--O:(ne.c=se,ne.e=O,ne.s=k,ne=q(ne,Ie,Ge,be,P),se=ne.c,W=ne.r,O=ne.e),x=O+Ge+1,Be=se[x],N=P/2,W=W||x<0||se[x+1]!=null,W=be<4?(Be!=null||W)&&(be==0||be==(ne.s<0?3:2)):Be>N||Be==N&&(be==4||W||be==6&&se[x-1]&1||be==(ne.s<0?8:7)),x<1||!se[0])b=W?B(I.charAt(1),-Ge,I.charAt(0)):I.charAt(0);else{if(se.length=x,W)for(--P;++se[--x]>P;)se[x]=0,x||(++O,se=[1].concat(se));for(N=se.length;!se[--N];);for(Be=0,b="";Be<=N;b+=I.charAt(se[Be++]));b=B(b,O,I.charAt(0))}return b}})(),q=(function(){function E(M,P,k){var U,I,x,O,N=0,W=M.length,ne=P%m,se=P/m|0;for(M=M.slice();W--;)x=M[W]%m,O=M[W]/m|0,U=se*x+O*ne,I=ne*x+U%m*m+N,N=(I/k|0)+(U/m|0)+se*O,M[W]=I%k;return N&&(M=[N].concat(M)),M}function C(M,P,k,U){var I,x;if(k!=U)x=k>U?1:-1;else for(I=x=0;I<k;I++)if(M[I]!=P[I]){x=M[I]>P[I]?1:-1;break}return x}function b(M,P,k,U){for(var I=0;k--;)M[k]-=I,I=M[k]<P[k]?1:0,M[k]=I*U+M[k]-P[k];for(;!M[0]&&M.length>1;M.splice(0,1));}return function(M,P,k,U,I){var x,O,N,W,ne,se,Ie,Be,Ge,be,Ne,Ke,Li,Fi,qi,It,$n,it=M.s==P.s?1:-1,Ye=M.c,De=P.c;if(!Ye||!Ye[0]||!De||!De[0])return new K(!M.s||!P.s||(Ye?De&&Ye[0]==De[0]:!De)?NaN:Ye&&Ye[0]==0||!De?it*0:it/0);for(Be=new K(it),Ge=Be.c=[],O=M.e-P.e,it=k+O+1,I||(I=a,O=v(M.e/d)-v(P.e/d),it=it/d|0),N=0;De[N]==(Ye[N]||0);N++);if(De[N]>(Ye[N]||0)&&O--,it<0)Ge.push(1),W=!0;else{for(Fi=Ye.length,It=De.length,N=0,it+=2,ne=i(I/(De[0]+1)),ne>1&&(De=E(De,ne,I),Ye=E(Ye,ne,I),It=De.length,Fi=Ye.length),Li=It,be=Ye.slice(0,It),Ne=be.length;Ne<It;be[Ne++]=0);$n=De.slice(),$n=[0].concat($n),qi=De[0],De[1]>=I/2&&qi++;do{if(ne=0,x=C(De,be,It,Ne),x<0){if(Ke=be[0],It!=Ne&&(Ke=Ke*I+(be[1]||0)),ne=i(Ke/qi),ne>1)for(ne>=I&&(ne=I-1),se=E(De,ne,I),Ie=se.length,Ne=be.length;C(se,be,Ie,Ne)==1;)ne--,b(se,It<Ie?$n:De,Ie,I),Ie=se.length,x=1;else ne==0&&(x=ne=1),se=De.slice(),Ie=se.length;if(Ie<Ne&&(se=[0].concat(se)),b(be,se,Ne,I),Ne=be.length,x==-1)for(;C(De,be,It,Ne)<1;)ne++,b(be,It<Ne?$n:De,Ne,I),Ne=be.length}else x===0&&(ne++,be=[0]);Ge[N++]=ne,be[0]?be[Ne++]=Ye[Li]||0:(be=[Ye[Li]],Ne=1)}while((Li++<Fi||be[0]!=null)&&it--);W=be[0]!=null,Ge[0]||Ge.splice(0,1)}if(I==a){for(N=1,it=Ge[0];it>=10;it/=10,N++);dt(Be,k+(Be.e=N+O*d-1)+1,U,W)}else Be.e=O,Be.r=+W;return Be}})();function _t(E,C,b,M){var P,k,U,I,x;if(b==null?b=fe:A(b,0,8),!E.c)return E.toString();if(P=E.c[0],U=E.e,C==null)x=w(E.c),x=M==1||M==2&&(U<=le||U>=ve)?F(x,U):B(x,U,"0");else if(E=dt(new K(E),C,b),k=E.e,x=w(E.c),I=x.length,M==1||M==2&&(C<=k||k<=le)){for(;I<C;x+="0",I++);x=F(x,k)}else if(C-=U+(M===2&&k>U),x=B(x,k,"0"),k+1>I){if(--C>0)for(x+=".";C--;x+="0");}else if(C+=k-I,C>0)for(k+1==I&&(x+=".");C--;x+="0");return E.s<0&&P?"-"+x:x}function ct(E,C){for(var b,M,P=1,k=new K(E[0]);P<E.length;P++)M=new K(E[P]),(!M.s||(b=T(k,M))===C||b===0&&k.s===C)&&(k=M);return k}function to(E,C,b){for(var M=1,P=C.length;!C[--P];C.pop());for(P=C[0];P>=10;P/=10,M++);return(b=M+b*d-1)>Oe?E.c=E.e=null:b<Me?E.c=[E.e=0]:(E.e=b,E.c=C),E}Y=(function(){var E=/^(-?)0([xbo])(?=\w[\w.]*$)/i,C=/^([^.]+)\.$/,b=/^\.([^.]+)$/,M=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(k,U,I,x){var O,N=I?U:U.replace(P,"");if(M.test(N))k.s=isNaN(N)?null:N<0?-1:1;else{if(!I&&(N=N.replace(E,function(W,ne,se){return O=(se=se.toLowerCase())=="x"?16:se=="b"?2:8,!x||x==O?ne:W}),x&&(O=x,N=N.replace(C,"$1").replace(b,"0.$1")),U!=N))return new K(N,O);if(K.DEBUG)throw Error(s+"Not a"+(x?" base "+x:"")+" number: "+U);k.s=null}k.c=k.e=null}})();function dt(E,C,b,M){var P,k,U,I,x,O,N,W=E.c,ne=h;if(W){e:{for(P=1,I=W[0];I>=10;I/=10,P++);if(k=C-P,k<0)k+=d,U=C,x=W[O=0],N=i(x/ne[P-U-1]%10);else if(O=r((k+1)/d),O>=W.length)if(M){for(;W.length<=O;W.push(0));x=N=0,P=1,k%=d,U=k-d+1}else break e;else{for(x=I=W[O],P=1;I>=10;I/=10,P++);k%=d,U=k-d+P,N=U<0?0:i(x/ne[P-U-1]%10)}if(M=M||C<0||W[O+1]!=null||(U<0?x:x%ne[P-U-1]),M=b<4?(N||M)&&(b==0||b==(E.s<0?3:2)):N>5||N==5&&(b==4||M||b==6&&(k>0?U>0?x/ne[P-U]:0:W[O-1])%10&1||b==(E.s<0?8:7)),C<1||!W[0])return W.length=0,M?(C-=E.e+1,W[0]=ne[(d-C%d)%d],E.e=-C||0):W[0]=E.e=0,E;if(k==0?(W.length=O,I=1,O--):(W.length=O+1,I=ne[d-k],W[O]=U>0?i(x/ne[P-U]%ne[U])*I:0),M)for(;;)if(O==0){for(k=1,U=W[0];U>=10;U/=10,k++);for(U=W[0]+=I,I=1;U>=10;U/=10,I++);k!=I&&(E.e++,W[0]==a&&(W[0]=1));break}else{if(W[O]+=I,W[O]!=a)break;W[O--]=0,I=1}for(k=W.length;W[--k]===0;W.pop());}E.e>Oe?E.c=E.e=null:E.e<Me&&(E.c=[E.e=0])}return E}function ze(E){var C,b=E.e;return b===null?E.toString():(C=w(E.c),C=b<=le||b>=ve?F(C,b):B(C,b,"0"),E.s<0?"-"+C:C)}return L.absoluteValue=L.abs=function(){var E=new K(this);return E.s<0&&(E.s=1),E},L.comparedTo=function(E,C){return T(this,new K(E,C))},L.decimalPlaces=L.dp=function(E,C){var b,M,P,k=this;if(E!=null)return A(E,0,g),C==null?C=fe:A(C,0,8),dt(new K(k),E+k.e+1,C);if(!(b=k.c))return null;if(M=((P=b.length-1)-v(this.e/d))*d,P=b[P])for(;P%10==0;P/=10,M--);return M<0&&(M=0),M},L.dividedBy=L.div=function(E,C){return q(this,new K(E,C),oe,fe)},L.dividedToIntegerBy=L.idiv=function(E,C){return q(this,new K(E,C),0,1)},L.exponentiatedBy=L.pow=function(E,C){var b,M,P,k,U,I,x,O,N,W=this;if(E=new K(E),E.c&&!E.isInteger())throw Error(s+"Exponent not an integer: "+ze(E));if(C!=null&&(C=new K(C)),I=E.e>14,!W.c||!W.c[0]||W.c[0]==1&&!W.e&&W.c.length==1||!E.c||!E.c[0])return N=new K(Math.pow(+ze(W),I?E.s*(2-G(E)):+ze(E))),C?N.mod(C):N;if(x=E.s<0,C){if(C.c?!C.c[0]:!C.s)return new K(NaN);M=!x&&W.isInteger()&&C.isInteger(),M&&(W=W.mod(C))}else{if(E.e>9&&(W.e>0||W.e<-1||(W.e==0?W.c[0]>1||I&&W.c[1]>=24e7:W.c[0]<8e13||I&&W.c[0]<=9999975e7)))return k=W.s<0&&G(E)?-0:0,W.e>-1&&(k=1/k),new K(x?1/k:k);ut&&(k=r(ut/d+2))}for(I?(b=new K(.5),x&&(E.s=1),O=G(E)):(P=Math.abs(+ze(E)),O=P%2),N=new K(te);;){if(O){if(N=N.times(W),!N.c)break;k?N.c.length>k&&(N.c.length=k):M&&(N=N.mod(C))}if(P){if(P=i(P/2),P===0)break;O=P%2}else if(E=E.times(b),dt(E,E.e+1,1),E.e>14)O=G(E);else{if(P=+ze(E),P===0)break;O=P%2}W=W.times(W),k?W.c&&W.c.length>k&&(W.c.length=k):M&&(W=W.mod(C))}return M?N:(x&&(N=te.div(N)),C?N.mod(C):k?dt(N,ut,fe,U):N)},L.integerValue=function(E){var C=new K(this);return E==null?E=fe:A(E,0,8),dt(C,C.e+1,E)},L.isEqualTo=L.eq=function(E,C){return T(this,new K(E,C))===0},L.isFinite=function(){return!!this.c},L.isGreaterThan=L.gt=function(E,C){return T(this,new K(E,C))>0},L.isGreaterThanOrEqualTo=L.gte=function(E,C){return(C=T(this,new K(E,C)))===1||C===0},L.isInteger=function(){return!!this.c&&v(this.e/d)>this.c.length-2},L.isLessThan=L.lt=function(E,C){return T(this,new K(E,C))<0},L.isLessThanOrEqualTo=L.lte=function(E,C){return(C=T(this,new K(E,C)))===-1||C===0},L.isNaN=function(){return!this.s},L.isNegative=function(){return this.s<0},L.isPositive=function(){return this.s>0},L.isZero=function(){return!!this.c&&this.c[0]==0},L.minus=function(E,C){var b,M,P,k,U=this,I=U.s;if(E=new K(E,C),C=E.s,!I||!C)return new K(NaN);if(I!=C)return E.s=-C,U.plus(E);var x=U.e/d,O=E.e/d,N=U.c,W=E.c;if(!x||!O){if(!N||!W)return N?(E.s=-C,E):new K(W?U:NaN);if(!N[0]||!W[0])return W[0]?(E.s=-C,E):new K(N[0]?U:fe==3?-0:0)}if(x=v(x),O=v(O),N=N.slice(),I=x-O){for((k=I<0)?(I=-I,P=N):(O=x,P=W),P.reverse(),C=I;C--;P.push(0));P.reverse()}else for(M=(k=(I=N.length)<(C=W.length))?I:C,I=C=0;C<M;C++)if(N[C]!=W[C]){k=N[C]<W[C];break}if(k&&(P=N,N=W,W=P,E.s=-E.s),C=(M=W.length)-(b=N.length),C>0)for(;C--;N[b++]=0);for(C=a-1;M>I;){if(N[--M]<W[M]){for(b=M;b&&!N[--b];N[b]=C);--N[b],N[M]+=a}N[M]-=W[M]}for(;N[0]==0;N.splice(0,1),--O);return N[0]?to(E,N,O):(E.s=fe==3?-1:1,E.c=[E.e=0],E)},L.modulo=L.mod=function(E,C){var b,M,P=this;return E=new K(E,C),!P.c||!E.s||E.c&&!E.c[0]?new K(NaN):!E.c||P.c&&!P.c[0]?new K(P):(et==9?(M=E.s,E.s=1,b=q(P,E,0,3),E.s=M,b.s*=M):b=q(P,E,0,et),E=P.minus(b.times(E)),!E.c[0]&&et==1&&(E.s=P.s),E)},L.multipliedBy=L.times=function(E,C){var b,M,P,k,U,I,x,O,N,W,ne,se,Ie,Be,Ge,be=this,Ne=be.c,Ke=(E=new K(E,C)).c;if(!Ne||!Ke||!Ne[0]||!Ke[0])return!be.s||!E.s||Ne&&!Ne[0]&&!Ke||Ke&&!Ke[0]&&!Ne?E.c=E.e=E.s=null:(E.s*=be.s,!Ne||!Ke?E.c=E.e=null:(E.c=[0],E.e=0)),E;for(M=v(be.e/d)+v(E.e/d),E.s*=be.s,x=Ne.length,W=Ke.length,x<W&&(Ie=Ne,Ne=Ke,Ke=Ie,P=x,x=W,W=P),P=x+W,Ie=[];P--;Ie.push(0));for(Be=a,Ge=m,P=W;--P>=0;){for(b=0,ne=Ke[P]%Ge,se=Ke[P]/Ge|0,U=x,k=P+U;k>P;)O=Ne[--U]%Ge,N=Ne[U]/Ge|0,I=se*O+N*ne,O=ne*O+I%Ge*Ge+Ie[k]+b,b=(O/Be|0)+(I/Ge|0)+se*N,Ie[k--]=O%Be;Ie[k]=b}return b?++M:Ie.splice(0,1),to(E,Ie,M)},L.negated=function(){var E=new K(this);return E.s=-E.s||null,E},L.plus=function(E,C){var b,M=this,P=M.s;if(E=new K(E,C),C=E.s,!P||!C)return new K(NaN);if(P!=C)return E.s=-C,M.minus(E);var k=M.e/d,U=E.e/d,I=M.c,x=E.c;if(!k||!U){if(!I||!x)return new K(P/0);if(!I[0]||!x[0])return x[0]?E:new K(I[0]?M:P*0)}if(k=v(k),U=v(U),I=I.slice(),P=k-U){for(P>0?(U=k,b=x):(P=-P,b=I),b.reverse();P--;b.push(0));b.reverse()}for(P=I.length,C=x.length,P-C<0&&(b=x,x=I,I=b,C=P),P=0;C;)P=(I[--C]=I[C]+x[C]+P)/a|0,I[C]=a===I[C]?0:I[C]%a;return P&&(I=[P].concat(I),++U),to(E,I,U)},L.precision=L.sd=function(E,C){var b,M,P,k=this;if(E!=null&&E!==!!E)return A(E,1,g),C==null?C=fe:A(C,0,8),dt(new K(k),E,C);if(!(b=k.c))return null;if(P=b.length-1,M=P*d+1,P=b[P]){for(;P%10==0;P/=10,M--);for(P=b[0];P>=10;P/=10,M++);}return E&&k.e+1>M&&(M=k.e+1),M},L.shiftedBy=function(E){return A(E,-u,u),this.times("1e"+E)},L.squareRoot=L.sqrt=function(){var E,C,b,M,P,k=this,U=k.c,I=k.s,x=k.e,O=oe+4,N=new K("0.5");if(I!==1||!U||!U[0])return new K(!I||I<0&&(!U||U[0])?NaN:U?k:1/0);if(I=Math.sqrt(+ze(k)),I==0||I==1/0?(C=w(U),(C.length+x)%2==0&&(C+="0"),I=Math.sqrt(+C),x=v((x+1)/2)-(x<0||x%2),I==1/0?C="5e"+x:(C=I.toExponential(),C=C.slice(0,C.indexOf("e")+1)+x),b=new K(C)):b=new K(I+""),b.c[0]){for(x=b.e,I=x+O,I<3&&(I=0);;)if(P=b,b=N.times(P.plus(q(k,P,O,1))),w(P.c).slice(0,I)===(C=w(b.c)).slice(0,I))if(b.e<x&&--I,C=C.slice(I-3,I+1),C=="9999"||!M&&C=="4999"){if(!M&&(dt(P,P.e+oe+2,0),P.times(P).eq(k))){b=P;break}O+=4,I+=4,M=1}else{(!+C||!+C.slice(1)&&C.charAt(0)=="5")&&(dt(b,b.e+oe+2,1),E=!b.times(b).eq(k));break}}return dt(b,b.e+oe+1,fe,E)},L.toExponential=function(E,C){return E!=null&&(A(E,0,g),E++),_t(this,E,C,1)},L.toFixed=function(E,C){return E!=null&&(A(E,0,g),E=E+this.e+1),_t(this,E,C)},L.toFormat=function(E,C,b){var M,P=this;if(b==null)E!=null&&C&&typeof C=="object"?(b=C,C=null):E&&typeof E=="object"?(b=E,E=C=null):b=Ui;else if(typeof b!="object")throw Error(s+"Argument not an object: "+b);if(M=P.toFixed(E,C),P.c){var k,U=M.split("."),I=+b.groupSize,x=+b.secondaryGroupSize,O=b.groupSeparator||"",N=U[0],W=U[1],ne=P.s<0,se=ne?N.slice(1):N,Ie=se.length;if(x&&(k=I,I=x,x=k,Ie-=k),I>0&&Ie>0){for(k=Ie%I||I,N=se.substr(0,k);k<Ie;k+=I)N+=O+se.substr(k,I);x>0&&(N+=O+se.slice(k)),ne&&(N="-"+N)}M=W?N+(b.decimalSeparator||"")+((x=+b.fractionGroupSize)?W.replace(new RegExp("\\d{"+x+"}\\B","g"),"$&"+(b.fractionGroupSeparator||"")):W):N}return(b.prefix||"")+M+(b.suffix||"")},L.toFraction=function(E){var C,b,M,P,k,U,I,x,O,N,W,ne,se=this,Ie=se.c;if(E!=null&&(I=new K(E),!I.isInteger()&&(I.c||I.s!==1)||I.lt(te)))throw Error(s+"Argument "+(I.isInteger()?"out of range: ":"not an integer: ")+ze(I));if(!Ie)return new K(se);for(C=new K(te),O=b=new K(te),M=x=new K(te),ne=w(Ie),k=C.e=ne.length-se.e-1,C.c[0]=h[(U=k%d)<0?d+U:U],E=!E||I.comparedTo(C)>0?k>0?C:O:I,U=Oe,Oe=1/0,I=new K(ne),x.c[0]=0;N=q(I,C,0,1),P=b.plus(N.times(M)),P.comparedTo(E)!=1;)b=M,M=P,O=x.plus(N.times(P=O)),x=P,C=I.minus(N.times(P=C)),I=P;return P=q(E.minus(b),M,0,1),x=x.plus(P.times(O)),b=b.plus(P.times(M)),x.s=O.s=se.s,k=k*2,W=q(O,M,k,fe).minus(se).abs().comparedTo(q(x,b,k,fe).minus(se).abs())<1?[O,M]:[x,b],Oe=U,W},L.toNumber=function(){return+ze(this)},L.toPrecision=function(E,C){return E!=null&&A(E,1,g),_t(this,E,C,2)},L.toString=function(E){var C,b=this,M=b.s,P=b.e;return P===null?M?(C="Infinity",M<0&&(C="-"+C)):C="NaN":(E==null?C=P<=le||P>=ve?F(w(b.c),P):B(w(b.c),P,"0"):E===10&&eo?(b=dt(new K(b),oe+P+1,fe),C=B(w(b.c),b.e,"0")):(A(E,2,An.length,"Base"),C=$(B(w(b.c),P,"0"),10,E,M,!0)),M<0&&b.c[0]&&(C="-"+C)),C},L.valueOf=L.toJSON=function(){return ze(this)},L._isBigNumber=!0,H!=null&&K.set(H),K}function v(H){var q=H|0;return H>0||H===q?q:q-1}function w(H){for(var q,$,Y=1,L=H.length,te=H[0]+"";Y<L;){for(q=H[Y++]+"",$=d-q.length;$--;q="0"+q);te+=q}for(L=te.length;te.charCodeAt(--L)===48;);return te.slice(0,L+1||1)}function T(H,q){var $,Y,L=H.c,te=q.c,oe=H.s,fe=q.s,le=H.e,ve=q.e;if(!oe||!fe)return null;if($=L&&!L[0],Y=te&&!te[0],$||Y)return $?Y?0:-fe:oe;if(oe!=fe)return oe;if($=oe<0,Y=le==ve,!L||!te)return Y?0:!L^$?1:-1;if(!Y)return le>ve^$?1:-1;for(fe=(le=L.length)<(ve=te.length)?le:ve,oe=0;oe<fe;oe++)if(L[oe]!=te[oe])return L[oe]>te[oe]^$?1:-1;return le==ve?0:le>ve^$?1:-1}function A(H,q,$,Y){if(H<q||H>$||H!==i(H))throw Error(s+(Y||"Argument")+(typeof H=="number"?H<q||H>$?" out of range: ":" not an integer: ":" not a primitive number: ")+String(H))}function G(H){var q=H.c.length-1;return v(H.e/d)==q&&H.c[q]%2!=0}function F(H,q){return(H.length>1?H.charAt(0)+"."+H.slice(1):H)+(q<0?"e":"e+")+q}function B(H,q,$){var Y,L;if(q<0){for(L=$+".";++q;L+=$);H=L+H}else if(Y=H.length,++q>Y){for(L=$,q-=Y;--q;L+=$);H+=L}else q<Y&&(H=H.slice(0,q)+"."+H.slice(q));return H}e=_(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof Cl<"u"&&Cl.exports?Cl.exports=e:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=e)})(M_)});var L_=z((z$,U_)=>{var O_=Ld(),D_=U_.exports;(function(){"use strict";function t(u){return u<10?"0"+u:u}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,i,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;function a(u){return n.lastIndex=0,n.test(u)?'"'+u.replace(n,function(h){var m=s[h];return typeof m=="string"?m:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+u+'"'}function d(u,h){var m,g,_,v,w=r,T,A=h[u],G=A!=null&&(A instanceof O_||O_.isBigNumber(A));switch(A&&typeof A=="object"&&typeof A.toJSON=="function"&&(A=A.toJSON(u)),typeof o=="function"&&(A=o.call(h,u,A)),typeof A){case"string":return G?A:a(A);case"number":return isFinite(A)?String(A):"null";case"boolean":case"null":case"bigint":return String(A);case"object":if(!A)return"null";if(r+=i,T=[],Object.prototype.toString.apply(A)==="[object Array]"){for(v=A.length,m=0;m<v;m+=1)T[m]=d(m,A)||"null";return _=T.length===0?"[]":r?`[
`+r+T.join(`,
`+r)+`
`+w+"]":"["+T.join(",")+"]",r=w,_}if(o&&typeof o=="object")for(v=o.length,m=0;m<v;m+=1)typeof o[m]=="string"&&(g=o[m],_=d(g,A),_&&T.push(a(g)+(r?": ":":")+_));else Object.keys(A).forEach(function(F){var B=d(F,A);B&&T.push(a(F)+(r?": ":":")+B)});return _=T.length===0?"{}":r?`{
`+r+T.join(`,
`+r)+`
`+w+"}":"{"+T.join(",")+"}",r=w,_}}typeof D_.stringify!="function"&&(D_.stringify=function(u,h,m){var g;if(r="",i="",typeof m=="number")for(g=0;g<m;g+=1)i+=" ";else typeof m=="string"&&(i=m);if(o=h,h&&typeof h!="function"&&(typeof h!="object"||typeof h.length!="number"))throw new Error("JSON.stringify");return d("",{"":u})})})()});var q_=z((K$,F_)=>{var Al=null,YI=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,XI=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,ZI=function(t){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(t!=null){if(t.strict===!0&&(e.strict=!0),t.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=t.alwaysParseAsBig===!0?t.alwaysParseAsBig:!1,e.useNativeBigInt=t.useNativeBigInt===!0?t.useNativeBigInt:!1,typeof t.constructorAction<"u")if(t.constructorAction==="error"||t.constructorAction==="ignore"||t.constructorAction==="preserve")e.constructorAction=t.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${t.constructorAction}`);if(typeof t.protoAction<"u")if(t.protoAction==="error"||t.protoAction==="ignore"||t.protoAction==="preserve")e.protoAction=t.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${t.protoAction}`)}var n,r,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},s,o=function(w){throw{name:"SyntaxError",message:w,at:n,text:s}},a=function(w){return w&&w!==r&&o("Expected '"+w+"' instead of '"+r+"'"),r=s.charAt(n),n+=1,r},d=function(){var w,T="";for(r==="-"&&(T="-",a("-"));r>="0"&&r<="9";)T+=r,a();if(r===".")for(T+=".";a()&&r>="0"&&r<="9";)T+=r;if(r==="e"||r==="E")for(T+=r,a(),(r==="-"||r==="+")&&(T+=r,a());r>="0"&&r<="9";)T+=r,a();if(w=+T,!isFinite(w))o("Bad number");else return Al==null&&(Al=Ld()),T.length>15?e.storeAsString?T:e.useNativeBigInt?BigInt(T):new Al(T):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(w):new Al(w):w},u=function(){var w,T,A="",G;if(r==='"')for(var F=n;a();){if(r==='"')return n-1>F&&(A+=s.substring(F,n-1)),a(),A;if(r==="\\"){if(n-1>F&&(A+=s.substring(F,n-1)),a(),r==="u"){for(G=0,T=0;T<4&&(w=parseInt(a(),16),!!isFinite(w));T+=1)G=G*16+w;A+=String.fromCharCode(G)}else if(typeof i[r]=="string")A+=i[r];else break;F=n}}o("Bad string")},h=function(){for(;r&&r<=" ";)a()},m=function(){switch(r){case"t":return a("t"),a("r"),a("u"),a("e"),!0;case"f":return a("f"),a("a"),a("l"),a("s"),a("e"),!1;case"n":return a("n"),a("u"),a("l"),a("l"),null}o("Unexpected '"+r+"'")},g,_=function(){var w=[];if(r==="["){if(a("["),h(),r==="]")return a("]"),w;for(;r;){if(w.push(g()),h(),r==="]")return a("]"),w;a(","),h()}}o("Bad array")},v=function(){var w,T=Object.create(null);if(r==="{"){if(a("{"),h(),r==="}")return a("}"),T;for(;r;){if(w=u(),h(),a(":"),e.strict===!0&&Object.hasOwnProperty.call(T,w)&&o('Duplicate key "'+w+'"'),YI.test(w)===!0?e.protoAction==="error"?o("Object contains forbidden prototype property"):e.protoAction==="ignore"?g():T[w]=g():XI.test(w)===!0?e.constructorAction==="error"?o("Object contains forbidden constructor property"):e.constructorAction==="ignore"?g():T[w]=g():T[w]=g(),h(),r==="}")return a("}"),T;a(","),h()}}o("Bad object")};return g=function(){switch(h(),r){case"{":return v();case"[":return _();case'"':return u();case"-":return d();default:return r>="0"&&r<="9"?d():m()}},function(w,T){var A;return s=w+"",n=0,r=" ",A=g(),h(),r&&o("Syntax error"),typeof T=="function"?(function G(F,B){var H,q,$=F[B];return $&&typeof $=="object"&&Object.keys($).forEach(function(Y){q=G($,Y),q!==void 0?$[Y]=q:delete $[Y]}),T.call(F,B,$)})({"":A},""):A}};F_.exports=ZI});var H_=z((Y$,bl)=>{var B_=L_().stringify,G_=q_();bl.exports=function(t){return{parse:G_(t),stringify:B_}};bl.exports.parse=G_();bl.exports.stringify=B_});var Fd=z(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.GCE_LINUX_BIOS_PATHS=void 0;hn.isGoogleCloudServerless=W_;hn.isGoogleComputeEngineLinux=J_;hn.isGoogleComputeEngineMACAddress=z_;hn.isGoogleComputeEngine=K_;hn.detectGCPResidency=jI;var V_=X("fs"),$_=X("os");hn.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var QI=/^42:01/;function W_(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function J_(){if((0,$_.platform)()!=="linux")return!1;try{(0,V_.statSync)(hn.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let t=(0,V_.readFileSync)(hn.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(t)}catch{return!1}}function z_(){let t=(0,$_.networkInterfaces)();for(let e of Object.values(t))if(e){for(let{mac:n}of e)if(QI.test(n))return!0}return!1}function K_(){return J_()||z_()}function jI(){return W_()||K_()}});var Y_=z(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});Rl.Colours=void 0;var at=class t{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){t.enabled=t.isEnabled(process==null?void 0:process.stderr),this.enabled?(t.reset="\x1B[0m",t.bright="\x1B[1m",t.dim="\x1B[2m",t.red="\x1B[31m",t.green="\x1B[32m",t.yellow="\x1B[33m",t.blue="\x1B[34m",t.magenta="\x1B[35m",t.cyan="\x1B[36m",t.white="\x1B[37m",t.grey="\x1B[90m"):(t.reset="",t.bright="",t.dim="",t.red="",t.green="",t.yellow="",t.blue="",t.magenta="",t.cyan="",t.white="",t.grey="")}};Rl.Colours=at;at.enabled=!1;at.reset="";at.bright="";at.dim="";at.red="";at.green="";at.yellow="";at.blue="";at.magenta="";at.cyan="";at.white="";at.grey="";at.refresh()});var j_=z(Ue=>{"use strict";var eP=Ue&&Ue.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),tP=Ue&&Ue.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),X_=Ue&&Ue.__importStar||(function(){var t=function(e){return t=Object.getOwnPropertyNames||function(n){var r=[];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[r.length]=i);return r},t(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var r=t(e),i=0;i<r.length;i++)r[i]!=="default"&&eP(n,e,r[i]);return tP(n,e),n}})();Object.defineProperty(Ue,"__esModule",{value:!0});Ue.env=Ue.DebugLogBackendBase=Ue.placeholder=Ue.AdhocDebugLogger=Ue.LogSeverity=void 0;Ue.getNodeBackend=Bd;Ue.getDebugBackend=rP;Ue.getStructuredBackend=iP;Ue.setBackend=sP;Ue.log=Q_;var nP=X("events"),bo=X_(X("process")),Z_=X_(X("util")),Dt=Y_(),pn;(function(t){t.DEFAULT="DEFAULT",t.DEBUG="DEBUG",t.INFO="INFO",t.WARNING="WARNING",t.ERROR="ERROR"})(pn||(Ue.LogSeverity=pn={}));var Ro=class extends nP.EventEmitter{constructor(e,n){super(),this.namespace=e,this.upstream=n,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(r,i)=>this.on(r,i)}),this.func.debug=(...r)=>this.invokeSeverity(pn.DEBUG,...r),this.func.info=(...r)=>this.invokeSeverity(pn.INFO,...r),this.func.warn=(...r)=>this.invokeSeverity(pn.WARNING,...r),this.func.error=(...r)=>this.invokeSeverity(pn.ERROR,...r),this.func.sublog=r=>Q_(r,this.func)}invoke(e,...n){if(this.upstream)try{this.upstream(e,...n)}catch{}try{this.emit("log",e,n)}catch{}}invokeSeverity(e,...n){this.invoke({severity:e},...n)}};Ue.AdhocDebugLogger=Ro;Ue.placeholder=new Ro("",()=>{}).func;var vs=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let n=(e=bo.env[Ue.env.nodeEnables])!==null&&e!==void 0?e:"*";n==="all"&&(n="*"),this.filters=n.split(",")}log(e,n,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let i=this.cached.get(e);i||(i=this.makeLogger(e),this.cached.set(e,i)),i(n,...r)}catch(i){console.error(i)}}};Ue.DebugLogBackendBase=vs;var qd=class extends vs{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(n,...r)=>{var i;let s=`${Dt.Colours.green}${e}${Dt.Colours.reset}`,o=`${Dt.Colours.yellow}${bo.pid}${Dt.Colours.reset}`,a;switch(n.severity){case pn.ERROR:a=`${Dt.Colours.red}${n.severity}${Dt.Colours.reset}`;break;case pn.INFO:a=`${Dt.Colours.magenta}${n.severity}${Dt.Colours.reset}`;break;case pn.WARNING:a=`${Dt.Colours.yellow}${n.severity}${Dt.Colours.reset}`;break;default:a=(i=n.severity)!==null&&i!==void 0?i:pn.DEFAULT;break}let d=Z_.formatWithOptions({colors:Dt.Colours.enabled},...r),u=Object.assign({},n);delete u.severity;let h=Object.getOwnPropertyNames(u).length?JSON.stringify(u):"",m=h?`${Dt.Colours.grey}${h}${Dt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",o,s,a,d,h?` ${m}`:"")}:()=>{}}setFilters(){let n=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${n}$`,"i")}};function Bd(){return new qd}var Gd=class extends vs{constructor(e){super(),this.debugPkg=e}makeLogger(e){let n=this.debugPkg(e);return(r,...i)=>{n(i[0],...i.slice(1))}}setFilters(){var e;let n=(e=bo.env.NODE_DEBUG)!==null&&e!==void 0?e:"";bo.env.NODE_DEBUG=`${n}${n?",":""}${this.filters.join(",")}`}};function rP(t){return new Gd(t)}var Hd=class extends vs{constructor(e){var n;super(),this.upstream=(n=e)!==null&&n!==void 0?n:void 0}makeLogger(e){var n;let r=(n=this.upstream)===null||n===void 0?void 0:n.makeLogger(e);return(i,...s)=>{var o;let a=(o=i.severity)!==null&&o!==void 0?o:pn.INFO,d=Object.assign({severity:a,message:Z_.format(...s)},i),u=JSON.stringify(d);r?r(i,u):console.log("%s",u)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function iP(t){return new Hd(t)}Ue.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var Vd=new Map,Ut;function sP(t){Ut=t,Vd.clear()}function Q_(t,e){if(!Ut&&!bo.env[Ue.env.nodeEnables]||!t)return Ue.placeholder;e&&(t=`${e.instance.namespace}:${t}`);let n=Vd.get(t);if(n)return n.func;if(Ut===null)return Ue.placeholder;Ut===void 0&&(Ut=Bd());let r=(()=>{let i;return new Ro(t,(o,...a)=>{if(i!==Ut){if(Ut===null)return;Ut===void 0&&(Ut=Bd()),i=Ut}Ut?.log(t,o,...a)})})();return Vd.set(t,r),r.func}});var $d=z(Ti=>{"use strict";var oP=Ti&&Ti.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),aP=Ti&&Ti.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&oP(e,t,n)};Object.defineProperty(Ti,"__esModule",{value:!0});aP(j_(),Ti)});var Po=z(de=>{"use strict";var tE=de&&de.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),lP=de&&de.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),uP=de&&de.__importStar||(function(){var t=function(e){return t=Object.getOwnPropertyNames||function(n){var r=[];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[r.length]=i);return r},t(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var r=t(e),i=0;i<r.length;i++)r[i]!=="default"&&tE(n,e,r[i]);return lP(n,e),n}})(),cP=de&&de.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&tE(e,t,n)};Object.defineProperty(de,"__esModule",{value:!0});de.gcpResidencyCache=de.METADATA_SERVER_DETECTION=de.HEADERS=de.HEADER_VALUE=de.HEADER_NAME=de.SECONDARY_HOST_ADDRESS=de.HOST_ADDRESS=de.BASE_PATH=void 0;de.instance=gP;de.project=yP;de.universe=_P;de.bulk=EP;de.isAvailable=SP;de.resetIsAvailableCache=TP;de.getGCPResidency=zd;de.setGCPResidency=nE;de.requestTimeout=rE;var Wd=rt(),dP=H_(),fP=Fd(),hP=uP($d());de.BASE_PATH="/computeMetadata/v1";de.HOST_ADDRESS="http://169.254.169.254";de.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";de.HEADER_NAME="Metadata-Flavor";de.HEADER_VALUE="Google";de.HEADERS=Object.freeze({[de.HEADER_NAME]:de.HEADER_VALUE});var eE=hP.log("gcp-metadata");de.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function Jd(t){return t||(t=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||de.HOST_ADDRESS),/^https?:\/\//.test(t)||(t=`http://${t}`),new URL(de.BASE_PATH,t).href}function pP(t){Object.keys(t).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function Io(t,e={},n=3,r=!1){let i=new Headers(de.HEADERS),s="",o={};if(typeof t=="object"){let m=t;new Headers(m.headers).forEach((g,_)=>i.set(_,g)),s=m.metadataKey,o=m.params||o,n=m.noResponseRetries||n,r=m.fastFail||r}else s=t;typeof e=="string"?s+=`/${e}`:(pP(e),e.property&&(s+=`/${e.property}`),new Headers(e.headers).forEach((m,g)=>i.set(g,m)),o=e.params||o);let a=r?mP:Wd.request,d={url:`${Jd()}/${s}`,headers:i,retryConfig:{noResponseRetries:n},params:o,responseType:"text",timeout:rE()};eE.info("instance request %j",d);let u=await a(d);eE.info("instance metadata is %s",u.data);let h=u.headers.get(de.HEADER_NAME);if(h!==de.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${de.HEADER_NAME} header. Expected '${de.HEADER_VALUE}', got ${h?`'${h}'`:"no header"}`);if(typeof u.data=="string")try{return dP.parse(u.data)}catch{}return u.data}async function mP(t){let e={...t,url:t.url?.toString().replace(Jd(),Jd(de.SECONDARY_HOST_ADDRESS))},n=(0,Wd.request)(t),r=(0,Wd.request)(e);return Promise.any([n,r])}function gP(t){return Io("instance",t)}function yP(t){return Io("project",t)}function _P(t){return Io("universe",t)}async function EP(t){let e={};return await Promise.all(t.map(n=>(async()=>{let r=await Io(n),i=n.metadataKey;e[i]=r})())),e}function vP(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var Il;async function SP(){if(process.env.METADATA_SERVER_DETECTION){let t=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(t in de.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${t}\`, but it should be \`${Object.keys(de.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(t){case"assume-present":return!0;case"none":return!1;case"bios-only":return zd();case"ping-only":}}try{return Il===void 0&&(Il=Io("instance",void 0,vP(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await Il,!0}catch(t){let e=t;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let n="UNKNOWN";e.code&&(n=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${n}`,"MetadataLookupWarning")}return!1}}function TP(){Il=void 0}de.gcpResidencyCache=null;function zd(){return de.gcpResidencyCache===null&&nE(),de.gcpResidencyCache}function nE(t=null){de.gcpResidencyCache=t!==null?t:(0,fP.detectGCPResidency)()}function rE(){return zd()?0:3e3}cP(Fd(),de)});var oE=z(Pl=>{"use strict";Pl.byteLength=CP;Pl.toByteArray=bP;Pl.fromByteArray=PP;var Dn=[],Qt=[],wP=typeof Uint8Array<"u"?Uint8Array:Array,Kd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(wi=0,iE=Kd.length;wi<iE;++wi)Dn[wi]=Kd[wi],Qt[Kd.charCodeAt(wi)]=wi;var wi,iE;Qt[45]=62;Qt[95]=63;function sE(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function CP(t){var e=sE(t),n=e[0],r=e[1];return(n+r)*3/4-r}function AP(t,e,n){return(e+n)*3/4-n}function bP(t){var e,n=sE(t),r=n[0],i=n[1],s=new wP(AP(t,r,i)),o=0,a=i>0?r-4:r,d;for(d=0;d<a;d+=4)e=Qt[t.charCodeAt(d)]<<18|Qt[t.charCodeAt(d+1)]<<12|Qt[t.charCodeAt(d+2)]<<6|Qt[t.charCodeAt(d+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Qt[t.charCodeAt(d)]<<2|Qt[t.charCodeAt(d+1)]>>4,s[o++]=e&255),i===1&&(e=Qt[t.charCodeAt(d)]<<10|Qt[t.charCodeAt(d+1)]<<4|Qt[t.charCodeAt(d+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function RP(t){return Dn[t>>18&63]+Dn[t>>12&63]+Dn[t>>6&63]+Dn[t&63]}function IP(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(RP(r));return i.join("")}function PP(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(IP(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Dn[e>>2]+Dn[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Dn[e>>10]+Dn[e>>4&63]+Dn[e<<2&63]+"=")),i.join("")}});var Xd=z(Yd=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});Yd.fromArrayBufferToHex=xP;function xP(t){return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}});var aE=z(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.BrowserCrypto=void 0;var Ss=oE(),kP=Xd(),Zd=class t{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let n=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",n);return Ss.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let n=new Uint8Array(e);return window.crypto.getRandomValues(n),Ss.fromByteArray(n)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,n,r){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(n),o=Ss.toByteArray(t.padBase64(r)),a=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,a,o,s)}async sign(e,n){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(n),s=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),o=await window.crypto.subtle.sign(r,s,i);return Ss.fromByteArray(new Uint8Array(o))}decodeBase64StringUtf8(e){let n=Ss.toByteArray(t.padBase64(e));return new TextDecoder().decode(n)}encodeBase64StringUtf8(e){let n=new TextEncoder().encode(e);return Ss.fromByteArray(n)}async sha256DigestHex(e){let n=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",n);return(0,kP.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,n){let r=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),i=new TextEncoder,s=await window.crypto.subtle.importKey("raw",i.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",s,i.encode(n))}};xl.BrowserCrypto=Zd});var lE=z(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});kl.NodeCrypto=void 0;var Ts=X("crypto"),Qd=class{async sha256DigestBase64(e){return Ts.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return Ts.randomBytes(e).toString("base64")}async verify(e,n,r){let i=Ts.createVerify("RSA-SHA256");return i.update(n),i.end(),i.verify(e,r,"base64")}async sign(e,n){let r=Ts.createSign("RSA-SHA256");return r.update(n),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return Ts.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,n){let r=typeof e=="string"?e:MP(e);return NP(Ts.createHmac("sha256",r).update(n).digest())}};kl.NodeCrypto=Qd;function NP(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function MP(t){return Buffer.from(t)}});var xo=z(ar=>{"use strict";var OP=ar&&ar.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),DP=ar&&ar.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&OP(e,t,n)};Object.defineProperty(ar,"__esModule",{value:!0});ar.createCrypto=FP;ar.hasBrowserCrypto=uE;var UP=aE(),LP=lE();DP(Xd(),ar);function FP(){return uE()?new UP.BrowserCrypto:new LP.NodeCrypto}function uE(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}});var ws=z((jd,dE)=>{var Nl=X("buffer"),Un=Nl.Buffer;function cE(t,e){for(var n in t)e[n]=t[n]}Un.from&&Un.alloc&&Un.allocUnsafe&&Un.allocUnsafeSlow?dE.exports=Nl:(cE(Nl,jd),jd.Buffer=Ci);function Ci(t,e,n){return Un(t,e,n)}Ci.prototype=Object.create(Un.prototype);cE(Un,Ci);Ci.from=function(t,e,n){if(typeof t=="number")throw new TypeError("Argument must not be a number");return Un(t,e,n)};Ci.alloc=function(t,e,n){if(typeof t!="number")throw new TypeError("Argument must be a number");var r=Un(t);return e!==void 0?typeof n=="string"?r.fill(e,n):r.fill(e):r.fill(0),r};Ci.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Un(t)};Ci.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Nl.SlowBuffer(t)}});var hE=z((oW,fE)=>{"use strict";function ef(t){var e=(t/8|0)+(t%8===0?0:1);return e}var qP={ES256:ef(256),ES384:ef(384),ES512:ef(521)};function BP(t){var e=qP[t];if(e)return e;throw new Error('Unknown algorithm "'+t+'"')}fE.exports=BP});var tf=z((aW,EE)=>{"use strict";var Ml=ws().Buffer,mE=hE(),Ol=128,gE=0,GP=32,HP=16,VP=2,yE=HP|GP|gE<<6,Dl=VP|gE<<6;function $P(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _E(t){if(Ml.isBuffer(t))return t;if(typeof t=="string")return Ml.from(t,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function WP(t,e){t=_E(t);var n=mE(e),r=n+1,i=t.length,s=0;if(t[s++]!==yE)throw new Error('Could not find expected "seq"');var o=t[s++];if(o===(Ol|1)&&(o=t[s++]),i-s<o)throw new Error('"seq" specified length of "'+o+'", only "'+(i-s)+'" remaining');if(t[s++]!==Dl)throw new Error('Could not find expected "int" for "r"');var a=t[s++];if(i-s-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-s-2)+'" available');if(r<a)throw new Error('"r" specified length of "'+a+'", max of "'+r+'" is acceptable');var d=s;if(s+=a,t[s++]!==Dl)throw new Error('Could not find expected "int" for "s"');var u=t[s++];if(i-s!==u)throw new Error('"s" specified length of "'+u+'", expected "'+(i-s)+'"');if(r<u)throw new Error('"s" specified length of "'+u+'", max of "'+r+'" is acceptable');var h=s;if(s+=u,s!==i)throw new Error('Expected to consume entire buffer, but "'+(i-s)+'" bytes remain');var m=n-a,g=n-u,_=Ml.allocUnsafe(m+a+g+u);for(s=0;s<m;++s)_[s]=0;t.copy(_,s,d+Math.max(-m,0),d+a),s=n;for(var v=s;s<v+g;++s)_[s]=0;return t.copy(_,s,h+Math.max(-g,0),h+u),_=_.toString("base64"),_=$P(_),_}function pE(t,e,n){for(var r=0;e+r<n&&t[e+r]===0;)++r;var i=t[e+r]>=Ol;return i&&--r,r}function JP(t,e){t=_E(t);var n=mE(e),r=t.length;if(r!==n*2)throw new TypeError('"'+e+'" signatures must be "'+n*2+'" bytes, saw "'+r+'"');var i=pE(t,0,n),s=pE(t,n,t.length),o=n-i,a=n-s,d=2+o+1+1+a,u=d<Ol,h=Ml.allocUnsafe((u?2:3)+d),m=0;return h[m++]=yE,u?h[m++]=d:(h[m++]=Ol|1,h[m++]=d&255),h[m++]=Dl,h[m++]=o,i<0?(h[m++]=0,m+=t.copy(h,m,0,n)):m+=t.copy(h,m,i,n),h[m++]=Dl,h[m++]=a,s<0?(h[m++]=0,t.copy(h,m,n)):t.copy(h,m,n+s),h}EE.exports={derToJose:WP,joseToDer:JP}});var mn=z(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.LRUCache=void 0;lr.snakeToCamel=SE;lr.originalOrCamelOptions=XP;lr.removeUndefinedValuesInObject=ZP;lr.isValidFile=QP;lr.getWellKnownCertificateConfigFileLocation=jP;var zP=X("fs"),KP=X("os"),nf=X("path"),YP="certificate_config.json",vE="gcloud";function SE(t){return t.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function XP(t){function e(n){let r=t||{};return r[n]??r[SE(n)]}return{get:e}}var rf=class{capacity;#e=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#t(e,n){this.#e.delete(e),this.#e.set(e,{value:n,lastAccessed:Date.now()})}set(e,n){this.#t(e,n),this.#n()}get(e){let n=this.#e.get(e);if(n)return this.#t(e,n.value),this.#n(),n.value}#n(){let e=this.maxAge?Date.now()-this.maxAge:0,n=this.#e.entries().next();for(;!n.done&&(this.#e.size>this.capacity||n.value[1].lastAccessed<e);)this.#e.delete(n.value[0]),n=this.#e.entries().next()}};lr.LRUCache=rf;function ZP(t){return Object.entries(t).forEach(([e,n])=>{(n===void 0||n==="undefined")&&delete t[e]}),t}async function QP(t){try{return(await zP.promises.lstat(t)).isFile()}catch{return!1}}function jP(){let t=process.env.CLOUDSDK_CONFIG||(ex()?nf.join(process.env.APPDATA||"",vE):nf.join(process.env.HOME||"",".config",vE));return nf.join(t,YP)}function ex(){return KP.platform().startsWith("win")}});var TE=z((uW,tx)=>{tx.exports={name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var sf=z(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.USER_AGENT=Lr.PRODUCT_NAME=Lr.pkg=void 0;var wE=TE();Lr.pkg=wE;var CE="google-api-nodejs-client";Lr.PRODUCT_NAME=CE;var nx=`${CE}/${wE.version}`;Lr.USER_AGENT=nx});var Lt=z(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.AuthClient=gn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=gn.DEFAULT_UNIVERSE=void 0;var rx=X("events"),of=rt(),ix=mn(),sx=$d(),af=sf();gn.DEFAULT_UNIVERSE="googleapis.com";gn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=300*1e3;var lf=class t extends rx.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=gn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=gn.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let n=(0,ix.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=n.get("project_id")??null,this.quotaProjectId=n.get("quota_project_id"),this.credentials=n.get("credentials")??{},this.universeDomain=n.get("universe_domain")??gn.DEFAULT_UNIVERSE,this.transporter=e.transporter??new of.Gaxios(e.transporterOptions),n.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(t.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(t.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let n=e[0],r=e[1],i,s=new Headers;return typeof n=="string"?i=new URL(n):n instanceof URL?i=n:n&&n.url&&(i=new URL(n.url)),n&&typeof n=="object"&&"headers"in n&&of.Gaxios.mergeHeaders(s,n.headers),r&&of.Gaxios.mergeHeaders(s,new Headers(r.headers)),typeof n=="object"&&!(n instanceof URL)?this.request({...r,...n,headers:s,url:i}):this.request({...r,headers:s,url:i})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,n){let r=n.get("x-goog-user-project"),i=n.get("authorization");return r&&e.set("x-goog-user-project",r),i&&e.set("authorization",i),e}static log=(0,sx.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let r=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${r}`)}let n=e.headers.get("User-Agent");n?n.includes(`${af.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${n} ${af.USER_AGENT}`):e.headers.set("User-Agent",af.USER_AGENT);try{let r=e,i=r[t.RequestMethodNameSymbol],s=`${Math.floor(Math.random()*1e3)}`;r[t.RequestLogIdSymbol]=s;let o={url:e.url,headers:e.headers};i?t.log.info("%s [%s] request %j",i,s,o):t.log.info("[%s] request %j",s,o)}catch{}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let n=e.config,r=n[t.RequestMethodNameSymbol],i=n[t.RequestLogIdSymbol];r?t.log.info("%s [%s] response %j",r,i,e.data):t.log.info("[%s] response %j",i,e.data)}catch{}return e},rejected:async e=>{try{let n=e.config,r=n[t.RequestMethodNameSymbol],i=n[t.RequestLogIdSymbol];r?t.log.info("%s [%s] error %j",r,i,e.response?.data):t.log.error("[%s] error %j",i,e.response?.data)}catch{}throw e}};static setMethodName(e,n){try{let r=e;r[t.RequestMethodNameSymbol]=n}catch{}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};gn.AuthClient=lf});var cf=z(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.LoginTicket=void 0;var uf=class{envelope;payload;constructor(e,n){this.envelope=e,this.payload=n}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};Ul.LoginTicket=uf});var Ai=z(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.OAuth2Client=Ln.ClientAuthentication=Ln.CertificateFormat=Ln.CodeChallengeMethod=void 0;var AE=rt(),ox=X("querystring"),ax=X("stream"),lx=tf(),bE=mn(),df=xo(),Cs=Lt(),ux=cf(),RE;(function(t){t.Plain="plain",t.S256="S256"})(RE||(Ln.CodeChallengeMethod=RE={}));var ur;(function(t){t.PEM="PEM",t.JWK="JWK"})(ur||(Ln.CertificateFormat=ur={}));var ko;(function(t){t.ClientSecretPost="ClientSecretPost",t.ClientSecretBasic="ClientSecretBasic",t.None="None"})(ko||(Ln.ClientAuthentication=ko={}));var ff=class t extends Cs.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=ur.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},n,r){super(typeof e=="object"?e:{}),typeof e!="object"&&(e={clientId:e,clientSecret:n,redirectUri:r}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||ko.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+ox.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,df.createCrypto)(),r=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),s=(await e.sha256DigestBase64(r)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:r,codeChallenge:s}}getToken(e,n){let r=typeof e=="string"?{code:e}:e;if(n)this.getTokenAsync(r).then(i=>n(null,i.tokens,i.res),i=>n(i,null,i.response));else return this.getTokenAsync(r)}async getTokenAsync(e){let n=this.endpoints.oauth2TokenUrl.toString(),r=new Headers,i={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===ko.ClientSecretBasic){let d=Buffer.from(`${this._clientId}:${this._clientSecret}`);r.set("authorization",`Basic ${d.toString("base64")}`)}this.clientAuthentication===ko.ClientSecretPost&&(i.client_secret=this._clientSecret);let s={...t.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,bE.removeUndefinedValuesInObject)(i)),headers:r};Cs.AuthClient.setMethodName(s,"getTokenAsync");let o=await this.transporter.request(s),a=o.data;return o.data&&o.data.expires_in&&(a.expiry_date=new Date().getTime()+o.data.expires_in*1e3,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:o}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let n=this.refreshTokenNoCache(e).then(r=>(this.refreshTokenPromises.delete(e),r),r=>{throw this.refreshTokenPromises.delete(e),r});return this.refreshTokenPromises.set(e,n),n}async refreshTokenNoCache(e){if(!e)throw new Error("No refresh token is set.");let n=this.endpoints.oauth2TokenUrl.toString(),r={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},i;try{let o={...t.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,bE.removeUndefinedValuesInObject)(r))};Cs.AuthClient.setMethodName(o,"refreshTokenNoCache"),i=await this.transporter.request(o)}catch(o){throw o instanceof AE.GaxiosError&&o.message==="invalid_grant"&&o.response?.data&&/ReAuth/i.test(o.response.data.error_description)&&(o.message=JSON.stringify(o.response.data)),o}let s=i.data;return i.data&&i.data.expires_in&&(s.expiry_date=new Date().getTime()+i.data.expires_in*1e3,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:i}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(n=>e(null,n.credentials,n.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),n=e.tokens;return n.refresh_token=this.credentials.refresh_token,this.credentials=n,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(n=>e(null,n.token,n.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let r=await this.processAndValidateRefreshHandler();if(r?.access_token)return this.setCredentials(r),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let n=await this.refreshAccessTokenAsync();if(!n.credentials||n.credentials&&!n.credentials.access_token)throw new Error("Could not refresh access token.");return{token:n.credentials.access_token,res:n.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let n=this.credentials;if(!n.access_token&&!n.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(n.access_token&&!this.isTokenExpiring()){n.token_type=n.token_type||"Bearer";let a=new Headers({authorization:n.token_type+" "+n.access_token});return{headers:this.addSharedMetadataHeaders(a)}}if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token){this.setCredentials(a);let d=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(d)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let r=null,i=null;try{r=await this.refreshToken(n.refresh_token),i=r.tokens}catch(a){let d=a;throw d.response&&(d.response.status===403||d.response.status===404)&&(d.message=`Could not refresh access token: ${d.message}`),d}let s=this.credentials;s.token_type=s.token_type||"Bearer",i.refresh_token=s.refresh_token,this.credentials=i;let o=new Headers({authorization:s.token_type+" "+i.access_token});return{headers:this.addSharedMetadataHeaders(o),res:r.res}}static getRevokeTokenUrl(e){return new t().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let n=new URL(this.endpoints.oauth2RevokeUrl);return n.searchParams.append("token",e),n}revokeToken(e,n){let r={...t.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(Cs.AuthClient.setMethodName(r,"revokeToken"),n)this.transporter.request(r).then(i=>n(null,i),n);else return this.transporter.request(r)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(n=>e(null,n),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){try{let r=await this.getRequestMetadataAsync();return e.headers=AE.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,r.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(r){let i=r.response;if(i){let s=i.status,o=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),a=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,d=i.config.data instanceof ax.Readable,u=s===401||s===403;if(!n&&u&&!d&&o)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!n&&u&&!d&&a){let h=await this.processAndValidateRefreshHandler();return h?.access_token&&this.setCredentials(h),this.requestAsync(e,!0)}}throw r}}verifyIdToken(e,n){if(n&&typeof n!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(n)this.verifyIdTokenAsync(e).then(r=>n(null,r),n);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let n=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,n.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:n}=await this.transporter.request({...t.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+n.expires_in*1e3,scopes:n.scope.split(" ")},n);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(n=>e(null,n.certs,n.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),n=(0,df.hasBrowserCrypto)()?ur.JWK:ur.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===n)return{certs:this.certificateCache,format:n};let r,i;switch(n){case ur.PEM:i=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case ur.JWK:i=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${n}`)}try{let u={...t.RETRY_CONFIG,url:i};Cs.AuthClient.setMethodName(u,"getFederatedSignonCertsAsync"),r=await this.transporter.request(u)}catch(u){throw u instanceof Error&&(u.message=`Failed to retrieve verification certificates: ${u.message}`),u}let s=r?.headers.get("cache-control"),o=-1;if(s){let u=/max-age=(?<maxAge>[0-9]+)/.exec(s)?.groups?.maxAge;u&&(o=Number(u)*1e3)}let a={};switch(n){case ur.PEM:a=r.data;break;case ur.JWK:for(let u of r.data.keys)a[u.kid]=u;break;default:throw new Error(`Unsupported certificate format ${n}`)}let d=new Date;return this.certificateExpiry=o===-1?null:new Date(d.getTime()+o),this.certificateCache=a,this.certificateCacheFormat=n,{certs:a,format:n,res:r}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(n=>e(null,n.pubkeys,n.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,n=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let r={...t.RETRY_CONFIG,url:n};Cs.AuthClient.setMethodName(r,"getIapPublicKeysAsync"),e=await this.transporter.request(r)}catch(r){throw r instanceof Error&&(r.message=`Failed to retrieve verification certificates: ${r.message}`),r}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,n,r,i,s){let o=(0,df.createCrypto)();s||(s=t.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let a=e.split(".");if(a.length!==3)throw new Error("Wrong number of segments in token: "+e);let d=a[0]+"."+a[1],u=a[2],h,m;try{h=JSON.parse(o.decodeBase64StringUtf8(a[0]))}catch(F){throw F instanceof Error&&(F.message=`Can't parse token envelope: ${a[0]}': ${F.message}`),F}if(!h)throw new Error("Can't parse token envelope: "+a[0]);try{m=JSON.parse(o.decodeBase64StringUtf8(a[1]))}catch(F){throw F instanceof Error&&(F.message=`Can't parse token payload '${a[0]}`),F}if(!m)throw new Error("Can't parse token payload: "+a[1]);if(!Object.prototype.hasOwnProperty.call(n,h.kid))throw new Error("No pem found for envelope: "+JSON.stringify(h));let g=n[h.kid];if(h.alg==="ES256"&&(u=lx.joseToDer(u,"ES256").toString("base64")),!await o.verify(g,d,u))throw new Error("Invalid token signature: "+e);if(!m.iat)throw new Error("No issue time in token: "+JSON.stringify(m));if(!m.exp)throw new Error("No expiration time in token: "+JSON.stringify(m));let v=Number(m.iat);if(isNaN(v))throw new Error("iat field using invalid format");let w=Number(m.exp);if(isNaN(w))throw new Error("exp field using invalid format");let T=new Date().getTime()/1e3;if(w>=T+s)throw new Error("Expiration time too far in future: "+JSON.stringify(m));let A=v-t.CLOCK_SKEW_SECS_,G=w+t.CLOCK_SKEW_SECS_;if(T<A)throw new Error("Token used too early, "+T+" < "+A+": "+JSON.stringify(m));if(T>G)throw new Error("Token used too late, "+T+" > "+G+": "+JSON.stringify(m));if(i&&i.indexOf(m.iss)<0)throw new Error("Invalid issuer, expected one of ["+i+"], but got "+m.iss);if(typeof r<"u"&&r!==null){let F=m.aud,B=!1;if(r.constructor===Array?B=r.indexOf(F)>-1:B=F===r,!B)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new ux.LoginTicket(h,m)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};Ln.OAuth2Client=ff});var pf=z(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});Ll.Compute=void 0;var cx=rt(),IE=Po(),dx=Ai(),hf=class extends dx.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e=`service-accounts/${this.serviceAccountEmail}/token`,n;try{let i={property:e};this.scopes.length>0&&(i.params={scopes:this.scopes.join(",")}),n=await IE.instance(i)}catch(i){throw i instanceof cx.GaxiosError&&(i.message=`Could not refresh access token: ${i.message}`,this.wrapError(i)),i}let r=n;return n&&n.expires_in&&(r.expiry_date=new Date().getTime()+n.expires_in*1e3,delete r.expires_in),this.emit("tokens",r),{tokens:r,res:null}}async fetchIdToken(e){let n=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,r;try{let i={property:n};r=await IE.instance(i)}catch(i){throw i instanceof Error&&(i.message=`Could not fetch ID token: ${i.message}`),i}return r}wrapError(e){let n=e.response;n&&n.status&&(e.status=n.status,n.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:n.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};Ll.Compute=hf});var gf=z(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});Fl.IdTokenClient=void 0;var fx=Ai(),mf=class extends fx.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let n=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:n,expiry_date:this.getIdTokenExpiryDate(n)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let n=e.split(".")[1];if(n)return JSON.parse(Buffer.from(n,"base64").toString("ascii")).exp*1e3}};Fl.IdTokenClient=mf});var yf=z(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.GCPEnv=void 0;As.clear=hx;As.getEnv=px;var PE=Po(),Fn;(function(t){t.APP_ENGINE="APP_ENGINE",t.KUBERNETES_ENGINE="KUBERNETES_ENGINE",t.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",t.COMPUTE_ENGINE="COMPUTE_ENGINE",t.CLOUD_RUN="CLOUD_RUN",t.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",t.NONE="NONE"})(Fn||(As.GCPEnv=Fn={}));var No;function hx(){No=void 0}async function px(){return No||(No=mx(),No)}async function mx(){let t=Fn.NONE;return gx()?t=Fn.APP_ENGINE:yx()?t=Fn.CLOUD_FUNCTIONS:await Sx()?await vx()?t=Fn.KUBERNETES_ENGINE:_x()?t=Fn.CLOUD_RUN:Ex()?t=Fn.CLOUD_RUN_JOBS:t=Fn.COMPUTE_ENGINE:t=Fn.NONE,t}function gx(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function yx(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function _x(){return!!process.env.K_CONFIGURATION}function Ex(){return!!process.env.CLOUD_RUN_JOB}async function vx(){try{return await PE.instance("attributes/cluster-name"),!0}catch{return!1}}async function Sx(){return PE.isAvailable()}});var _f=z((yW,xE)=>{var ql=ws().Buffer,Tx=X("stream"),wx=X("util");function Bl(t){if(this.buffer=null,this.writable=!0,this.readable=!0,!t)return this.buffer=ql.alloc(0),this;if(typeof t.pipe=="function")return this.buffer=ql.alloc(0),t.pipe(this),this;if(t.length||typeof t=="object")return this.buffer=t,this.writable=!1,process.nextTick(function(){this.emit("end",t),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof t+")")}wx.inherits(Bl,Tx);Bl.prototype.write=function(e){this.buffer=ql.concat([this.buffer,ql.from(e)]),this.emit("data",e)};Bl.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};xE.exports=Bl});var NE=z((_W,kE)=>{"use strict";var Mo=X("buffer").Buffer,Ef=X("buffer").SlowBuffer;kE.exports=Gl;function Gl(t,e){if(!Mo.isBuffer(t)||!Mo.isBuffer(e)||t.length!==e.length)return!1;for(var n=0,r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}Gl.install=function(){Mo.prototype.equal=Ef.prototype.equal=function(e){return Gl(this,e)}};var Cx=Mo.prototype.equal,Ax=Ef.prototype.equal;Gl.restore=function(){Mo.prototype.equal=Cx,Ef.prototype.equal=Ax}});var wf=z((EW,GE)=>{var Rs=ws().Buffer,jt=X("crypto"),OE=tf(),ME=X("util"),bx=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,Oo="secret must be a string or buffer",bs="key must be a string or a buffer",Rx="key must be a string, a buffer or an object",Sf=typeof jt.createPublicKey=="function";Sf&&(bs+=" or a KeyObject",Oo+="or a KeyObject");function DE(t){if(!Rs.isBuffer(t)&&typeof t!="string"&&(!Sf||typeof t!="object"||typeof t.type!="string"||typeof t.asymmetricKeyType!="string"||typeof t.export!="function"))throw yn(bs)}function UE(t){if(!Rs.isBuffer(t)&&typeof t!="string"&&typeof t!="object")throw yn(Rx)}function Ix(t){if(!Rs.isBuffer(t)){if(typeof t=="string")return t;if(!Sf||typeof t!="object"||t.type!=="secret"||typeof t.export!="function")throw yn(Oo)}}function Tf(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function LE(t){t=t.toString();var e=4-t.length%4;if(e!==4)for(var n=0;n<e;++n)t+="=";return t.replace(/\-/g,"+").replace(/_/g,"/")}function yn(t){var e=[].slice.call(arguments,1),n=ME.format.bind(ME,t).apply(null,e);return new TypeError(n)}function Px(t){return Rs.isBuffer(t)||typeof t=="string"}function Do(t){return Px(t)||(t=JSON.stringify(t)),t}function FE(t){return function(n,r){Ix(r),n=Do(n);var i=jt.createHmac("sha"+t,r),s=(i.update(n),i.digest("base64"));return Tf(s)}}var vf,xx="timingSafeEqual"in jt?function(e,n){return e.byteLength!==n.byteLength?!1:jt.timingSafeEqual(e,n)}:function(e,n){return vf||(vf=NE()),vf(e,n)};function kx(t){return function(n,r,i){var s=FE(t)(n,i);return xx(Rs.from(r),Rs.from(s))}}function qE(t){return function(n,r){UE(r),n=Do(n);var i=jt.createSign("RSA-SHA"+t),s=(i.update(n),i.sign(r,"base64"));return Tf(s)}}function BE(t){return function(n,r,i){DE(i),n=Do(n),r=LE(r);var s=jt.createVerify("RSA-SHA"+t);return s.update(n),s.verify(i,r,"base64")}}function Nx(t){return function(n,r){UE(r),n=Do(n);var i=jt.createSign("RSA-SHA"+t),s=(i.update(n),i.sign({key:r,padding:jt.constants.RSA_PKCS1_PSS_PADDING,saltLength:jt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return Tf(s)}}function Mx(t){return function(n,r,i){DE(i),n=Do(n),r=LE(r);var s=jt.createVerify("RSA-SHA"+t);return s.update(n),s.verify({key:i,padding:jt.constants.RSA_PKCS1_PSS_PADDING,saltLength:jt.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function Ox(t){var e=qE(t);return function(){var r=e.apply(null,arguments);return r=OE.derToJose(r,"ES"+t),r}}function Dx(t){var e=BE(t);return function(r,i,s){i=OE.joseToDer(i,"ES"+t).toString("base64");var o=e(r,i,s);return o}}function Ux(){return function(){return""}}function Lx(){return function(e,n){return n===""}}GE.exports=function(e){var n={hs:FE,rs:qE,ps:Nx,es:Ox,none:Ux},r={hs:kx,rs:BE,ps:Mx,es:Dx,none:Lx},i=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!i)throw yn(bx,e);var s=(i[1]||i[3]).toLowerCase(),o=i[2];return{sign:n[s](o),verify:r[s](o)}}});var Cf=z((vW,HE)=>{var Fx=X("buffer").Buffer;HE.exports=function(e){return typeof e=="string"?e:typeof e=="number"||Fx.isBuffer(e)?e.toString():JSON.stringify(e)}});var KE=z((SW,zE)=>{var qx=ws().Buffer,VE=_f(),Bx=wf(),Gx=X("stream"),$E=Cf(),Af=X("util");function WE(t,e){return qx.from(t,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Hx(t,e,n){n=n||"utf8";var r=WE($E(t),"binary"),i=WE($E(e),n);return Af.format("%s.%s",r,i)}function JE(t){var e=t.header,n=t.payload,r=t.secret||t.privateKey,i=t.encoding,s=Bx(e.alg),o=Hx(e,n,i),a=s.sign(o,r);return Af.format("%s.%s",o,a)}function Hl(t){var e=t.secret;if(e=e??t.privateKey,e=e??t.key,/^hs/i.test(t.header.alg)===!0&&e==null)throw new TypeError("secret must be a string or buffer or a KeyObject");var n=new VE(e);this.readable=!0,this.header=t.header,this.encoding=t.encoding,this.secret=this.privateKey=this.key=n,this.payload=new VE(t.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}Af.inherits(Hl,Gx);Hl.prototype.sign=function(){try{var e=JE({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};Hl.sign=JE;zE.exports=Hl});var iv=z((TW,rv)=>{var XE=ws().Buffer,YE=_f(),Vx=wf(),$x=X("stream"),ZE=Cf(),Wx=X("util"),Jx=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function zx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Kx(t){if(zx(t))return t;try{return JSON.parse(t)}catch{return}}function QE(t){var e=t.split(".",1)[0];return Kx(XE.from(e,"base64").toString("binary"))}function Yx(t){return t.split(".",2).join(".")}function jE(t){return t.split(".")[2]}function Xx(t,e){e=e||"utf8";var n=t.split(".")[1];return XE.from(n,"base64").toString(e)}function ev(t){return Jx.test(t)&&!!QE(t)}function tv(t,e,n){if(!e){var r=new Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}t=ZE(t);var i=jE(t),s=Yx(t),o=Vx(e);return o.verify(s,i,n)}function nv(t,e){if(e=e||{},t=ZE(t),!ev(t))return null;var n=QE(t);if(!n)return null;var r=Xx(t);return(n.typ==="JWT"||e.json)&&(r=JSON.parse(r,e.encoding)),{header:n,payload:r,signature:jE(t)}}function Is(t){t=t||{};var e=t.secret;if(e=e??t.publicKey,e=e??t.key,/^hs/i.test(t.algorithm)===!0&&e==null)throw new TypeError("secret must be a string or buffer or a KeyObject");var n=new YE(e);this.readable=!0,this.algorithm=t.algorithm,this.encoding=t.encoding,this.secret=this.publicKey=this.key=n,this.signature=new YE(t.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}Wx.inherits(Is,$x);Is.prototype.verify=function(){try{var e=tv(this.signature.buffer,this.algorithm,this.key.buffer),n=nv(this.signature.buffer,this.encoding);return this.emit("done",e,n),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(r){this.readable=!1,this.emit("error",r),this.emit("close")}};Is.decode=nv;Is.isValid=ev;Is.verify=tv;rv.exports=Is});var bf=z(Fr=>{var sv=KE(),Vl=iv(),Zx=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];Fr.ALGORITHMS=Zx;Fr.sign=sv.sign;Fr.verify=Vl.verify;Fr.decode=Vl.decode;Fr.isValid=Vl.isValid;Fr.createSign=function(e){return new sv(e)};Fr.createVerify=function(e){return new Vl(e)}});var vv=z(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});Wl.GoogleToken=void 0;var ov=$l(X("fs")),Qx=rt(),jx=$l(bf()),ek=$l(X("path")),tk=X("util");function $l(t,e){if(typeof WeakMap=="function")var n=new WeakMap,r=new WeakMap;return($l=function(s,o){if(!o&&s&&s.__esModule)return s;var a,d,u={__proto__:null,default:s};if(s===null||cr(s)!="object"&&typeof s!="function")return u;if(a=o?r:n){if(a.has(s))return a.get(s);a.set(s,u)}for(var h in s)h!=="default"&&{}.hasOwnProperty.call(s,h)&&((d=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,h))&&(d.get||d.set)?a(u,h,d):u[h]=s[h]);return u})(t,e)}function cr(t){"@babel/helpers - typeof";return cr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cr(t)}function nk(t,e){mv(t,e),e.add(t)}function rk(t,e,n){mv(t,e),e.set(t,n)}function mv(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function av(t,e,n){return t.set(_n(t,e),n),n}function lv(t,e){return t.get(_n(t,e))}function _n(t,e,n){if(typeof t=="function"?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function uv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_v(r.key),r)}}function gv(t,e,n){return e&&uv(t.prototype,e),n&&uv(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function yv(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ik(t,e,n){return e=qo(e),sk(t,Nf()?Reflect.construct(e,n||[],qo(t).constructor):e.apply(t,n))}function sk(t,e){if(e&&(cr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ok(t)}function ok(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ak(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fo(t,e)}function Rf(t){var e=typeof Map=="function"?new Map:void 0;return Rf=function(r){if(r===null||!uk(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return lk(r,arguments,qo(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Fo(i,r)},Rf(t)}function lk(t,e,n){if(Nf())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&Fo(i,n.prototype),i}function Nf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nf=function(){return!!t})()}function uk(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function Fo(t,e){return Fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Fo(t,e)}function qo(t){return qo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qo(t)}function Ft(t,e,n){return(e=_v(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _v(t){var e=ck(t,"string");return cr(e)=="symbol"?e:e+""}function ck(t,e){if(cr(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(cr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Bt(){var t,e,n=typeof Symbol=="function"?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(_,v,w,T){var A=v&&v.prototype instanceof a?v:a,G=Object.create(A.prototype);return qt(G,"_invoke",(function(F,B,H){var q,$,Y,L=0,te=H||[],oe=!1,fe={p:0,n:0,v:t,a:le,f:le.bind(t,4),d:function(Me,Oe){return q=Me,$=0,Y=t,fe.n=Oe,o}};function le(ve,Me){for($=ve,Y=Me,e=0;!oe&&L&&!Oe&&e<te.length;e++){var Oe,Pe=te[e],et=fe.p,ut=Pe[2];ve>3?(Oe=ut===Me)&&(Y=Pe[($=Pe[4])?5:($=3,3)],Pe[4]=Pe[5]=t):Pe[0]<=et&&((Oe=ve<2&&et<Pe[1])?($=0,fe.v=Me,fe.n=Pe[1]):et<ut&&(Oe=ve<3||Pe[0]>Me||Me>ut)&&(Pe[4]=ve,Pe[5]=Me,fe.n=ut,$=0))}if(Oe||ve>1)return o;throw oe=!0,Me}return function(ve,Me,Oe){if(L>1)throw TypeError("Generator is already running");for(oe&&Me===1&&le(Me,Oe),$=Me,Y=Oe;(e=$<2?t:Y)||!oe;){q||($?$<3?($>1&&(fe.n=-1),le($,Y)):fe.n=Y:fe.v=Y);try{if(L=2,q){if($||(ve="next"),e=q[ve]){if(!(e=e.call(q,Y)))throw TypeError("iterator result is not an object");if(!e.done)return e;Y=e.value,$<2&&($=0)}else $===1&&(e=q.return)&&e.call(q),$<2&&(Y=TypeError("The iterator does not provide a '"+ve+"' method"),$=1);q=t}else if((e=(oe=fe.n<0)?Y:F.call(B,fe))!==o)break}catch(Pe){q=t,$=1,Y=Pe}finally{L=1}}return{value:e,done:oe}}})(_,w,T),!0),G}var o={};function a(){}function d(){}function u(){}e=Object.getPrototypeOf;var h=[][r]?e(e([][r]())):(qt(e={},r,function(){return this}),e),m=u.prototype=a.prototype=Object.create(h);function g(_){return Object.setPrototypeOf?Object.setPrototypeOf(_,u):(_.__proto__=u,qt(_,i,"GeneratorFunction")),_.prototype=Object.create(m),_}return d.prototype=u,qt(m,"constructor",u),qt(u,"constructor",d),d.displayName="GeneratorFunction",qt(u,i,"GeneratorFunction"),qt(m),qt(m,i,"Generator"),qt(m,r,function(){return this}),qt(m,"toString",function(){return"[object Generator]"}),(Bt=function(){return{w:s,m:g}})()}function qt(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch{i=0}qt=function(o,a,d,u){if(a)i?i(o,a,{value:d,enumerable:!u,configurable:!u,writable:!u}):o[a]=d;else{var h=function(g,_){qt(o,g,function(v){return this._invoke(g,_,v)})};h("next",0),h("throw",1),h("return",2)}},qt(t,e,n,r)}function cv(t,e,n,r,i,s,o){try{var a=t[s](o),d=a.value}catch(u){return void n(u)}a.done?e(d):Promise.resolve(d).then(r,i)}function Ps(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(d){cv(s,r,i,o,a,"next",d)}function a(d){cv(s,r,i,o,a,"throw",d)}o(void 0)})}}var dv=ov.readFile?(0,tk.promisify)(ov.readFile):Ps(Bt().m(function t(){return Bt().w(function(e){for(;;)switch(e.n){case 0:throw new Lo("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},t)})),fv="https://oauth2.googleapis.com/token",dk="https://oauth2.googleapis.com/revoke?token=",Lo=(function(t){function e(n,r){var i;return yv(this,e),i=ik(this,e,[n]),Ft(i,"code",void 0),i.code=r,i}return ak(e,t),gv(e)})(Rf(Error)),Uo=new WeakMap,qn=new WeakSet,CW=Wl.GoogleToken=(function(){function t(e){yv(this,t),nk(this,qn),Ft(this,"expiresAt",void 0),Ft(this,"key",void 0),Ft(this,"keyFile",void 0),Ft(this,"iss",void 0),Ft(this,"sub",void 0),Ft(this,"scope",void 0),Ft(this,"rawToken",void 0),Ft(this,"tokenExpires",void 0),Ft(this,"email",void 0),Ft(this,"additionalClaims",void 0),Ft(this,"eagerRefreshThresholdMillis",void 0),Ft(this,"transporter",{request:function(r){return(0,Qx.request)(r)}}),rk(this,Uo,void 0),_n(qn,this,Ev).call(this,e)}return gv(t,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var n=new Date().getTime();return this.rawToken&&this.expiresAt?n>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var n,r=new Date().getTime(),i=(n=this.eagerRefreshThresholdMillis)!==null&&n!==void 0?n:0;return this.rawToken&&this.expiresAt?this.expiresAt<=r+i:!0}},{key:"getToken",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(cr(n)==="object"&&(r=n,n=void 0),r=Object.assign({forceRefresh:!1},r),n){var i=n;_n(qn,this,hv).call(this,r).then(function(s){return i(null,s)},n);return}return _n(qn,this,hv).call(this,r)}},{key:"getCredentials",value:(function(){var e=Ps(Bt().m(function r(i){var s,o,a,d,u,h,m;return Bt().w(function(g){for(;;)switch(g.n){case 0:s=ek.extname(i),m=s,g.n=m===".json"?1:m===".der"||m===".crt"||m===".pem"?4:m===".p12"||m===".pfx"?6:7;break;case 1:return g.n=2,dv(i,"utf8");case 2:if(o=g.v,a=JSON.parse(o),d=a.private_key,u=a.client_email,!(!d||!u)){g.n=3;break}throw new Lo("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return g.a(2,{privateKey:d,clientEmail:u});case 4:return g.n=5,dv(i,"utf8");case 5:return h=g.v,g.a(2,{privateKey:h});case 6:throw new Lo("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new Lo("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return g.a(2)}},r)}));function n(r){return e.apply(this,arguments)}return n})()},{key:"revokeToken",value:function(n){if(n){_n(qn,this,pv).call(this).then(function(){return n()},n);return}return _n(qn,this,pv).call(this)}}])})();function hv(t){return If.apply(this,arguments)}function If(){return If=Ps(Bt().m(function t(e){return Bt().w(function(n){for(;;)switch(n.n){case 0:if(!(lv(Uo,this)&&!e.forceRefresh)){n.n=1;break}return n.a(2,lv(Uo,this));case 1:return n.p=1,n.n=2,av(Uo,this,_n(qn,this,fk).call(this,e));case 2:return n.a(2,n.v);case 3:return n.p=3,av(Uo,this,void 0),n.f(3);case 4:return n.a(2)}},t,this,[[1,,3,4]])})),If.apply(this,arguments)}function fk(t){return Pf.apply(this,arguments)}function Pf(){return Pf=Ps(Bt().m(function t(e){var n;return Bt().w(function(r){for(;;)switch(r.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){r.n=1;break}return r.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){r.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){r.n=4;break}return r.n=3,this.getCredentials(this.keyFile);case 3:n=r.v,this.key=n.privateKey,this.iss=n.clientEmail||this.iss,n.clientEmail||_n(qn,this,hk).call(this);case 4:return r.a(2,_n(qn,this,pk).call(this))}},t,this)})),Pf.apply(this,arguments)}function hk(){if(!this.iss)throw new Lo("email is required.","MISSING_CREDENTIALS")}function pv(){return xf.apply(this,arguments)}function xf(){return xf=Ps(Bt().m(function t(){var e;return Bt().w(function(n){for(;;)switch(n.n){case 0:if(this.accessToken){n.n=1;break}throw new Error("No token to revoke.");case 1:return e=dk+this.accessToken,n.n=2,this.transporter.request({url:e,retry:!0});case 2:_n(qn,this,Ev).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return n.a(2)}},t,this)})),xf.apply(this,arguments)}function Ev(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=t.keyFile,this.key=t.key,this.rawToken=void 0,this.iss=t.email||t.iss,this.sub=t.sub,this.additionalClaims=t.additionalClaims,cr(t.scope)==="object"?this.scope=t.scope.join(" "):this.scope=t.scope,this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,t.transporter&&(this.transporter=t.transporter)}function pk(){return kf.apply(this,arguments)}function kf(){return kf=Ps(Bt().m(function t(){var e,n,r,i,s,o,a,d,u,h;return Bt().w(function(m){for(;;)switch(m.n){case 0:return e=Math.floor(new Date().getTime()/1e3),n=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:fv,exp:e+3600,iat:e,sub:this.sub},n),i=jx.sign({header:{alg:"RS256"},payload:r,secret:this.key}),m.p=1,m.n=2,this.transporter.request({method:"POST",url:fv,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return s=m.v,this.rawToken=s.data,this.expiresAt=s.data.expires_in===null||s.data.expires_in===void 0?void 0:(e+s.data.expires_in)*1e3,m.a(2,this.rawToken);case 3:throw m.p=3,h=m.v,this.rawToken=void 0,this.tokenExpires=void 0,d=h.response&&(o=h.response)!==null&&o!==void 0&&o.data?(a=h.response)===null||a===void 0?void 0:a.data:{},d.error&&(u=d.error_description?": ".concat(d.error_description):"",h.message="".concat(d.error).concat(u)),h;case 4:return m.a(2)}},t,this,[[1,3]])})),kf.apply(this,arguments)}});var Of=z(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.JWTAccess=void 0;var mk=bf(),gk=mn(),Sv={alg:"RS256",typ:"JWT"},Mf=class t{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new gk.LRUCache({capacity:500,maxAge:3600*1e3});constructor(e,n,r,i){this.email=e,this.key=n,this.keyId=r,this.eagerRefreshThresholdMillis=i??300*1e3}getCachedKey(e,n){let r=e;if(n&&Array.isArray(n)&&n.length?r=e?`${e}_${n.join("_")}`:`${n.join("_")}`:typeof n=="string"&&(r=e?`${e}_${n}`:n),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,n,r){let i=this.getCachedKey(e,r),s=this.cache.get(i),o=Date.now();if(s&&s.expiration-o>this.eagerRefreshThresholdMillis)return new Headers(s.headers);let a=Math.floor(Date.now()/1e3),d=t.getExpirationTime(a),u;if(Array.isArray(r)&&(r=r.join(" ")),r?u={iss:this.email,sub:this.email,scope:r,exp:d,iat:a}:u={iss:this.email,sub:this.email,aud:e,exp:d,iat:a},n){for(let v in u)if(n[v])throw new Error(`The '${v}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...Sv,kid:this.keyId}:Sv,m=Object.assign(u,n),g=mk.sign({header:h,payload:m,secret:this.key}),_=new Headers({authorization:`Bearer ${g}`});return this.cache.set(i,{expiration:d*1e3,headers:_}),_}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((n,r)=>{e||r(new Error("Must pass in a stream containing the service account auth settings."));let i="";e.setEncoding("utf8").on("data",s=>i+=s).on("error",r).on("end",()=>{try{let s=JSON.parse(i);this.fromJSON(s),n()}catch(s){r(s)}})})}};Jl.JWTAccess=Mf});var Uf=z(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});Kl.JWT=void 0;var Tv=vv(),yk=Of(),_k=Ai(),zl=Lt(),Df=class t extends _k.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let n=new t(this);return n.scopes=e,n}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let n=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==zl.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==zl.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${zl.DEFAULT_UNIVERSE}`);if(!this.apiKey&&n)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:r}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${r.id_token}`}))}}else{this.access||(this.access=new yk.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let r;this.hasUserScopes()?r=this.scopes:e||(r=this.defaultScopes);let i=this.useJWTAccessWithScope||this.universeDomain!==zl.DEFAULT_UNIVERSE,s=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,i?r:void 0);return{headers:this.addSharedMetadataHeaders(s)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let n=new Tv.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await n.getToken({forceRefresh:!0}),!n.idToken)throw new Error("Unknown error: Failed to fetch ID token");return n.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(n=>e(null,n),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),r={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",r),{res:null,tokens:r}}createGToken(){return this.gtoken||(this.gtoken=new Tv.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((n,r)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let i="";e.setEncoding("utf8").on("error",r).on("data",s=>i+=s).on("end",()=>{try{let s=JSON.parse(i);this.fromJSON(s),n()}catch(s){r(s)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let n=await this.createGToken().getCredentials(this.keyFile);return{private_key:n.privateKey,client_email:n.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};Kl.JWT=Df});var Ff=z(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});xs.UserRefreshClient=xs.USER_REFRESH_ACCOUNT_TYPE=void 0;var Ek=Ai(),vk=Lt();xs.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var Lf=class t extends Ek.OAuth2Client{_refreshToken;constructor(e,n,r,i,s){let o=e&&typeof e=="object"?e:{clientId:e,clientSecret:n,refreshToken:r,eagerRefreshThresholdMillis:i,forceRefreshOnFailure:s};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let n={...t.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return vk.AuthClient.setMethodName(n,"fetchIdToken"),(await this.transporter.request(n)).data.id_token}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((n,r)=>{if(!e)return r(new Error("Must pass in a stream containing the user refresh token."));let i="";e.setEncoding("utf8").on("error",r).on("data",s=>i+=s).on("end",()=>{try{let s=JSON.parse(i);return this.fromJSON(s),n()}catch(s){return r(s)}})})}static fromJSON(e){let n=new t;return n.fromJSON(e),n}};xs.UserRefreshClient=Lf});var Bf=z(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.Impersonated=ks.IMPERSONATED_ACCOUNT_TYPE=void 0;var wv=Ai(),Sk=rt(),Tk=mn();ks.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var qf=class t extends wv.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new wv.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,!!!(0,Tk.originalOrCamelOptions)(e).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${n}:signBlob`,i={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...t.RETRY_CONFIG,url:r,data:i,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,n=`${this.endpoint}/v1/${e}:generateAccessToken`,r={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},i=await this.sourceClient.request({...t.RETRY_CONFIG,url:n,data:r,method:"POST"}),s=i.data;return this.credentials.access_token=s.accessToken,this.credentials.expiry_date=Date.parse(s.expireTime),{tokens:this.credentials,res:i}}catch(e){if(!(e instanceof Error))throw e;let n=0,r="";throw e instanceof Sk.GaxiosError&&(n=e?.response?.data?.error?.status,r=e?.response?.data?.error?.message),n&&r?(e.message=`${n}: unable to impersonate: ${r}`,e):(e.message=`unable to impersonate: ${e}`,e)}}async fetchIdToken(e,n){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,i=`${this.endpoint}/v1/${r}:generateIdToken`,s={delegates:this.delegates,audience:e,includeEmail:n?.includeEmail??!0,useEmailAzp:n?.includeEmail??!0};return(await this.sourceClient.request({...t.RETRY_CONFIG,url:i,data:s,method:"POST"})).data.token}};ks.Impersonated=qf});var Hf=z(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.OAuthClientAuthHandler=void 0;Bo.getErrorFromOAuthErrorResponse=Ak;var Ns=rt(),wk=xo(),Ck=["PUT","POST","PATCH"],Gf=class{#e=(0,wk.createCrypto)();#t;transporter;constructor(e){e&&"clientId"in e?(this.#t=e,this.transporter=new Ns.Gaxios):(this.#t=e?.clientAuthentication,this.transporter=e?.transporter||new Ns.Gaxios)}applyClientAuthenticationOptions(e,n){e.headers=Ns.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,n),n||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,n){if(n)e.headers=Ns.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${n}`});else if(this.#t?.confidentialClientType==="basic"){e.headers=Ns.Gaxios.mergeHeaders(e.headers);let r=this.#t.clientId,i=this.#t.clientSecret||"",s=this.#e.encodeBase64StringUtf8(`${r}:${i}`);Ns.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${s}`})}}injectAuthenticatedRequestBody(e){if(this.#t?.confidentialClientType==="request-body"){let n=(e.method||"GET").toUpperCase();if(!Ck.includes(n))throw new Error(`${n} HTTP method does not support ${this.#t.confidentialClientType} client authentication`);let i=new Headers(e.headers).get("content-type");if(i?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let s=new URLSearchParams(e.data??"");s.append("client_id",this.#t.clientId),s.append("client_secret",this.#t.clientSecret||""),e.data=s}else if(i?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#t.clientId,client_secret:this.#t.clientSecret||""});else throw new Error(`${i} content-types are not supported with ${this.#t.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Bo.OAuthClientAuthHandler=Gf;function Ak(t,e){let n=t.error,r=t.error_description,i=t.error_uri,s=`Error code ${n}`;typeof r<"u"&&(s+=`: ${r}`),typeof i<"u"&&(s+=` - ${i}`);let o=new Error(s);if(e){let a=Object.keys(e);e.stack&&a.push("stack"),a.forEach(d=>{d!=="message"&&Object.defineProperty(o,d,{value:e[d],writable:!1,enumerable:!0})})}return o}});var Xl=z(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.StsCredentials=void 0;var bk=rt(),Rk=Lt(),Cv=Hf(),Ik=mn(),Vf=class t extends Cv.OAuthClientAuthHandler{#e;constructor(e={tokenExchangeEndpoint:""},n){(typeof e!="object"||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:n}),super(e),this.#e=e.tokenExchangeEndpoint}async exchangeToken(e,n,r){let i={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:r&&JSON.stringify(r)},s={...t.RETRY_CONFIG,url:this.#e.toString(),method:"POST",headers:n,data:new URLSearchParams((0,Ik.removeUndefinedValuesInObject)(i))};Rk.AuthClient.setMethodName(s,"exchangeToken"),this.applyClientAuthenticationOptions(s);try{let o=await this.transporter.request(s),a=o.data;return a.res=o,a}catch(o){throw o instanceof bk.GaxiosError&&o.response?(0,Cv.getErrorFromOAuthErrorResponse)(o.response.data,o):o}}};Yl.StsCredentials=Vf});var qr=z(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.BaseExternalAccountClient=en.CLOUD_RESOURCE_MANAGER=en.EXTERNAL_ACCOUNT_TYPE=en.EXPIRATION_TIME_OFFSET=void 0;var Pk=rt(),xk=X("stream"),$f=Lt(),kk=Xl(),Av=mn(),Nk=sf(),Mk="urn:ietf:params:oauth:grant-type:token-exchange",Ok="urn:ietf:params:oauth:token-type:access_token",Wf="https://www.googleapis.com/auth/cloud-platform",Dk=3600;en.EXPIRATION_TIME_OFFSET=300*1e3;en.EXTERNAL_ACCOUNT_TYPE="external_account";en.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var Uk="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",Lk="https://sts.{universeDomain}/v1/token",Jf=class t extends $f.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#e=null;constructor(e){super(e);let n=(0,Av.originalOrCamelOptions)(e),r=n.get("type");if(r&&r!==en.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${en.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let i=n.get("client_id"),s=n.get("client_secret");this.tokenUrl=n.get("token_url")??Lk.replace("{universeDomain}",this.universeDomain);let o=n.get("subject_token_type"),a=n.get("workforce_pool_user_project"),d=n.get("service_account_impersonation_url"),u=n.get("service_account_impersonation"),h=(0,Av.originalOrCamelOptions)(u).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(n.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),i&&(this.clientAuth={confidentialClientType:"basic",clientId:i,clientSecret:s}),this.stsCredential=new kk.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=n.get("scopes")||[Wf],this.cachedAccessToken=null,this.audience=n.get("audience"),this.subjectTokenType=o,this.workforcePoolUserProject=a;let m=new RegExp(Uk);if(this.workforcePoolUserProject&&!this.audience.match(m))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=Dk),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);return/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl)?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let n=await this.getRequestHeaders(),r={...t.RETRY_CONFIG,headers:n,url:`${this.cloudResourceManagerURL.toString()}${e}`};$f.AuthClient.setMethodName(r,"getProjectId");let i=await this.transporter.request(r);return this.projectId=i.data.projectId,this.projectId}return null}async requestAsync(e,n=!1){let r;try{let i=await this.getRequestHeaders();e.headers=Pk.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,i),r=await this.transporter.request(e)}catch(i){let s=i.response;if(s){let o=s.status,a=s.config.data instanceof xk.Readable;if(!n&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){this.#e=this.#e||this.#t();try{return await this.#e}finally{this.#e=null}}async#t(){let e=await this.retrieveSubjectToken(),n={grantType:Mk,audience:this.audience,requestedTokenType:Ok,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[Wf]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,i=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),s=await this.stsCredential.exchangeToken(n,i,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(s.access_token):s.expires_in?this.cachedAccessToken={access_token:s.access_token,expiry_date:new Date().getTime()+s.expires_in*1e3,res:s.res}:this.cachedAccessToken={access_token:s.access_token,res:s.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let n=e.match(/\/projects\/([^/]+)/);return n?n[1]:null}async getImpersonatedAccessToken(e){let n={...t.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};$f.AuthClient.setMethodName(n,"getImpersonatedAccessToken");let r=await this.transporter.request(n),i=r.data;return{access_token:i.accessToken,expiry_date:new Date(i.expireTime).getTime(),res:r}}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[Wf]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),n=this.serviceAccountImpersonationUrl!==void 0,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${Nk.pkg.version} google-byoid-sdk source/${r} sa-impersonation/${n} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};en.BaseExternalAccountClient=Jf});var bv=z(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.FileSubjectTokenSupplier=void 0;var Kf=X("util"),Yf=X("fs"),Fk=(0,Kf.promisify)(Yf.readFile??(()=>{})),qk=(0,Kf.promisify)(Yf.realpath??(()=>{})),Bk=(0,Kf.promisify)(Yf.lstat??(()=>{})),zf=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await qk(e),!(await Bk(e)).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let n,r=await Fk(e,{encoding:"utf8"});if(this.formatType==="text"?n=r:this.formatType==="json"&&this.subjectTokenFieldName&&(n=JSON.parse(r)[this.subjectTokenFieldName]),!n)throw new Error("Unable to parse the subject_token from the credential_source file");return n}};Zl.FileSubjectTokenSupplier=zf});var Rv=z(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});Ql.UrlSubjectTokenSupplier=void 0;var Gk=Lt(),Xf=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let n={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};Gk.AuthClient.setMethodName(n,"getSubjectToken");let r;if(this.formatType==="text"?r=(await e.transporter.request(n)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(r=(await e.transporter.request(n)).data[this.subjectTokenFieldName]),!r)throw new Error("Unable to parse the subject_token from the credential_source URL");return r}};Ql.UrlSubjectTokenSupplier=Xf});var Iv=z(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.CertificateSubjectTokenSupplier=Gt.InvalidConfigurationError=Gt.CertificateSourceUnavailableError=Gt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var jl=mn(),eu=X("fs"),tu=X("crypto"),Hk=X("https");Gt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var Bn=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};Gt.CertificateSourceUnavailableError=Bn;var tn=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};Gt.InvalidConfigurationError=tn;var Zf=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new tn("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new tn("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new tn("Cannot create mTLS Agent with missing certificate or key");return new Hk.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#e();let{certPath:e,keyPath:n}=await this.#t();return{cert:this.cert,key:this.key}=await this.#n(e,n),await this.#s(this.cert)}async#e(){let e=this.certificateConfigPath;if(e){if(await(0,jl.isValidFile)(e))return e;throw new Bn(`Provided certificate config path is invalid: ${e}`)}let n=process.env[Gt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(n){if(await(0,jl.isValidFile)(n))return n;throw new Bn(`Path from environment variable "${Gt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${n}`)}let r=(0,jl.getWellKnownCertificateConfigFileLocation)();if(await(0,jl.isValidFile)(r))return r;throw new Bn(`Could not find certificate configuration file. Searched override path, the "${Gt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${r}).`)}async#t(){let e=this.certificateConfigPath,n;try{n=await eu.promises.readFile(e,"utf8")}catch{throw new Bn(`Failed to read certificate config file at: ${e}`)}try{let r=JSON.parse(n),i=r?.cert_configs?.workload?.cert_path,s=r?.cert_configs?.workload?.key_path;if(!i||!s)throw new tn(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:i,keyPath:s}}catch(r){throw r instanceof tn?r:new tn(`Failed to parse certificate config from ${e}: ${r.message}`)}}async#n(e,n){let r,i;try{r=await eu.promises.readFile(e),new tu.X509Certificate(r)}catch(s){let o=s instanceof Error?s.message:String(s);throw new Bn(`Failed to read certificate file at ${e}: ${o}`)}try{i=await eu.promises.readFile(n),(0,tu.createPrivateKey)(i)}catch(s){let o=s instanceof Error?s.message:String(s);throw new Bn(`Failed to read private key file at ${n}: ${o}`)}return{cert:r,key:i}}async#s(e){let n=new tu.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([n.raw.toString("base64")]);try{let s=((await eu.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((d,u)=>{try{return new tu.X509Certificate(d)}catch(h){let m=h instanceof Error?h.message:String(h);throw new tn(`Failed to parse certificate at index ${u} in trust chain file ${this.trustChainPath}: ${m}`)}}),o=s.findIndex(d=>n.raw.equals(d.raw)),a;if(o===-1)a=[n,...s];else if(o===0)a=s;else throw new tn(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${o}).`);return JSON.stringify(a.map(d=>d.raw.toString("base64")))}catch(r){if(r instanceof tn)throw r;let i=r instanceof Error?r.message:String(r);throw new Bn(`Failed to process certificate chain from ${this.trustChainPath}: ${i}`)}}};Gt.CertificateSubjectTokenSupplier=Zf});var eh=z(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});nu.IdentityPoolClient=void 0;var Vk=qr(),Qf=mn(),$k=bv(),Wk=Rv(),Pv=Iv(),Jk=Xl(),xv=rt(),jf=class t extends Vk.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let n=(0,Qf.originalOrCamelOptions)(e),r=n.get("credential_source"),i=n.get("subject_token_supplier");if(!r&&!i)throw new Error("A credential source or subject token supplier must be specified.");if(r&&i)throw new Error("Only one of credential source or subject token supplier can be specified.");if(i)this.subjectTokenSupplier=i,this.credentialSourceType="programmatic";else{let s=(0,Qf.originalOrCamelOptions)(r),o=(0,Qf.originalOrCamelOptions)(s.get("format")),a=o.get("type")||"text",d=o.get("subject_token_field_name");if(a!=="json"&&a!=="text")throw new Error(`Invalid credential_source format "${a}"`);if(a==="json"&&!d)throw new Error("Missing subject_token_field_name for JSON credential_source format");let u=s.get("file"),h=s.get("url"),m=s.get("certificate"),g=s.get("headers");if(u&&h||h&&m||u&&m)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(u)this.credentialSourceType="file",this.subjectTokenSupplier=new $k.FileSubjectTokenSupplier({filePath:u,formatType:a,subjectTokenFieldName:d});else if(h)this.credentialSourceType="url",this.subjectTokenSupplier=new Wk.UrlSubjectTokenSupplier({url:h,formatType:a,subjectTokenFieldName:d,headers:g,additionalGaxiosOptions:t.RETRY_CONFIG});else if(m){this.credentialSourceType="certificate";let _=new Pv.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:m.use_default_certificate_config,certificateConfigLocation:m.certificate_config_location,trustChainPath:m.trust_chain_path});this.subjectTokenSupplier=_}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof Pv.CertificateSubjectTokenSupplier){let n=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new Jk.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new xv.Gaxios({agent:n})}),this.transporter=new xv.Gaxios({...this.transporter.defaults||{},agent:n})}return e}};nu.IdentityPoolClient=jf});var nh=z(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.AwsRequestSigner=void 0;var ru=rt(),Nv=xo(),kv="AWS4-HMAC-SHA256",zk="aws4_request",th=class{getCredentials;region;crypto;constructor(e,n){this.getCredentials=e,this.region=n,this.crypto=(0,Nv.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let n=typeof e.data=="object"?JSON.stringify(e.data):e.data,r=e.url,i=e.method||"GET",s=e.body||n,o=e.headers,a=await this.getCredentials(),d=new URL(r);if(typeof s!="string"&&s!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${s}`);let u=await Yk({crypto:this.crypto,host:d.host,canonicalUri:d.pathname,canonicalQuerystring:d.search.slice(1),method:i,region:this.region,securityCredentials:a,requestPayload:s,additionalAmzHeaders:o}),h=ru.Gaxios.mergeHeaders(u.amzDate?{"x-amz-date":u.amzDate}:{},{authorization:u.authorizationHeader,host:d.host},o||{});a.token&&ru.Gaxios.mergeHeaders(h,{"x-amz-security-token":a.token});let m={url:r,method:i,headers:h};return s!==void 0&&(m.body=s),m}};iu.AwsRequestSigner=th;async function Go(t,e,n){return await t.signWithHmacSha256(e,n)}async function Kk(t,e,n,r,i){let s=await Go(t,`AWS4${e}`,n),o=await Go(t,s,r),a=await Go(t,o,i);return await Go(t,a,"aws4_request")}async function Yk(t){let e=ru.Gaxios.mergeHeaders(t.additionalAmzHeaders),n=t.requestPayload||"",r=t.host.split(".")[0],i=new Date,s=i.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),o=i.toISOString().replace(/[-]/g,"").replace(/T.*/,"");t.securityCredentials.token&&e.set("x-amz-security-token",t.securityCredentials.token);let a=ru.Gaxios.mergeHeaders({host:t.host},e.has("date")?{}:{"x-amz-date":s},e),d="",u=[...a.keys()].sort();u.forEach(G=>{d+=`${G}:${a.get(G)}
`});let h=u.join(";"),m=await t.crypto.sha256DigestHex(n),g=`${t.method.toUpperCase()}
${t.canonicalUri}
${t.canonicalQuerystring}
${d}
${h}
${m}`,_=`${o}/${t.region}/${r}/${zk}`,v=`${kv}
${s}
${_}
`+await t.crypto.sha256DigestHex(g),w=await Kk(t.crypto,t.securityCredentials.secretAccessKey,o,t.region,r),T=await Go(t.crypto,w,v),A=`${kv} Credential=${t.securityCredentials.accessKeyId}/${_}, SignedHeaders=${h}, Signature=${(0,Nv.fromArrayBufferToHex)(T)}`;return{amzDate:e.has("date")?void 0:s,authorizationHeader:A,canonicalQuerystring:t.canonicalQuerystring}}});var Mv=z(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.DefaultAwsSecurityCredentialsSupplier=void 0;var su=Lt(),rh=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#s)return this.#s;let n=new Headers;if(!this.#s&&this.imdsV2SessionTokenUrl&&n.set("x-aws-ec2-metadata-token",await this.#e(e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:n};su.AuthClient.setMethodName(r,"getAwsRegion");let i=await e.transporter.request(r);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(this.#r)return this.#r;let n=new Headers;this.imdsV2SessionTokenUrl&&n.set("x-aws-ec2-metadata-token",await this.#e(e.transporter));let r=await this.#t(n,e.transporter),i=await this.#n(r,n,e.transporter);return{accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,token:i.Token}}async#e(e){let n={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return su.AuthClient.setMethodName(n,"#getImdsV2SessionToken"),(await e.request(n)).data}async#t(e,n){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return su.AuthClient.setMethodName(r,"#getAwsRoleName"),(await n.request(r)).data}async#n(e,n,r){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:n};return su.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await r.request(i)).data}get#s(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get#r(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}};ou.DefaultAwsSecurityCredentialsSupplier=rh});var sh=z(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.AwsClient=void 0;var Xk=nh(),Zk=qr(),Qk=Mv(),Ov=mn(),jk=rt(),ih=class t extends Zk.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static#e="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let n=(0,Ov.originalOrCamelOptions)(e),r=n.get("credential_source"),i=n.get("aws_security_credentials_supplier");if(!r&&!i)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(r&&i)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(i)this.awsSecurityCredentialsSupplier=i,this.regionalCredVerificationUrl=t.#e,this.credentialSourceType="programmatic";else{let s=(0,Ov.originalOrCamelOptions)(r);this.environmentId=s.get("environment_id");let o=s.get("region_url"),a=s.get("url"),d=s.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new Qk.DefaultAwsSecurityCredentialsSupplier({regionUrl:o,securityCredentialsUrl:a,imdsV2SessionTokenUrl:d}),this.regionalCredVerificationUrl=s.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(!e||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(e[2],10)!==1)throw new Error(`aws version "${e[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new Xk.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...t.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),n=[];return jk.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((i,s)=>n.push({key:s,value:i})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:n}))}};au.AwsClient=ih});var ch=z(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.InvalidSubjectTokenError=We.InvalidMessageFieldError=We.InvalidCodeFieldError=We.InvalidTokenTypeFieldError=We.InvalidExpirationTimeFieldError=We.InvalidSuccessFieldError=We.InvalidVersionFieldError=We.ExecutableResponseError=We.ExecutableResponse=void 0;var lu="urn:ietf:params:oauth:token-type:saml2",oh="urn:ietf:params:oauth:token-type:id_token",ah="urn:ietf:params:oauth:token-type:jwt",lh=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new uu("Executable response must contain a 'version' field.");if(e.success===void 0)throw new cu("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==lu&&this.tokenType!==oh&&this.tokenType!==ah)throw new du(`Executable response must contain a 'token_type' field when successful and it must be one of ${oh}, ${ah}, or ${lu}.`);if(this.tokenType===lu){if(!e.saml_response)throw new Ho(`Executable response must contain a 'saml_response' field when token_type=${lu}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new Ho(`Executable response must contain a 'id_token' field when token_type=${oh} or ${ah}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new fu("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new hu("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};We.ExecutableResponse=lh;var Gn=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};We.ExecutableResponseError=Gn;var uu=class extends Gn{};We.InvalidVersionFieldError=uu;var cu=class extends Gn{};We.InvalidSuccessFieldError=cu;var uh=class extends Gn{};We.InvalidExpirationTimeFieldError=uh;var du=class extends Gn{};We.InvalidTokenTypeFieldError=du;var fu=class extends Gn{};We.InvalidCodeFieldError=fu;var hu=class extends Gn{};We.InvalidMessageFieldError=hu;var Ho=class extends Gn{};We.InvalidSubjectTokenError=Ho});var hh=z(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.PluggableAuthHandler=Ms.ExecutableError=void 0;var bi=ch(),eN=X("child_process"),dh=X("fs"),pu=class extends Error{code;constructor(e,n){super(`The executable failed with exit code: ${n} and error message: ${e}.`),this.code=n,Object.setPrototypeOf(this,new.target.prototype)}};Ms.ExecutableError=pu;var fh=class t{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=t.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((n,r)=>{let i=eN.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),s="";i.stdout.on("data",a=>{s+=a}),i.stderr.on("data",a=>{s+=a});let o=setTimeout(()=>(i.removeAllListeners(),i.kill(),r(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);i.on("close",a=>{if(clearTimeout(o),a===0)try{let d=JSON.parse(s),u=new bi.ExecutableResponse(d);return n(u)}catch(d){return d instanceof bi.ExecutableResponseError?r(d):r(new bi.ExecutableResponseError(`The executable returned an invalid response: ${s}`))}else return r(new pu(s,a.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await dh.promises.realpath(this.outputFile)}catch{return}if(!(await dh.promises.lstat(e)).isFile())return;let n=await dh.promises.readFile(e,{encoding:"utf8"});if(n!=="")try{let r=JSON.parse(n);return new bi.ExecutableResponse(r).isValid()?new bi.ExecutableResponse(r):void 0}catch(r){throw r instanceof bi.ExecutableResponseError?r:new bi.ExecutableResponseError(`The output file contained an invalid response: ${n}`)}}static parseCommand(e){let n=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!n)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let r=0;r<n.length;r++)n[r][0]==='"'&&n[r].slice(-1)==='"'&&(n[r]=n[r].slice(1,-1));return n}};Ms.PluggableAuthHandler=fh});var mh=z(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.PluggableAuthClient=Os.ExecutableError=void 0;var tN=qr(),nN=ch(),Dv=hh(),rN=hh();Object.defineProperty(Os,"ExecutableError",{enumerable:!0,get:function(){return rN.ExecutableError}});var iN=30*1e3,Uv=5*1e3,Lv=120*1e3,sN="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",Fv=1,ph=class extends tN.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=iN;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<Uv||this.timeoutMillis>Lv)throw new Error(`Timeout must be between ${Uv} and ${Lv} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new Dv.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[sN]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let n=new Map;n.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),n.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),n.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&n.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&n.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(n)}if(e.version>Fv)throw new Error(`Version of executable is not currently supported, maximum supported version is ${Fv}.`);if(!e.success)throw new Dv.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new nN.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};Os.PluggableAuthClient=ph});var yh=z(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.ExternalAccountClient=void 0;var oN=qr(),aN=eh(),lN=sh(),uN=mh(),gh=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===oN.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new lN.AwsClient(e):e.credential_source?.executable?new uN.PluggableAuthClient(e):new aN.IdentityPoolClient(e):null}};mu.ExternalAccountClient=gh});var vh=z(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});Ds.ExternalAccountAuthorizedUserClient=Ds.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var Bv=Lt(),qv=Hf(),Gv=rt(),cN=X("stream"),dN=qr();Ds.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var fN="https://sts.{universeDomain}/v1/oauthtoken",_h=class t extends qv.OAuthClientAuthHandler{#e;constructor(e){super(e),this.#e=e.tokenRefreshEndpoint}async refreshToken(e,n){let r={...t.RETRY_CONFIG,url:this.#e,method:"POST",headers:n,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};Bv.AuthClient.setMethodName(r,"refreshToken"),this.applyClientAuthenticationOptions(r);try{let i=await this.transporter.request(r),s=i.data;return s.res=i,s}catch(i){throw i instanceof Gv.GaxiosError&&i.response?(0,qv.getErrorFromOAuthErrorResponse)(i.response.data,i):i}}},Eh=class extends Bv.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let n={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new _h({tokenRefreshEndpoint:e.token_url??fN.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:n}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof e?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=dN.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){let r;try{let i=await this.getRequestHeaders();e.headers=Gv.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,i),r=await this.transporter.request(e)}catch(i){let s=i.response;if(s){let o=s.status,a=s.config.data instanceof cN.Readable;if(!n&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Ds.ExternalAccountAuthorizedUserClient=Eh});var Wv=z(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.GoogleAuth=En.GoogleAuthExceptionMessages=void 0;var hN=X("child_process"),Vo=X("fs"),pN=rt(),$o=Po(),mN=X("os"),Sh=X("path"),gN=xo(),yN=pf(),_N=gf(),EN=yf(),Us=Uf(),Hv=Ff(),Ls=Bf(),vN=yh(),Wo=qr(),Th=Lt(),Vv=vh(),$v=mn();En.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var wh=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#e=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError(En.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(n=>e(null,n),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===En.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId(),e)return this._cachedProjectId=e,e;throw new Error(En.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await $o.universe("universe-domain"),e||=Th.DEFAULT_UNIVERSE}catch(n){if(n&&n?.response?.status===404)e=Th.DEFAULT_UNIVERSE;else throw n}return e}async getUniverseDomain(){let e=(0,$v.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=Th.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},n){let r;if(typeof e=="function"?n=e:r=e,n)this.getApplicationDefaultAsync(r).then(i=>n(null,i.credential,i.projectId),n);else return this.getApplicationDefaultAsync(r)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.#t(this.cachedCredential,null);let n;if(n=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),n)return n instanceof Us.JWT?n.scopes=this.scopes:n instanceof Wo.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#t(n);if(n=await this._tryGetApplicationCredentialsFromWellKnownFile(e),n)return n instanceof Us.JWT?n.scopes=this.scopes:n instanceof Wo.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#t(n);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#t(new yN.Compute(e));throw new Error(En.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async#t(e,n=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return n&&(e.quotaProjectId=n),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=$o.getGCPResidency()||await $o.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let n=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!n||n.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(n,e)}catch(r){throw r instanceof Error&&(r.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${r.message}`),r}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let n=null;if(this._isWindows())n=process.env.APPDATA;else{let i=process.env.HOME;i&&(n=Sh.join(i,".config"))}return n&&(n=Sh.join(n,"gcloud","application_default_credentials.json"),Vo.existsSync(n)||(n=null)),n?await this._getApplicationCredentialsFromFilePath(n,e):null}async _getApplicationCredentialsFromFilePath(e,n={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=Vo.realpathSync(e),!Vo.lstatSync(e).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let r=Vo.createReadStream(e);return this.fromStream(r,n)}fromImpersonatedJSON(e){if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Ls.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Ls.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let n=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!r)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let i=(this.scopes||e.scopes||this.defaultScopes)??[];return new Ls.Impersonated({...e,sourceClient:n,targetPrincipal:r,targetScopes:Array.isArray(i)?i:[i]})}fromJSON(e,n={}){let r,i=(0,$v.originalOrCamelOptions)(n).get("universe_domain");return e.type===Hv.USER_REFRESH_ACCOUNT_TYPE?(r=new Hv.UserRefreshClient(n),r.fromJSON(e)):e.type===Ls.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===Wo.EXTERNAL_ACCOUNT_TYPE?(r=vN.ExternalAccountClient.fromJSON({...e,...n}),r.scopes=this.getAnyScopes()):e.type===Vv.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new Vv.ExternalAccountAuthorizedUserClient({...e,...n}):(n.scopes=this.scopes,r=new Us.JWT(n),this.setGapicJWTValues(r),r.fromJSON(e)),i&&(r.universeDomain=i),r}_cacheClientFromJSON(e,n){let r=this.fromJSON(e,n);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,n={},r){let i={};if(typeof n=="function"?r=n:i=n,r)this.fromStreamAsync(e,i).then(s=>r(null,s),r);else return this.fromStreamAsync(e,i)}fromStreamAsync(e,n){return new Promise((r,i)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let s=[];e.setEncoding("utf8").on("error",i).on("data",o=>s.push(o)).on("end",()=>{try{try{let o=JSON.parse(s.join("")),a=this._cacheClientFromJSON(o,n);return r(a)}catch(o){if(!this.keyFilename)throw o;let a=new Us.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),r(a)}}catch(o){return i(o)}})})}fromAPIKey(e,n={}){return new Us.JWT({...n,apiKey:e})}_isWindows(){let e=mN.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,hN.exec)("gcloud config config-helper --format json",(n,r)=>{if(!n&&r)try{let i=JSON.parse(r).configuration.properties.core.project;e(i);return}catch{}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let n=await this.getClient();if(n&&n.projectId)return n.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==Wo.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await $o.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(n=>e(null,n),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof Ls.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof Wo.BaseExternalAccountClient){let n=e.getServiceAccountEmail();if(n)return{client_email:n,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[n,r]=await Promise.all([$o.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:n,universe_domain:r}}throw new Error(En.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#e=this.#e||this.#n();try{return await this.#e}finally{this.#e=null}}async#n(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=Sh.resolve(this.keyFilename),n=Vo.createReadStream(e);return await this.fromStreamAsync(n,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:n}=await this.#t(e);return n}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let n=await this.getClient();if(!("fetchIdToken"in n))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new _N.IdTokenClient({targetAudience:e,idTokenProvider:n})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let n=e.url,i=await(await this.getClient()).getRequestHeaders(n);return e.headers=pN.Gaxios.mergeHeaders(e.headers,i),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,EN.getEnv)()}async sign(e,n){let r=await this.getClient(),i=await this.getUniverseDomain();if(n=n||`https://iamcredentials.${i}/v1/projects/-/serviceAccounts/`,r instanceof Ls.Impersonated)return(await r.sign(e)).signedBlob;let s=(0,gN.createCrypto)();if(r instanceof Us.JWT&&r.key)return await s.sign(r.key,e);let o=await this.getCredentials();if(!o.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(s,o.client_email,e,n)}async signBlob(e,n,r,i){let s=new URL(i+`${n}:signBlob`);return(await this.request({method:"POST",url:s.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};En.GoogleAuth=wh});var Jv=z(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.IAMAuth=void 0;var Ch=class{selector;token;constructor(e,n){this.selector=e,this.token=n,this.selector=e,this.token=n}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};gu.IAMAuth=Ch});var zv=z(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.DownscopedClient=Hn.EXPIRATION_TIME_OFFSET=Hn.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var SN=rt(),TN=X("stream"),Ah=Lt(),wN=Xl(),CN="urn:ietf:params:oauth:grant-type:token-exchange",AN="urn:ietf:params:oauth:token-type:access_token",bN="urn:ietf:params:oauth:token-type:access_token";Hn.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;Hn.EXPIRATION_TIME_OFFSET=300*1e3;var bh=class extends Ah.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,n={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof Ah.AuthClient?{}:e),e instanceof Ah.AuthClient?(this.authClient=e,this.credentialAccessBoundary=n):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>Hn.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${Hn.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let r of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(r.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new wN.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){let r;try{let i=await this.getRequestHeaders();e.headers=SN.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,i),r=await this.transporter.request(e)}catch(i){let s=i.response;if(s){let o=s.status,a=s.config.data instanceof TN.Readable;if(!n&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,n={grantType:CN,requestedTokenType:AN,subjectToken:e,subjectTokenType:bN},r=await this.stsCredential.exchangeToken(n,void 0,this.credentialAccessBoundary),i=this.authClient.credentials?.expiry_date||null,s=r.expires_in?new Date().getTime()+r.expires_in*1e3:i;return this.cachedDownscopedAccessToken={access_token:r.access_token,expiry_date:s,res:r.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Hn.DownscopedClient=bh});var Kv=z(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});yu.PassThroughClient=void 0;var RN=Lt(),Rh=class extends RN.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};yu.PassThroughClient=Rh});var jv=z(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.GoogleAuth=ie.auth=ie.PassThroughClient=ie.ExternalAccountAuthorizedUserClient=ie.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=ie.ExecutableError=ie.PluggableAuthClient=ie.DownscopedClient=ie.BaseExternalAccountClient=ie.ExternalAccountClient=ie.IdentityPoolClient=ie.AwsRequestSigner=ie.AwsClient=ie.UserRefreshClient=ie.LoginTicket=ie.ClientAuthentication=ie.OAuth2Client=ie.CodeChallengeMethod=ie.Impersonated=ie.JWT=ie.JWTAccess=ie.IdTokenClient=ie.IAMAuth=ie.GCPEnv=ie.Compute=ie.DEFAULT_UNIVERSE=ie.AuthClient=ie.gaxios=ie.gcpMetadata=void 0;var Yv=Wv();Object.defineProperty(ie,"GoogleAuth",{enumerable:!0,get:function(){return Yv.GoogleAuth}});ie.gcpMetadata=Po();ie.gaxios=rt();var Xv=Lt();Object.defineProperty(ie,"AuthClient",{enumerable:!0,get:function(){return Xv.AuthClient}});Object.defineProperty(ie,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return Xv.DEFAULT_UNIVERSE}});var IN=pf();Object.defineProperty(ie,"Compute",{enumerable:!0,get:function(){return IN.Compute}});var PN=yf();Object.defineProperty(ie,"GCPEnv",{enumerable:!0,get:function(){return PN.GCPEnv}});var xN=Jv();Object.defineProperty(ie,"IAMAuth",{enumerable:!0,get:function(){return xN.IAMAuth}});var kN=gf();Object.defineProperty(ie,"IdTokenClient",{enumerable:!0,get:function(){return kN.IdTokenClient}});var NN=Of();Object.defineProperty(ie,"JWTAccess",{enumerable:!0,get:function(){return NN.JWTAccess}});var MN=Uf();Object.defineProperty(ie,"JWT",{enumerable:!0,get:function(){return MN.JWT}});var ON=Bf();Object.defineProperty(ie,"Impersonated",{enumerable:!0,get:function(){return ON.Impersonated}});var Ih=Ai();Object.defineProperty(ie,"CodeChallengeMethod",{enumerable:!0,get:function(){return Ih.CodeChallengeMethod}});Object.defineProperty(ie,"OAuth2Client",{enumerable:!0,get:function(){return Ih.OAuth2Client}});Object.defineProperty(ie,"ClientAuthentication",{enumerable:!0,get:function(){return Ih.ClientAuthentication}});var DN=cf();Object.defineProperty(ie,"LoginTicket",{enumerable:!0,get:function(){return DN.LoginTicket}});var UN=Ff();Object.defineProperty(ie,"UserRefreshClient",{enumerable:!0,get:function(){return UN.UserRefreshClient}});var LN=sh();Object.defineProperty(ie,"AwsClient",{enumerable:!0,get:function(){return LN.AwsClient}});var FN=nh();Object.defineProperty(ie,"AwsRequestSigner",{enumerable:!0,get:function(){return FN.AwsRequestSigner}});var qN=eh();Object.defineProperty(ie,"IdentityPoolClient",{enumerable:!0,get:function(){return qN.IdentityPoolClient}});var BN=yh();Object.defineProperty(ie,"ExternalAccountClient",{enumerable:!0,get:function(){return BN.ExternalAccountClient}});var GN=qr();Object.defineProperty(ie,"BaseExternalAccountClient",{enumerable:!0,get:function(){return GN.BaseExternalAccountClient}});var HN=zv();Object.defineProperty(ie,"DownscopedClient",{enumerable:!0,get:function(){return HN.DownscopedClient}});var Zv=mh();Object.defineProperty(ie,"PluggableAuthClient",{enumerable:!0,get:function(){return Zv.PluggableAuthClient}});Object.defineProperty(ie,"ExecutableError",{enumerable:!0,get:function(){return Zv.ExecutableError}});var Qv=vh();Object.defineProperty(ie,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return Qv.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}});Object.defineProperty(ie,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return Qv.ExternalAccountAuthorizedUserClient}});var VN=Kv();Object.defineProperty(ie,"PassThroughClient",{enumerable:!0,get:function(){return VN.PassThroughClient}});var $N=new Yv.GoogleAuth;ie.auth=$N});var dr=z((XW,nS)=>{"use strict";var eS=["nodebuffer","arraybuffer","fragments"],tS=typeof Blob<"u";tS&&eS.push("blob");nS.exports={BINARY_TYPES:eS,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:tS,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Jo=z((ZW,_u)=>{"use strict";var{EMPTY_BUFFER:WN}=dr(),Ph=Buffer[Symbol.species];function JN(t,e){if(t.length===0)return WN;if(t.length===1)return t[0];let n=Buffer.allocUnsafe(e),r=0;for(let i=0;i<t.length;i++){let s=t[i];n.set(s,r),r+=s.length}return r<e?new Ph(n.buffer,n.byteOffset,r):n}function rS(t,e,n,r,i){for(let s=0;s<i;s++)n[r+s]=t[s]^e[s&3]}function iS(t,e){for(let n=0;n<t.length;n++)t[n]^=e[n&3]}function zN(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function xh(t){if(xh.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Ph(t):ArrayBuffer.isView(t)?e=new Ph(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),xh.readOnly=!1),e}_u.exports={concat:JN,mask:rS,toArrayBuffer:zN,toBuffer:xh,unmask:iS};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=X("bufferutil");_u.exports.mask=function(e,n,r,i,s){s<48?rS(e,n,r,i,s):t.mask(e,n,r,i,s)},_u.exports.unmask=function(e,n){e.length<32?iS(e,n):t.unmask(e,n)}}catch{}});var aS=z((QW,oS)=>{"use strict";var sS=Symbol("kDone"),kh=Symbol("kRun"),Nh=class{constructor(e){this[sS]=()=>{this.pending--,this[kh]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[kh]()}[kh](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[sS])}}};oS.exports=Nh});var Ko=z((jW,dS)=>{"use strict";var zo=X("zlib"),lS=Jo(),KN=aS(),{kStatusCode:uS}=dr(),YN=Buffer[Symbol.species],XN=Buffer.from([0,0,255,255]),vu=Symbol("permessage-deflate"),fr=Symbol("total-length"),Fs=Symbol("callback"),Br=Symbol("buffers"),qs=Symbol("error"),Eu,Mh=class{constructor(e,n,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!n,this._deflate=null,this._inflate=null,this.params=null,!Eu){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Eu=new KN(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Fs];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let n=this._options,r=e.find(i=>!(n.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(n.serverMaxWindowBits===!1||typeof n.serverMaxWindowBits=="number"&&n.serverMaxWindowBits>i.server_max_window_bits)||typeof n.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return n.serverNoContextTakeover&&(r.server_no_context_takeover=!0),n.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof n.serverMaxWindowBits=="number"&&(r.server_max_window_bits=n.serverMaxWindowBits),typeof n.clientMaxWindowBits=="number"?r.client_max_window_bits=n.clientMaxWindowBits:(r.client_max_window_bits===!0||n.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let n=e[0];if(this._options.clientNoContextTakeover===!1&&n.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!n.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(n.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&n.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return n}normalizeParams(e){return e.forEach(n=>{Object.keys(n).forEach(r=>{let i=n[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let s=+i;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let s=+i;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=s}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);n[r]=i})}),e}decompress(e,n,r){Eu.add(i=>{this._decompress(e,n,(s,o)=>{i(),r(s,o)})})}compress(e,n,r){Eu.add(i=>{this._compress(e,n,(s,o)=>{i(),r(s,o)})})}_decompress(e,n,r){let i=this._isServer?"client":"server";if(!this._inflate){let s=`${i}_max_window_bits`,o=typeof this.params[s]!="number"?zo.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=zo.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[vu]=this,this._inflate[fr]=0,this._inflate[Br]=[],this._inflate.on("error",QN),this._inflate.on("data",cS)}this._inflate[Fs]=r,this._inflate.write(e),n&&this._inflate.write(XN),this._inflate.flush(()=>{let s=this._inflate[qs];if(s){this._inflate.close(),this._inflate=null,r(s);return}let o=lS.concat(this._inflate[Br],this._inflate[fr]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[fr]=0,this._inflate[Br]=[],n&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,n,r){let i=this._isServer?"server":"client";if(!this._deflate){let s=`${i}_max_window_bits`,o=typeof this.params[s]!="number"?zo.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=zo.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[fr]=0,this._deflate[Br]=[],this._deflate.on("data",ZN)}this._deflate[Fs]=r,this._deflate.write(e),this._deflate.flush(zo.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=lS.concat(this._deflate[Br],this._deflate[fr]);n&&(s=new YN(s.buffer,s.byteOffset,s.length-4)),this._deflate[Fs]=null,this._deflate[fr]=0,this._deflate[Br]=[],n&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),r(null,s)})}};dS.exports=Mh;function ZN(t){this[Br].push(t),this[fr]+=t.length}function cS(t){if(this[fr]+=t.length,this[vu]._maxPayload<1||this[fr]<=this[vu]._maxPayload){this[Br].push(t);return}this[qs]=new RangeError("Max payload size exceeded"),this[qs].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[qs][uS]=1009,this.removeListener("data",cS),this.reset()}function QN(t){if(this[vu]._inflate=null,this[qs]){this[Fs](this[qs]);return}t[uS]=1007,this[Fs](t)}});var Bs=z((e2,Su)=>{"use strict";var{isUtf8:fS}=X("buffer"),{hasBlob:jN}=dr(),eM=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function tM(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Oh(t){let e=t.length,n=0;for(;n<e;)if((t[n]&128)===0)n++;else if((t[n]&224)===192){if(n+1===e||(t[n+1]&192)!==128||(t[n]&254)===192)return!1;n+=2}else if((t[n]&240)===224){if(n+2>=e||(t[n+1]&192)!==128||(t[n+2]&192)!==128||t[n]===224&&(t[n+1]&224)===128||t[n]===237&&(t[n+1]&224)===160)return!1;n+=3}else if((t[n]&248)===240){if(n+3>=e||(t[n+1]&192)!==128||(t[n+2]&192)!==128||(t[n+3]&192)!==128||t[n]===240&&(t[n+1]&240)===128||t[n]===244&&t[n+1]>143||t[n]>244)return!1;n+=4}else return!1;return!0}function nM(t){return jN&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Su.exports={isBlob:nM,isValidStatusCode:tM,isValidUTF8:Oh,tokenChars:eM};if(fS)Su.exports.isValidUTF8=function(t){return t.length<24?Oh(t):fS(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=X("utf-8-validate");Su.exports.isValidUTF8=function(e){return e.length<32?Oh(e):t(e)}}catch{}});var qh=z((t2,ES)=>{"use strict";var{Writable:rM}=X("stream"),hS=Ko(),{BINARY_TYPES:iM,EMPTY_BUFFER:pS,kStatusCode:sM,kWebSocket:oM}=dr(),{concat:Dh,toArrayBuffer:aM,unmask:lM}=Jo(),{isValidStatusCode:uM,isValidUTF8:mS}=Bs(),Tu=Buffer[Symbol.species],nn=0,gS=1,yS=2,_S=3,Uh=4,Lh=5,wu=6,Fh=class extends rM{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||iM[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[oM]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=nn}_write(e,n,r){if(this._opcode===8&&this._state==nn)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new Tu(r.buffer,r.byteOffset+e,r.length-e),new Tu(r.buffer,r.byteOffset,e)}let n=Buffer.allocUnsafe(e);do{let r=this._buffers[0],i=n.length-e;e>=r.length?n.set(this._buffers.shift(),i):(n.set(new Uint8Array(r.buffer,r.byteOffset,e),i),this._buffers[0]=new Tu(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return n}startLoop(e){this._loop=!0;do switch(this._state){case nn:this.getInfo(e);break;case gS:this.getPayloadLength16(e);break;case yS:this.getPayloadLength64(e);break;case _S:this.getMask();break;case Uh:this.getData(e);break;case Lh:case wu:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let n=this.consume(2);if((n[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let r=(n[0]&64)===64;if(r&&!this._extensions[hS.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(n[0]&128)===128,this._opcode=n[0]&15,this._payloadLength=n[1]&127,this._opcode===0){if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(n[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=gS:this._payloadLength===127?this._state=yS:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let n=this.consume(8),r=n.readUInt32BE(0);if(r>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=r*Math.pow(2,32)+n.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let n=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(n);return}this._masked?this._state=_S:this._state=Uh}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Uh}getData(e){let n=pS;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}n=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&lM(n,this._mask)}if(this._opcode>7){this.controlMessage(n,e);return}if(this._compressed){this._state=Lh,this.decompress(n,e);return}n.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(n)),this.dataMessage(e)}decompress(e,n){this._extensions[hS.extensionName].decompress(e,this._fin,(i,s)=>{if(i)return n(i);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");n(o);return}this._fragments.push(s)}this.dataMessage(n),this._state===nn&&this.startLoop(n)})}dataMessage(e){if(!this._fin){this._state=nn;return}let n=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=Dh(r,n):this._binaryType==="arraybuffer"?i=aM(Dh(r,n)):this._binaryType==="blob"?i=new Blob(r):i=r,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=nn):(this._state=wu,setImmediate(()=>{this.emit("message",i,!0),this._state=nn,this.startLoop(e)}))}else{let i=Dh(r,n);if(!this._skipUTF8Validation&&!mS(i)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===Lh||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=nn):(this._state=wu,setImmediate(()=>{this.emit("message",i,!1),this._state=nn,this.startLoop(e)}))}}controlMessage(e,n){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,pS),this.end();else{let r=e.readUInt16BE(0);if(!uM(r)){let s=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");n(s);return}let i=new Tu(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!mS(i)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");n(s);return}this._loop=!1,this.emit("conclude",r,i),this.end()}this._state=nn;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=nn):(this._state=wu,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=nn,this.startLoop(n)}))}createError(e,n,r,i,s){this._loop=!1,this._errored=!0;let o=new e(r?`Invalid WebSocket frame: ${n}`:n);return Error.captureStackTrace(o,this.createError),o.code=s,o[sM]=i,o}};ES.exports=Fh});var Hh=z((r2,TS)=>{"use strict";var{Duplex:n2}=X("stream"),{randomFillSync:cM}=X("crypto"),vS=Ko(),{EMPTY_BUFFER:dM,kWebSocket:fM,NOOP:hM}=dr(),{isBlob:Gs,isValidStatusCode:pM}=Bs(),{mask:SS,toBuffer:Ri}=Jo(),rn=Symbol("kByteLength"),mM=Buffer.alloc(4),Cu=8*1024,Ii,Hs=Cu,vn=0,gM=1,yM=2,Bh=class t{constructor(e,n,r){this._extensions=n||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=vn,this.onerror=hM,this[fM]=void 0}static frame(e,n){let r,i=!1,s=2,o=!1;n.mask&&(r=n.maskBuffer||mM,n.generateMask?n.generateMask(r):(Hs===Cu&&(Ii===void 0&&(Ii=Buffer.alloc(Cu)),cM(Ii,0,Cu),Hs=0),r[0]=Ii[Hs++],r[1]=Ii[Hs++],r[2]=Ii[Hs++],r[3]=Ii[Hs++]),o=(r[0]|r[1]|r[2]|r[3])===0,s=6);let a;typeof e=="string"?(!n.mask||o)&&n[rn]!==void 0?a=n[rn]:(e=Buffer.from(e),a=e.length):(a=e.length,i=n.mask&&n.readOnly&&!o);let d=a;a>=65536?(s+=8,d=127):a>125&&(s+=2,d=126);let u=Buffer.allocUnsafe(i?a+s:s);return u[0]=n.fin?n.opcode|128:n.opcode,n.rsv1&&(u[0]|=64),u[1]=d,d===126?u.writeUInt16BE(a,2):d===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),n.mask?(u[1]|=128,u[s-4]=r[0],u[s-3]=r[1],u[s-2]=r[2],u[s-1]=r[3],o?[u,e]:i?(SS(e,r,u,s,a),[u]):(SS(e,r,e,0,a),[u,e])):[u,e]}close(e,n,r,i){let s;if(e===void 0)s=dM;else{if(typeof e!="number"||!pM(e))throw new TypeError("First argument must be a valid error code number");if(n===void 0||!n.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(n);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof n=="string"?s.write(n,2):s.set(n,2)}}let o={[rn]:s.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==vn?this.enqueue([this.dispatch,s,!1,o,i]):this.sendFrame(t.frame(s,o),i)}ping(e,n,r){let i,s;if(typeof e=="string"?(i=Buffer.byteLength(e),s=!1):Gs(e)?(i=e.size,s=!1):(e=Ri(e),i=e.length,s=Ri.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[rn]:i,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};Gs(e)?this._state!==vn?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):this._state!==vn?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(t.frame(e,o),r)}pong(e,n,r){let i,s;if(typeof e=="string"?(i=Buffer.byteLength(e),s=!1):Gs(e)?(i=e.size,s=!1):(e=Ri(e),i=e.length,s=Ri.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[rn]:i,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};Gs(e)?this._state!==vn?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):this._state!==vn?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(t.frame(e,o),r)}send(e,n,r){let i=this._extensions[vS.extensionName],s=n.binary?2:1,o=n.compress,a,d;typeof e=="string"?(a=Buffer.byteLength(e),d=!1):Gs(e)?(a=e.size,d=!1):(e=Ri(e),a=e.length,d=Ri.readOnly),this._firstFragment?(this._firstFragment=!1,o&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=i._threshold),this._compress=o):(o=!1,s=0),n.fin&&(this._firstFragment=!0);let u={[rn]:a,fin:n.fin,generateMask:this._generateMask,mask:n.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:d,rsv1:o};Gs(e)?this._state!==vn?this.enqueue([this.getBlobData,e,this._compress,u,r]):this.getBlobData(e,this._compress,u,r):this._state!==vn?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}getBlobData(e,n,r,i){this._bufferedBytes+=r[rn],this._state=yM,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(Gh,this,a,i);return}this._bufferedBytes-=r[rn];let o=Ri(s);n?this.dispatch(o,n,r,i):(this._state=vn,this.sendFrame(t.frame(o,r),i),this.dequeue())}).catch(s=>{process.nextTick(_M,this,s,i)})}dispatch(e,n,r,i){if(!n){this.sendFrame(t.frame(e,r),i);return}let s=this._extensions[vS.extensionName];this._bufferedBytes+=r[rn],this._state=gM,s.compress(e,r.fin,(o,a)=>{if(this._socket.destroyed){let d=new Error("The socket was closed while data was being compressed");Gh(this,d,i);return}this._bufferedBytes-=r[rn],this._state=vn,r.readOnly=!1,this.sendFrame(t.frame(a,r),i),this.dequeue()})}dequeue(){for(;this._state===vn&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][rn],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][rn],this._queue.push(e)}sendFrame(e,n){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],n),this._socket.uncork()):this._socket.write(e[0],n)}};TS.exports=Bh;function Gh(t,e,n){typeof n=="function"&&n(e);for(let r=0;r<t._queue.length;r++){let i=t._queue[r],s=i[i.length-1];typeof s=="function"&&s(e)}}function _M(t,e,n){Gh(t,e,n),t.onerror(e)}});var kS=z((i2,xS)=>{"use strict";var{kForOnEventAttribute:Yo,kListener:Vh}=dr(),wS=Symbol("kCode"),CS=Symbol("kData"),AS=Symbol("kError"),bS=Symbol("kMessage"),RS=Symbol("kReason"),Vs=Symbol("kTarget"),IS=Symbol("kType"),PS=Symbol("kWasClean"),hr=class{constructor(e){this[Vs]=null,this[IS]=e}get target(){return this[Vs]}get type(){return this[IS]}};Object.defineProperty(hr.prototype,"target",{enumerable:!0});Object.defineProperty(hr.prototype,"type",{enumerable:!0});var Pi=class extends hr{constructor(e,n={}){super(e),this[wS]=n.code===void 0?0:n.code,this[RS]=n.reason===void 0?"":n.reason,this[PS]=n.wasClean===void 0?!1:n.wasClean}get code(){return this[wS]}get reason(){return this[RS]}get wasClean(){return this[PS]}};Object.defineProperty(Pi.prototype,"code",{enumerable:!0});Object.defineProperty(Pi.prototype,"reason",{enumerable:!0});Object.defineProperty(Pi.prototype,"wasClean",{enumerable:!0});var $s=class extends hr{constructor(e,n={}){super(e),this[AS]=n.error===void 0?null:n.error,this[bS]=n.message===void 0?"":n.message}get error(){return this[AS]}get message(){return this[bS]}};Object.defineProperty($s.prototype,"error",{enumerable:!0});Object.defineProperty($s.prototype,"message",{enumerable:!0});var Xo=class extends hr{constructor(e,n={}){super(e),this[CS]=n.data===void 0?null:n.data}get data(){return this[CS]}};Object.defineProperty(Xo.prototype,"data",{enumerable:!0});var EM={addEventListener(t,e,n={}){for(let i of this.listeners(t))if(!n[Yo]&&i[Vh]===e&&!i[Yo])return;let r;if(t==="message")r=function(s,o){let a=new Xo("message",{data:o?s:s.toString()});a[Vs]=this,Au(e,this,a)};else if(t==="close")r=function(s,o){let a=new Pi("close",{code:s,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Vs]=this,Au(e,this,a)};else if(t==="error")r=function(s){let o=new $s("error",{error:s,message:s.message});o[Vs]=this,Au(e,this,o)};else if(t==="open")r=function(){let s=new hr("open");s[Vs]=this,Au(e,this,s)};else return;r[Yo]=!!n[Yo],r[Vh]=e,n.once?this.once(t,r):this.on(t,r)},removeEventListener(t,e){for(let n of this.listeners(t))if(n[Vh]===e&&!n[Yo]){this.removeListener(t,n);break}}};xS.exports={CloseEvent:Pi,ErrorEvent:$s,Event:hr,EventTarget:EM,MessageEvent:Xo};function Au(t,e,n){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,n):t.call(e,n)}});var $h=z((s2,NS)=>{"use strict";var{tokenChars:Zo}=Bs();function Vn(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}function vM(t){let e=Object.create(null),n=Object.create(null),r=!1,i=!1,s=!1,o,a,d=-1,u=-1,h=-1,m=0;for(;m<t.length;m++)if(u=t.charCodeAt(m),o===void 0)if(h===-1&&Zo[u]===1)d===-1&&(d=m);else if(m!==0&&(u===32||u===9))h===-1&&d!==-1&&(h=m);else if(u===59||u===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let _=t.slice(d,h);u===44?(Vn(e,_,n),n=Object.create(null)):o=_,d=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);else if(a===void 0)if(h===-1&&Zo[u]===1)d===-1&&(d=m);else if(u===32||u===9)h===-1&&d!==-1&&(h=m);else if(u===59||u===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m),Vn(n,t.slice(d,h),!0),u===44&&(Vn(e,o,n),n=Object.create(null),o=void 0),d=h=-1}else if(u===61&&d!==-1&&h===-1)a=t.slice(d,m),d=h=-1;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(i){if(Zo[u]!==1)throw new SyntaxError(`Unexpected character at index ${m}`);d===-1?d=m:r||(r=!0),i=!1}else if(s)if(Zo[u]===1)d===-1&&(d=m);else if(u===34&&d!==-1)s=!1,h=m;else if(u===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(u===34&&t.charCodeAt(m-1)===61)s=!0;else if(h===-1&&Zo[u]===1)d===-1&&(d=m);else if(d!==-1&&(u===32||u===9))h===-1&&(h=m);else if(u===59||u===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let _=t.slice(d,h);r&&(_=_.replace(/\\/g,""),r=!1),Vn(n,a,_),u===44&&(Vn(e,o,n),n=Object.create(null),o=void 0),a=void 0,d=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);if(d===-1||s||u===32||u===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=m);let g=t.slice(d,h);return o===void 0?Vn(e,g,n):(a===void 0?Vn(n,g,!0):r?Vn(n,a,g.replace(/\\/g,"")):Vn(n,a,g),Vn(e,o,n)),e}function SM(t){return Object.keys(t).map(e=>{let n=t[e];return Array.isArray(n)||(n=[n]),n.map(r=>[e].concat(Object.keys(r).map(i=>{let s=r[i];return Array.isArray(s)||(s=[s]),s.map(o=>o===!0?i:`${i}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}NS.exports={format:SM,parse:vM}});var Pu=z((l2,$S)=>{"use strict";var TM=X("events"),wM=X("https"),CM=X("http"),DS=X("net"),AM=X("tls"),{randomBytes:bM,createHash:RM}=X("crypto"),{Duplex:o2,Readable:a2}=X("stream"),{URL:Wh}=X("url"),Gr=Ko(),IM=qh(),PM=Hh(),{isBlob:xM}=Bs(),{BINARY_TYPES:MS,CLOSE_TIMEOUT:kM,EMPTY_BUFFER:bu,GUID:NM,kForOnEventAttribute:Jh,kListener:MM,kStatusCode:OM,kWebSocket:je,NOOP:US}=dr(),{EventTarget:{addEventListener:DM,removeEventListener:UM}}=kS(),{format:LM,parse:FM}=$h(),{toBuffer:qM}=Jo(),LS=Symbol("kAborted"),zh=[8,13],pr=["CONNECTING","OPEN","CLOSING","CLOSED"],BM=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,$e=class t extends TM{constructor(e,n,r){super(),this._binaryType=MS[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=bu,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,n===void 0?n=[]:Array.isArray(n)||(typeof n=="object"&&n!==null?(r=n,n=[]):n=[n]),FS(this,e,n,r)):(this._autoPong=r.autoPong,this._closeTimeout=r.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){MS.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,n,r){let i=new IM({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),s=new PM(e,this._extensions,r.generateMask);this._receiver=i,this._sender=s,this._socket=e,i[je]=this,s[je]=this,e[je]=this,i.on("conclude",VM),i.on("drain",$M),i.on("error",WM),i.on("message",JM),i.on("ping",zM),i.on("pong",KM),s.onerror=YM,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),n.length>0&&e.unshift(n),e.on("close",GS),e.on("data",Iu),e.on("end",HS),e.on("error",VS),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Gr.extensionName]&&this._extensions[Gr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,n){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Ht(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,n,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),BS(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=n=void 0):typeof n=="function"&&(r=n,n=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Kh(this,e,r);return}n===void 0&&(n=!this._isServer),this._sender.ping(e||bu,n,r)}pong(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=n=void 0):typeof n=="function"&&(r=n,n=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Kh(this,e,r);return}n===void 0&&(n=!this._isServer),this._sender.pong(e||bu,n,r)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof n=="function"&&(r=n,n={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Kh(this,e,r);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...n};this._extensions[Gr.extensionName]||(i.compress=!1),this._sender.send(e||bu,i,r)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Ht(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty($e,"CONNECTING",{enumerable:!0,value:pr.indexOf("CONNECTING")});Object.defineProperty($e.prototype,"CONNECTING",{enumerable:!0,value:pr.indexOf("CONNECTING")});Object.defineProperty($e,"OPEN",{enumerable:!0,value:pr.indexOf("OPEN")});Object.defineProperty($e.prototype,"OPEN",{enumerable:!0,value:pr.indexOf("OPEN")});Object.defineProperty($e,"CLOSING",{enumerable:!0,value:pr.indexOf("CLOSING")});Object.defineProperty($e.prototype,"CLOSING",{enumerable:!0,value:pr.indexOf("CLOSING")});Object.defineProperty($e,"CLOSED",{enumerable:!0,value:pr.indexOf("CLOSED")});Object.defineProperty($e.prototype,"CLOSED",{enumerable:!0,value:pr.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty($e.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty($e.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[Jh])return e[MM];return null},set(e){for(let n of this.listeners(t))if(n[Jh]){this.removeListener(t,n);break}typeof e=="function"&&this.addEventListener(t,e,{[Jh]:!0})}})});$e.prototype.addEventListener=DM;$e.prototype.removeEventListener=UM;$S.exports=$e;function FS(t,e,n,r){let i={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:kM,protocolVersion:zh[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=i.autoPong,t._closeTimeout=i.closeTimeout,!zh.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${zh.join(", ")})`);let s;if(e instanceof Wh)s=e;else try{s=new Wh(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),t._url=s.href;let o=s.protocol==="wss:",a=s.protocol==="ws+unix:",d;if(s.protocol!=="ws:"&&!o&&!a?d=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!s.pathname?d="The URL's pathname is empty":s.hash&&(d="The URL contains a fragment identifier"),d){let w=new SyntaxError(d);if(t._redirects===0)throw w;Ru(t,w);return}let u=o?443:80,h=bM(16).toString("base64"),m=o?wM.request:CM.request,g=new Set,_;if(i.createConnection=i.createConnection||(o?HM:GM),i.defaultPort=i.defaultPort||u,i.port=s.port||u,i.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},i.path=s.pathname+s.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(_=new Gr(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=LM({[Gr.extensionName]:_.offer()})),n.length){for(let w of n){if(typeof w!="string"||!BM.test(w)||g.has(w))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(w)}i.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(s.username||s.password)&&(i.auth=`${s.username}:${s.password}`),a){let w=i.path.split(":");i.socketPath=w[0],i.path=w[1]}let v;if(i.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=o,t._originalHostOrSocketPath=a?i.socketPath:s.host;let w=r&&r.headers;if(r={...r,headers:{}},w)for(let[T,A]of Object.entries(w))r.headers[T.toLowerCase()]=A}else if(t.listenerCount("redirect")===0){let w=a?t._originalIpc?i.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:s.host===t._originalHostOrSocketPath;(!w||t._originalSecure&&!o)&&(delete i.headers.authorization,delete i.headers.cookie,w||delete i.headers.host,i.auth=void 0)}i.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),v=t._req=m(i),t._redirects&&t.emit("redirect",t.url,v)}else v=t._req=m(i);i.timeout&&v.on("timeout",()=>{Ht(t,v,"Opening handshake has timed out")}),v.on("error",w=>{v===null||v[LS]||(v=t._req=null,Ru(t,w))}),v.on("response",w=>{let T=w.headers.location,A=w.statusCode;if(T&&i.followRedirects&&A>=300&&A<400){if(++t._redirects>i.maxRedirects){Ht(t,v,"Maximum redirects exceeded");return}v.abort();let G;try{G=new Wh(T,e)}catch{let B=new SyntaxError(`Invalid URL: ${T}`);Ru(t,B);return}FS(t,G,n,r)}else t.emit("unexpected-response",v,w)||Ht(t,v,`Unexpected server response: ${w.statusCode}`)}),v.on("upgrade",(w,T,A)=>{if(t.emit("upgrade",w),t.readyState!==$e.CONNECTING)return;v=t._req=null;let G=w.headers.upgrade;if(G===void 0||G.toLowerCase()!=="websocket"){Ht(t,T,"Invalid Upgrade header");return}let F=RM("sha1").update(h+NM).digest("base64");if(w.headers["sec-websocket-accept"]!==F){Ht(t,T,"Invalid Sec-WebSocket-Accept header");return}let B=w.headers["sec-websocket-protocol"],H;if(B!==void 0?g.size?g.has(B)||(H="Server sent an invalid subprotocol"):H="Server sent a subprotocol but none was requested":g.size&&(H="Server sent no subprotocol"),H){Ht(t,T,H);return}B&&(t._protocol=B);let q=w.headers["sec-websocket-extensions"];if(q!==void 0){if(!_){Ht(t,T,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let $;try{$=FM(q)}catch{Ht(t,T,"Invalid Sec-WebSocket-Extensions header");return}let Y=Object.keys($);if(Y.length!==1||Y[0]!==Gr.extensionName){Ht(t,T,"Server indicated an extension that was not requested");return}try{_.accept($[Gr.extensionName])}catch{Ht(t,T,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[Gr.extensionName]=_}t.setSocket(T,A,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(v,t):v.end()}function Ru(t,e){t._readyState=$e.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function GM(t){return t.path=t.socketPath,DS.connect(t)}function HM(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=DS.isIP(t.host)?"":t.host),AM.connect(t)}function Ht(t,e,n){t._readyState=$e.CLOSING;let r=new Error(n);Error.captureStackTrace(r,Ht),e.setHeader?(e[LS]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ru,t,r)):(e.destroy(r),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function Kh(t,e,n){if(e){let r=xM(e)?e.size:qM(e).length;t._socket?t._sender._bufferedBytes+=r:t._bufferedAmount+=r}if(n){let r=new Error(`WebSocket is not open: readyState ${t.readyState} (${pr[t.readyState]})`);process.nextTick(n,r)}}function VM(t,e){let n=this[je];n._closeFrameReceived=!0,n._closeMessage=e,n._closeCode=t,n._socket[je]!==void 0&&(n._socket.removeListener("data",Iu),process.nextTick(qS,n._socket),t===1005?n.close():n.close(t,e))}function $M(){let t=this[je];t.isPaused||t._socket.resume()}function WM(t){let e=this[je];e._socket[je]!==void 0&&(e._socket.removeListener("data",Iu),process.nextTick(qS,e._socket),e.close(t[OM])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function OS(){this[je].emitClose()}function JM(t,e){this[je].emit("message",t,e)}function zM(t){let e=this[je];e._autoPong&&e.pong(t,!this._isServer,US),e.emit("ping",t)}function KM(t){this[je].emit("pong",t)}function qS(t){t.resume()}function YM(t){let e=this[je];e.readyState!==$e.CLOSED&&(e.readyState===$e.OPEN&&(e._readyState=$e.CLOSING,BS(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function BS(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),t._closeTimeout)}function GS(){let t=this[je];if(this.removeListener("close",GS),this.removeListener("data",Iu),this.removeListener("end",HS),t._readyState=$e.CLOSING,!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&this._readableState.length!==0){let e=this.read(this._readableState.length);t._receiver.write(e)}t._receiver.end(),this[je]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",OS),t._receiver.on("finish",OS))}function Iu(t){this[je]._receiver.write(t)||this.pause()}function HS(){let t=this[je];t._readyState=$e.CLOSING,t._receiver.end(),this.end()}function VS(){let t=this[je];this.removeListener("error",VS),this.on("error",US),t&&(t._readyState=$e.CLOSING,this.destroy())}});var KS=z((c2,zS)=>{"use strict";var u2=Pu(),{Duplex:XM}=X("stream");function WS(t){t.emit("close")}function ZM(){!this.destroyed&&this._writableState.finished&&this.destroy()}function JS(t){this.removeListener("error",JS),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function QM(t,e){let n=!0,r=new XM({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(s,o){let a=!o&&r._readableState.objectMode?s.toString():s;r.push(a)||t.pause()}),t.once("error",function(s){r.destroyed||(n=!1,r.destroy(s))}),t.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(i,s){if(t.readyState===t.CLOSED){s(i),process.nextTick(WS,r);return}let o=!1;t.once("error",function(d){o=!0,s(d)}),t.once("close",function(){o||s(i),process.nextTick(WS,r)}),n&&t.terminate()},r._final=function(i){if(t.readyState===t.CONNECTING){t.once("open",function(){r._final(i)});return}t._socket!==null&&(t._socket._writableState.finished?(i(),r._readableState.endEmitted&&r.destroy()):(t._socket.once("finish",function(){i()}),t.close()))},r._read=function(){t.isPaused&&t.resume()},r._write=function(i,s,o){if(t.readyState===t.CONNECTING){t.once("open",function(){r._write(i,s,o)});return}t.send(i,o)},r.on("end",ZM),r.on("error",JS),r}zS.exports=QM});var XS=z((d2,YS)=>{"use strict";var{tokenChars:jM}=Bs();function eO(t){let e=new Set,n=-1,r=-1,i=0;for(i;i<t.length;i++){let o=t.charCodeAt(i);if(r===-1&&jM[o]===1)n===-1&&(n=i);else if(i!==0&&(o===32||o===9))r===-1&&n!==-1&&(r=i);else if(o===44){if(n===-1)throw new SyntaxError(`Unexpected character at index ${i}`);r===-1&&(r=i);let a=t.slice(n,r);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),n=r=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(n===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let s=t.slice(n,i);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}YS.exports={parse:eO}});var rT=z((h2,nT)=>{"use strict";var tO=X("events"),xu=X("http"),{Duplex:f2}=X("stream"),{createHash:nO}=X("crypto"),ZS=$h(),xi=Ko(),rO=XS(),iO=Pu(),{CLOSE_TIMEOUT:sO,GUID:oO,kWebSocket:aO}=dr(),lO=/^[+/0-9A-Za-z]{22}==$/,QS=0,jS=1,tT=2,Yh=class extends tO{constructor(e,n){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:sO,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:iO,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=xu.createServer((r,i)=>{let s=xu.STATUS_CODES[426];i.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),i.end(s)}),this._server.listen(e.port,e.host,e.backlog,n)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=uO(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,s,o)=>{this.handleUpgrade(i,s,o,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=QS}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===tT){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Qo,this);return}if(e&&this.once("close",e),this._state!==jS)if(this._state=jS,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Qo,this):process.nextTick(Qo,this);else{let n=this._server;this._removeListeners(),this._removeListeners=this._server=null,n.close(()=>{Qo(this)})}}shouldHandle(e){if(this.options.path){let n=e.url.indexOf("?");if((n!==-1?e.url.slice(0,n):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,n,r,i){n.on("error",eT);let s=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){ki(this,e,n,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){ki(this,e,n,400,"Invalid Upgrade header");return}if(s===void 0||!lO.test(s)){ki(this,e,n,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){ki(this,e,n,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){jo(n,400);return}let d=e.headers["sec-websocket-protocol"],u=new Set;if(d!==void 0)try{u=rO.parse(d)}catch{ki(this,e,n,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],m={};if(this.options.perMessageDeflate&&h!==void 0){let g=new xi(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let _=ZS.parse(h);_[xi.extensionName]&&(g.accept(_[xi.extensionName]),m[xi.extensionName]=g)}catch{ki(this,e,n,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(_,v,w,T)=>{if(!_)return jo(n,v||401,w,T);this.completeUpgrade(m,s,u,e,n,r,i)});return}if(!this.options.verifyClient(g))return jo(n,401)}this.completeUpgrade(m,s,u,e,n,r,i)}completeUpgrade(e,n,r,i,s,o,a){if(!s.readable||!s.writable)return s.destroy();if(s[aO])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>QS)return jo(s,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${nO("sha1").update(n+oO).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(r.size){let m=this.options.handleProtocols?this.options.handleProtocols(r,i):r.values().next().value;m&&(u.push(`Sec-WebSocket-Protocol: ${m}`),h._protocol=m)}if(e[xi.extensionName]){let m=e[xi.extensionName].params,g=ZS.format({[xi.extensionName]:[m]});u.push(`Sec-WebSocket-Extensions: ${g}`),h._extensions=e}this.emit("headers",u,i),s.write(u.concat(`\r
`).join(`\r
`)),s.removeListener("error",eT),h.setSocket(s,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Qo,this)})),a(h,i)}};nT.exports=Yh;function uO(t,e){for(let n of Object.keys(e))t.on(n,e[n]);return function(){for(let r of Object.keys(e))t.removeListener(r,e[r])}}function Qo(t){t._state=tT,t.emit("close")}function eT(){this.destroy()}function jo(t,e,n,r){n=n||xu.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...r},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${xu.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+n)}function ki(t,e,n,r,i,s){if(t.listenerCount("wsClientError")){let o=new Error(i);Error.captureStackTrace(o,ki),t.emit("wsClientError",o,n,e)}else jo(n,r,i,s)}});var zc=(t,e,n)=>(r,i)=>{let s=-1;return o(0);async function o(a){if(a<=s)throw new Error("next() called multiple times");s=a;let d,u=!1,h;if(t[a]?(h=t[a][0][0],r.req.routeIndex=a):h=a===t.length&&i||void 0,h)try{d=await h(r,()=>o(a+1))}catch(m){if(m instanceof Error&&e)r.error=m,d=await e(m,r),u=!0;else throw m}else r.finalized===!1&&n&&(d=await n(r));return d&&(r.finalized===!1||u)&&(r.res=d),r}};var ag=Symbol();var lg=async(t,e=Object.create(null))=>{let{all:n=!1,dot:r=!1}=e,s=(t instanceof Ma?t.raw.headers:t.headers).get("Content-Type");return s?.startsWith("multipart/form-data")||s?.startsWith("application/x-www-form-urlencoded")?n0(t,{all:n,dot:r}):{}};async function n0(t,e){let n=await t.formData();return n?r0(n,e):{}}function r0(t,e){let n=Object.create(null);return t.forEach((r,i)=>{e.all||i.endsWith("[]")?i0(n,i,r):n[i]=r}),e.dot&&Object.entries(n).forEach(([r,i])=>{r.includes(".")&&(s0(n,r,i),delete n[r])}),n}var i0=(t,e,n)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(n):t[e]=[t[e],n]:e.endsWith("[]")?t[e]=[n]:t[e]=n},s0=(t,e,n)=>{let r=t,i=e.split(".");i.forEach((s,o)=>{o===i.length-1?r[s]=n:((!r[s]||typeof r[s]!="object"||Array.isArray(r[s])||r[s]instanceof File)&&(r[s]=Object.create(null)),r=r[s])})};var Yc=t=>{let e=t.split("/");return e[0]===""&&e.shift(),e},ug=t=>{let{groups:e,path:n}=o0(t),r=Yc(n);return a0(r,e)},o0=t=>{let e=[];return t=t.replace(/\{[^}]+\}/g,(n,r)=>{let i=`@${r}`;return e.push([i,n]),i}),{groups:e,path:t}},a0=(t,e)=>{for(let n=e.length-1;n>=0;n--){let[r]=e[n];for(let i=t.length-1;i>=0;i--)if(t[i].includes(r)){t[i]=t[i].replace(r,e[n][1]);break}}return t},Oa={},cg=(t,e)=>{if(t==="*")return"*";let n=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(n){let r=`${t}#${e}`;return Oa[r]||(n[2]?Oa[r]=e&&e[0]!==":"&&e[0]!=="*"?[r,n[1],new RegExp(`^${n[2]}(?=/${e})`)]:[t,n[1],new RegExp(`^${n[2]}$`)]:Oa[r]=[t,n[1],!0]),Oa[r]}return null},Da=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,n=>{try{return e(n)}catch{return n}})}},l0=t=>Da(t,decodeURI),Xc=t=>{let e=t.url,n=e.indexOf("/",e.indexOf(":")+4),r=n;for(;r<e.length;r++){let i=e.charCodeAt(r);if(i===37){let s=e.indexOf("?",r),o=e.slice(n,s===-1?void 0:s);return l0(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(i===63)break}return e.slice(n,r)};var dg=t=>{let e=Xc(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},ei=(t,e,...n)=>(n.length&&(e=ei(e,...n)),`${t?.[0]==="/"?"":"/"}${t}${e==="/"?"":`${t?.at(-1)==="/"?"":"/"}${e?.[0]==="/"?e.slice(1):e}`}`),Ua=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;let e=t.split("/"),n=[],r="";return e.forEach(i=>{if(i!==""&&!/\:/.test(i))r+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){n.length===0&&r===""?n.push("/"):n.push(r);let s=i.replace("?","");r+="/"+s,n.push(r)}else r+="/"+i}),n.filter((i,s,o)=>o.indexOf(i)===s)},Kc=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?Da(t,Zc):t):t,fg=(t,e,n)=>{let r;if(!n&&e&&!/[%+]/.test(e)){let o=t.indexOf("?",8);if(o===-1)return;for(t.startsWith(e,o+1)||(o=t.indexOf(`&${e}`,o+1));o!==-1;){let a=t.charCodeAt(o+e.length+1);if(a===61){let d=o+e.length+2,u=t.indexOf("&",d);return Kc(t.slice(d,u===-1?void 0:u))}else if(a==38||isNaN(a))return"";o=t.indexOf(`&${e}`,o+1)}if(r=/[%+]/.test(t),!r)return}let i={};r??=/[%+]/.test(t);let s=t.indexOf("?",8);for(;s!==-1;){let o=t.indexOf("&",s+1),a=t.indexOf("=",s);a>o&&o!==-1&&(a=-1);let d=t.slice(s+1,a===-1?o===-1?void 0:o:a);if(r&&(d=Kc(d)),s=o,d==="")continue;let u;a===-1?u="":(u=t.slice(a+1,o===-1?void 0:o),r&&(u=Kc(u))),n?(i[d]&&Array.isArray(i[d])||(i[d]=[]),i[d].push(u)):i[d]??=u}return e?i[e]:i},hg=fg,pg=(t,e)=>fg(t,e,!0),Zc=decodeURIComponent;var mg=t=>Da(t,Zc),Ma=class{raw;#e;#t;routeIndex=0;path;bodyCache={};constructor(t,e="/",n=[[]]){this.raw=t,this.path=e,this.#t=n,this.#e={}}param(t){return t?this.#n(t):this.#s()}#n(t){let e=this.#t[0][this.routeIndex][1][t],n=this.#r(e);return n&&/\%/.test(n)?mg(n):n}#s(){let t={},e=Object.keys(this.#t[0][this.routeIndex][1]);for(let n of e){let r=this.#r(this.#t[0][this.routeIndex][1][n]);r!==void 0&&(t[n]=/\%/.test(r)?mg(r):r)}return t}#r(t){return this.#t[1]?this.#t[1][t]:t}query(t){return hg(this.url,t)}queries(t){return pg(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;let e={};return this.raw.headers.forEach((n,r)=>{e[r]=n}),e}async parseBody(t){return this.bodyCache.parsedBody??=await lg(this,t)}#i=t=>{let{bodyCache:e,raw:n}=this,r=e[t];if(r)return r;let i=Object.keys(e)[0];return i?e[i].then(s=>(i==="json"&&(s=JSON.stringify(s)),new Response(s)[t]())):e[t]=n[t]()};json(){return this.#i("text").then(t=>JSON.parse(t))}text(){return this.#i("text")}arrayBuffer(){return this.#i("arrayBuffer")}blob(){return this.#i("blob")}formData(){return this.#i("formData")}addValidatedData(t,e){this.#e[t]=e}valid(t){return this.#e[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[ag](){return this.#t}get matchedRoutes(){return this.#t[0].map(([[,t]])=>t)}get routePath(){return this.#t[0].map(([[,t]])=>t)[this.routeIndex].path}};var gg={Stringify:1,BeforeStream:2,Stream:3},u0=(t,e)=>{let n=new String(t);return n.isEscaped=!0,n.callbacks=e,n};var Qc=async(t,e,n,r,i)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));let s=t.callbacks;if(!s?.length)return Promise.resolve(t);i?i[0]+=t:i=[t];let o=Promise.all(s.map(a=>a({phase:e,buffer:i,context:r}))).then(a=>Promise.all(a.filter(Boolean).map(d=>Qc(d,e,!1,r,i))).then(()=>i[0]));return n?u0(await o,s):o};var c0="text/plain; charset=UTF-8",jc=(t,e)=>({"Content-Type":t,...e}),yg=class{#e;#t;env={};#n;finalized=!1;error;#s;#r;#i;#o;#a;#l;#c;#d;#f;constructor(t,e){this.#e=t,e&&(this.#r=e.executionCtx,this.env=e.env,this.#l=e.notFoundHandler,this.#f=e.path,this.#d=e.matchResult)}get req(){return this.#t??=new Ma(this.#e,this.#f,this.#d),this.#t}get event(){if(this.#r&&"respondWith"in this.#r)return this.#r;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#r)return this.#r;throw Error("This context has no ExecutionContext")}get res(){return this.#i||=new Response(null,{headers:this.#c??=new Headers})}set res(t){if(this.#i&&t){t=new Response(t.body,t);for(let[e,n]of this.#i.headers.entries())if(e!=="content-type")if(e==="set-cookie"){let r=this.#i.headers.getSetCookie();t.headers.delete("set-cookie");for(let i of r)t.headers.append("set-cookie",i)}else t.headers.set(e,n)}this.#i=t,this.finalized=!0}render=(...t)=>(this.#a??=e=>this.html(e),this.#a(...t));setLayout=t=>this.#o=t;getLayout=()=>this.#o;setRenderer=t=>{this.#a=t};header=(t,e,n)=>{this.finalized&&(this.#i=new Response(this.#i.body,this.#i));let r=this.#i?this.#i.headers:this.#c??=new Headers;e===void 0?r.delete(t):n?.append?r.append(t,e):r.set(t,e)};status=t=>{this.#s=t};set=(t,e)=>{this.#n??=new Map,this.#n.set(t,e)};get=t=>this.#n?this.#n.get(t):void 0;get var(){return this.#n?Object.fromEntries(this.#n):{}}#u(t,e,n){let r=this.#i?new Headers(this.#i.headers):this.#c??new Headers;if(typeof e=="object"&&"headers"in e){let s=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(let[o,a]of s)o.toLowerCase()==="set-cookie"?r.append(o,a):r.set(o,a)}if(n)for(let[s,o]of Object.entries(n))if(typeof o=="string")r.set(s,o);else{r.delete(s);for(let a of o)r.append(s,a)}let i=typeof e=="number"?e:e?.status??this.#s;return new Response(t,{status:i,headers:r})}newResponse=(...t)=>this.#u(...t);body=(t,e,n)=>this.#u(t,e,n);text=(t,e,n)=>!this.#c&&!this.#s&&!e&&!n&&!this.finalized?new Response(t):this.#u(t,e,jc(c0,n));json=(t,e,n)=>this.#u(JSON.stringify(t),e,jc("application/json",n));html=(t,e,n)=>{let r=i=>this.#u(i,e,jc("text/html; charset=UTF-8",n));return typeof t=="object"?Qc(t,gg.Stringify,!1,{}).then(r):r(t)};redirect=(t,e)=>{let n=String(t);return this.header("Location",/[^\x00-\xFF]/.test(n)?encodeURI(n):n),this.newResponse(null,e??302)};notFound=()=>(this.#l??=()=>new Response,this.#l(this))};var He="ALL",_g="all",Eg=["get","post","put","delete","options","patch"],La="Can not add a route since the matcher is already built.",Fa=class extends Error{};var vg="__COMPOSED_HANDLER";var d0=t=>t.text("404 Not Found",404),Sg=(t,e)=>{if("getResponse"in t){let n=t.getResponse();return e.newResponse(n.body,n)}return console.error(t),e.text("Internal Server Error",500)},Tg=class wg{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#e="/";routes=[];constructor(e={}){[...Eg,_g].forEach(s=>{this[s]=(o,...a)=>(typeof o=="string"?this.#e=o:this.#s(s,this.#e,o),a.forEach(d=>{this.#s(s,this.#e,d)}),this)}),this.on=(s,o,...a)=>{for(let d of[o].flat()){this.#e=d;for(let u of[s].flat())a.map(h=>{this.#s(u.toUpperCase(),this.#e,h)})}return this},this.use=(s,...o)=>(typeof s=="string"?this.#e=s:(this.#e="*",o.unshift(s)),o.forEach(a=>{this.#s(He,this.#e,a)}),this);let{strict:r,...i}=e;Object.assign(this,i),this.getPath=r??!0?e.getPath??Xc:dg}#t(){let e=new wg({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,e.#n=this.#n,e.routes=this.routes,e}#n=d0;errorHandler=Sg;route(e,n){let r=this.basePath(e);return n.routes.map(i=>{let s;n.errorHandler===Sg?s=i.handler:(s=async(o,a)=>(await zc([],n.errorHandler)(o,()=>i.handler(o,a))).res,s[vg]=i.handler),r.#s(i.method,i.path,s)}),this}basePath(e){let n=this.#t();return n._basePath=ei(this._basePath,e),n}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#n=e,this);mount(e,n,r){let i,s;r&&(typeof r=="function"?s=r:(s=r.optionHandler,r.replaceRequest===!1?i=d=>d:i=r.replaceRequest));let o=s?d=>{let u=s(d);return Array.isArray(u)?u:[u]}:d=>{let u;try{u=d.executionCtx}catch{}return[d.env,u]};i||=(()=>{let d=ei(this._basePath,e),u=d==="/"?0:d.length;return h=>{let m=new URL(h.url);return m.pathname=m.pathname.slice(u)||"/",new Request(m,h)}})();let a=async(d,u)=>{let h=await n(i(d.req.raw),...o(d));if(h)return h;await u()};return this.#s(He,ei(e,"*"),a),this}#s(e,n,r){e=e.toUpperCase(),n=ei(this._basePath,n);let i={basePath:this._basePath,path:n,method:e,handler:r};this.router.add(e,n,[r,i]),this.routes.push(i)}#r(e,n){if(e instanceof Error)return this.errorHandler(e,n);throw e}#i(e,n,r,i){if(i==="HEAD")return(async()=>new Response(null,await this.#i(e,n,r,"GET")))();let s=this.getPath(e,{env:r}),o=this.router.match(i,s),a=new yg(e,{path:s,matchResult:o,env:r,executionCtx:n,notFoundHandler:this.#n});if(o[0].length===1){let u;try{u=o[0][0][0][0](a,async()=>{a.res=await this.#n(a)})}catch(h){return this.#r(h,a)}return u instanceof Promise?u.then(h=>h||(a.finalized?a.res:this.#n(a))).catch(h=>this.#r(h,a)):u??this.#n(a)}let d=zc(o[0],this.errorHandler,this.#n);return(async()=>{try{let u=await d(a);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return this.#r(u,a)}})()}fetch=(e,...n)=>this.#i(e,n[1],n[0],e.method);request=(e,n,r,i)=>e instanceof Request?this.fetch(n?new Request(e,n):e,r,i):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${ei("/",e)}`,n),r,i));fire=()=>{addEventListener("fetch",e=>{e.respondWith(this.#i(e.request,e,void 0,e.request.method))})}};var qa=[];function ed(t,e){let n=this.buildAllMatchers(),r=((i,s)=>{let o=n[i]||n[He],a=o[2][s];if(a)return a;let d=s.match(o[0]);if(!d)return[[],qa];let u=d.indexOf("",1);return[o[1][u],d]});return this.match=r,r(t,e)}var Ba="[^/]+",co=".*",fo="(?:|/.*)",ti=Symbol(),f0=new Set(".\\+*[^]$()");function h0(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===co||t===fo?1:e===co||e===fo?-1:t===Ba?1:e===Ba?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var Cg=class td{#e;#t;#n=Object.create(null);insert(e,n,r,i,s){if(e.length===0){if(this.#e!==void 0)throw ti;if(s)return;this.#e=n;return}let[o,...a]=e,d=o==="*"?a.length===0?["","",co]:["","",Ba]:o==="/*"?["","",fo]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),u;if(d){let h=d[1],m=d[2]||Ba;if(h&&d[2]&&(m===".*"||(m=m.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(m))))throw ti;if(u=this.#n[m],!u){if(Object.keys(this.#n).some(g=>g!==co&&g!==fo))throw ti;if(s)return;u=this.#n[m]=new td,h!==""&&(u.#t=i.varIndex++)}!s&&h!==""&&r.push([h,u.#t])}else if(u=this.#n[o],!u){if(Object.keys(this.#n).some(h=>h.length>1&&h!==co&&h!==fo))throw ti;if(s)return;u=this.#n[o]=new td}u.insert(a,n,r,i,s)}buildRegExpStr(){let n=Object.keys(this.#n).sort(h0).map(r=>{let i=this.#n[r];return(typeof i.#t=="number"?`(${r})@${i.#t}`:f0.has(r)?`\\${r}`:r)+i.buildRegExpStr()});return typeof this.#e=="number"&&n.unshift(`#${this.#e}`),n.length===0?"":n.length===1?n[0]:"(?:"+n.join("|")+")"}};var Ag=class{#e={varIndex:0};#t=new Cg;insert(t,e,n){let r=[],i=[];for(let o=0;;){let a=!1;if(t=t.replace(/\{[^}]+\}/g,d=>{let u=`@\\${o}`;return i[o]=[u,d],o++,a=!0,u}),!a)break}let s=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=i.length-1;o>=0;o--){let[a]=i[o];for(let d=s.length-1;d>=0;d--)if(s[d].indexOf(a)!==-1){s[d]=s[d].replace(a,i[o][1]);break}}return this.#t.insert(s,e,r,this.#e,n),r}buildRegExp(){let t=this.#t.buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0,n=[],r=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,s,o)=>s!==void 0?(n[++e]=Number(s),"$()"):(o!==void 0&&(r[Number(o)]=++e),"")),[new RegExp(`^${t}`),n,r]}};var p0=[/^$/,[],Object.create(null)],bg=Object.create(null);function Rg(t){return bg[t]??=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,n)=>n?`\\${n}`:"(?:|/.*)")}$`)}function m0(){bg=Object.create(null)}function g0(t){let e=new Ag,n=[];if(t.length===0)return p0;let r=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,h],[m,g])=>u?1:m?-1:h.length-g.length),i=Object.create(null);for(let u=0,h=-1,m=r.length;u<m;u++){let[g,_,v]=r[u];g?i[_]=[v.map(([T])=>[T,Object.create(null)]),qa]:h++;let w;try{w=e.insert(_,h,g)}catch(T){throw T===ti?new Fa(_):T}g||(n[h]=v.map(([T,A])=>{let G=Object.create(null);for(A-=1;A>=0;A--){let[F,B]=w[A];G[F]=B}return[T,G]}))}let[s,o,a]=e.buildRegExp();for(let u=0,h=n.length;u<h;u++)for(let m=0,g=n[u].length;m<g;m++){let _=n[u][m]?.[1];if(!_)continue;let v=Object.keys(_);for(let w=0,T=v.length;w<T;w++)_[v[w]]=a[_[v[w]]]}let d=[];for(let u in o)d[u]=n[o[u]];return[s,d,i]}function Zi(t,e){if(t){for(let n of Object.keys(t).sort((r,i)=>i.length-r.length))if(Rg(n).test(e))return[...t[n]]}}var Ga=class{name="RegExpRouter";#e;#t;constructor(){this.#e={[He]:Object.create(null)},this.#t={[He]:Object.create(null)}}add(t,e,n){let r=this.#e,i=this.#t;if(!r||!i)throw new Error(La);r[t]||[r,i].forEach(a=>{a[t]=Object.create(null),Object.keys(a[He]).forEach(d=>{a[t][d]=[...a[He][d]]})}),e==="/*"&&(e="*");let s=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){let a=Rg(e);t===He?Object.keys(r).forEach(d=>{r[d][e]||=Zi(r[d],e)||Zi(r[He],e)||[]}):r[t][e]||=Zi(r[t],e)||Zi(r[He],e)||[],Object.keys(r).forEach(d=>{(t===He||t===d)&&Object.keys(r[d]).forEach(u=>{a.test(u)&&r[d][u].push([n,s])})}),Object.keys(i).forEach(d=>{(t===He||t===d)&&Object.keys(i[d]).forEach(u=>a.test(u)&&i[d][u].push([n,s]))});return}let o=Ua(e)||[e];for(let a=0,d=o.length;a<d;a++){let u=o[a];Object.keys(i).forEach(h=>{(t===He||t===h)&&(i[h][u]||=[...Zi(r[h],u)||Zi(r[He],u)||[]],i[h][u].push([n,s-d+a+1]))})}}match=ed;buildAllMatchers(){let t=Object.create(null);return Object.keys(this.#t).concat(Object.keys(this.#e)).forEach(e=>{t[e]||=this.#n(e)}),this.#e=this.#t=void 0,m0(),t}#n(t){let e=[],n=t===He;return[this.#e,this.#t].forEach(r=>{let i=r[t]?Object.keys(r[t]).map(s=>[s,r[t][s]]):[];i.length!==0?(n||=!0,e.push(...i)):t!==He&&e.push(...Object.keys(r[He]).map(s=>[s,r[He][s]]))}),n?g0(e):null}};var nd=class{name="SmartRouter";#e=[];#t=[];constructor(t){this.#e=t.routers}add(t,e,n){if(!this.#t)throw new Error(La);this.#t.push([t,e,n])}match(t,e){if(!this.#t)throw new Error("Fatal error");let n=this.#e,r=this.#t,i=n.length,s=0,o;for(;s<i;s++){let a=n[s];try{for(let d=0,u=r.length;d<u;d++)a.add(...r[d]);o=a.match(t,e)}catch(d){if(d instanceof Fa)continue;throw d}this.match=a.match.bind(a),this.#e=[a],this.#t=void 0;break}if(s===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(this.#t||this.#e.length!==1)throw new Error("No active router has been determined yet.");return this.#e[0]}};var ho=Object.create(null),Ig=class Pg{#e;#t;#n;#s=0;#r=ho;constructor(e,n,r){if(this.#t=r||Object.create(null),this.#e=[],e&&n){let i=Object.create(null);i[e]={handler:n,possibleKeys:[],score:0},this.#e=[i]}this.#n=[]}insert(e,n,r){this.#s=++this.#s;let i=this,s=ug(n),o=[];for(let a=0,d=s.length;a<d;a++){let u=s[a],h=s[a+1],m=cg(u,h),g=Array.isArray(m)?m[0]:u;if(g in i.#t){i=i.#t[g],m&&o.push(m[1]);continue}i.#t[g]=new Pg,m&&(i.#n.push(m),o.push(m[1])),i=i.#t[g]}return i.#e.push({[e]:{handler:r,possibleKeys:o.filter((a,d,u)=>u.indexOf(a)===d),score:this.#s}}),i}#i(e,n,r,i){let s=[];for(let o=0,a=e.#e.length;o<a;o++){let d=e.#e[o],u=d[n]||d[He],h={};if(u!==void 0&&(u.params=Object.create(null),s.push(u),r!==ho||i&&i!==ho))for(let m=0,g=u.possibleKeys.length;m<g;m++){let _=u.possibleKeys[m],v=h[u.score];u.params[_]=i?.[_]&&!v?i[_]:r[_]??i?.[_],h[u.score]=!0}}return s}search(e,n){let r=[];this.#r=ho;let s=[this],o=Yc(n),a=[];for(let d=0,u=o.length;d<u;d++){let h=o[d],m=d===u-1,g=[];for(let _=0,v=s.length;_<v;_++){let w=s[_],T=w.#t[h];T&&(T.#r=w.#r,m?(T.#t["*"]&&r.push(...this.#i(T.#t["*"],e,w.#r)),r.push(...this.#i(T,e,w.#r))):g.push(T));for(let A=0,G=w.#n.length;A<G;A++){let F=w.#n[A],B=w.#r===ho?{}:{...w.#r};if(F==="*"){let te=w.#t["*"];te&&(r.push(...this.#i(te,e,w.#r)),te.#r=B,g.push(te));continue}let[H,q,$]=F;if(!h&&!($ instanceof RegExp))continue;let Y=w.#t[H],L=o.slice(d).join("/");if($ instanceof RegExp){let te=$.exec(L);if(te){if(B[q]=te[0],r.push(...this.#i(Y,e,w.#r,B)),Object.keys(Y.#t).length){Y.#r=B;let oe=te[0].match(/\//)?.length??0;(a[oe]||=[]).push(Y)}continue}}($===!0||$.test(h))&&(B[q]=h,m?(r.push(...this.#i(Y,e,B,w.#r)),Y.#t["*"]&&r.push(...this.#i(Y.#t["*"],e,B,w.#r))):(Y.#r=B,g.push(Y)))}}s=g.concat(a.shift()??[])}return r.length>1&&r.sort((d,u)=>d.score-u.score),[r.map(({handler:d,params:u})=>[d,u])]}};var rd=class{name="TrieRouter";#e;constructor(){this.#e=new Ig}add(t,e,n){let r=Ua(e);if(r){for(let i=0,s=r.length;i<s;i++)this.#e.insert(t,r[i],n);return}this.#e.insert(t,e,n)}match(t,e){return this.#e.search(t,e)}};var un=class extends Tg{constructor(t={}){super(t),this.router=t.router??new nd({routers:[new Ga,new rd]})}};var xg=t=>{let e="",n=new Uint8Array(t);for(let r=0,i=n.length;r<i;r++)e+=String.fromCharCode(n[r]);return btoa(e)},kg=t=>{let e=atob(t),n=new Uint8Array(new ArrayBuffer(e.length)),r=e.length/2;for(let i=0,s=e.length-1;i<=r;i++,s--)n[i]=e.charCodeAt(i),n[s]=e.charCodeAt(s);return n};function po(t){return/[^\x00-\x7F]/.test(t)?encodeURIComponent(t):t}var y0=t=>t.requestContext;var id=(t,{isContentTypeBinary:e}={isContentTypeBinary:void 0})=>async(n,r)=>{let i=b0(n),s=i.createRequest(n),o=y0(n),a=await t.fetch(s,{event:n,requestContext:o,lambdaContext:r});return i.createResult(n,a,{isContentTypeBinary:e})},Ha=class{getHeaderValue(t,e){return t?Array.isArray(t[e])?t[e][0]:t[e]:void 0}getDomainName(t){if(t.requestContext&&"domainName"in t.requestContext)return t.requestContext.domainName;let e=this.getHeaderValue(t.headers,"host");if(e)return e;let n="multiValueHeaders"in t?t.multiValueHeaders:{};return this.getHeaderValue(n,"host")}createRequest(t){let e=this.getQueryString(t),n=this.getDomainName(t),r=this.getPath(t),i=`https://${n}${r}`,s=e?`${i}?${e}`:i,o=this.getHeaders(t),a=this.getMethod(t),d={headers:o,method:a};return t.body&&(d.body=t.isBase64Encoded?kg(t.body):t.body),new Request(s,d)}async createResult(t,e,n){let r=e.headers.get("content-type"),i=n.isContentTypeBinary??Ng,s=!!(r&&i(r));if(!s){let d=e.headers.get("content-encoding");s=x0(d)}let a={body:s?xg(await e.arrayBuffer()):await e.text(),statusCode:e.status,isBase64Encoded:s,..."multiValueHeaders"in t&&t.multiValueHeaders?{multiValueHeaders:{}}:{headers:{}}};return this.setCookies(t,e,a),a.multiValueHeaders?e.headers.forEach((d,u)=>{a.multiValueHeaders[u]=[d]}):e.headers.forEach((d,u)=>{a.headers[u]=d}),a}setCookies(t,e,n){if(e.headers.has("set-cookie")){let r=e.headers.getSetCookie?e.headers.getSetCookie():Array.from(e.headers.entries()).filter(([i])=>i==="set-cookie").map(([,i])=>i);Array.isArray(r)&&(this.setCookiesToResult(n,r),e.headers.delete("set-cookie"))}}},_0=class extends Ha{getPath(t){return t.rawPath}getMethod(t){return t.requestContext.http.method}getQueryString(t){return t.rawQueryString}getCookies(t,e){Array.isArray(t.cookies)&&e.set("Cookie",t.cookies.join("; "))}setCookiesToResult(t,e){t.cookies=e}getHeaders(t){let e=new Headers;if(this.getCookies(t,e),t.headers)for(let[n,r]of Object.entries(t.headers))r&&e.set(n,r);return e}},E0=new _0,v0=class extends Ha{getPath(t){return t.path}getMethod(t){return t.httpMethod}getQueryString(t){return t.multiValueQueryStringParameters?Object.entries(t.multiValueQueryStringParameters||{}).filter(([,e])=>e).map(([e,n])=>n.map(r=>`${encodeURIComponent(e)}=${encodeURIComponent(r)}`).join("&")).join("&"):Object.entries(t.queryStringParameters||{}).filter(([,e])=>e).map(([e,n])=>`${encodeURIComponent(e)}=${encodeURIComponent(n||"")}`).join("&")}getCookies(t,e){}getHeaders(t){let e=new Headers;if(this.getCookies(t,e),t.headers)for(let[n,r]of Object.entries(t.headers))r&&e.set(n,po(r));if(t.multiValueHeaders){for(let[n,r]of Object.entries(t.multiValueHeaders))if(r){let i=e.get(n);r.forEach(s=>{let o=po(s);return(!i||!i.includes(o))&&e.append(n,o)})}}return e}setCookiesToResult(t,e){t.multiValueHeaders={"set-cookie":e}}},S0=new v0,T0=class extends Ha{getHeaders(t){let e=new Headers;if(t.multiValueHeaders){for(let[n,r]of Object.entries(t.multiValueHeaders))if(r&&Array.isArray(r)){let i=po(r.join("; "));e.set(n,i)}}else for(let[n,r]of Object.entries(t.headers??{}))r&&e.set(n,po(r));return e}getPath(t){return t.path}getMethod(t){return t.httpMethod}getQueryString(t){return t.multiValueQueryStringParameters?Object.entries(t.multiValueQueryStringParameters||{}).filter(([,e])=>e).map(([e,n])=>`${e}=${n.join(`&${e}=`)}`).join("&"):Object.entries(t.queryStringParameters||{}).filter(([,e])=>e).map(([e,n])=>`${e}=${n}`).join("&")}getCookies(t,e){let n;t.multiValueHeaders?n=t.multiValueHeaders.cookie?.join("; "):n=t.headers?t.headers.cookie:void 0,n&&e.append("Cookie",n)}setCookiesToResult(t,e){t.multiValueHeaders?t.multiValueHeaders["set-cookie"]=e:t.headers["set-cookie"]=e.join(", ")}},w0=new T0,C0=class extends Ha{getPath(t){return t.path}getMethod(t){return t.method}getQueryString(){return""}getHeaders(t){let e=new Headers;if(t.headers){for(let[n,r]of Object.entries(t.headers))if(r){let i=e.get(n);r.forEach(s=>{let o=po(s);return(!i||!i.includes(o))&&e.append(n,o)})}}return e}getCookies(){}setCookiesToResult(t,e){t.headers={...t.headers,"set-cookie":e.join(", ")}}},A0=new C0,b0=t=>R0(t)?w0:I0(t)?E0:P0(t)?A0:S0,R0=t=>t.requestContext?Object.hasOwn(t.requestContext,"elb"):!1,I0=t=>Object.hasOwn(t,"rawPath"),P0=t=>t.requestContext?Object.hasOwn(t.requestContext,"serviceArn"):!1,Ng=t=>!/^text\/(?:plain|html|css|javascript|csv)|(?:\/|\+)(?:json|xml)\s*(?:;|$)/.test(t),x0=t=>t===null?!1:/^(gzip|deflate|compress|br)/.test(t);var Mg=t=>{let n={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...t},r=(s=>typeof s=="string"?s==="*"?()=>s:o=>s===o?o:null:typeof s=="function"?s:o=>s.includes(o)?o:null)(n.origin),i=(s=>typeof s=="function"?s:Array.isArray(s)?()=>s:()=>[])(n.allowMethods);return async function(o,a){function d(h,m){o.res.headers.set(h,m)}let u=await r(o.req.header("origin")||"",o);if(u&&d("Access-Control-Allow-Origin",u),n.credentials&&d("Access-Control-Allow-Credentials","true"),n.exposeHeaders?.length&&d("Access-Control-Expose-Headers",n.exposeHeaders.join(",")),o.req.method==="OPTIONS"){n.origin!=="*"&&d("Vary","Origin"),n.maxAge!=null&&d("Access-Control-Max-Age",n.maxAge.toString());let h=await i(o.req.header("origin")||"",o);h.length&&d("Access-Control-Allow-Methods",h.join(","));let m=n.allowHeaders;if(!m?.length){let g=o.req.header("Access-Control-Request-Headers");g&&(m=g.split(/\s*,\s*/))}return m?.length&&(d("Access-Control-Allow-Headers",m.join(",")),o.res.headers.append("Vary","Access-Control-Request-Headers")),o.res.headers.delete("Content-Length"),o.res.headers.delete("Content-Type"),new Response(null,{headers:o.res.headers,status:204,statusText:"No Content"})}await a(),n.origin!=="*"&&o.header("Vary","Origin",{append:!0})}};function k0(){let{process:t,Deno:e}=globalThis;return!(typeof e?.noColor=="boolean"?e.noColor:t!==void 0?"NO_COLOR"in t?.env:!1)}async function Og(){let{navigator:t}=globalThis,e="cloudflare:workers";return!(t!==void 0&&t.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import(e)).env??{})}catch{return!1}})():!k0())}var N0=t=>{let[e,n]=[",","."];return t.map(i=>i.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+e)).join(n)},M0=t=>{let e=Date.now()-t;return N0([e<1e3?e+"ms":Math.round(e/1e3)+"s"])},O0=async t=>{if(await Og())switch(t/100|0){case 5:return`\x1B[31m${t}\x1B[0m`;case 4:return`\x1B[33m${t}\x1B[0m`;case 3:return`\x1B[36m${t}\x1B[0m`;case 2:return`\x1B[32m${t}\x1B[0m`}return`${t}`};async function Dg(t,e,n,r,i=0,s){let o=e==="<--"?`${e} ${n} ${r}`:`${e} ${n} ${r} ${await O0(i)} ${s}`;t(o)}var Ug=(t=console.log)=>async function(n,r){let{method:i,url:s}=n.req,o=s.slice(s.indexOf("/",8));await Dg(t,"<--",i,o);let a=Date.now();await r(),await Dg(t,"-->",i,o,n.res.status,M0(a))};var pe={};Jc(pe,{BRAND:()=>ob,DIRTY:()=>ni,EMPTY_PATH:()=>F0,INVALID:()=>ce,NEVER:()=>$b,OK:()=>ot,ParseStatus:()=>tt,Schema:()=>Se,ZodAny:()=>Ir,ZodArray:()=>tr,ZodBigInt:()=>ii,ZodBoolean:()=>si,ZodBranded:()=>go,ZodCatch:()=>gi,ZodDate:()=>oi,ZodDefault:()=>mi,ZodDiscriminatedUnion:()=>Wa,ZodEffects:()=>zt,ZodEnum:()=>hi,ZodError:()=>vt,ZodFirstPartyTypeKind:()=>he,ZodFunction:()=>za,ZodIntersection:()=>ci,ZodIssueCode:()=>J,ZodLazy:()=>di,ZodLiteral:()=>fi,ZodMap:()=>rs,ZodNaN:()=>ss,ZodNativeEnum:()=>pi,ZodNever:()=>cn,ZodNull:()=>li,ZodNullable:()=>Pn,ZodNumber:()=>ri,ZodObject:()=>St,ZodOptional:()=>Wt,ZodParsedType:()=>ee,ZodPipeline:()=>yo,ZodPromise:()=>Pr,ZodReadonly:()=>yi,ZodRecord:()=>Ja,ZodSchema:()=>Se,ZodSet:()=>is,ZodString:()=>Rr,ZodSymbol:()=>ts,ZodTransformer:()=>zt,ZodTuple:()=>In,ZodType:()=>Se,ZodUndefined:()=>ai,ZodUnion:()=>ui,ZodUnknown:()=>er,ZodVoid:()=>ns,addIssueToContext:()=>Z,any:()=>mb,array:()=>Eb,bigint:()=>cb,boolean:()=>zg,coerce:()=>Vb,custom:()=>$g,date:()=>db,datetimeRegex:()=>Hg,defaultErrorMap:()=>Qn,discriminatedUnion:()=>wb,effect:()=>Db,enum:()=>Nb,function:()=>Pb,getErrorMap:()=>Qi,getParsedType:()=>Rn,instanceof:()=>lb,intersection:()=>Cb,isAborted:()=>Va,isAsync:()=>ji,isDirty:()=>$a,isValid:()=>br,late:()=>ab,lazy:()=>xb,literal:()=>kb,makeIssue:()=>mo,map:()=>Rb,nan:()=>ub,nativeEnum:()=>Mb,never:()=>yb,null:()=>pb,nullable:()=>Lb,number:()=>Jg,object:()=>vb,objectUtil:()=>sd,oboolean:()=>Hb,onumber:()=>Gb,optional:()=>Ub,ostring:()=>Bb,pipeline:()=>qb,preprocess:()=>Fb,promise:()=>Ob,quotelessJson:()=>D0,record:()=>bb,set:()=>Ib,setErrorMap:()=>L0,strictObject:()=>Sb,string:()=>Wg,symbol:()=>fb,transformer:()=>Db,tuple:()=>Ab,undefined:()=>hb,union:()=>Tb,unknown:()=>gb,util:()=>Ce,void:()=>_b});var Ce;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{let s={};for(let o of i)s[o]=o;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(let a of s)o[a]=i[a];return t.objectValues(o)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},t.find=(i,s)=>{for(let o of i)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=r,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Ce||(Ce={}));var sd;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(sd||(sd={}));var ee=Ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rn=t=>{switch(typeof t){case"undefined":return ee.undefined;case"string":return ee.string;case"number":return Number.isNaN(t)?ee.nan:ee.number;case"boolean":return ee.boolean;case"function":return ee.function;case"bigint":return ee.bigint;case"symbol":return ee.symbol;case"object":return Array.isArray(t)?ee.array:t===null?ee.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ee.promise:typeof Map<"u"&&t instanceof Map?ee.map:typeof Set<"u"&&t instanceof Set?ee.set:typeof Date<"u"&&t instanceof Date?ee.date:ee.object;default:return ee.unknown}};var J=Ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),D0=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),vt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(s){return s.message},r={_errors:[]},i=s=>{for(let o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let a=r,d=0;for(;d<o.path.length;){let u=o.path[d];d===o.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(n(o))):a[u]=a[u]||{_errors:[]},a=a[u],d++}}};return i(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let i of this.issues)if(i.path.length>0){let s=i.path[0];n[s]=n[s]||[],n[s].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};vt.create=t=>new vt(t);var U0=(t,e)=>{let n;switch(t.code){case J.invalid_type:t.received===ee.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case J.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Ce.jsonStringifyReplacer)}`;break;case J.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ce.joinValues(t.keys,", ")}`;break;case J.invalid_union:n="Invalid input";break;case J.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ce.joinValues(t.options)}`;break;case J.invalid_enum_value:n=`Invalid enum value. Expected ${Ce.joinValues(t.options)}, received '${t.received}'`;break;case J.invalid_arguments:n="Invalid function arguments";break;case J.invalid_return_type:n="Invalid function return type";break;case J.invalid_date:n="Invalid date";break;case J.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Ce.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case J.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case J.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case J.custom:n="Invalid input";break;case J.invalid_intersection_types:n="Intersection results could not be merged";break;case J.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case J.not_finite:n="Number must be finite";break;default:n=e.defaultError,Ce.assertNever(t)}return{message:n}},Qn=U0;var Lg=Qn;function L0(t){Lg=t}function Qi(){return Lg}var mo=t=>{let{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let a="",d=r.filter(u=>!!u).slice().reverse();for(let u of d)a=u(o,{data:e,defaultError:a}).message;return{...i,path:s,message:a}},F0=[];function Z(t,e){let n=Qi(),r=mo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Qn?void 0:Qn].filter(i=>!!i)});t.common.issues.push(r)}var tt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let i of n){if(i.status==="aborted")return ce;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let i of n){let s=await i.key,o=await i.value;r.push({key:s,value:o})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let i of n){let{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return ce;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}},ce=Object.freeze({status:"aborted"}),ni=t=>({status:"dirty",value:t}),ot=t=>({status:"valid",value:t}),Va=t=>t.status==="aborted",$a=t=>t.status==="dirty",br=t=>t.status==="valid",ji=t=>typeof Promise<"u"&&t instanceof Promise;var re;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(re||(re={}));var Jt=class{constructor(e,n,r,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Fg=(t,e)=>{if(br(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new vt(t.common.issues);return this._error=n,this._error}}};function Ee(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{let{message:d}=t;return o.code==="invalid_enum_value"?{message:d??a.defaultError}:typeof a.data>"u"?{message:d??r??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:d??n??a.defaultError}},description:i}}var Se=class{get description(){return this._def.description}_getType(e){return Rn(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Rn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new tt,ctx:{common:e.parent.common,data:e.data,parsedType:Rn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(ji(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){let r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rn(e)},i=this._parseSync({data:e,path:r.path,parent:r});return Fg(r,i)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rn(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:n});return br(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>br(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rn(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(ji(i)?i:Promise.resolve(i));return Fg(r,s)}refine(e,n){let r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,s)=>{let o=e(i),a=()=>s.addIssue({code:J.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(d=>d?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,n){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(e){return new zt({schema:this,typeName:he.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Wt.create(this,this._def)}nullable(){return Pn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tr.create(this)}promise(){return Pr.create(this,this._def)}or(e){return ui.create([this,e],this._def)}and(e){return ci.create(this,e,this._def)}transform(e){return new zt({...Ee(this._def),schema:this,typeName:he.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new mi({...Ee(this._def),innerType:this,defaultValue:n,typeName:he.ZodDefault})}brand(){return new go({typeName:he.ZodBranded,type:this,...Ee(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new gi({...Ee(this._def),innerType:this,catchValue:n,typeName:he.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return yo.create(this,e)}readonly(){return yi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},q0=/^c[^\s-]{8,}$/i,B0=/^[0-9a-z]+$/,G0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,H0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,V0=/^[a-z0-9_-]{21}$/i,$0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,W0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,J0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,z0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",od,K0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Y0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,X0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Z0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Q0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,j0=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Bg="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",eb=new RegExp(`^${Bg}$`);function Gg(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function tb(t){return new RegExp(`^${Gg(t)}$`)}function Hg(t){let e=`${Bg}T${Gg(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function nb(t,e){return!!((e==="v4"||!e)&&K0.test(t)||(e==="v6"||!e)&&X0.test(t))}function rb(t,e){if(!$0.test(t))return!1;try{let[n]=t.split(".");if(!n)return!1;let r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function ib(t,e){return!!((e==="v4"||!e)&&Y0.test(t)||(e==="v6"||!e)&&Z0.test(t))}var Rr=class t extends Se{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ee.string){let s=this._getOrReturnCtx(e);return Z(s,{code:J.invalid_type,expected:ee.string,received:s.parsedType}),ce}let r=new tt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),Z(i,{code:J.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),Z(i,{code:J.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){let o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?Z(i,{code:J.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&Z(i,{code:J.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")J0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"email",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")od||(od=new RegExp(z0,"u")),od.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"emoji",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")H0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"uuid",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")V0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"nanoid",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")q0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"cuid",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")B0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"cuid2",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")G0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"ulid",code:J.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),Z(i,{validation:"url",code:J.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"regex",code:J.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Hg(s).test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?eb.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?tb(s).test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{code:J.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?W0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"duration",code:J.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?nb(e.data,s.version)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"ip",code:J.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?rb(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"jwt",code:J.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?ib(e.data,s.version)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"cidr",code:J.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?Q0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"base64",code:J.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?j0.test(e.data)||(i=this._getOrReturnCtx(e,i),Z(i,{validation:"base64url",code:J.invalid_string,message:s.message}),r.dirty()):Ce.assertNever(s);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(i=>e.test(i),{validation:n,code:J.invalid_string,...re.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...re.errToObj(e)})}url(e){return this._addCheck({kind:"url",...re.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...re.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...re.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...re.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...re.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...re.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...re.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...re.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...re.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...re.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...re.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...re.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...re.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...re.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...re.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...re.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...re.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...re.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...re.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...re.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...re.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...re.errToObj(n)})}nonempty(e){return this.min(1,re.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Rr.create=t=>new Rr({checks:[],typeName:he.ZodString,coerce:t?.coerce??!1,...Ee(t)});function sb(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r,s=Number.parseInt(t.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return s%o/10**i}var ri=class t extends Se{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ee.number){let s=this._getOrReturnCtx(e);return Z(s,{code:J.invalid_type,expected:ee.number,received:s.parsedType}),ce}let r,i=new tt;for(let s of this._def.checks)s.kind==="int"?Ce.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Z(r,{code:J.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?sb(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Z(r,{code:J.not_finite,message:s.message}),i.dirty()):Ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,re.toString(n))}gt(e,n){return this.setLimit("min",e,!1,re.toString(n))}lte(e,n){return this.setLimit("max",e,!0,re.toString(n))}lt(e,n){return this.setLimit("max",e,!1,re.toString(n))}setLimit(e,n,r,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:re.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:re.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:re.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:re.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:re.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:re.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:re.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:re.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:re.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:re.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ce.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};ri.create=t=>new ri({checks:[],typeName:he.ZodNumber,coerce:t?.coerce||!1,...Ee(t)});var ii=class t extends Se{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ee.bigint)return this._getInvalidInput(e);let r,i=new tt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Z(r,{code:J.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return Z(n,{code:J.invalid_type,expected:ee.bigint,received:n.parsedType}),ce}gte(e,n){return this.setLimit("min",e,!0,re.toString(n))}gt(e,n){return this.setLimit("min",e,!1,re.toString(n))}lte(e,n){return this.setLimit("max",e,!0,re.toString(n))}lt(e,n){return this.setLimit("max",e,!1,re.toString(n))}setLimit(e,n,r,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:re.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:re.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:re.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:re.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:re.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:re.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};ii.create=t=>new ii({checks:[],typeName:he.ZodBigInt,coerce:t?.coerce??!1,...Ee(t)});var si=class extends Se{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ee.boolean){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.boolean,received:r.parsedType}),ce}return ot(e.data)}};si.create=t=>new si({typeName:he.ZodBoolean,coerce:t?.coerce||!1,...Ee(t)});var oi=class t extends Se{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ee.date){let s=this._getOrReturnCtx(e);return Z(s,{code:J.invalid_type,expected:ee.date,received:s.parsedType}),ce}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return Z(s,{code:J.invalid_date}),ce}let r=new tt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),Z(i,{code:J.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),Z(i,{code:J.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Ce.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:re.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:re.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};oi.create=t=>new oi({checks:[],coerce:t?.coerce||!1,typeName:he.ZodDate,...Ee(t)});var ts=class extends Se{_parse(e){if(this._getType(e)!==ee.symbol){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.symbol,received:r.parsedType}),ce}return ot(e.data)}};ts.create=t=>new ts({typeName:he.ZodSymbol,...Ee(t)});var ai=class extends Se{_parse(e){if(this._getType(e)!==ee.undefined){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.undefined,received:r.parsedType}),ce}return ot(e.data)}};ai.create=t=>new ai({typeName:he.ZodUndefined,...Ee(t)});var li=class extends Se{_parse(e){if(this._getType(e)!==ee.null){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.null,received:r.parsedType}),ce}return ot(e.data)}};li.create=t=>new li({typeName:he.ZodNull,...Ee(t)});var Ir=class extends Se{constructor(){super(...arguments),this._any=!0}_parse(e){return ot(e.data)}};Ir.create=t=>new Ir({typeName:he.ZodAny,...Ee(t)});var er=class extends Se{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ot(e.data)}};er.create=t=>new er({typeName:he.ZodUnknown,...Ee(t)});var cn=class extends Se{_parse(e){let n=this._getOrReturnCtx(e);return Z(n,{code:J.invalid_type,expected:ee.never,received:n.parsedType}),ce}};cn.create=t=>new cn({typeName:he.ZodNever,...Ee(t)});var ns=class extends Se{_parse(e){if(this._getType(e)!==ee.undefined){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.void,received:r.parsedType}),ce}return ot(e.data)}};ns.create=t=>new ns({typeName:he.ZodVoid,...Ee(t)});var tr=class t extends Se{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),i=this._def;if(n.parsedType!==ee.array)return Z(n,{code:J.invalid_type,expected:ee.array,received:n.parsedType}),ce;if(i.exactLength!==null){let o=n.data.length>i.exactLength.value,a=n.data.length<i.exactLength.value;(o||a)&&(Z(n,{code:o?J.too_big:J.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(Z(n,{code:J.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(Z(n,{code:J.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,a)=>i.type._parseAsync(new Jt(n,o,n.path,a)))).then(o=>tt.mergeArray(r,o));let s=[...n.data].map((o,a)=>i.type._parseSync(new Jt(n,o,n.path,a)));return tt.mergeArray(r,s)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:re.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:re.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:re.toString(n)}})}nonempty(e){return this.min(1,e)}};tr.create=(t,e)=>new tr({type:t,minLength:null,maxLength:null,exactLength:null,typeName:he.ZodArray,...Ee(e)});function es(t){if(t instanceof St){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=Wt.create(es(r))}return new St({...t._def,shape:()=>e})}else return t instanceof tr?new tr({...t._def,type:es(t.element)}):t instanceof Wt?Wt.create(es(t.unwrap())):t instanceof Pn?Pn.create(es(t.unwrap())):t instanceof In?In.create(t.items.map(e=>es(e))):t}var St=class t extends Se{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=Ce.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==ee.object){let u=this._getOrReturnCtx(e);return Z(u,{code:J.invalid_type,expected:ee.object,received:u.parsedType}),ce}let{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof cn&&this._def.unknownKeys==="strip"))for(let u in i.data)o.includes(u)||a.push(u);let d=[];for(let u of o){let h=s[u],m=i.data[u];d.push({key:{status:"valid",value:u},value:h._parse(new Jt(i,m,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof cn){let u=this._def.unknownKeys;if(u==="passthrough")for(let h of a)d.push({key:{status:"valid",value:h},value:{status:"valid",value:i.data[h]}});else if(u==="strict")a.length>0&&(Z(i,{code:J.unrecognized_keys,keys:a}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let h of a){let m=i.data[h];d.push({key:{status:"valid",value:h},value:u._parse(new Jt(i,m,i.path,h)),alwaysSet:h in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let u=[];for(let h of d){let m=await h.key,g=await h.value;u.push({key:m,value:g,alwaysSet:h.alwaysSet})}return u}).then(u=>tt.mergeObjectSync(r,u)):tt.mergeObjectSync(r,d)}get shape(){return this._def.shape()}strict(e){return re.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{let i=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:re.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:he.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let r of Ce.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let r of Ce.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}deepPartial(){return es(this)}partial(e){let n={};for(let r of Ce.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?n[r]=i:n[r]=i.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let r of Ce.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Wt;)s=s._def.innerType;n[r]=s}return new t({...this._def,shape:()=>n})}keyof(){return Vg(Ce.objectKeys(this.shape))}};St.create=(t,e)=>new St({shape:()=>t,unknownKeys:"strip",catchall:cn.create(),typeName:he.ZodObject,...Ee(e)});St.strictCreate=(t,e)=>new St({shape:()=>t,unknownKeys:"strict",catchall:cn.create(),typeName:he.ZodObject,...Ee(e)});St.lazycreate=(t,e)=>new St({shape:t,unknownKeys:"strip",catchall:cn.create(),typeName:he.ZodObject,...Ee(e)});var ui=class extends Se{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function i(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;let o=s.map(a=>new vt(a.ctx.common.issues));return Z(n,{code:J.invalid_union,unionErrors:o}),ce}if(n.common.async)return Promise.all(r.map(async s=>{let o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(i);{let s,o=[];for(let d of r){let u={...n,common:{...n.common,issues:[]},parent:null},h=d._parseSync({data:n.data,path:n.path,parent:u});if(h.status==="valid")return h;h.status==="dirty"&&!s&&(s={result:h,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;let a=o.map(d=>new vt(d));return Z(n,{code:J.invalid_union,unionErrors:a}),ce}}get options(){return this._def.options}};ui.create=(t,e)=>new ui({options:t,typeName:he.ZodUnion,...Ee(e)});var jn=t=>t instanceof di?jn(t.schema):t instanceof zt?jn(t.innerType()):t instanceof fi?[t.value]:t instanceof hi?t.options:t instanceof pi?Ce.objectValues(t.enum):t instanceof mi?jn(t._def.innerType):t instanceof ai?[void 0]:t instanceof li?[null]:t instanceof Wt?[void 0,...jn(t.unwrap())]:t instanceof Pn?[null,...jn(t.unwrap())]:t instanceof go||t instanceof yi?jn(t.unwrap()):t instanceof gi?jn(t._def.innerType):[],Wa=class t extends Se{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.object)return Z(n,{code:J.invalid_type,expected:ee.object,received:n.parsedType}),ce;let r=this.discriminator,i=n.data[r],s=this.optionsMap.get(i);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(Z(n,{code:J.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ce)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let i=new Map;for(let s of n){let o=jn(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,s)}}return new t({typeName:he.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:i,...Ee(r)})}};function ad(t,e){let n=Rn(t),r=Rn(e);if(t===e)return{valid:!0,data:t};if(n===ee.object&&r===ee.object){let i=Ce.objectKeys(e),s=Ce.objectKeys(t).filter(a=>i.indexOf(a)!==-1),o={...t,...e};for(let a of s){let d=ad(t[a],e[a]);if(!d.valid)return{valid:!1};o[a]=d.data}return{valid:!0,data:o}}else if(n===ee.array&&r===ee.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let s=0;s<t.length;s++){let o=t[s],a=e[s],d=ad(o,a);if(!d.valid)return{valid:!1};i.push(d.data)}return{valid:!0,data:i}}else return n===ee.date&&r===ee.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var ci=class extends Se{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),i=(s,o)=>{if(Va(s)||Va(o))return ce;let a=ad(s.value,o.value);return a.valid?(($a(s)||$a(o))&&n.dirty(),{status:n.value,value:a.data}):(Z(r,{code:J.invalid_intersection_types}),ce)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};ci.create=(t,e,n)=>new ci({left:t,right:e,typeName:he.ZodIntersection,...Ee(n)});var In=class t extends Se{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.array)return Z(r,{code:J.invalid_type,expected:ee.array,received:r.parsedType}),ce;if(r.data.length<this._def.items.length)return Z(r,{code:J.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ce;!this._def.rest&&r.data.length>this._def.items.length&&(Z(r,{code:J.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let s=[...r.data].map((o,a)=>{let d=this._def.items[a]||this._def.rest;return d?d._parse(new Jt(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>tt.mergeArray(n,o)):tt.mergeArray(n,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};In.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new In({items:t,typeName:he.ZodTuple,rest:null,...Ee(e)})};var Ja=class t extends Se{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.object)return Z(r,{code:J.invalid_type,expected:ee.object,received:r.parsedType}),ce;let i=[],s=this._def.keyType,o=this._def.valueType;for(let a in r.data)i.push({key:s._parse(new Jt(r,a,r.path,a)),value:o._parse(new Jt(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?tt.mergeObjectAsync(n,i):tt.mergeObjectSync(n,i)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof Se?new t({keyType:e,valueType:n,typeName:he.ZodRecord,...Ee(r)}):new t({keyType:Rr.create(),valueType:e,typeName:he.ZodRecord,...Ee(n)})}},rs=class extends Se{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.map)return Z(r,{code:J.invalid_type,expected:ee.map,received:r.parsedType}),ce;let i=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,d],u)=>({key:i._parse(new Jt(r,a,r.path,[u,"key"])),value:s._parse(new Jt(r,d,r.path,[u,"value"]))}));if(r.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let d of o){let u=await d.key,h=await d.value;if(u.status==="aborted"||h.status==="aborted")return ce;(u.status==="dirty"||h.status==="dirty")&&n.dirty(),a.set(u.value,h.value)}return{status:n.value,value:a}})}else{let a=new Map;for(let d of o){let u=d.key,h=d.value;if(u.status==="aborted"||h.status==="aborted")return ce;(u.status==="dirty"||h.status==="dirty")&&n.dirty(),a.set(u.value,h.value)}return{status:n.value,value:a}}}};rs.create=(t,e,n)=>new rs({valueType:e,keyType:t,typeName:he.ZodMap,...Ee(n)});var is=class t extends Se{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.set)return Z(r,{code:J.invalid_type,expected:ee.set,received:r.parsedType}),ce;let i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(Z(r,{code:J.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(Z(r,{code:J.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());let s=this._def.valueType;function o(d){let u=new Set;for(let h of d){if(h.status==="aborted")return ce;h.status==="dirty"&&n.dirty(),u.add(h.value)}return{status:n.value,value:u}}let a=[...r.data.values()].map((d,u)=>s._parse(new Jt(r,d,r.path,u)));return r.common.async?Promise.all(a).then(d=>o(d)):o(a)}min(e,n){return new t({...this._def,minSize:{value:e,message:re.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:re.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};is.create=(t,e)=>new is({valueType:t,minSize:null,maxSize:null,typeName:he.ZodSet,...Ee(e)});var za=class t extends Se{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.function)return Z(n,{code:J.invalid_type,expected:ee.function,received:n.parsedType}),ce;function r(a,d){return mo({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Qi(),Qn].filter(u=>!!u),issueData:{code:J.invalid_arguments,argumentsError:d}})}function i(a,d){return mo({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Qi(),Qn].filter(u=>!!u),issueData:{code:J.invalid_return_type,returnTypeError:d}})}let s={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof Pr){let a=this;return ot(async function(...d){let u=new vt([]),h=await a._def.args.parseAsync(d,s).catch(_=>{throw u.addIssue(r(d,_)),u}),m=await Reflect.apply(o,this,h);return await a._def.returns._def.type.parseAsync(m,s).catch(_=>{throw u.addIssue(i(m,_)),u})})}else{let a=this;return ot(function(...d){let u=a._def.args.safeParse(d,s);if(!u.success)throw new vt([r(d,u.error)]);let h=Reflect.apply(o,this,u.data),m=a._def.returns.safeParse(h,s);if(!m.success)throw new vt([i(h,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:In.create(e).rest(er.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||In.create([]).rest(er.create()),returns:n||er.create(),typeName:he.ZodFunction,...Ee(r)})}},di=class extends Se{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};di.create=(t,e)=>new di({getter:t,typeName:he.ZodLazy,...Ee(e)});var fi=class extends Se{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return Z(n,{received:n.data,code:J.invalid_literal,expected:this._def.value}),ce}return{status:"valid",value:e.data}}get value(){return this._def.value}};fi.create=(t,e)=>new fi({value:t,typeName:he.ZodLiteral,...Ee(e)});function Vg(t,e){return new hi({values:t,typeName:he.ZodEnum,...Ee(e)})}var hi=class t extends Se{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return Z(n,{expected:Ce.joinValues(r),received:n.parsedType,code:J.invalid_type}),ce}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return Z(n,{received:n.data,code:J.invalid_enum_value,options:r}),ce}return ot(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};hi.create=Vg;var pi=class extends Se{_parse(e){let n=Ce.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ee.string&&r.parsedType!==ee.number){let i=Ce.objectValues(n);return Z(r,{expected:Ce.joinValues(i),received:r.parsedType,code:J.invalid_type}),ce}if(this._cache||(this._cache=new Set(Ce.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let i=Ce.objectValues(n);return Z(r,{received:r.data,code:J.invalid_enum_value,options:i}),ce}return ot(e.data)}get enum(){return this._def.values}};pi.create=(t,e)=>new pi({values:t,typeName:he.ZodNativeEnum,...Ee(e)});var Pr=class extends Se{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.promise&&n.common.async===!1)return Z(n,{code:J.invalid_type,expected:ee.promise,received:n.parsedType}),ce;let r=n.parsedType===ee.promise?n.data:Promise.resolve(n.data);return ot(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}};Pr.create=(t,e)=>new Pr({type:t,typeName:he.ZodPromise,...Ee(e)});var zt=class extends Se{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===he.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:o=>{Z(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){let o=i.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(n.value==="aborted")return ce;let d=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return d.status==="aborted"?ce:d.status==="dirty"?ni(d.value):n.value==="dirty"?ni(d.value):d});{if(n.value==="aborted")return ce;let a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?ce:a.status==="dirty"?ni(a.value):n.value==="dirty"?ni(a.value):a}}if(i.type==="refinement"){let o=a=>{let d=i.refinement(a,s);if(r.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ce:(a.status==="dirty"&&n.dirty(),o(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?ce:(a.status==="dirty"&&n.dirty(),o(a.value).then(()=>({status:n.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!br(o))return ce;let a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>br(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:n.value,value:a})):ce);Ce.assertNever(i)}};zt.create=(t,e,n)=>new zt({schema:t,typeName:he.ZodEffects,effect:e,...Ee(n)});zt.createWithPreprocess=(t,e,n)=>new zt({schema:e,effect:{type:"preprocess",transform:t},typeName:he.ZodEffects,...Ee(n)});var Wt=class extends Se{_parse(e){return this._getType(e)===ee.undefined?ot(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Wt.create=(t,e)=>new Wt({innerType:t,typeName:he.ZodOptional,...Ee(e)});var Pn=class extends Se{_parse(e){return this._getType(e)===ee.null?ot(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Pn.create=(t,e)=>new Pn({innerType:t,typeName:he.ZodNullable,...Ee(e)});var mi=class extends Se{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===ee.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};mi.create=(t,e)=>new mi({innerType:t,typeName:he.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ee(e)});var gi=class extends Se{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ji(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new vt(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new vt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};gi.create=(t,e)=>new gi({innerType:t,typeName:he.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ee(e)});var ss=class extends Se{_parse(e){if(this._getType(e)!==ee.nan){let r=this._getOrReturnCtx(e);return Z(r,{code:J.invalid_type,expected:ee.nan,received:r.parsedType}),ce}return{status:"valid",value:e.data}}};ss.create=t=>new ss({typeName:he.ZodNaN,...Ee(t)});var ob=Symbol("zod_brand"),go=class extends Se{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},yo=class t extends Se{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ce:s.status==="dirty"?(n.dirty(),ni(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ce:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:he.ZodPipeline})}},yi=class extends Se{_parse(e){let n=this._def.innerType._parse(e),r=i=>(br(i)&&(i.value=Object.freeze(i.value)),i);return ji(n)?n.then(i=>r(i)):r(n)}unwrap(){return this._def.innerType}};yi.create=(t,e)=>new yi({innerType:t,typeName:he.ZodReadonly,...Ee(e)});function qg(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function $g(t,e={},n){return t?Ir.create().superRefine((r,i)=>{let s=t(r);if(s instanceof Promise)return s.then(o=>{if(!o){let a=qg(e,r),d=a.fatal??n??!0;i.addIssue({code:"custom",...a,fatal:d})}});if(!s){let o=qg(e,r),a=o.fatal??n??!0;i.addIssue({code:"custom",...o,fatal:a})}}):Ir.create()}var ab={object:St.lazycreate},he;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(he||(he={}));var lb=(t,e={message:`Input not instance of ${t.name}`})=>$g(n=>n instanceof t,e),Wg=Rr.create,Jg=ri.create,ub=ss.create,cb=ii.create,zg=si.create,db=oi.create,fb=ts.create,hb=ai.create,pb=li.create,mb=Ir.create,gb=er.create,yb=cn.create,_b=ns.create,Eb=tr.create,vb=St.create,Sb=St.strictCreate,Tb=ui.create,wb=Wa.create,Cb=ci.create,Ab=In.create,bb=Ja.create,Rb=rs.create,Ib=is.create,Pb=za.create,xb=di.create,kb=fi.create,Nb=hi.create,Mb=pi.create,Ob=Pr.create,Db=zt.create,Ub=Wt.create,Lb=Pn.create,Fb=zt.createWithPreprocess,qb=yo.create,Bb=()=>Wg().optional(),Gb=()=>Jg().optional(),Hb=()=>zg().optional(),Vb={string:(t=>Rr.create({...t,coerce:!0})),number:(t=>ri.create({...t,coerce:!0})),boolean:(t=>si.create({...t,coerce:!0})),bigint:(t=>ii.create({...t,coerce:!0})),date:(t=>oi.create({...t,coerce:!0}))};var $b=ce;import{GetCommand as jb,PutCommand as eR,DeleteCommand as tR,ScanCommand as Yg,QueryCommand as nR,UpdateCommand as rR}from"@aws-sdk/lib-dynamodb";import{DynamoDBClient as zb}from"@aws-sdk/client-dynamodb";import{DynamoDBDocumentClient as Kb}from"@aws-sdk/lib-dynamodb";var Wb=pe.object({AWS_REGION:pe.string().default("us-east-2"),AWS_ACCESS_KEY_ID:pe.string().optional(),AWS_SECRET_ACCESS_KEY:pe.string().optional(),DYNAMODB_PRODUCTS_TABLE:pe.string().default("fitit-products"),DYNAMODB_SERVICE_PROFILES_TABLE:pe.string().default("fitit-service-profiles"),DYNAMODB_SERVICE_REQUESTS_TABLE:pe.string().default("fitit-service-requests"),DYNAMODB_CHAT_TABLE:pe.string().default("fitit-chat"),GEMINI_API_KEY:pe.string().optional(),PORT:pe.string().default("3000").transform(Number),NODE_ENV:pe.enum(["development","production","test"]).default("development")});function Jb(){let t=Wb.safeParse(process.env);if(!t.success)throw console.error("\u274C Invalid environment configuration:"),console.error(t.error.format()),new Error("Invalid environment configuration");return t.data}var ht=Jb(),tH=ht.NODE_ENV==="production",ld=ht.NODE_ENV==="development";var Yb=new zb({region:ht.AWS_REGION,...ht.AWS_ACCESS_KEY_ID&&ht.AWS_SECRET_ACCESS_KEY&&{credentials:{accessKeyId:ht.AWS_ACCESS_KEY_ID,secretAccessKey:ht.AWS_SECRET_ACCESS_KEY}},maxAttempts:3}),Kt=Kb.from(Yb,{marshallOptions:{convertEmptyValues:!0,removeUndefinedValues:!0,convertClassInstanceToMap:!0},unmarshallOptions:{wrapNumbers:!1}}),xr={PRODUCTS:ht.DYNAMODB_PRODUCTS_TABLE,SERVICE_PROFILES:ht.DYNAMODB_SERVICE_PROFILES_TABLE,SERVICE_REQUESTS:ht.DYNAMODB_SERVICE_REQUESTS_TABLE,CHAT:ht.DYNAMODB_CHAT_TABLE};var Te=class extends Error{statusCode;code;details;isOperational;constructor(e,n=500,r="INTERNAL_ERROR",i,s=!0){super(e),this.name=this.constructor.name,this.statusCode=n,this.code=r,this.details=i,this.isOperational=s,Error.captureStackTrace(this,this.constructor)}toJSON(){return{success:!1,error:{code:this.code,message:this.message,...this.details&&{details:this.details}}}}},os=class extends Te{constructor(e,n){let r=n?`${e} with ID '${n}' not found`:`${e} not found`;super(r,404,"NOT_FOUND",{resource:e,id:n})}},xt=class extends Te{constructor(e,n){super(e,400,"VALIDATION_ERROR",n)}},pt=class extends Te{constructor(e,n){super(e,500,"DATABASE_ERROR",n,!1)}};var Kg={DEBUG:0,INFO:1,WARN:2,ERROR:3},Xb=ld?"DEBUG":"INFO";function Zb(t){if(ld){let e=[`[${t.timestamp}]`,`[${t.level}]`,t.correlationId?`[${t.correlationId}]`:"",t.message].filter(Boolean);return t.data?`${e.join(" ")}
${JSON.stringify(t.data,null,2)}`:e.join(" ")}return JSON.stringify(t)}function Qb(t){return Kg[t]>=Kg[Xb]}function kr(t,e,n,r){if(!Qb(t))return;let i={timestamp:new Date().toISOString(),level:t,message:e,correlationId:r,data:n},s=Zb(i);switch(t){case"ERROR":console.error(s);break;case"WARN":console.warn(s);break;default:console.log(s)}}var Ve={debug:(t,e,n)=>kr("DEBUG",t,e,n),info:(t,e,n)=>kr("INFO",t,e,n),warn:(t,e,n)=>kr("WARN",t,e,n),error:(t,e,n)=>kr("ERROR",t,e,n),withCorrelationId:t=>({debug:(e,n)=>kr("DEBUG",e,n,t),info:(e,n)=>kr("INFO",e,n,t),warn:(e,n)=>kr("WARN",e,n,t),error:(e,n)=>kr("ERROR",e,n,t)})};var nr=class{async getById(e){try{return(await Kt.send(new jb({TableName:this.tableName,Key:{id:e}}))).Item||null}catch(n){throw Ve.error(`Failed to get ${this.entityName} by ID`,{tableName:this.tableName,id:e,error:String(n)}),new pt(`Failed to retrieve ${this.entityName}`)}}async getByIdOrThrow(e){let n=await this.getById(e);if(!n)throw new os(this.entityName,e);return n}async getAll(e){try{return(await Kt.send(new Yg({TableName:this.tableName,...e&&{Limit:e}}))).Items||[]}catch(n){throw Ve.error(`Failed to scan ${this.entityName}`,{tableName:this.tableName,error:String(n)}),new pt(`Failed to retrieve ${this.entityName} list`)}}async create(e){let n=new Date().toISOString(),r={...e,createdAt:n,updatedAt:n};try{return await Kt.send(new eR({TableName:this.tableName,Item:r,ConditionExpression:"attribute_not_exists(id)"})),Ve.info(`Created ${this.entityName}`,{id:e.id}),r}catch(i){throw i.name==="ConditionalCheckFailedException"?new pt(`${this.entityName} with this ID already exists`):(Ve.error(`Failed to create ${this.entityName}`,{tableName:this.tableName,id:e.id,error:String(i)}),new pt(`Failed to create ${this.entityName}`))}}async update(e,n){let r=[],i={},s={},o={...n,updatedAt:new Date().toISOString()};if(Object.entries(o).forEach(([a,d],u)=>{if(a==="id")return;let h=`#attr${u}`,m=`:val${u}`;r.push(`${h} = ${m}`),i[h]=a,s[m]=d}),r.length===0)return this.getByIdOrThrow(e);try{let a=await Kt.send(new rR({TableName:this.tableName,Key:{id:e},UpdateExpression:`SET ${r.join(", ")}`,ExpressionAttributeNames:i,ExpressionAttributeValues:s,ConditionExpression:"attribute_exists(id)",ReturnValues:"ALL_NEW"}));return Ve.info(`Updated ${this.entityName}`,{id:e}),a.Attributes}catch(a){throw a.name==="ConditionalCheckFailedException"?new os(this.entityName,e):(Ve.error(`Failed to update ${this.entityName}`,{tableName:this.tableName,id:e,error:String(a)}),new pt(`Failed to update ${this.entityName}`))}}async delete(e){try{await Kt.send(new tR({TableName:this.tableName,Key:{id:e},ConditionExpression:"attribute_exists(id)"})),Ve.info(`Deleted ${this.entityName}`,{id:e})}catch(n){throw n.name==="ConditionalCheckFailedException"?new os(this.entityName,e):(Ve.error(`Failed to delete ${this.entityName}`,{tableName:this.tableName,id:e,error:String(n)}),new pt(`Failed to delete ${this.entityName}`))}}async queryByIndex(e,n,r){try{return(await Kt.send(new nR({TableName:this.tableName,IndexName:e,KeyConditionExpression:"#key = :value",ExpressionAttributeNames:{"#key":String(n)},ExpressionAttributeValues:{":value":r}}))).Items||[]}catch(i){throw Ve.error(`Failed to query ${this.entityName} by index`,{tableName:this.tableName,indexName:e,keyName:String(n),error:String(i)}),new pt(`Failed to query ${this.entityName}`)}}async scanWithFilter(e,n,r){try{return(await Kt.send(new Yg({TableName:this.tableName,FilterExpression:e,ExpressionAttributeNames:n,ExpressionAttributeValues:r}))).Items||[]}catch(i){throw Ve.error(`Failed to scan ${this.entityName} with filter`,{tableName:this.tableName,error:String(i)}),new pt(`Failed to filter ${this.entityName}`)}}};var nt=[];for(let t=0;t<256;++t)nt.push((t+256).toString(16).slice(1));function Xg(t,e=0){return(nt[t[e+0]]+nt[t[e+1]]+nt[t[e+2]]+nt[t[e+3]]+"-"+nt[t[e+4]]+nt[t[e+5]]+"-"+nt[t[e+6]]+nt[t[e+7]]+"-"+nt[t[e+8]]+nt[t[e+9]]+"-"+nt[t[e+10]]+nt[t[e+11]]+nt[t[e+12]]+nt[t[e+13]]+nt[t[e+14]]+nt[t[e+15]]).toLowerCase()}import{randomFillSync as iR}from"crypto";var Ya=new Uint8Array(256),Ka=Ya.length;function ud(){return Ka>Ya.length-16&&(iR(Ya),Ka=0),Ya.slice(Ka,Ka+=16)}import{randomUUID as sR}from"crypto";var cd={randomUUID:sR};function oR(t,e,n){if(cd.randomUUID&&!e&&!t)return cd.randomUUID();t=t||{};let r=t.random??t.rng?.()??ud();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[n+i]=r[i];return e}return Xg(r)}var rr=oR;var Xa=class extends nr{tableName=xr.PRODUCTS;entityName="Product";async createProduct(e){let n={id:rr(),name:e.name,price:e.price,category:e.category,image:e.image||`https://picsum.photos/300/300?random=${Date.now()}`,description:e.description,rating:e.rating??0};return this.create(n)}async updateProduct(e,n){return this.update(e,n)}async getByCategory(e){return this.scanWithFilter("#category = :category",{"#category":"category"},{":category":e})}async getTopRated(e=10){return(await this.getAll()).sort((r,i)=>i.rating-r.rating).slice(0,e)}async searchByName(e){let n=await this.getAll(),r=e.toLowerCase();return n.filter(i=>i.name.toLowerCase().includes(r)||i.description.toLowerCase().includes(r))}},xn=new Xa;var Za=class extends nr{tableName=xr.SERVICE_PROFILES;entityName="ServiceProfile";async createProfile(e){let n={id:rr(),name:e.name,profession:e.profession,rate:e.rate,rating:e.rating??0,image:e.image||`https://picsum.photos/200/200?random=${Date.now()}`,available:e.available??!0};return this.create(n)}async getByProfession(e){return this.scanWithFilter("#profession = :profession",{"#profession":"profession"},{":profession":e})}async getAvailable(){return this.scanWithFilter("#available = :available",{"#available":"available"},{":available":!0})}async getAvailableByProfession(e){return this.scanWithFilter("#profession = :profession AND #available = :available",{"#profession":"profession","#available":"available"},{":profession":e,":available":!0})}async updateAvailability(e,n){return this.update(e,{available:n})}async updateRating(e,n){if(n<0||n>5)throw new Error("Rating must be between 0 and 5");return this.update(e,{rating:n})}async getTopRated(e=10){return(await this.getAll()).sort((r,i)=>i.rating-r.rating).slice(0,e)}},ir=new Za;var Qa=class extends nr{tableName=xr.SERVICE_REQUESTS;entityName="ServiceRequest";async createRequest(e){let n={id:rr(),customerId:e.customerId,customerName:e.customerName,description:e.description,category:e.category,status:"OPEN",date:new Date().toLocaleDateString()};return this.create(n)}async getByCustomerId(e){return this.scanWithFilter("#customerId = :customerId",{"#customerId":"customerId"},{":customerId":e})}async getByStatus(e){return this.scanWithFilter("#status = :status",{"#status":"status"},{":status":e})}async getOpenRequests(){return this.getByStatus("OPEN")}async getByCategory(e){return this.scanWithFilter("#category = :category",{"#category":"category"},{":category":e})}async updateStatus(e,n){let r={status:n.status};return n.professionalId&&(r.professionalId=n.professionalId),this.update(e,r)}async acceptJob(e,n){return this.updateStatus(e,{status:"IN_PROGRESS",professionalId:n})}async completeJob(e){return this.updateStatus(e,{status:"COMPLETED"})}async getByProfessionalId(e){return this.scanWithFilter("#professionalId = :professionalId",{"#professionalId":"professionalId"},{":professionalId":e})}async getRecent(e=20){return(await this.getAll()).sort((r,i)=>{let s=r.createdAt?new Date(r.createdAt).getTime():0;return(i.createdAt?new Date(i.createdAt).getTime():0)-s}).slice(0,e)}},kt=new Qa;import{PutCommand as aR,QueryCommand as lR,DeleteCommand as uR}from"@aws-sdk/lib-dynamodb";var ja=class{tableName=xr.CHAT;entityName="ChatMessage";async getSessionHistory(e,n=50){try{return(await Kt.send(new lR({TableName:this.tableName,KeyConditionExpression:"#sessionId = :sessionId",ExpressionAttributeNames:{"#sessionId":"sessionId"},ExpressionAttributeValues:{":sessionId":e},ScanIndexForward:!0,Limit:n}))).Items||[]}catch(r){throw Ve.error("Failed to get chat history",{sessionId:e,error:String(r)}),new pt("Failed to retrieve chat history")}}async addMessage(e,n,r){let i={id:rr(),sessionId:e,role:n,text:r,timestamp:new Date().toISOString()};try{return await Kt.send(new aR({TableName:this.tableName,Item:i})),Ve.debug("Added chat message",{sessionId:e,role:n}),i}catch(s){throw Ve.error("Failed to add chat message",{sessionId:e,error:String(s)}),new pt("Failed to save chat message")}}async clearSession(e){try{let n=await this.getSessionHistory(e,1e3);for(let r of n)await Kt.send(new uR({TableName:this.tableName,Key:{sessionId:r.sessionId,timestamp:r.timestamp}}));Ve.info("Cleared chat session",{sessionId:e,messageCount:n.length})}catch(n){throw Ve.error("Failed to clear chat session",{sessionId:e,error:String(n)}),new pt("Failed to clear chat session")}}async getFormattedHistory(e){return(await this.getSessionHistory(e)).map(r=>({role:r.role,text:r.text}))}},as=new ja;function xe(t,e,n=200,r){let i={success:!0,data:e,...r&&{meta:r}};return t.json(i,n)}function us(t,e){return xe(t,e,201)}function Zg(t){return new Response(null,{status:204})}function ls(t,e,n,r,i){let s={success:!1,error:{code:n,message:r,...i&&{details:i}}};return t.json(s,e)}function Re(t,e){return t.json(e.toJSON(),e.statusCode)}var _e={badRequest:(t,e="Invalid request",n)=>ls(t,400,"BAD_REQUEST",e,n),unauthorized:(t,e="Authentication required")=>ls(t,401,"UNAUTHORIZED",e),forbidden:(t,e="Access denied")=>ls(t,403,"FORBIDDEN",e),notFound:(t,e="Resource",n)=>ls(t,404,"NOT_FOUND",n?`${e} with ID '${n}' not found`:`${e} not found`),conflict:(t,e,n)=>ls(t,409,"CONFLICT",e,n),internalError:(t,e="Internal server error")=>ls(t,500,"INTERNAL_ERROR",e)};var kn=new un,Qg=pe.object({name:pe.string().min(1,"Name is required").max(100),price:pe.number().positive("Price must be positive"),category:pe.enum(["Power Tools","Hand Tools","Electrical","Plumbing","Safety"]),image:pe.string().url().optional(),description:pe.string().min(1,"Description is required").max(500),rating:pe.number().min(0).max(5).optional()}),cR=Qg.partial();kn.get("/",async t=>{try{let e=await xn.getAll();return xe(t,e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.get("/category/:category",async t=>{try{let e=t.req.param("category"),n=["Power Tools","Hand Tools","Electrical","Plumbing","Safety"];if(!n.includes(e))return _e.badRequest(t,`Invalid category. Valid options: ${n.join(", ")}`);let r=await xn.getByCategory(e);return xe(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.get("/search",async t=>{try{let e=t.req.query("q");if(!e||e.length<2)return _e.badRequest(t,"Search query must be at least 2 characters");let n=await xn.searchByName(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.get("/top-rated",async t=>{try{let e=parseInt(t.req.query("limit")||"10",10),n=await xn.getTopRated(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.get("/:id",async t=>{try{let e=t.req.param("id"),n=await xn.getById(e);return n?xe(t,n):_e.notFound(t,"Product",e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.post("/",async t=>{try{let e=await t.req.json(),n=Qg.safeParse(e);if(!n.success)throw new xt("Invalid product data",{errors:n.error.flatten().fieldErrors});let r=await xn.createProduct(n.data);return us(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.put("/:id",async t=>{try{let e=t.req.param("id"),n=await t.req.json(),r=cR.safeParse(n);if(!r.success)throw new xt("Invalid product data",{errors:r.error.flatten().fieldErrors});let i=await xn.updateProduct(e,r.data);return xe(t,i)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});kn.delete("/:id",async t=>{try{let e=t.req.param("id");return await xn.delete(e),Zg(t)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});var sr=new un,dR=pe.object({name:pe.string().min(1,"Name is required").max(100),profession:pe.enum(["Electrician","Carpenter","Plumber","HVAC","General Handyman"]),rate:pe.number().positive("Rate must be positive"),rating:pe.number().min(0).max(5).optional(),image:pe.string().url().optional(),available:pe.boolean().optional()}),fR=pe.object({available:pe.boolean()});sr.get("/",async t=>{try{let e=await ir.getAll();return xe(t,e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.get("/available",async t=>{try{let e=await ir.getAvailable();return xe(t,e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.get("/top-rated",async t=>{try{let e=parseInt(t.req.query("limit")||"10",10),n=await ir.getTopRated(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.get("/profession/:profession",async t=>{try{let e=t.req.param("profession"),n=["Electrician","Carpenter","Plumber","HVAC","General Handyman"];if(!n.includes(e))return _e.badRequest(t,`Invalid profession. Valid options: ${n.join(", ")}`);let r=await ir.getByProfession(e);return xe(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.get("/:id",async t=>{try{let e=t.req.param("id"),n=await ir.getById(e);return n?xe(t,n):_e.notFound(t,"ServiceProfile",e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.post("/",async t=>{try{let e=await t.req.json(),n=dR.safeParse(e);if(!n.success)throw new xt("Invalid profile data",{errors:n.error.flatten().fieldErrors});let r=await ir.createProfile(n.data);return us(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sr.patch("/:id/availability",async t=>{try{let e=t.req.param("id"),n=await t.req.json(),r=fR.safeParse(n);if(!r.success)throw new xt("Invalid availability data",{errors:r.error.flatten().fieldErrors});let i=await ir.updateAvailability(e,r.data.available);return xe(t,i)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});var Nt=new un,hR=pe.object({customerId:pe.string().min(1,"Customer ID is required"),customerName:pe.string().min(1,"Customer name is required").max(100),description:pe.string().min(1,"Description is required").max(1e3),category:pe.string().min(1,"Category is required")}),pR=pe.object({status:pe.enum(["OPEN","IN_PROGRESS","COMPLETED"]),professionalId:pe.string().optional()});Nt.get("/",async t=>{try{let e=await kt.getAll();return xe(t,e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/open",async t=>{try{let e=await kt.getOpenRequests();return xe(t,e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/recent",async t=>{try{let e=parseInt(t.req.query("limit")||"20",10),n=await kt.getRecent(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/status/:status",async t=>{try{let e=t.req.param("status"),n=["OPEN","IN_PROGRESS","COMPLETED"];if(!n.includes(e))return _e.badRequest(t,`Invalid status. Valid options: ${n.join(", ")}`);let r=await kt.getByStatus(e);return xe(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/customer/:customerId",async t=>{try{let e=t.req.param("customerId"),n=await kt.getByCustomerId(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/professional/:professionalId",async t=>{try{let e=t.req.param("professionalId"),n=await kt.getByProfessionalId(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.get("/:id",async t=>{try{let e=t.req.param("id"),n=await kt.getById(e);return n?xe(t,n):_e.notFound(t,"ServiceRequest",e)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.post("/",async t=>{try{let e=await t.req.json(),n=hR.safeParse(e);if(!n.success)throw new xt("Invalid request data",{errors:n.error.flatten().fieldErrors});let r=await kt.createRequest(n.data);return us(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.patch("/:id/status",async t=>{try{let e=t.req.param("id"),n=await t.req.json(),r=pR.safeParse(n);if(!r.success)throw new xt("Invalid status data",{errors:r.error.flatten().fieldErrors});let i=await kt.updateStatus(e,r.data);return xe(t,i)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.post("/:id/accept",async t=>{try{let e=t.req.param("id"),n=await t.req.json();if(!n.professionalId)return _e.badRequest(t,"Professional ID is required");let r=await kt.acceptJob(e,n.professionalId);return xe(t,r)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});Nt.post("/:id/complete",async t=>{try{let e=t.req.param("id"),n=await kt.completeJob(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});var Rw=Zn(jv(),1);import{createWriteStream as mO}from"fs";import*as pc from"fs/promises";import{writeFile as gO}from"fs/promises";import{Readable as yO}from"node:stream";import{finished as _O}from"node:stream/promises";var cO=Zn(KS(),1),dO=Zn(qh(),1),fO=Zn(Hh(),1),Xh=Zn(Pu(),1),hO=Zn(rT(),1);import*as Iw from"path";var EO,vO;function SO(){return{geminiUrl:EO,vertexUrl:vO}}function TO(t,e,n,r){var i,s;if(!t?.baseUrl){let o=SO();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:n:(s=o.geminiUrl)!==null&&s!==void 0?s:r}return t.baseUrl}var wn=class{};function Q(t,e){let n=/\{([^}]+)\}/g;return t.replace(n,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){let s=e[i];return s!=null?String(s):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function c(t,e,n){for(let s=0;s<e.length-1;s++){let o=e[s];if(o.endsWith("[]")){let a=o.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(t[a])){let d=t[a];if(Array.isArray(n))for(let u=0;u<d.length;u++){let h=d[u];c(h,e.slice(s+1),n[u])}else for(let u of d)c(u,e.slice(s+1),n)}return}else if(o.endsWith("[0]")){let a=o.slice(0,-3);a in t||(t[a]=[{}]);let d=t[a];c(d[0],e.slice(s+1),n);return}(!t[o]||typeof t[o]!="object")&&(t[o]={}),t=t[o]}let r=e[e.length-1],i=t[r];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function l(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;let i=e[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(s in t){let o=t[s];return Array.isArray(o)?o.map(a=>l(a,e.slice(r+1),n)):n}else return n}else t=t[i]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function wO(t,e){for(let[n,r]of Object.entries(e)){let i=n.split("."),s=r.split("."),o=new Set,a=-1;for(let d=0;d<i.length;d++)if(i[d]==="*"){a=d;break}if(a!==-1&&s.length>a)for(let d=a;d<s.length;d++){let u=s[d];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&o.add(u)}jh(t,i,s,0,o)}}function jh(t,e,n,r,i){if(r>=e.length||typeof t!="object"||t===null)return;let s=e[r];if(s.endsWith("[]")){let o=s.slice(0,-2),a=t;if(o in a&&Array.isArray(a[o]))for(let d of a[o])jh(d,e,n,r+1,i)}else if(s==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){let o=t,a=Object.keys(o).filter(u=>!u.startsWith("_")&&!i.has(u)),d={};for(let u of a)d[u]=o[u];for(let[u,h]of Object.entries(d)){let m=[];for(let g of n.slice(r))g==="*"?m.push(u):m.push(g);c(o,m,h)}for(let u of a)delete o[u]}}else{let o=t;s in o&&jh(o[s],e,n,r+1,i)}}function Zp(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function CO(t){let e={},n=l(t,["operationName"]);n!=null&&c(e,["operationName"],n);let r=l(t,["resourceName"]);return r!=null&&c(e,["_url","resourceName"],r),e}function AO(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response","generateVideoResponse"]);return o!=null&&c(e,["response"],RO(o)),e}function bO(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response"]);return o!=null&&c(e,["response"],IO(o)),e}function RO(t){let e={},n=l(t,["generatedSamples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>PO(o))),c(e,["generatedVideos"],s)}let r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=l(t,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function IO(t){let e={},n=l(t,["videos"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>xO(o))),c(e,["generatedVideos"],s)}let r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=l(t,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function PO(t){let e={},n=l(t,["video"]);return n!=null&&c(e,["video"],UO(n)),e}function xO(t){let e={},n=l(t,["_self"]);return n!=null&&c(e,["video"],LO(n)),e}function kO(t){let e={},n=l(t,["operationName"]);return n!=null&&c(e,["_url","operationName"],n),e}function NO(t){let e={},n=l(t,["operationName"]);return n!=null&&c(e,["_url","operationName"],n),e}function MO(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response"]);return o!=null&&c(e,["response"],OO(o)),e}function OO(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["parent"]);r!=null&&c(e,["parent"],r);let i=l(t,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function Qp(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response"]);return o!=null&&c(e,["response"],DO(o)),e}function DO(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["parent"]);r!=null&&c(e,["parent"],r);let i=l(t,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function UO(t){let e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);let r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],Zp(r));let i=l(t,["encoding"]);return i!=null&&c(e,["mimeType"],i),e}function LO(t){let e={},n=l(t,["gcsUri"]);n!=null&&c(e,["uri"],n);let r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],Zp(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}var iT;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(iT||(iT={}));var sT;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(sT||(sT={}));var oT;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(oT||(oT={}));var Hr;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Hr||(Hr={}));var aT;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(aT||(aT={}));var lT;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(lT||(lT={}));var uT;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(uT||(uT={}));var cT;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(cT||(cT={}));var dT;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(dT||(dT={}));var fT;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(fT||(fT={}));var hT;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(hT||(hT={}));var pT;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(pT||(pT={}));var mT;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(mT||(mT={}));var gT;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(gT||(gT={}));var yT;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(yT||(yT={}));var _T;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(_T||(_T={}));var ET;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ET||(ET={}));var vT;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(vT||(vT={}));var ST;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(ST||(ST={}));var TT;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(TT||(TT={}));var wT;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(wT||(wT={}));var Fu;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Fu||(Fu={}));var CT;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(CT||(CT={}));var AT;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(AT||(AT={}));var bT;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(bT||(bT={}));var ep;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ep||(ep={}));var RT;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(RT||(RT={}));var IT;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(IT||(IT={}));var tp;(function(t){t.COLLECTION="COLLECTION"})(tp||(tp={}));var PT;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(PT||(PT={}));var xT;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(xT||(xT={}));var kT;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(kT||(kT={}));var NT;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(NT||(NT={}));var MT;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(MT||(MT={}));var OT;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(OT||(OT={}));var DT;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(DT||(DT={}));var UT;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(UT||(UT={}));var LT;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(LT||(LT={}));var FT;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(FT||(FT={}));var qT;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(qT||(qT={}));var BT;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(BT||(BT={}));var GT;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(GT||(GT={}));var HT;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(HT||(HT={}));var VT;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(VT||(VT={}));var $T;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})($T||($T={}));var WT;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED",t.REGISTERED="REGISTERED"})(WT||(WT={}));var JT;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(JT||(JT={}));var zT;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(zT||(zT={}));var KT;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(KT||(KT={}));var YT;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.ACTIVITY_START="ACTIVITY_START",t.ACTIVITY_END="ACTIVITY_END"})(YT||(YT={}));var XT;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(XT||(XT={}));var ZT;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ZT||(ZT={}));var QT;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(QT||(QT={}));var jT;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(jT||(jT={}));var ew;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(ew||(ew={}));var tw;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(tw||(tw={}));var Js;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Js||(Js={}));var Di=class{constructor(e){let n={};for(let r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}};var Mi=class{get text(){var e,n,r,i,s,o,a,d;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",h=!1,m=[];for(let g of(d=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&d!==void 0?d:[]){for(let[_,v]of Object.entries(g))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(v!==null||v!==void 0)&&m.push(_);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,u+=g.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?u:void 0}get data(){var e,n,r,i,s,o,a,d;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="",h=[];for(let m of(d=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&d!==void 0?d:[]){for(let[g,_]of Object.entries(m))g!=="inlineData"&&(_!==null||_!==void 0)&&h.push(g);m.inlineData&&typeof m.inlineData.data=="string"&&(u+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,n,r,i,s,o,a,d;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let u=(d=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||d===void 0?void 0:d.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if(u?.length!==0)return u}get executableCode(){var e,n,r,i,s,o,a,d,u;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let h=(d=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||d===void 0?void 0:d.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if(h?.length!==0)return(u=h?.[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,n,r,i,s,o,a,d,u;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let h=(d=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||d===void 0?void 0:d.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if(h?.length!==0)return(u=h?.[0])===null||u===void 0?void 0:u.output}},qu=class{},Bu=class{},np=class{},rp=class{},ip=class{},sp=class{},Gu=class{},Hu=class{},Vu=class{},op=class{};var $u=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,i,s=e;return n?i=bO(s):i=AO(s),Object.assign(r,i),r}},Wu=class{},Ju=class{},zu=class{},Ku=class{},ap=class{},lp=class{},up=class{};var cp=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,s=MO(e);return Object.assign(r,s),r}},dp=class{},fp=class{},hp=class{};var Yu=class{};var pp=class{get text(){var e,n,r;let i="",s=!1,o=[];for(let a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(let[d,u]of Object.entries(a))d!=="text"&&d!=="thought"&&u!==null&&o.push(d);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;s=!0,i+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?i:void 0}get data(){var e,n,r;let i="",s=[];for(let o of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(let[a,d]of Object.entries(o))a!=="inlineData"&&d!==null&&s.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var mp=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Xu=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,s=Qp(e);return Object.assign(r,s),r}};function ke(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Pw(t,e){let n=ke(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function xw(t){return Array.isArray(t)?t.map(e=>Zu(e)):[Zu(t)]}function Zu(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function kw(t){let e=Zu(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Nw(t){let e=Zu(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function nw(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Mw(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>nw(e)):[nw(t)]}function gp(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function rw(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function iw(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function lt(t){if(t==null)throw new Error("ContentUnion is required");return gp(t)?t:{role:"user",parts:Mw(t)}}function jp(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{let r=lt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){let n=lt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>lt(n)):[lt(e)]}function sn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(rw(t)||iw(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[lt(t)]}let e=[],n=[],r=gp(t[0]);for(let i of t){let s=gp(i);if(s!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(i);else{if(rw(i)||iw(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:Mw(n)}),e}function FO(t,e){t.includes("null")&&(e.nullable=!0);let n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(Hr).includes(n[0].toUpperCase())?n[0].toUpperCase():Hr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let r of n)e.anyOf.push({type:Object.values(Hr).includes(r.toUpperCase())?r.toUpperCase():Hr.TYPE_UNSPECIFIED})}}function zs(t){let e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");let s=t.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,t=s[1]):s[1].type==="null"&&(e.nullable=!0,t=s[0])),t.type instanceof Array&&FO(t.type,e);for(let[o,a]of Object.entries(t))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Hr).includes(a.toUpperCase())?a.toUpperCase():Hr.TYPE_UNSPECIFIED}else if(n.includes(o))e[o]=zs(a);else if(r.includes(o)){let d=[];for(let u of a){if(u.type=="null"){e.nullable=!0;continue}d.push(zs(u))}e[o]=d}else if(i.includes(o)){let d={};for(let[u,h]of Object.entries(a))d[u]=zs(h);e[o]=d}else{if(o==="additionalProperties")continue;e[o]=a}return e}function em(t){return zs(t)}function tm(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function nm(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Zs(t){if(t.functionDeclarations)for(let e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=zs(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=zs(e.response));return t}function Qs(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");let e=[];for(let n of t)e.push(n);return e}function qO(t,e,n,r=1){let i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function yr(t,e){if(typeof e!="string")throw new Error("name must be a string");return qO(t,e,"cachedContents")}function Ow(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function $r(t){return Zp(t)}function BO(t){return t!=null&&typeof t=="object"&&"name"in t}function Dw(t){return t!=null&&typeof t=="object"&&"video"in t}function Uw(t){return t!=null&&typeof t=="object"&&"uri"in t}function rm(t){var e;let n;if(BO(t)&&(n=t.name),!(Uw(t)&&(n=t.uri,n===void 0))&&!(Dw(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Lw(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Fw(t){for(let e of["models","tunedModels","publisherModels"])if(GO(t,e))return t[e];return[]}function GO(t,e){return t!==null&&typeof t=="object"&&e in t}function HO(t,e={}){let n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function VO(t,e={}){let n=[],r=new Set;for(let i of t){let s=i.name;if(r.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);r.add(s);let o=HO(i,e);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}function qw(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function $O(t){if(typeof t!="string")return t;let e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Bw(t){if(typeof t!="object"||t===null)return{};let e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;let i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let s=!1;for(let o of i){if(typeof o!="object"||o===null)continue;let d=o.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){s=!0;break}}return s&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function js(t,e){let n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Gw(t){let e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function WO(t){let e={},n=l(t,["responsesFile"]);n!=null&&c(e,["fileName"],n);let r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>AD(o))),c(e,["inlinedResponses"],s)}let i=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["inlinedEmbedContentResponses"],s)}return e}function JO(t){let e={},n=l(t,["predictionsFormat"]);n!=null&&c(e,["format"],n);let r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&c(e,["gcsUri"],r);let i=l(t,["bigqueryDestination","outputUri"]);return i!=null&&c(e,["bigqueryUri"],i),e}function zO(t){let e={},n=l(t,["format"]);n!=null&&c(e,["predictionsFormat"],n);let r=l(t,["gcsUri"]);r!=null&&c(e,["gcsDestination","outputUriPrefix"],r);let i=l(t,["bigqueryUri"]);if(i!=null&&c(e,["bigqueryDestination","outputUri"],i),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Uu(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata","displayName"]);r!=null&&c(e,["displayName"],r);let i=l(t,["metadata","state"]);i!=null&&c(e,["state"],Gw(i));let s=l(t,["metadata","createTime"]);s!=null&&c(e,["createTime"],s);let o=l(t,["metadata","endTime"]);o!=null&&c(e,["endTime"],o);let a=l(t,["metadata","updateTime"]);a!=null&&c(e,["updateTime"],a);let d=l(t,["metadata","model"]);d!=null&&c(e,["model"],d);let u=l(t,["metadata","output"]);return u!=null&&c(e,["dest"],WO(Bw(u))),e}function yp(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);let i=l(t,["state"]);i!=null&&c(e,["state"],Gw(i));let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["createTime"]);o!=null&&c(e,["createTime"],o);let a=l(t,["startTime"]);a!=null&&c(e,["startTime"],a);let d=l(t,["endTime"]);d!=null&&c(e,["endTime"],d);let u=l(t,["updateTime"]);u!=null&&c(e,["updateTime"],u);let h=l(t,["model"]);h!=null&&c(e,["model"],h);let m=l(t,["inputConfig"]);m!=null&&c(e,["src"],KO(m));let g=l(t,["outputConfig"]);g!=null&&c(e,["dest"],JO(Bw(g)));let _=l(t,["completionStats"]);return _!=null&&c(e,["completionStats"],_),e}function KO(t){let e={},n=l(t,["instancesFormat"]);n!=null&&c(e,["format"],n);let r=l(t,["gcsSource","uris"]);r!=null&&c(e,["gcsUri"],r);let i=l(t,["bigquerySource","inputUri"]);return i!=null&&c(e,["bigqueryUri"],i),e}function YO(t,e){let n={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let r=l(e,["fileName"]);r!=null&&c(n,["fileName"],r);let i=l(e,["inlinedRequests"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>CD(t,o))),c(n,["requests","requests"],s)}return n}function XO(t){let e={},n=l(t,["format"]);n!=null&&c(e,["instancesFormat"],n);let r=l(t,["gcsUri"]);r!=null&&c(e,["gcsSource","uris"],r);let i=l(t,["bigqueryUri"]);if(i!=null&&c(e,["bigquerySource","inputUri"],i),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function ZO(t){let e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function QO(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function jO(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function eD(t){let e={},n=l(t,["content"]);n!=null&&c(e,["content"],n);let r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],tD(r));let i=l(t,["tokenCount"]);i!=null&&c(e,["tokenCount"],i);let s=l(t,["finishReason"]);s!=null&&c(e,["finishReason"],s);let o=l(t,["avgLogprobs"]);o!=null&&c(e,["avgLogprobs"],o);let a=l(t,["groundingMetadata"]);a!=null&&c(e,["groundingMetadata"],a);let d=l(t,["index"]);d!=null&&c(e,["index"],d);let u=l(t,["logprobsResult"]);u!=null&&c(e,["logprobsResult"],u);let h=l(t,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>_)),c(e,["safetyRatings"],g)}let m=l(t,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function tD(t){let e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["citations"],r)}return e}function Hw(t){let e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ND(s))),c(e,["parts"],i)}let r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function nD(t,e){let n={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&c(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function rD(t,e){let n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=l(t,["dest"]);return e!==void 0&&i!=null&&c(e,["outputConfig"],zO($O(i))),n}function sw(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["src"]);i!=null&&c(n,["batch","inputConfig"],YO(t,qw(t,i)));let s=l(e,["config"]);return s!=null&&nD(s,n),n}function iD(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["model"],ke(t,r));let i=l(e,["src"]);i!=null&&c(n,["inputConfig"],XO(qw(t,i)));let s=l(e,["config"]);return s!=null&&rD(s,n),n}function sD(t,e){let n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["batch","displayName"],r),n}function oD(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["src"]);i!=null&&c(n,["batch","inputConfig"],hD(t,i));let s=l(e,["config"]);return s!=null&&sD(s,n),n}function aD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function lD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function uD(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["name"]);r!=null&&c(e,["name"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);return s!=null&&c(e,["error"],s),e}function cD(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["name"]);r!=null&&c(e,["name"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);return s!=null&&c(e,["error"],s),e}function dD(t,e){let n={},r=l(e,["contents"]);if(r!=null){let s=jp(t,r);Array.isArray(s)&&(s=s.map(o=>o)),c(n,["requests[]","request","content"],s)}let i=l(e,["config"]);return i!=null&&(c(n,["_self"],fD(i,n)),wO(n,{"requests[].*":"requests[].request.*"})),n}function fD(t,e){let n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);let i=l(t,["title"]);e!==void 0&&i!=null&&c(e,["requests[]","title"],i);let s=l(t,["outputDimensionality"]);if(e!==void 0&&s!=null&&c(e,["requests[]","outputDimensionality"],s),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function hD(t,e){let n={},r=l(e,["fileName"]);r!=null&&c(n,["file_name"],r);let i=l(e,["inlinedRequests"]);return i!=null&&c(n,["requests"],dD(t,i)),n}function pD(t){let e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function mD(t){let e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);let r=l(t,["args"]);r!=null&&c(e,["args"],r);let i=l(t,["name"]);if(i!=null&&c(e,["name"],i),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function gD(t){let e={},n=l(t,["allowedFunctionNames"]);n!=null&&c(e,["allowedFunctionNames"],n);let r=l(t,["mode"]);if(r!=null&&c(e,["mode"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function yD(t,e,n){let r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&c(n,["systemInstruction"],Hw(lt(i)));let s=l(e,["temperature"]);s!=null&&c(r,["temperature"],s);let o=l(e,["topP"]);o!=null&&c(r,["topP"],o);let a=l(e,["topK"]);a!=null&&c(r,["topK"],a);let d=l(e,["candidateCount"]);d!=null&&c(r,["candidateCount"],d);let u=l(e,["maxOutputTokens"]);u!=null&&c(r,["maxOutputTokens"],u);let h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=l(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let _=l(e,["presencePenalty"]);_!=null&&c(r,["presencePenalty"],_);let v=l(e,["frequencyPenalty"]);v!=null&&c(r,["frequencyPenalty"],v);let w=l(e,["seed"]);w!=null&&c(r,["seed"],w);let T=l(e,["responseMimeType"]);T!=null&&c(r,["responseMimeType"],T);let A=l(e,["responseSchema"]);A!=null&&c(r,["responseSchema"],em(A));let G=l(e,["responseJsonSchema"]);if(G!=null&&c(r,["responseJsonSchema"],G),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let F=l(e,["safetySettings"]);if(n!==void 0&&F!=null){let le=F;Array.isArray(le)&&(le=le.map(ve=>MD(ve))),c(n,["safetySettings"],le)}let B=l(e,["tools"]);if(n!==void 0&&B!=null){let le=Qs(B);Array.isArray(le)&&(le=le.map(ve=>DD(Zs(ve)))),c(n,["tools"],le)}let H=l(e,["toolConfig"]);if(n!==void 0&&H!=null&&c(n,["toolConfig"],OD(H)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let q=l(e,["cachedContent"]);n!==void 0&&q!=null&&c(n,["cachedContent"],yr(t,q));let $=l(e,["responseModalities"]);$!=null&&c(r,["responseModalities"],$);let Y=l(e,["mediaResolution"]);Y!=null&&c(r,["mediaResolution"],Y);let L=l(e,["speechConfig"]);if(L!=null&&c(r,["speechConfig"],tm(L)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let te=l(e,["thinkingConfig"]);te!=null&&c(r,["thinkingConfig"],te);let oe=l(e,["imageConfig"]);oe!=null&&c(r,["imageConfig"],wD(oe));let fe=l(e,["enableEnhancedCivicAnswers"]);if(fe!=null&&c(r,["enableEnhancedCivicAnswers"],fe),l(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function _D(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(u=>eD(u))),c(e,["candidates"],d)}let i=l(t,["modelVersion"]);i!=null&&c(e,["modelVersion"],i);let s=l(t,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);let o=l(t,["responseId"]);o!=null&&c(e,["responseId"],o);let a=l(t,["usageMetadata"]);return a!=null&&c(e,["usageMetadata"],a),e}function ED(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function vD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],js(t,r)),n}function SD(t){let e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function TD(t){let e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function wD(t){let e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);let r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function CD(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["request","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let a=sn(i);Array.isArray(a)&&(a=a.map(d=>Hw(d))),c(n,["request","contents"],a)}let s=l(e,["metadata"]);s!=null&&c(n,["metadata"],s);let o=l(e,["config"]);return o!=null&&c(n,["request","generationConfig"],yD(t,o,l(n,["request"],{}))),n}function AD(t){let e={},n=l(t,["response"]);n!=null&&c(e,["response"],_D(n));let r=l(t,["error"]);return r!=null&&c(e,["error"],r),e}function bD(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);if(e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function RD(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);e!==void 0&&i!=null&&c(e,["_query","pageToken"],i);let s=l(t,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),n}function ID(t){let e={},n=l(t,["config"]);return n!=null&&bD(n,e),e}function PD(t){let e={},n=l(t,["config"]);return n!=null&&RD(n,e),e}function xD(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["operations"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>Uu(o))),c(e,["batchJobs"],s)}return e}function kD(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["batchPredictionJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>yp(o))),c(e,["batchJobs"],s)}return e}function ND(t){let e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);let r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=l(t,["executableCode"]);i!=null&&c(e,["executableCode"],i);let s=l(t,["fileData"]);s!=null&&c(e,["fileData"],pD(s));let o=l(t,["functionCall"]);o!=null&&c(e,["functionCall"],mD(o));let a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);let d=l(t,["inlineData"]);d!=null&&c(e,["inlineData"],ZO(d));let u=l(t,["text"]);u!=null&&c(e,["text"],u);let h=l(t,["thought"]);h!=null&&c(e,["thought"],h);let m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);let g=l(t,["videoMetadata"]);return g!=null&&c(e,["videoMetadata"],g),e}function MD(t){let e={},n=l(t,["category"]);if(n!=null&&c(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function OD(t){let e={},n=l(t,["retrievalConfig"]);n!=null&&c(e,["retrievalConfig"],n);let r=l(t,["functionCallingConfig"]);return r!=null&&c(e,["functionCallingConfig"],gD(r)),e}function DD(t){let e={};if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=l(t,["computerUse"]);n!=null&&c(e,["computerUse"],n);let r=l(t,["fileSearch"]);r!=null&&c(e,["fileSearch"],r);let i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=l(t,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}let o=l(t,["googleMaps"]);o!=null&&c(e,["googleMaps"],SD(o));let a=l(t,["googleSearch"]);a!=null&&c(e,["googleSearch"],TD(a));let d=l(t,["googleSearchRetrieval"]);d!=null&&c(e,["googleSearchRetrieval"],d);let u=l(t,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}var mr;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(mr||(mr={}));var gr=class{constructor(e,n,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,i)}init(e,n,r){var i,s;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n?.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!r||Object.keys(r).length===0?o={config:{}}:typeof r=="object"?o=Object.assign({},r):o=r,o.config&&(o.config.pageToken=n.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(s=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var _p=class extends wn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new gr(mr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){let n=sw(this.apiClient,e),r=n._url,i=Q("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,d=a.requests,u=[];for(let h of d){let m=Object.assign({},h);if(m.systemInstruction){let g=m.systemInstruction;delete m.systemInstruction;let _=m.request;_.systemInstruction=g,m.request=_}u.push(m)}return a.requests=u,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){let r=n?Object.assign({},n):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){let s=this.getGcsUri(e),o=this.getBigqueryUri(e);if(s)s.endsWith(".jsonl")?r.dest=`${s.slice(0,-6)}/dest`:r.dest=`${s}_dest_${i}`;else if(o)r.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=iD(this.apiClient,e);return a=Q("batchPredictionJobs",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>yp(h))}else{let u=sw(this.apiClient,e);return a=Q("{model}:batchGenerateContent",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>Uu(h))}}async createEmbeddingsInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=oD(this.apiClient,e);return s=Q("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>Uu(d))}}async get(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=vD(this.apiClient,e);return a=Q("batchPredictionJobs/{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>yp(h))}else{let u=ED(this.apiClient,e);return a=Q("batches/{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>Uu(h))}}async cancel(e){var n,r,i,s;let o="",a={};if(this.apiClient.isVertexAI()){let d=jO(this.apiClient,e);o=Q("batchPredictionJobs/{name}:cancel",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{let d=QO(this.apiClient,e);o=Q("batches/{name}:cancel",d._url),a=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=PD(e);return a=Q("batchPredictionJobs",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=kD(h),g=new Yu;return Object.assign(g,m),g})}else{let u=ID(e);return a=Q("batches",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=xD(h),g=new Yu;return Object.assign(g,m),g})}}async delete(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=lD(this.apiClient,e);return a=Q("batchPredictionJobs/{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>cD(h))}else{let u=aD(this.apiClient,e);return a=Q("batches/{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>uD(h))}}};function UD(t){let e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function ow(t){let e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>sU(s))),c(e,["parts"],i)}let r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function LD(t,e){let n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=l(t,["expireTime"]);e!==void 0&&i!=null&&c(e,["expireTime"],i);let s=l(t,["displayName"]);e!==void 0&&s!=null&&c(e,["displayName"],s);let o=l(t,["contents"]);if(e!==void 0&&o!=null){let h=sn(o);Array.isArray(h)&&(h=h.map(m=>ow(m))),c(e,["contents"],h)}let a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&c(e,["systemInstruction"],ow(lt(a)));let d=l(t,["tools"]);if(e!==void 0&&d!=null){let h=d;Array.isArray(h)&&(h=h.map(m=>aU(m))),c(e,["tools"],h)}let u=l(t,["toolConfig"]);if(e!==void 0&&u!=null&&c(e,["toolConfig"],oU(u)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function FD(t,e){let n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=l(t,["expireTime"]);e!==void 0&&i!=null&&c(e,["expireTime"],i);let s=l(t,["displayName"]);e!==void 0&&s!=null&&c(e,["displayName"],s);let o=l(t,["contents"]);if(e!==void 0&&o!=null){let m=sn(o);Array.isArray(m)&&(m=m.map(g=>g)),c(e,["contents"],m)}let a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&c(e,["systemInstruction"],lt(a));let d=l(t,["tools"]);if(e!==void 0&&d!=null){let m=d;Array.isArray(m)&&(m=m.map(g=>lU(g))),c(e,["tools"],m)}let u=l(t,["toolConfig"]);e!==void 0&&u!=null&&c(e,["toolConfig"],u);let h=l(t,["kmsKeyName"]);return e!==void 0&&h!=null&&c(e,["encryption_spec","kmsKeyName"],h),n}function qD(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["model"],Pw(t,r));let i=l(e,["config"]);return i!=null&&LD(i,n),n}function BD(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["model"],Pw(t,r));let i=l(e,["config"]);return i!=null&&FD(i,n),n}function GD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],yr(t,r)),n}function HD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],yr(t,r)),n}function VD(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function $D(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function WD(t){let e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function JD(t){let e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);let r=l(t,["args"]);r!=null&&c(e,["args"],r);let i=l(t,["name"]);if(i!=null&&c(e,["name"],i),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function zD(t){let e={},n=l(t,["allowedFunctionNames"]);n!=null&&c(e,["allowedFunctionNames"],n);let r=l(t,["mode"]);if(r!=null&&c(e,["mode"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function KD(t){let e={},n=l(t,["description"]);n!=null&&c(e,["description"],n);let r=l(t,["name"]);r!=null&&c(e,["name"],r);let i=l(t,["parameters"]);i!=null&&c(e,["parameters"],i);let s=l(t,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let o=l(t,["response"]);o!=null&&c(e,["response"],o);let a=l(t,["responseJsonSchema"]);if(a!=null&&c(e,["responseJsonSchema"],a),l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function YD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],yr(t,r)),n}function XD(t,e){let n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],yr(t,r)),n}function ZD(t){let e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function QD(t){let e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function jD(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),n}function eU(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),n}function tU(t){let e={},n=l(t,["config"]);return n!=null&&jD(n,e),e}function nU(t){let e={},n=l(t,["config"]);return n!=null&&eU(n,e),e}function rU(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["cachedContents"],s)}return e}function iU(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["cachedContents"],s)}return e}function sU(t){let e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);let r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=l(t,["executableCode"]);i!=null&&c(e,["executableCode"],i);let s=l(t,["fileData"]);s!=null&&c(e,["fileData"],WD(s));let o=l(t,["functionCall"]);o!=null&&c(e,["functionCall"],JD(o));let a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);let d=l(t,["inlineData"]);d!=null&&c(e,["inlineData"],UD(d));let u=l(t,["text"]);u!=null&&c(e,["text"],u);let h=l(t,["thought"]);h!=null&&c(e,["thought"],h);let m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);let g=l(t,["videoMetadata"]);return g!=null&&c(e,["videoMetadata"],g),e}function oU(t){let e={},n=l(t,["retrievalConfig"]);n!=null&&c(e,["retrievalConfig"],n);let r=l(t,["functionCallingConfig"]);return r!=null&&c(e,["functionCallingConfig"],zD(r)),e}function aU(t){let e={};if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=l(t,["computerUse"]);n!=null&&c(e,["computerUse"],n);let r=l(t,["fileSearch"]);r!=null&&c(e,["fileSearch"],r);let i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=l(t,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}let o=l(t,["googleMaps"]);o!=null&&c(e,["googleMaps"],ZD(o));let a=l(t,["googleSearch"]);a!=null&&c(e,["googleSearch"],QD(a));let d=l(t,["googleSearchRetrieval"]);d!=null&&c(e,["googleSearchRetrieval"],d);let u=l(t,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function lU(t){let e={},n=l(t,["retrieval"]);n!=null&&c(e,["retrieval"],n);let r=l(t,["computerUse"]);if(r!=null&&c(e,["computerUse"],r),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);let s=l(t,["enterpriseWebSearch"]);s!=null&&c(e,["enterpriseWebSearch"],s);let o=l(t,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(g=>KD(g))),c(e,["functionDeclarations"],m)}let a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],a);let d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let u=l(t,["googleSearchRetrieval"]);u!=null&&c(e,["googleSearchRetrieval"],u);let h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function uU(t,e){let n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=l(t,["expireTime"]);return e!==void 0&&i!=null&&c(e,["expireTime"],i),n}function cU(t,e){let n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=l(t,["expireTime"]);return e!==void 0&&i!=null&&c(e,["expireTime"],i),n}function dU(t,e){let n={},r=l(e,["name"]);r!=null&&c(n,["_url","name"],yr(t,r));let i=l(e,["config"]);return i!=null&&uU(i,n),n}function fU(t,e){let n={},r=l(e,["name"]);r!=null&&c(n,["_url","name"],yr(t,r));let i=l(e,["config"]);return i!=null&&cU(i,n),n}var Ep=class extends wn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new gr(mr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=BD(this.apiClient,e);return a=Q("cachedContents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{let u=qD(this.apiClient,e);return a=Q("cachedContents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async get(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=XD(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{let u=YD(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async delete(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=HD(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=$D(h),g=new zu;return Object.assign(g,m),g})}else{let u=GD(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=VD(h),g=new zu;return Object.assign(g,m),g})}}async update(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=fU(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>h)}else{let u=dU(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>h)}}async listInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=nU(e);return a=Q("cachedContents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=iU(h),g=new Ku;return Object.assign(g,m),g})}else{let u=tU(e);return a=Q("cachedContents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=rU(h),g=new Ku;return Object.assign(g,m),g})}}};function Qu(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function aw(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ge(t){return this instanceof ge?(this.v=t,this):new ge(t)}function Sn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(_){return function(v){return Promise.resolve(v).then(_,m)}}function a(_,v){r[_]&&(i[_]=function(w){return new Promise(function(T,A){s.push([_,w,T,A])>1||d(_,w)})},v&&(i[_]=v(i[_])))}function d(_,v){try{u(r[_](v))}catch(w){g(s[0][3],w)}}function u(_){_.value instanceof ge?Promise.resolve(_.value.v).then(h,m):g(s[0][2],_)}function h(_){d("next",_)}function m(_){d("throw",_)}function g(_,v){_(v),s.shift(),s.length&&d(s[0][0],s[0][1])}}function Tn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof aw=="function"?aw(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,d){o=t[s](o),i(a,d,o.done,o.value)})}}function i(s,o,a,d){Promise.resolve(d).then(function(u){s({value:u,done:a})},o)}}function hU(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;let n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Vw(n)}function Vw(t){if(t.parts===void 0||t.parts.length===0)return!1;for(let e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function pU(t){if(t.length!==0){for(let e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function lw(t){if(t===void 0||t.length===0)return[];let e=[],n=t.length,r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{let i=[],s=!0;for(;r<n&&t[r].role==="model";)i.push(t[r]),s&&!Vw(t[r])&&(s=!1),r++;s?e.push(...i):e.pop()}return e}var vp=class{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new Sp(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Sp=class{constructor(e,n,r,i={},s=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=i,this.history=s,this.sendPromise=Promise.resolve(),pU(s)}async sendMessage(e){var n;await this.sendPromise;let r=lt(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var s,o,a;let d=await i,u=(o=(s=d.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content,h=d.automaticFunctionCallingHistory,m=this.getHistory(!0).length,g=[];h!=null&&(g=(a=h.slice(m))!==null&&a!==void 0?a:[]);let _=u?[u]:[];this.recordHistory(r,_,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;let r=lt(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let s=await i;return this.processStreamResponse(s,r)}getHistory(e=!1){let n=e?lw(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return Sn(this,arguments,function*(){var i,s,o,a,d,u;let h=[];try{for(var m=!0,g=Tn(e),_;_=yield ge(g.next()),i=_.done,!i;m=!0){a=_.value,m=!1;let v=a;if(hU(v)){let w=(u=(d=v.candidates)===null||d===void 0?void 0:d[0])===null||u===void 0?void 0:u.content;w!==void 0&&h.push(w)}yield yield ge(v)}}catch(v){s={error:v}}finally{try{!m&&!i&&(o=g.return)&&(yield ge(o.call(g)))}finally{if(s)throw s.error}}this.recordHistory(n,h)})}recordHistory(e,n,r){let i=[];n.length>0&&n.every(s=>s.role!==void 0)?i=n:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...lw(r)):this.history.push(e),this.history.push(...i)}};var ra=class t extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,t.prototype)}};function mU(t){let e={},n=l(t,["file"]);return n!=null&&c(e,["file"],n),e}function gU(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function yU(t){let e={},n=l(t,["name"]);return n!=null&&c(e,["_url","file"],rm(n)),e}function _U(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function EU(t){let e={},n=l(t,["name"]);return n!=null&&c(e,["_url","file"],rm(n)),e}function vU(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),n}function SU(t){let e={},n=l(t,["config"]);return n!=null&&vU(n,e),e}function TU(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["files"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["files"],s)}return e}var Tp=class extends wn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new gr(mr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=SU(e);return s=Q("files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>{let u=TU(d),h=new dp;return Object.assign(h,u),h})}}async createInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=mU(e);return s=Q("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=gU(d),h=new fp;return Object.assign(h,u),h})}}async get(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=EU(e);return s=Q("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=yU(e);return s=Q("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>{let u=_U(d),h=new hp;return Object.assign(h,u),h})}}};function Lu(t){let e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function wU(t){let e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>qU(s))),c(e,["parts"],i)}let r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function CU(t){let e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function AU(t){let e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);let r=l(t,["args"]);r!=null&&c(e,["args"],r);let i=l(t,["name"]);if(i!=null&&c(e,["name"],i),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function bU(t){let e={},n=l(t,["description"]);n!=null&&c(e,["description"],n);let r=l(t,["name"]);r!=null&&c(e,["name"],r);let i=l(t,["parameters"]);i!=null&&c(e,["parameters"],i);let s=l(t,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let o=l(t,["response"]);o!=null&&c(e,["response"],o);let a=l(t,["responseJsonSchema"]);if(a!=null&&c(e,["responseJsonSchema"],a),l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function RU(t){let e={},n=l(t,["modelSelectionConfig"]);n!=null&&c(e,["modelConfig"],n);let r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);let i=l(t,["audioTimestamp"]);i!=null&&c(e,["audioTimestamp"],i);let s=l(t,["candidateCount"]);s!=null&&c(e,["candidateCount"],s);let o=l(t,["enableAffectiveDialog"]);o!=null&&c(e,["enableAffectiveDialog"],o);let a=l(t,["frequencyPenalty"]);a!=null&&c(e,["frequencyPenalty"],a);let d=l(t,["logprobs"]);d!=null&&c(e,["logprobs"],d);let u=l(t,["maxOutputTokens"]);u!=null&&c(e,["maxOutputTokens"],u);let h=l(t,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);let m=l(t,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);let g=l(t,["responseLogprobs"]);g!=null&&c(e,["responseLogprobs"],g);let _=l(t,["responseMimeType"]);_!=null&&c(e,["responseMimeType"],_);let v=l(t,["responseModalities"]);v!=null&&c(e,["responseModalities"],v);let w=l(t,["responseSchema"]);w!=null&&c(e,["responseSchema"],w);let T=l(t,["routingConfig"]);T!=null&&c(e,["routingConfig"],T);let A=l(t,["seed"]);A!=null&&c(e,["seed"],A);let G=l(t,["speechConfig"]);G!=null&&c(e,["speechConfig"],G);let F=l(t,["stopSequences"]);F!=null&&c(e,["stopSequences"],F);let B=l(t,["temperature"]);B!=null&&c(e,["temperature"],B);let H=l(t,["thinkingConfig"]);H!=null&&c(e,["thinkingConfig"],H);let q=l(t,["topK"]);q!=null&&c(e,["topK"],q);let $=l(t,["topP"]);if($!=null&&c(e,["topP"],$),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function IU(t){let e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function PU(t){let e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function xU(t,e){let n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);let i=l(t,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let s=l(t,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let o=l(t,["topP"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","topP"],o);let a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);let d=l(t,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=l(t,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],nm(m));let g=l(t,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let _=l(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=l(t,["systemInstruction"]);e!==void 0&&v!=null&&c(e,["setup","systemInstruction"],wU(lt(v)));let w=l(t,["tools"]);if(e!==void 0&&w!=null){let q=Qs(w);Array.isArray(q)&&(q=q.map($=>GU(Zs($)))),c(e,["setup","tools"],q)}let T=l(t,["sessionResumption"]);e!==void 0&&T!=null&&c(e,["setup","sessionResumption"],BU(T));let A=l(t,["inputAudioTranscription"]);e!==void 0&&A!=null&&c(e,["setup","inputAudioTranscription"],A);let G=l(t,["outputAudioTranscription"]);e!==void 0&&G!=null&&c(e,["setup","outputAudioTranscription"],G);let F=l(t,["realtimeInputConfig"]);e!==void 0&&F!=null&&c(e,["setup","realtimeInputConfig"],F);let B=l(t,["contextWindowCompression"]);e!==void 0&&B!=null&&c(e,["setup","contextWindowCompression"],B);let H=l(t,["proactivity"]);if(e!==void 0&&H!=null&&c(e,["setup","proactivity"],H),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function kU(t,e){let n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],RU(r));let i=l(t,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let s=l(t,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let o=l(t,["topP"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","topP"],o);let a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);let d=l(t,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=l(t,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],nm(m));let g=l(t,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let _=l(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=l(t,["systemInstruction"]);e!==void 0&&v!=null&&c(e,["setup","systemInstruction"],lt(v));let w=l(t,["tools"]);if(e!==void 0&&w!=null){let $=Qs(w);Array.isArray($)&&($=$.map(Y=>HU(Zs(Y)))),c(e,["setup","tools"],$)}let T=l(t,["sessionResumption"]);e!==void 0&&T!=null&&c(e,["setup","sessionResumption"],T);let A=l(t,["inputAudioTranscription"]);e!==void 0&&A!=null&&c(e,["setup","inputAudioTranscription"],A);let G=l(t,["outputAudioTranscription"]);e!==void 0&&G!=null&&c(e,["setup","outputAudioTranscription"],G);let F=l(t,["realtimeInputConfig"]);e!==void 0&&F!=null&&c(e,["setup","realtimeInputConfig"],F);let B=l(t,["contextWindowCompression"]);e!==void 0&&B!=null&&c(e,["setup","contextWindowCompression"],B);let H=l(t,["proactivity"]);e!==void 0&&H!=null&&c(e,["setup","proactivity"],H);let q=l(t,["explicitVadSignal"]);return e!==void 0&&q!=null&&c(e,["setup","explicitVadSignal"],q),n}function NU(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],ke(t,r));let i=l(e,["config"]);return i!=null&&c(n,["config"],xU(i,n)),n}function MU(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],ke(t,r));let i=l(e,["config"]);return i!=null&&c(n,["config"],kU(i,n)),n}function OU(t){let e={},n=l(t,["musicGenerationConfig"]);return n!=null&&c(e,["musicGenerationConfig"],n),e}function DU(t){let e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["weightedPrompts"],r)}return e}function UU(t){let e={},n=l(t,["media"]);if(n!=null){let u=xw(n);Array.isArray(u)&&(u=u.map(h=>Lu(h))),c(e,["mediaChunks"],u)}let r=l(t,["audio"]);r!=null&&c(e,["audio"],Lu(Nw(r)));let i=l(t,["audioStreamEnd"]);i!=null&&c(e,["audioStreamEnd"],i);let s=l(t,["video"]);s!=null&&c(e,["video"],Lu(kw(s)));let o=l(t,["text"]);o!=null&&c(e,["text"],o);let a=l(t,["activityStart"]);a!=null&&c(e,["activityStart"],a);let d=l(t,["activityEnd"]);return d!=null&&c(e,["activityEnd"],d),e}function LU(t){let e={},n=l(t,["media"]);if(n!=null){let u=xw(n);Array.isArray(u)&&(u=u.map(h=>h)),c(e,["mediaChunks"],u)}let r=l(t,["audio"]);r!=null&&c(e,["audio"],Nw(r));let i=l(t,["audioStreamEnd"]);i!=null&&c(e,["audioStreamEnd"],i);let s=l(t,["video"]);s!=null&&c(e,["video"],kw(s));let o=l(t,["text"]);o!=null&&c(e,["text"],o);let a=l(t,["activityStart"]);a!=null&&c(e,["activityStart"],a);let d=l(t,["activityEnd"]);return d!=null&&c(e,["activityEnd"],d),e}function FU(t){let e={},n=l(t,["setupComplete"]);n!=null&&c(e,["setupComplete"],n);let r=l(t,["serverContent"]);r!=null&&c(e,["serverContent"],r);let i=l(t,["toolCall"]);i!=null&&c(e,["toolCall"],i);let s=l(t,["toolCallCancellation"]);s!=null&&c(e,["toolCallCancellation"],s);let o=l(t,["usageMetadata"]);o!=null&&c(e,["usageMetadata"],VU(o));let a=l(t,["goAway"]);a!=null&&c(e,["goAway"],a);let d=l(t,["sessionResumptionUpdate"]);d!=null&&c(e,["sessionResumptionUpdate"],d);let u=l(t,["voiceActivityDetectionSignal"]);u!=null&&c(e,["voiceActivityDetectionSignal"],u);let h=l(t,["voiceActivity"]);return h!=null&&c(e,["voiceActivity"],$U(h)),e}function qU(t){let e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);let r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=l(t,["executableCode"]);i!=null&&c(e,["executableCode"],i);let s=l(t,["fileData"]);s!=null&&c(e,["fileData"],CU(s));let o=l(t,["functionCall"]);o!=null&&c(e,["functionCall"],AU(o));let a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);let d=l(t,["inlineData"]);d!=null&&c(e,["inlineData"],Lu(d));let u=l(t,["text"]);u!=null&&c(e,["text"],u);let h=l(t,["thought"]);h!=null&&c(e,["thought"],h);let m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);let g=l(t,["videoMetadata"]);return g!=null&&c(e,["videoMetadata"],g),e}function BU(t){let e={},n=l(t,["handle"]);if(n!=null&&c(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function GU(t){let e={};if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=l(t,["computerUse"]);n!=null&&c(e,["computerUse"],n);let r=l(t,["fileSearch"]);r!=null&&c(e,["fileSearch"],r);let i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=l(t,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}let o=l(t,["googleMaps"]);o!=null&&c(e,["googleMaps"],IU(o));let a=l(t,["googleSearch"]);a!=null&&c(e,["googleSearch"],PU(a));let d=l(t,["googleSearchRetrieval"]);d!=null&&c(e,["googleSearchRetrieval"],d);let u=l(t,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function HU(t){let e={},n=l(t,["retrieval"]);n!=null&&c(e,["retrieval"],n);let r=l(t,["computerUse"]);if(r!=null&&c(e,["computerUse"],r),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);let s=l(t,["enterpriseWebSearch"]);s!=null&&c(e,["enterpriseWebSearch"],s);let o=l(t,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(g=>bU(g))),c(e,["functionDeclarations"],m)}let a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],a);let d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let u=l(t,["googleSearchRetrieval"]);u!=null&&c(e,["googleSearchRetrieval"],u);let h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function VU(t){let e={},n=l(t,["promptTokenCount"]);n!=null&&c(e,["promptTokenCount"],n);let r=l(t,["cachedContentTokenCount"]);r!=null&&c(e,["cachedContentTokenCount"],r);let i=l(t,["candidatesTokenCount"]);i!=null&&c(e,["responseTokenCount"],i);let s=l(t,["toolUsePromptTokenCount"]);s!=null&&c(e,["toolUsePromptTokenCount"],s);let o=l(t,["thoughtsTokenCount"]);o!=null&&c(e,["thoughtsTokenCount"],o);let a=l(t,["totalTokenCount"]);a!=null&&c(e,["totalTokenCount"],a);let d=l(t,["promptTokensDetails"]);if(d!=null){let _=d;Array.isArray(_)&&(_=_.map(v=>v)),c(e,["promptTokensDetails"],_)}let u=l(t,["cacheTokensDetails"]);if(u!=null){let _=u;Array.isArray(_)&&(_=_.map(v=>v)),c(e,["cacheTokensDetails"],_)}let h=l(t,["candidatesTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(v=>v)),c(e,["responseTokensDetails"],_)}let m=l(t,["toolUsePromptTokensDetails"]);if(m!=null){let _=m;Array.isArray(_)&&(_=_.map(v=>v)),c(e,["toolUsePromptTokensDetails"],_)}let g=l(t,["trafficType"]);return g!=null&&c(e,["trafficType"],g),e}function $U(t){let e={},n=l(t,["type"]);return n!=null&&c(e,["voiceActivityType"],n),e}function WU(t){let e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function JU(t){let e={},n=l(t,["content"]);n!=null&&c(e,["content"],n);let r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],zU(r));let i=l(t,["tokenCount"]);i!=null&&c(e,["tokenCount"],i);let s=l(t,["finishReason"]);s!=null&&c(e,["finishReason"],s);let o=l(t,["avgLogprobs"]);o!=null&&c(e,["avgLogprobs"],o);let a=l(t,["groundingMetadata"]);a!=null&&c(e,["groundingMetadata"],a);let d=l(t,["index"]);d!=null&&c(e,["index"],d);let u=l(t,["logprobsResult"]);u!=null&&c(e,["logprobsResult"],u);let h=l(t,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>_)),c(e,["safetyRatings"],g)}let m=l(t,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function zU(t){let e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["citations"],r)}return e}function KU(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let s=sn(i);Array.isArray(s)&&(s=s.map(o=>o)),c(n,["contents"],s)}return n}function YU(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["tokensInfo"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["tokensInfo"],i)}return e}function XU(t){let e={},n=l(t,["values"]);n!=null&&c(e,["values"],n);let r=l(t,["statistics"]);return r!=null&&c(e,["statistics"],ZU(r)),e}function ZU(t){let e={},n=l(t,["truncated"]);n!=null&&c(e,["truncated"],n);let r=l(t,["token_count"]);return r!=null&&c(e,["tokenCount"],r),e}function mc(t){let e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>o1(s))),c(e,["parts"],i)}let r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function QU(t){let e={},n=l(t,["controlType"]);n!=null&&c(e,["controlType"],n);let r=l(t,["enableControlImageComputation"]);return r!=null&&c(e,["computeControl"],r),e}function jU(t){let e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function eL(t,e){let n={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&c(e,["systemInstruction"],lt(r));let i=l(t,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>zw(a))),c(e,["tools"],o)}let s=l(t,["generationConfig"]);return e!==void 0&&s!=null&&c(e,["generationConfig"],WL(s)),n}function tL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let o=sn(i);Array.isArray(o)&&(o=o.map(a=>mc(a))),c(n,["contents"],o)}let s=l(e,["config"]);return s!=null&&jU(s),n}function nL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let o=sn(i);Array.isArray(o)&&(o=o.map(a=>a)),c(n,["contents"],o)}let s=l(e,["config"]);return s!=null&&eL(s,n),n}function rL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["totalTokens"]);r!=null&&c(e,["totalTokens"],r);let i=l(t,["cachedContentTokenCount"]);return i!=null&&c(e,["cachedContentTokenCount"],i),e}function iL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["totalTokens"]);return r!=null&&c(e,["totalTokens"],r),e}function sL(t,e){let n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],ke(t,r)),n}function oL(t,e){let n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],ke(t,r)),n}function aL(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function lL(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function uL(t,e){let n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=l(t,["negativePrompt"]);e!==void 0&&i!=null&&c(e,["parameters","negativePrompt"],i);let s=l(t,["numberOfImages"]);e!==void 0&&s!=null&&c(e,["parameters","sampleCount"],s);let o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);let a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&c(e,["parameters","guidanceScale"],a);let d=l(t,["seed"]);e!==void 0&&d!=null&&c(e,["parameters","seed"],d);let u=l(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&c(e,["parameters","safetySetting"],u);let h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);let g=l(t,["includeRaiReason"]);e!==void 0&&g!=null&&c(e,["parameters","includeRaiReason"],g);let _=l(t,["language"]);e!==void 0&&_!=null&&c(e,["parameters","language"],_);let v=l(t,["outputMimeType"]);e!==void 0&&v!=null&&c(e,["parameters","outputOptions","mimeType"],v);let w=l(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&c(e,["parameters","outputOptions","compressionQuality"],w);let T=l(t,["addWatermark"]);e!==void 0&&T!=null&&c(e,["parameters","addWatermark"],T);let A=l(t,["labels"]);e!==void 0&&A!=null&&c(e,["labels"],A);let G=l(t,["editMode"]);e!==void 0&&G!=null&&c(e,["parameters","editMode"],G);let F=l(t,["baseSteps"]);return e!==void 0&&F!=null&&c(e,["parameters","editConfig","baseSteps"],F),n}function cL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["prompt"]);i!=null&&c(n,["instances[0]","prompt"],i);let s=l(e,["referenceImages"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(d=>f1(d))),c(n,["instances[0]","referenceImages"],a)}let o=l(e,["config"]);return o!=null&&uL(o,n),n}function dL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>gc(s))),c(e,["generatedImages"],i)}return e}function fL(t,e){let n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);let i=l(t,["title"]);e!==void 0&&i!=null&&c(e,["requests[]","title"],i);let s=l(t,["outputDimensionality"]);if(e!==void 0&&s!=null&&c(e,["requests[]","outputDimensionality"],s),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function hL(t,e){let n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["instances[]","task_type"],r);let i=l(t,["title"]);e!==void 0&&i!=null&&c(e,["instances[]","title"],i);let s=l(t,["outputDimensionality"]);e!==void 0&&s!=null&&c(e,["parameters","outputDimensionality"],s);let o=l(t,["mimeType"]);e!==void 0&&o!=null&&c(e,["instances[]","mimeType"],o);let a=l(t,["autoTruncate"]);return e!==void 0&&a!=null&&c(e,["parameters","autoTruncate"],a),n}function pL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let a=jp(t,i);Array.isArray(a)&&(a=a.map(d=>d)),c(n,["requests[]","content"],a)}let s=l(e,["config"]);s!=null&&fL(s,n);let o=l(e,["model"]);return o!==void 0&&c(n,["requests[]","model"],ke(t,o)),n}function mL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let o=jp(t,i);Array.isArray(o)&&(o=o.map(a=>a)),c(n,["instances[]","content"],o)}let s=l(e,["config"]);return s!=null&&hL(s,n),n}function gL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["embeddings"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["embeddings"],s)}let i=l(t,["metadata"]);return i!=null&&c(e,["metadata"],i),e}function yL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["predictions[]","embeddings"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>XU(o))),c(e,["embeddings"],s)}let i=l(t,["metadata"]);return i!=null&&c(e,["metadata"],i),e}function _L(t){let e={},n=l(t,["endpoint"]);n!=null&&c(e,["name"],n);let r=l(t,["deployedModelId"]);return r!=null&&c(e,["deployedModelId"],r),e}function EL(t){let e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function vL(t){let e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);let r=l(t,["args"]);r!=null&&c(e,["args"],r);let i=l(t,["name"]);if(i!=null&&c(e,["name"],i),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function SL(t){let e={},n=l(t,["allowedFunctionNames"]);n!=null&&c(e,["allowedFunctionNames"],n);let r=l(t,["mode"]);if(r!=null&&c(e,["mode"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function TL(t){let e={},n=l(t,["description"]);n!=null&&c(e,["description"],n);let r=l(t,["name"]);r!=null&&c(e,["name"],r);let i=l(t,["parameters"]);i!=null&&c(e,["parameters"],i);let s=l(t,["parametersJsonSchema"]);s!=null&&c(e,["parametersJsonSchema"],s);let o=l(t,["response"]);o!=null&&c(e,["response"],o);let a=l(t,["responseJsonSchema"]);if(a!=null&&c(e,["responseJsonSchema"],a),l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function wL(t,e,n){let r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&c(n,["systemInstruction"],mc(lt(i)));let s=l(e,["temperature"]);s!=null&&c(r,["temperature"],s);let o=l(e,["topP"]);o!=null&&c(r,["topP"],o);let a=l(e,["topK"]);a!=null&&c(r,["topK"],a);let d=l(e,["candidateCount"]);d!=null&&c(r,["candidateCount"],d);let u=l(e,["maxOutputTokens"]);u!=null&&c(r,["maxOutputTokens"],u);let h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=l(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let _=l(e,["presencePenalty"]);_!=null&&c(r,["presencePenalty"],_);let v=l(e,["frequencyPenalty"]);v!=null&&c(r,["frequencyPenalty"],v);let w=l(e,["seed"]);w!=null&&c(r,["seed"],w);let T=l(e,["responseMimeType"]);T!=null&&c(r,["responseMimeType"],T);let A=l(e,["responseSchema"]);A!=null&&c(r,["responseSchema"],em(A));let G=l(e,["responseJsonSchema"]);if(G!=null&&c(r,["responseJsonSchema"],G),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let F=l(e,["safetySettings"]);if(n!==void 0&&F!=null){let le=F;Array.isArray(le)&&(le=le.map(ve=>h1(ve))),c(n,["safetySettings"],le)}let B=l(e,["tools"]);if(n!==void 0&&B!=null){let le=Qs(B);Array.isArray(le)&&(le=le.map(ve=>v1(Zs(ve)))),c(n,["tools"],le)}let H=l(e,["toolConfig"]);if(n!==void 0&&H!=null&&c(n,["toolConfig"],E1(H)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let q=l(e,["cachedContent"]);n!==void 0&&q!=null&&c(n,["cachedContent"],yr(t,q));let $=l(e,["responseModalities"]);$!=null&&c(r,["responseModalities"],$);let Y=l(e,["mediaResolution"]);Y!=null&&c(r,["mediaResolution"],Y);let L=l(e,["speechConfig"]);if(L!=null&&c(r,["speechConfig"],tm(L)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let te=l(e,["thinkingConfig"]);te!=null&&c(r,["thinkingConfig"],te);let oe=l(e,["imageConfig"]);oe!=null&&c(r,["imageConfig"],XL(oe));let fe=l(e,["enableEnhancedCivicAnswers"]);if(fe!=null&&c(r,["enableEnhancedCivicAnswers"],fe),l(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function CL(t,e,n){let r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&c(n,["systemInstruction"],lt(i));let s=l(e,["temperature"]);s!=null&&c(r,["temperature"],s);let o=l(e,["topP"]);o!=null&&c(r,["topP"],o);let a=l(e,["topK"]);a!=null&&c(r,["topK"],a);let d=l(e,["candidateCount"]);d!=null&&c(r,["candidateCount"],d);let u=l(e,["maxOutputTokens"]);u!=null&&c(r,["maxOutputTokens"],u);let h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=l(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let _=l(e,["presencePenalty"]);_!=null&&c(r,["presencePenalty"],_);let v=l(e,["frequencyPenalty"]);v!=null&&c(r,["frequencyPenalty"],v);let w=l(e,["seed"]);w!=null&&c(r,["seed"],w);let T=l(e,["responseMimeType"]);T!=null&&c(r,["responseMimeType"],T);let A=l(e,["responseSchema"]);A!=null&&c(r,["responseSchema"],em(A));let G=l(e,["responseJsonSchema"]);G!=null&&c(r,["responseJsonSchema"],G);let F=l(e,["routingConfig"]);F!=null&&c(r,["routingConfig"],F);let B=l(e,["modelSelectionConfig"]);B!=null&&c(r,["modelConfig"],B);let H=l(e,["safetySettings"]);if(n!==void 0&&H!=null){let Pe=H;Array.isArray(Pe)&&(Pe=Pe.map(et=>et)),c(n,["safetySettings"],Pe)}let q=l(e,["tools"]);if(n!==void 0&&q!=null){let Pe=Qs(q);Array.isArray(Pe)&&(Pe=Pe.map(et=>zw(Zs(et)))),c(n,["tools"],Pe)}let $=l(e,["toolConfig"]);n!==void 0&&$!=null&&c(n,["toolConfig"],$);let Y=l(e,["labels"]);n!==void 0&&Y!=null&&c(n,["labels"],Y);let L=l(e,["cachedContent"]);n!==void 0&&L!=null&&c(n,["cachedContent"],yr(t,L));let te=l(e,["responseModalities"]);te!=null&&c(r,["responseModalities"],te);let oe=l(e,["mediaResolution"]);oe!=null&&c(r,["mediaResolution"],oe);let fe=l(e,["speechConfig"]);fe!=null&&c(r,["speechConfig"],tm(fe));let le=l(e,["audioTimestamp"]);le!=null&&c(r,["audioTimestamp"],le);let ve=l(e,["thinkingConfig"]);ve!=null&&c(r,["thinkingConfig"],ve);let Me=l(e,["imageConfig"]);if(Me!=null&&c(r,["imageConfig"],ZL(Me)),l(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let Oe=l(e,["modelArmorConfig"]);return n!==void 0&&Oe!=null&&c(n,["modelArmorConfig"],Oe),r}function uw(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let o=sn(i);Array.isArray(o)&&(o=o.map(a=>mc(a))),c(n,["contents"],o)}let s=l(e,["config"]);return s!=null&&c(n,["generationConfig"],wL(t,s,n)),n}function cw(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["contents"]);if(i!=null){let o=sn(i);Array.isArray(o)&&(o=o.map(a=>a)),c(n,["contents"],o)}let s=l(e,["config"]);return s!=null&&c(n,["generationConfig"],CL(t,s,n)),n}function dw(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(u=>JU(u))),c(e,["candidates"],d)}let i=l(t,["modelVersion"]);i!=null&&c(e,["modelVersion"],i);let s=l(t,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);let o=l(t,["responseId"]);o!=null&&c(e,["responseId"],o);let a=l(t,["usageMetadata"]);return a!=null&&c(e,["usageMetadata"],a),e}function fw(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(h=>h)),c(e,["candidates"],u)}let i=l(t,["createTime"]);i!=null&&c(e,["createTime"],i);let s=l(t,["modelVersion"]);s!=null&&c(e,["modelVersion"],s);let o=l(t,["promptFeedback"]);o!=null&&c(e,["promptFeedback"],o);let a=l(t,["responseId"]);a!=null&&c(e,["responseId"],a);let d=l(t,["usageMetadata"]);return d!=null&&c(e,["usageMetadata"],d),e}function AL(t,e){let n={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&c(e,["parameters","aspectRatio"],i);let s=l(t,["guidanceScale"]);if(e!==void 0&&s!=null&&c(e,["parameters","guidanceScale"],s),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=l(t,["safetyFilterLevel"]);e!==void 0&&o!=null&&c(e,["parameters","safetySetting"],o);let a=l(t,["personGeneration"]);e!==void 0&&a!=null&&c(e,["parameters","personGeneration"],a);let d=l(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&c(e,["parameters","includeSafetyAttributes"],d);let u=l(t,["includeRaiReason"]);e!==void 0&&u!=null&&c(e,["parameters","includeRaiReason"],u);let h=l(t,["language"]);e!==void 0&&h!=null&&c(e,["parameters","language"],h);let m=l(t,["outputMimeType"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","mimeType"],m);let g=l(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&c(e,["parameters","outputOptions","compressionQuality"],g),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let _=l(t,["imageSize"]);if(e!==void 0&&_!=null&&c(e,["parameters","sampleImageSize"],_),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function bL(t,e){let n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=l(t,["negativePrompt"]);e!==void 0&&i!=null&&c(e,["parameters","negativePrompt"],i);let s=l(t,["numberOfImages"]);e!==void 0&&s!=null&&c(e,["parameters","sampleCount"],s);let o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);let a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&c(e,["parameters","guidanceScale"],a);let d=l(t,["seed"]);e!==void 0&&d!=null&&c(e,["parameters","seed"],d);let u=l(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&c(e,["parameters","safetySetting"],u);let h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);let g=l(t,["includeRaiReason"]);e!==void 0&&g!=null&&c(e,["parameters","includeRaiReason"],g);let _=l(t,["language"]);e!==void 0&&_!=null&&c(e,["parameters","language"],_);let v=l(t,["outputMimeType"]);e!==void 0&&v!=null&&c(e,["parameters","outputOptions","mimeType"],v);let w=l(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&c(e,["parameters","outputOptions","compressionQuality"],w);let T=l(t,["addWatermark"]);e!==void 0&&T!=null&&c(e,["parameters","addWatermark"],T);let A=l(t,["labels"]);e!==void 0&&A!=null&&c(e,["labels"],A);let G=l(t,["imageSize"]);e!==void 0&&G!=null&&c(e,["parameters","sampleImageSize"],G);let F=l(t,["enhancePrompt"]);return e!==void 0&&F!=null&&c(e,["parameters","enhancePrompt"],F),n}function RL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["prompt"]);i!=null&&c(n,["instances[0]","prompt"],i);let s=l(e,["config"]);return s!=null&&AL(s,n),n}function IL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["prompt"]);i!=null&&c(n,["instances[0]","prompt"],i);let s=l(e,["config"]);return s!=null&&bL(s,n),n}function PL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["predictions"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>GL(o))),c(e,["generatedImages"],s)}let i=l(t,["positivePromptSafetyAttributes"]);return i!=null&&c(e,["positivePromptSafetyAttributes"],Ww(i)),e}function xL(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["predictions"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>gc(o))),c(e,["generatedImages"],s)}let i=l(t,["positivePromptSafetyAttributes"]);return i!=null&&c(e,["positivePromptSafetyAttributes"],Jw(i)),e}function kL(t,e){let n={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=l(t,["durationSeconds"]);if(e!==void 0&&i!=null&&c(e,["parameters","durationSeconds"],i),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);let o=l(t,["resolution"]);e!==void 0&&o!=null&&c(e,["parameters","resolution"],o);let a=l(t,["personGeneration"]);if(e!==void 0&&a!=null&&c(e,["parameters","personGeneration"],a),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let d=l(t,["negativePrompt"]);e!==void 0&&d!=null&&c(e,["parameters","negativePrompt"],d);let u=l(t,["enhancePrompt"]);if(e!==void 0&&u!=null&&c(e,["parameters","enhancePrompt"],u),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let h=l(t,["lastFrame"]);e!==void 0&&h!=null&&c(e,["instances[0]","lastFrame"],yc(h));let m=l(t,["referenceImages"]);if(e!==void 0&&m!=null){let g=m;Array.isArray(g)&&(g=g.map(_=>M1(_))),c(e,["instances[0]","referenceImages"],g)}if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function NL(t,e){let n={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=l(t,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);let s=l(t,["fps"]);e!==void 0&&s!=null&&c(e,["parameters","fps"],s);let o=l(t,["durationSeconds"]);e!==void 0&&o!=null&&c(e,["parameters","durationSeconds"],o);let a=l(t,["seed"]);e!==void 0&&a!=null&&c(e,["parameters","seed"],a);let d=l(t,["aspectRatio"]);e!==void 0&&d!=null&&c(e,["parameters","aspectRatio"],d);let u=l(t,["resolution"]);e!==void 0&&u!=null&&c(e,["parameters","resolution"],u);let h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=l(t,["pubsubTopic"]);e!==void 0&&m!=null&&c(e,["parameters","pubsubTopic"],m);let g=l(t,["negativePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","negativePrompt"],g);let _=l(t,["enhancePrompt"]);e!==void 0&&_!=null&&c(e,["parameters","enhancePrompt"],_);let v=l(t,["generateAudio"]);e!==void 0&&v!=null&&c(e,["parameters","generateAudio"],v);let w=l(t,["lastFrame"]);e!==void 0&&w!=null&&c(e,["instances[0]","lastFrame"],Cn(w));let T=l(t,["referenceImages"]);if(e!==void 0&&T!=null){let F=T;Array.isArray(F)&&(F=F.map(B=>O1(B))),c(e,["instances[0]","referenceImages"],F)}let A=l(t,["mask"]);e!==void 0&&A!=null&&c(e,["instances[0]","mask"],N1(A));let G=l(t,["compressionQuality"]);return e!==void 0&&G!=null&&c(e,["parameters","compressionQuality"],G),n}function ML(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response","generateVideoResponse"]);return o!=null&&c(e,["response"],LL(o)),e}function OL(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response"]);return o!=null&&c(e,["response"],FL(o)),e}function DL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["prompt"]);i!=null&&c(n,["instances[0]","prompt"],i);let s=l(e,["image"]);s!=null&&c(n,["instances[0]","image"],yc(s));let o=l(e,["video"]);o!=null&&c(n,["instances[0]","video"],Kw(o));let a=l(e,["source"]);a!=null&&qL(a,n);let d=l(e,["config"]);return d!=null&&kL(d,n),n}function UL(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["prompt"]);i!=null&&c(n,["instances[0]","prompt"],i);let s=l(e,["image"]);s!=null&&c(n,["instances[0]","image"],Cn(s));let o=l(e,["video"]);o!=null&&c(n,["instances[0]","video"],Yw(o));let a=l(e,["source"]);a!=null&&BL(a,n);let d=l(e,["config"]);return d!=null&&NL(d,n),n}function LL(t){let e={},n=l(t,["generatedSamples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>VL(o))),c(e,["generatedVideos"],s)}let r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=l(t,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function FL(t){let e={},n=l(t,["videos"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>$L(o))),c(e,["generatedVideos"],s)}let r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=l(t,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function qL(t,e){let n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=l(t,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],yc(i));let s=l(t,["video"]);return e!==void 0&&s!=null&&c(e,["instances[0]","video"],Kw(s)),n}function BL(t,e){let n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=l(t,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],Cn(i));let s=l(t,["video"]);return e!==void 0&&s!=null&&c(e,["instances[0]","video"],Yw(s)),n}function GL(t){let e={},n=l(t,["_self"]);n!=null&&c(e,["image"],QL(n));let r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);let i=l(t,["_self"]);return i!=null&&c(e,["safetyAttributes"],Ww(i)),e}function gc(t){let e={},n=l(t,["_self"]);n!=null&&c(e,["image"],$w(n));let r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);let i=l(t,["_self"]);i!=null&&c(e,["safetyAttributes"],Jw(i));let s=l(t,["prompt"]);return s!=null&&c(e,["enhancedPrompt"],s),e}function HL(t){let e={},n=l(t,["_self"]);n!=null&&c(e,["mask"],$w(n));let r=l(t,["labels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["labels"],i)}return e}function VL(t){let e={},n=l(t,["video"]);return n!=null&&c(e,["video"],x1(n)),e}function $L(t){let e={},n=l(t,["_self"]);return n!=null&&c(e,["video"],k1(n)),e}function WL(t){let e={},n=l(t,["modelSelectionConfig"]);n!=null&&c(e,["modelConfig"],n);let r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);let i=l(t,["audioTimestamp"]);i!=null&&c(e,["audioTimestamp"],i);let s=l(t,["candidateCount"]);s!=null&&c(e,["candidateCount"],s);let o=l(t,["enableAffectiveDialog"]);o!=null&&c(e,["enableAffectiveDialog"],o);let a=l(t,["frequencyPenalty"]);a!=null&&c(e,["frequencyPenalty"],a);let d=l(t,["logprobs"]);d!=null&&c(e,["logprobs"],d);let u=l(t,["maxOutputTokens"]);u!=null&&c(e,["maxOutputTokens"],u);let h=l(t,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);let m=l(t,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);let g=l(t,["responseLogprobs"]);g!=null&&c(e,["responseLogprobs"],g);let _=l(t,["responseMimeType"]);_!=null&&c(e,["responseMimeType"],_);let v=l(t,["responseModalities"]);v!=null&&c(e,["responseModalities"],v);let w=l(t,["responseSchema"]);w!=null&&c(e,["responseSchema"],w);let T=l(t,["routingConfig"]);T!=null&&c(e,["routingConfig"],T);let A=l(t,["seed"]);A!=null&&c(e,["seed"],A);let G=l(t,["speechConfig"]);G!=null&&c(e,["speechConfig"],G);let F=l(t,["stopSequences"]);F!=null&&c(e,["stopSequences"],F);let B=l(t,["temperature"]);B!=null&&c(e,["temperature"],B);let H=l(t,["thinkingConfig"]);H!=null&&c(e,["thinkingConfig"],H);let q=l(t,["topK"]);q!=null&&c(e,["topK"],q);let $=l(t,["topP"]);if($!=null&&c(e,["topP"],$),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function JL(t,e){let n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],ke(t,r)),n}function zL(t,e){let n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],ke(t,r)),n}function KL(t){let e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function YL(t){let e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function XL(t){let e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);let r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function ZL(t){let e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);let r=l(t,["imageSize"]);r!=null&&c(e,["imageSize"],r);let i=l(t,["personGeneration"]);i!=null&&c(e,["personGeneration"],i);let s=l(t,["outputMimeType"]);s!=null&&c(e,["imageOutputOptions","mimeType"],s);let o=l(t,["outputCompressionQuality"]);return o!=null&&c(e,["imageOutputOptions","compressionQuality"],o),e}function QL(t){let e={},n=l(t,["bytesBase64Encoded"]);n!=null&&c(e,["imageBytes"],$r(n));let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function $w(t){let e={},n=l(t,["gcsUri"]);n!=null&&c(e,["gcsUri"],n);let r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["imageBytes"],$r(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function yc(t){let e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let n=l(t,["imageBytes"]);n!=null&&c(e,["bytesBase64Encoded"],$r(n));let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Cn(t){let e={},n=l(t,["gcsUri"]);n!=null&&c(e,["gcsUri"],n);let r=l(t,["imageBytes"]);r!=null&&c(e,["bytesBase64Encoded"],$r(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function jL(t,e,n){let r={},i=l(e,["pageSize"]);n!==void 0&&i!=null&&c(n,["_query","pageSize"],i);let s=l(e,["pageToken"]);n!==void 0&&s!=null&&c(n,["_query","pageToken"],s);let o=l(e,["filter"]);n!==void 0&&o!=null&&c(n,["_query","filter"],o);let a=l(e,["queryBase"]);return n!==void 0&&a!=null&&c(n,["_url","models_url"],Lw(t,a)),r}function e1(t,e,n){let r={},i=l(e,["pageSize"]);n!==void 0&&i!=null&&c(n,["_query","pageSize"],i);let s=l(e,["pageToken"]);n!==void 0&&s!=null&&c(n,["_query","pageToken"],s);let o=l(e,["filter"]);n!==void 0&&o!=null&&c(n,["_query","filter"],o);let a=l(e,["queryBase"]);return n!==void 0&&a!=null&&c(n,["_url","models_url"],Lw(t,a)),r}function t1(t,e){let n={},r=l(e,["config"]);return r!=null&&jL(t,r,n),n}function n1(t,e){let n={},r=l(e,["config"]);return r!=null&&e1(t,r,n),n}function r1(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["_self"]);if(i!=null){let s=Fw(i);Array.isArray(s)&&(s=s.map(o=>wp(o))),c(e,["models"],s)}return e}function i1(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["_self"]);if(i!=null){let s=Fw(i);Array.isArray(s)&&(s=s.map(o=>Cp(o))),c(e,["models"],s)}return e}function s1(t){let e={},n=l(t,["maskMode"]);n!=null&&c(e,["maskMode"],n);let r=l(t,["segmentationClasses"]);r!=null&&c(e,["maskClasses"],r);let i=l(t,["maskDilation"]);return i!=null&&c(e,["dilation"],i),e}function wp(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);let i=l(t,["description"]);i!=null&&c(e,["description"],i);let s=l(t,["version"]);s!=null&&c(e,["version"],s);let o=l(t,["_self"]);o!=null&&c(e,["tunedModelInfo"],S1(o));let a=l(t,["inputTokenLimit"]);a!=null&&c(e,["inputTokenLimit"],a);let d=l(t,["outputTokenLimit"]);d!=null&&c(e,["outputTokenLimit"],d);let u=l(t,["supportedGenerationMethods"]);u!=null&&c(e,["supportedActions"],u);let h=l(t,["temperature"]);h!=null&&c(e,["temperature"],h);let m=l(t,["maxTemperature"]);m!=null&&c(e,["maxTemperature"],m);let g=l(t,["topP"]);g!=null&&c(e,["topP"],g);let _=l(t,["topK"]);_!=null&&c(e,["topK"],_);let v=l(t,["thinking"]);return v!=null&&c(e,["thinking"],v),e}function Cp(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);let i=l(t,["description"]);i!=null&&c(e,["description"],i);let s=l(t,["versionId"]);s!=null&&c(e,["version"],s);let o=l(t,["deployedModels"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(g=>_L(g))),c(e,["endpoints"],m)}let a=l(t,["labels"]);a!=null&&c(e,["labels"],a);let d=l(t,["_self"]);d!=null&&c(e,["tunedModelInfo"],T1(d));let u=l(t,["defaultCheckpointId"]);u!=null&&c(e,["defaultCheckpointId"],u);let h=l(t,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),c(e,["checkpoints"],m)}return e}function o1(t){let e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);let r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=l(t,["executableCode"]);i!=null&&c(e,["executableCode"],i);let s=l(t,["fileData"]);s!=null&&c(e,["fileData"],EL(s));let o=l(t,["functionCall"]);o!=null&&c(e,["functionCall"],vL(o));let a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);let d=l(t,["inlineData"]);d!=null&&c(e,["inlineData"],WU(d));let u=l(t,["text"]);u!=null&&c(e,["text"],u);let h=l(t,["thought"]);h!=null&&c(e,["thought"],h);let m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);let g=l(t,["videoMetadata"]);return g!=null&&c(e,["videoMetadata"],g),e}function a1(t){let e={},n=l(t,["productImage"]);return n!=null&&c(e,["image"],Cn(n)),e}function l1(t,e){let n={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=l(t,["baseSteps"]);e!==void 0&&i!=null&&c(e,["parameters","baseSteps"],i);let s=l(t,["outputGcsUri"]);e!==void 0&&s!=null&&c(e,["parameters","storageUri"],s);let o=l(t,["seed"]);e!==void 0&&o!=null&&c(e,["parameters","seed"],o);let a=l(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&c(e,["parameters","safetySetting"],a);let d=l(t,["personGeneration"]);e!==void 0&&d!=null&&c(e,["parameters","personGeneration"],d);let u=l(t,["addWatermark"]);e!==void 0&&u!=null&&c(e,["parameters","addWatermark"],u);let h=l(t,["outputMimeType"]);e!==void 0&&h!=null&&c(e,["parameters","outputOptions","mimeType"],h);let m=l(t,["outputCompressionQuality"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","compressionQuality"],m);let g=l(t,["enhancePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","enhancePrompt"],g);let _=l(t,["labels"]);return e!==void 0&&_!=null&&c(e,["labels"],_),n}function u1(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["source"]);i!=null&&d1(i,n);let s=l(e,["config"]);return s!=null&&l1(s,n),n}function c1(t){let e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>gc(i))),c(e,["generatedImages"],r)}return e}function d1(t,e){let n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=l(t,["personImage"]);e!==void 0&&i!=null&&c(e,["instances[0]","personImage","image"],Cn(i));let s=l(t,["productImages"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>a1(a))),c(e,["instances[0]","productImages"],o)}return n}function f1(t){let e={},n=l(t,["referenceImage"]);n!=null&&c(e,["referenceImage"],Cn(n));let r=l(t,["referenceId"]);r!=null&&c(e,["referenceId"],r);let i=l(t,["referenceType"]);i!=null&&c(e,["referenceType"],i);let s=l(t,["maskImageConfig"]);s!=null&&c(e,["maskImageConfig"],s1(s));let o=l(t,["controlImageConfig"]);o!=null&&c(e,["controlImageConfig"],QU(o));let a=l(t,["styleImageConfig"]);a!=null&&c(e,["styleImageConfig"],a);let d=l(t,["subjectImageConfig"]);return d!=null&&c(e,["subjectImageConfig"],d),e}function Ww(t){let e={},n=l(t,["safetyAttributes","categories"]);n!=null&&c(e,["categories"],n);let r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);let i=l(t,["contentType"]);return i!=null&&c(e,["contentType"],i),e}function Jw(t){let e={},n=l(t,["safetyAttributes","categories"]);n!=null&&c(e,["categories"],n);let r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);let i=l(t,["contentType"]);return i!=null&&c(e,["contentType"],i),e}function h1(t){let e={},n=l(t,["category"]);if(n!=null&&c(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function p1(t){let e={},n=l(t,["image"]);return n!=null&&c(e,["image"],Cn(n)),e}function m1(t,e){let n={},r=l(t,["mode"]);e!==void 0&&r!=null&&c(e,["parameters","mode"],r);let i=l(t,["maxPredictions"]);e!==void 0&&i!=null&&c(e,["parameters","maxPredictions"],i);let s=l(t,["confidenceThreshold"]);e!==void 0&&s!=null&&c(e,["parameters","confidenceThreshold"],s);let o=l(t,["maskDilation"]);e!==void 0&&o!=null&&c(e,["parameters","maskDilation"],o);let a=l(t,["binaryColorThreshold"]);e!==void 0&&a!=null&&c(e,["parameters","binaryColorThreshold"],a);let d=l(t,["labels"]);return e!==void 0&&d!=null&&c(e,["labels"],d),n}function g1(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["source"]);i!=null&&_1(i,n);let s=l(e,["config"]);return s!=null&&m1(s,n),n}function y1(t){let e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>HL(i))),c(e,["generatedMasks"],r)}return e}function _1(t,e){let n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=l(t,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],Cn(i));let s=l(t,["scribbleImage"]);return e!==void 0&&s!=null&&c(e,["instances[0]","scribble"],p1(s)),n}function E1(t){let e={},n=l(t,["retrievalConfig"]);n!=null&&c(e,["retrievalConfig"],n);let r=l(t,["functionCallingConfig"]);return r!=null&&c(e,["functionCallingConfig"],SL(r)),e}function v1(t){let e={};if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=l(t,["computerUse"]);n!=null&&c(e,["computerUse"],n);let r=l(t,["fileSearch"]);r!=null&&c(e,["fileSearch"],r);let i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=l(t,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}let o=l(t,["googleMaps"]);o!=null&&c(e,["googleMaps"],KL(o));let a=l(t,["googleSearch"]);a!=null&&c(e,["googleSearch"],YL(a));let d=l(t,["googleSearchRetrieval"]);d!=null&&c(e,["googleSearchRetrieval"],d);let u=l(t,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function zw(t){let e={},n=l(t,["retrieval"]);n!=null&&c(e,["retrieval"],n);let r=l(t,["computerUse"]);if(r!=null&&c(e,["computerUse"],r),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);let s=l(t,["enterpriseWebSearch"]);s!=null&&c(e,["enterpriseWebSearch"],s);let o=l(t,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(g=>TL(g))),c(e,["functionDeclarations"],m)}let a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],a);let d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let u=l(t,["googleSearchRetrieval"]);u!=null&&c(e,["googleSearchRetrieval"],u);let h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function S1(t){let e={},n=l(t,["baseModel"]);n!=null&&c(e,["baseModel"],n);let r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);let i=l(t,["updateTime"]);return i!=null&&c(e,["updateTime"],i),e}function T1(t){let e={},n=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&c(e,["baseModel"],n);let r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);let i=l(t,["updateTime"]);return i!=null&&c(e,["updateTime"],i),e}function w1(t,e){let n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=l(t,["description"]);e!==void 0&&i!=null&&c(e,["description"],i);let s=l(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&c(e,["defaultCheckpointId"],s),n}function C1(t,e){let n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=l(t,["description"]);e!==void 0&&i!=null&&c(e,["description"],i);let s=l(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&c(e,["defaultCheckpointId"],s),n}function A1(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","name"],ke(t,r));let i=l(e,["config"]);return i!=null&&w1(i,n),n}function b1(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["config"]);return i!=null&&C1(i,n),n}function R1(t,e){let n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=l(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&c(e,["parameters","safetySetting"],i);let s=l(t,["personGeneration"]);e!==void 0&&s!=null&&c(e,["parameters","personGeneration"],s);let o=l(t,["includeRaiReason"]);e!==void 0&&o!=null&&c(e,["parameters","includeRaiReason"],o);let a=l(t,["outputMimeType"]);e!==void 0&&a!=null&&c(e,["parameters","outputOptions","mimeType"],a);let d=l(t,["outputCompressionQuality"]);e!==void 0&&d!=null&&c(e,["parameters","outputOptions","compressionQuality"],d);let u=l(t,["enhanceInputImage"]);e!==void 0&&u!=null&&c(e,["parameters","upscaleConfig","enhanceInputImage"],u);let h=l(t,["imagePreservationFactor"]);e!==void 0&&h!=null&&c(e,["parameters","upscaleConfig","imagePreservationFactor"],h);let m=l(t,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);let g=l(t,["numberOfImages"]);e!==void 0&&g!=null&&c(e,["parameters","sampleCount"],g);let _=l(t,["mode"]);return e!==void 0&&_!=null&&c(e,["parameters","mode"],_),n}function I1(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],ke(t,r));let i=l(e,["image"]);i!=null&&c(n,["instances[0]","image"],Cn(i));let s=l(e,["upscaleFactor"]);s!=null&&c(n,["parameters","upscaleConfig","upscaleFactor"],s);let o=l(e,["config"]);return o!=null&&R1(o,n),n}function P1(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>gc(s))),c(e,["generatedImages"],i)}return e}function x1(t){let e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);let r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],$r(r));let i=l(t,["encoding"]);return i!=null&&c(e,["mimeType"],i),e}function k1(t){let e={},n=l(t,["gcsUri"]);n!=null&&c(e,["uri"],n);let r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],$r(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function N1(t){let e={},n=l(t,["image"]);n!=null&&c(e,["_self"],Cn(n));let r=l(t,["maskMode"]);return r!=null&&c(e,["maskMode"],r),e}function M1(t){let e={},n=l(t,["image"]);n!=null&&c(e,["image"],yc(n));let r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function O1(t){let e={},n=l(t,["image"]);n!=null&&c(e,["image"],Cn(n));let r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function Kw(t){let e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);let r=l(t,["videoBytes"]);r!=null&&c(e,["encodedVideo"],$r(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["encoding"],i),e}function Yw(t){let e={},n=l(t,["uri"]);n!=null&&c(e,["gcsUri"],n);let r=l(t,["videoBytes"]);r!=null&&c(e,["bytesBase64Encoded"],$r(r));let i=l(t,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function D1(t,e){let n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["displayName"],r),n}function U1(t){let e={},n=l(t,["config"]);return n!=null&&D1(n,e),e}function L1(t,e){let n={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),n}function F1(t){let e={},n=l(t,["name"]);n!=null&&c(e,["_url","name"],n);let r=l(t,["config"]);return r!=null&&L1(r,e),e}function q1(t){let e={},n=l(t,["name"]);return n!=null&&c(e,["_url","name"],n),e}function B1(t,e){let n={},r=l(t,["customMetadata"]);if(e!==void 0&&r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["customMetadata"],s)}let i=l(t,["chunkingConfig"]);return e!==void 0&&i!=null&&c(e,["chunkingConfig"],i),n}function G1(t){let e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);let r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);let i=l(t,["done"]);i!=null&&c(e,["done"],i);let s=l(t,["error"]);s!=null&&c(e,["error"],s);let o=l(t,["response"]);return o!=null&&c(e,["response"],V1(o)),e}function H1(t){let e={},n=l(t,["fileSearchStoreName"]);n!=null&&c(e,["_url","file_search_store_name"],n);let r=l(t,["fileName"]);r!=null&&c(e,["fileName"],r);let i=l(t,["config"]);return i!=null&&B1(i,e),e}function V1(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["parent"]);r!=null&&c(e,["parent"],r);let i=l(t,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function $1(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),n}function W1(t){let e={},n=l(t,["config"]);return n!=null&&$1(n,e),e}function J1(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["fileSearchStores"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["fileSearchStores"],s)}return e}function Xw(t,e){let n={},r=l(t,["mimeType"]);e!==void 0&&r!=null&&c(e,["mimeType"],r);let i=l(t,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);let s=l(t,["customMetadata"]);if(e!==void 0&&s!=null){let a=s;Array.isArray(a)&&(a=a.map(d=>d)),c(e,["customMetadata"],a)}let o=l(t,["chunkingConfig"]);return e!==void 0&&o!=null&&c(e,["chunkingConfig"],o),n}function z1(t){let e={},n=l(t,["fileSearchStoreName"]);n!=null&&c(e,["_url","file_search_store_name"],n);let r=l(t,["config"]);return r!=null&&Xw(r,e),e}function K1(t){let e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}var Y1="Content-Type",X1="X-Server-Timeout",Z1="User-Agent",Ap="x-goog-api-client",Q1="1.38.0",j1=`google-genai-sdk/${Q1}`,eF="v1beta1",tF="v1beta",bp=class{constructor(e){var n,r,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=(n=e.httpOptions)===null||n===void 0?void 0:n.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let s={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let a=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!a?(s.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?s.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(s.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),s.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:eF}else{if(!this.clientOptions.apiKey)throw new ra({message:"API key must be set when using the Gemini API.",status:403});s.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:tF,s.baseUrl="https://generativelanguage.googleapis.com/"}s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){let i=[this.getRequestUrlInternal(n)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,n){return!(n.baseUrl&&n.baseUrlResourceScope===tp.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);if(e.queryParams)for(let[o,a]of Object.entries(e.queryParams))i.searchParams.append(o,String(a));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,n,i.toString(),e.abortSignal),this.unaryApiCall(i,s,e.httpMethod)}patchHttpOptions(e,n){let r=JSON.parse(JSON.stringify(e));for(let[i,s]of Object.entries(n))typeof s=="object"?r[i]=Object.assign(Object.assign({},r[i]),s):s!==void 0&&(r[i]=s);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,n,i.toString(),e.abortSignal),this.streamApiCall(i,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,i){if(n&&n.timeout||i){let s=new AbortController,o=s.signal;if(n.timeout&&n?.timeout>0){let a=setTimeout(()=>s.abort(),n.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{s.abort()}),e.signal=o}return n&&n.extraBody!==null&&nF(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await hw(i),new Di(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await hw(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Sn(this,arguments,function*(){var r;let i=(r=e?.body)===null||r===void 0?void 0:r.getReader(),s=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="",a="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:u,value:h}=yield ge(i.read());if(u){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let m=s.decode(h,{stream:!0});try{let v=JSON.parse(m);if("error"in v){let w=JSON.parse(JSON.stringify(v.error)),T=w.status,A=w.code,G=`got status: ${T}. ${JSON.stringify(v)}`;if(A>=400&&A<600)throw new ra({message:G,status:A})}}catch(v){if(v.name==="ApiError")throw v}o+=m;let g=-1,_=0;for(;;){g=-1,_=0;for(let T of d){let A=o.indexOf(T);A!==-1&&(g===-1||A<g)&&(g=A,_=T.length)}if(g===-1)break;let v=o.substring(0,g);o=o.substring(g+_);let w=v.trim();if(w.startsWith(a)){let T=w.substring(a.length).trim();try{let A=new Response(T,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield ge(new Di(A))}catch(A){throw new Error(`exception parsing stream chunk ${T}. ${A}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){let e={},n=j1+" "+this.clientOptions.userAgentExtra;return e[Z1]=n,e[Ap]=n,e[Y1]="application/json",e}async getHeadersInternal(e,n){let r=new Headers;if(e&&e.headers){for(let[i,s]of Object.entries(e.headers))r.append(i,s);e.timeout&&e.timeout>0&&r.append(X1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;let i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let s=this.clientOptions.uploader,o=await s.stat(e);i.sizeBytes=String(o.size);let a=(r=n?.mimeType)!==null&&r!==void 0?r:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let d={file:i},u=this.getFileName(e),h=Q("upload/v1beta/files",d._url),m=await this.fetchUploadUrl(h,i.sizeBytes,i.mimeType,u,d,n?.httpOptions);return s.upload(e,m,this)}async uploadFileToFileSearchStore(e,n,r){var i;let s=this.clientOptions.uploader,o=await s.stat(n),a=String(o.size),d=(i=r?.mimeType)!==null&&i!==void 0?i:o.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let u=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(n),m={};r!=null&&Xw(r,m);let g=await this.fetchUploadUrl(u,a,d,h,m,r?.httpOptions);return s.uploadToFileSearchStore(n,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,i,s,o){var a;let d={};o?d=o:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},i?{"X-Goog-Upload-File-Name":i}:{})};let u=await this.request({path:e,body:JSON.stringify(s),httpMethod:"POST",httpOptions:d});if(!u||!u?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let h=(a=u?.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}};async function hw(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){let n=t.status,r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};let i=JSON.stringify(r);throw n>=400&&n<600?new ra({message:i,status:n}):new Error(i)}}function nF(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{let s=JSON.parse(t.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))n=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(s,o){let a=Object.assign({},s);for(let d in o)if(Object.prototype.hasOwnProperty.call(o,d)){let u=o[d],h=a[d];u&&typeof u=="object"&&!Array.isArray(u)&&h&&typeof h=="object"&&!Array.isArray(h)?a[d]=r(h,u):(h&&u&&typeof h!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof h}, New type: ${typeof u}. Overwriting.`),a[d]=u)}return a}let i=r(n,e);t.body=JSON.stringify(i)}var rF="mcp_used/unknown",iF=!1;function Zw(t){for(let e of t)if(sF(e)||typeof e=="object"&&"inputSchema"in e)return!0;return iF}function Qw(t){var e;let n=(e=t[Ap])!==null&&e!==void 0?e:"";t[Ap]=(n+` ${rF}`).trimStart()}function sF(t){return t!==null&&typeof t=="object"&&t instanceof Rp}function oF(t){return Sn(this,arguments,function*(n,r=100){let i,s=0;for(;s<r;){let o=yield ge(n.listTools({cursor:i}));for(let a of o.tools)yield yield ge(a),s++;if(!o.nextCursor)break;i=o.nextCursor}})}var Rp=class t{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new t(e,n)}async initialize(){var e,n,r,i;if(this.mcpTools.length>0)return;let s={},o=[];for(let h of this.mcpClients)try{for(var a=!0,d=(n=void 0,Tn(oF(h))),u;u=await d.next(),e=u.done,!e;a=!0){i=u.value,a=!1;let m=i;o.push(m);let g=m.name;if(s[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);s[g]=h}}catch(m){n={error:m}}finally{try{!a&&!e&&(r=d.return)&&await r.call(d)}finally{if(n)throw n.error}}this.mcpTools=o,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),VO(this.mcpTools,this.config)}async callTool(e){await this.initialize();let n=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[r.name],s;this.config.timeout&&(s={timeout:this.config.timeout});let o=await i.callTool({name:r.name,arguments:r.args},void 0,s);n.push({functionResponse:{name:r.name,response:o.isError?{error:o}:o}})}return n}};async function aF(t,e,n){let r=new mp,i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(r,i),e(r)}var Ip=class{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),o=uF(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${a}`,u=()=>{},h=new Promise(F=>{u=F}),m=e.callbacks,g=function(){u({})},_=this.apiClient,v={onopen:g,onmessage:F=>{aF(_,m.onmessage,F)},onerror:(n=m?.onerror)!==null&&n!==void 0?n:function(F){},onclose:(r=m?.onclose)!==null&&r!==void 0?r:function(F){}},w=this.webSocketFactory.create(d,lF(o),v);w.connect(),await h;let G={setup:{model:ke(this.apiClient,e.model)}};return w.send(JSON.stringify(G)),new Pp(w,this.apiClient)}},Pp=class{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let n=DU(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let n=OU(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){let n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Js.PLAY)}pause(){this.sendPlaybackControl(Js.PAUSE)}stop(){this.sendPlaybackControl(Js.STOP)}resetContext(){this.sendPlaybackControl(Js.RESET_CONTEXT)}close(){this.conn.close()}};function lF(t){let e={};return t.forEach((n,r)=>{e[r]=n}),e}function uF(t){let e=new Headers;for(let[n,r]of Object.entries(t))e.append(n,r);return e}var cF="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function dF(t,e,n){let r=new pp,i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;let s=JSON.parse(i);if(t.isVertexAI()){let o=FU(s);Object.assign(r,o)}else Object.assign(r,s);e(r)}var xp=class{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new Ip(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,i,s,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let d=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),h,m=this.apiClient.getHeaders();e.config&&e.config.tools&&Zw(e.config.tools)&&Qw(m);let g=pF(m);if(this.apiClient.isVertexAI()){let L=this.apiClient.getProject(),te=this.apiClient.getLocation(),oe=this.apiClient.getApiKey(),fe=!!L&&!!te||!!oe;this.apiClient.getCustomBaseUrl()&&!fe?h=d:(h=`${d}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,h))}else{let L=this.apiClient.getApiKey(),te="BidiGenerateContent",oe="key";L?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),te="BidiGenerateContentConstrained",oe="access_token"),h=`${d}/ws/google.ai.generativelanguage.${u}.GenerativeService.${te}?${oe}=${L}`}let _=()=>{},v=new Promise(L=>{_=L}),w=e.callbacks,T=function(){var L;(L=w?.onopen)===null||L===void 0||L.call(w),_({})},A=this.apiClient,G={onopen:T,onmessage:L=>{dF(A,w.onmessage,L)},onerror:(n=w?.onerror)!==null&&n!==void 0?n:function(L){},onclose:(r=w?.onclose)!==null&&r!==void 0?r:function(L){}},F=this.webSocketFactory.create(h,hF(g),G);F.connect(),await v;let B=ke(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&B.startsWith("publishers/")){let L=this.apiClient.getProject(),te=this.apiClient.getLocation();L&&te&&(B=`projects/${L}/locations/${te}/`+B)}let H={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Fu.AUDIO]}:e.config.responseModalities=[Fu.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let q=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],$=[];for(let L of q)if(this.isCallableTool(L)){let te=L;$.push(await te.tool())}else $.push(L);$.length>0&&(e.config.tools=$);let Y={model:B,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?H=MU(this.apiClient,Y):H=NU(this.apiClient,Y),delete H.config,F.send(JSON.stringify(H)),new kp(F,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},fF={turnComplete:!0},kp=class{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=sn(n.turns),e.isVertexAI()||(r=r.map(i=>mc(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(let s of r){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(cF)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},fF),e);let n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:LU(e)}:n={realtimeInput:UU(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}};function hF(t){let e={};return t.forEach((n,r)=>{e[r]=n}),e}function pF(t){let e=new Headers;for(let[n,r]of Object.entries(t))e.append(n,r);return e}var pw=10;function mw(t){var e,n,r;if(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(let o of(n=t?.tools)!==null&&n!==void 0?n:[])if(Ks(o)){i=!0;break}if(!i)return!0;let s=(r=t?.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function Ks(t){return"callTool"in t&&typeof t.callTool=="function"}function mF(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>Ks(i)))!==null&&r!==void 0?r:!1}function gw(t){var e;let n=[];return!((e=t?.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,i)=>{if(Ks(r))return;let s=r;s.functionDeclarations&&s.functionDeclarations.length>0&&n.push(i)}),n}function yw(t){var e;return!(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Np=class extends wn{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,i,s,o,a;let d=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!mF(n)||mw(n.config))return await this.generateContentInternal(d);let u=gw(n);if(u.length>0){let w=u.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${w}.`)}let h,m,g=sn(d.contents),_=(s=(i=(r=d.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:pw,v=0;for(;v<_&&(h=await this.generateContentInternal(d),!(!h.functionCalls||h.functionCalls.length===0));){let w=h.candidates[0].content,T=[];for(let A of(a=(o=n.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ks(A)){let F=await A.callTool(h.functionCalls);T.push(...F)}v++,m={role:"user",parts:T},d.contents=sn(d.contents),d.contents.push(w),d.contents.push(m),yw(d.config)&&(g.push(w),g.push(m))}return yw(d.config)&&(h.automaticFunctionCallingHistory=g),h},this.generateContentStream=async n=>{var r,i,s,o,a;if(this.maybeMoveToResponseJsonSchem(n),mw(n.config)){let m=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(m)}let d=gw(n);if(d.length>0){let m=d.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let u=(s=(i=(r=n?.config)===null||r===void 0?void 0:r.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||s===void 0?void 0:s.streamFunctionCallArguments,h=(a=(o=n?.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(u&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var i;let s,o=[];if(r?.generatedImages)for(let d of r.generatedImages)d&&d?.safetyAttributes&&((i=d?.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?s=d?.safetyAttributes:o.push(d);let a;return s?a={generatedImages:o,positivePromptSafetyAttributes:s,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;let o={config:Object.assign(Object.assign({},{queryBase:!0}),n?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((r=o.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new gr(mr.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async n=>{let r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));let i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var r,i,s,o,a,d;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((o=(s=n.source)===null||s===void 0?void 0:s.video)===null||o===void 0)&&o.uri&&(!((d=(a=n.source)===null||a===void 0?void 0:a.video)===null||d===void 0)&&d.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,i;let s=(n=e.config)===null||n===void 0?void 0:n.tools;if(!s)return e;let o=await Promise.all(s.map(async d=>Ks(d)?await d.tool():d)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&Zw(e.config.tools)){let d=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{},u=Object.assign({},d);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),Qw(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var n,r,i;let s=new Map;for(let o of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Ks(o)){let a=o,d=await a.tool();for(let u of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!u.name)throw new Error("Function declaration name is required.");if(s.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);s.set(u.name,a)}}return s}async processAfcStream(e){var n,r,i;let s=(i=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:pw,o=!1,a=0,d=await this.initAfcToolsMap(e);return(function(u,h,m){return Sn(this,arguments,function*(){for(var g,_,v,w,T,A;a<s;){o&&(a++,o=!1);let H=yield ge(u.processParamsMaybeAddMcpUsage(m)),q=yield ge(u.generateContentStreamInternal(H)),$=[],Y=[];try{for(var G=!0,F=(_=void 0,Tn(q)),B;B=yield ge(F.next()),g=B.done,!g;G=!0){w=B.value,G=!1;let L=w;if(yield yield ge(L),L.candidates&&(!((T=L.candidates[0])===null||T===void 0)&&T.content)){Y.push(L.candidates[0].content);for(let te of(A=L.candidates[0].content.parts)!==null&&A!==void 0?A:[])if(a<s&&te.functionCall){if(!te.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(te.functionCall.name)){let oe=yield ge(h.get(te.functionCall.name).callTool([te.functionCall]));$.push(...oe)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${te.functionCall.name}`)}}}}catch(L){_={error:L}}finally{try{!G&&!g&&(v=F.return)&&(yield ge(v.call(F)))}finally{if(_)throw _.error}}if($.length>0){o=!0;let L=new Mi;L.candidates=[{content:{role:"user",parts:$}}],yield yield ge(L);let te=[];te.push(...Y),te.push({role:"user",parts:$});let oe=sn(m.contents).concat(te);m.contents=oe}else break}})})(this,d,e)}async generateContentInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=cw(this.apiClient,e);return a=Q("{model}:generateContent",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=fw(h),g=new Mi;return Object.assign(g,m),g})}else{let u=uw(this.apiClient,e);return a=Q("{model}:generateContent",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=dw(h),g=new Mi;return Object.assign(g,m),g})}}async generateContentStreamInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=cw(this.apiClient,e);return a=Q("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(m){return Sn(this,arguments,function*(){var g,_,v,w;try{for(var T=!0,A=Tn(m),G;G=yield ge(A.next()),g=G.done,!g;T=!0){w=G.value,T=!1;let F=w,B=fw(yield ge(F.json()));B.sdkHttpResponse={headers:F.headers};let H=new Mi;Object.assign(H,B),yield yield ge(H)}}catch(F){_={error:F}}finally{try{!T&&!g&&(v=A.return)&&(yield ge(v.call(A)))}finally{if(_)throw _.error}}})})}else{let u=uw(this.apiClient,e);return a=Q("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(m){return Sn(this,arguments,function*(){var g,_,v,w;try{for(var T=!0,A=Tn(m),G;G=yield ge(A.next()),g=G.done,!g;T=!0){w=G.value,T=!1;let F=w,B=dw(yield ge(F.json()));B.sdkHttpResponse={headers:F.headers};let H=new Mi;Object.assign(H,B),yield yield ge(H)}}catch(F){_={error:F}}finally{try{!T&&!g&&(v=A.return)&&(yield ge(v.call(A)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=mL(this.apiClient,e);return a=Q("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=yL(h),g=new qu;return Object.assign(g,m),g})}else{let u=pL(this.apiClient,e);return a=Q("{model}:batchEmbedContents",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=gL(h),g=new qu;return Object.assign(g,m),g})}}async generateImagesInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=IL(this.apiClient,e);return a=Q("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=xL(h),g=new Bu;return Object.assign(g,m),g})}else{let u=RL(this.apiClient,e);return a=Q("{model}:predict",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=PL(h),g=new Bu;return Object.assign(g,m),g})}}async editImageInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=cL(this.apiClient,e);return s=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>{let u=dL(d),h=new np;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=I1(this.apiClient,e);return s=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>{let u=P1(d),h=new rp;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=u1(this.apiClient,e);return s=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=c1(d),h=new ip;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=g1(this.apiClient,e);return s=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=y1(d),h=new sp;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=zL(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>Cp(h))}else{let u=JL(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>wp(h))}}async listInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=n1(this.apiClient,e);return a=Q("{models_url}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=i1(h),g=new Gu;return Object.assign(g,m),g})}else{let u=t1(this.apiClient,e);return a=Q("{models_url}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=r1(h),g=new Gu;return Object.assign(g,m),g})}}async update(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=b1(this.apiClient,e);return a=Q("{model}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>Cp(h))}else{let u=A1(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>wp(h))}}async delete(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=oL(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=lL(h),g=new Hu;return Object.assign(g,m),g})}else{let u=sL(this.apiClient,e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=aL(h),g=new Hu;return Object.assign(g,m),g})}}async countTokens(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=nL(this.apiClient,e);return a=Q("{model}:countTokens",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=iL(h),g=new Vu;return Object.assign(g,m),g})}else{let u=tL(this.apiClient,e);return a=Q("{model}:countTokens",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=rL(h),g=new Vu;return Object.assign(g,m),g})}}async computeTokens(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=KU(this.apiClient,e);return s=Q("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>{let u=YU(d),h=new op;return Object.assign(h,u),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=UL(this.apiClient,e);return a=Q("{model}:predictLongRunning",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o.then(h=>{let m=OL(h),g=new $u;return Object.assign(g,m),g})}else{let u=DL(this.apiClient,e);return a=Q("{model}:predictLongRunning",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{let m=ML(h),g=new $u;return Object.assign(g,m),g})}}};var Mp=class extends wn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=n.name.split("/operations/")[0],s;r&&"httpOptions"in r&&(s=r.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:s}});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){let n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=n.name.split("/operations/")[0],s;r&&"httpOptions"in r&&(s=r.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:s}});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=NO(e);return a=Q("{operationName}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),o}else{let u=kO(e);return a=Q("{operationName}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o}}async fetchPredictVideosOperationInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=CO(e);return s=Q("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function gF(t){let e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function yF(t){let e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>bF(s))),c(e,["parts"],i)}let r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function _F(t,e,n){let r={},i=l(e,["expireTime"]);n!==void 0&&i!=null&&c(n,["expireTime"],i);let s=l(e,["newSessionExpireTime"]);n!==void 0&&s!=null&&c(n,["newSessionExpireTime"],s);let o=l(e,["uses"]);n!==void 0&&o!=null&&c(n,["uses"],o);let a=l(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&c(n,["bidiGenerateContentSetup"],AF(t,a));let d=l(e,["lockAdditionalFields"]);return n!==void 0&&d!=null&&c(n,["fieldMask"],d),r}function EF(t,e){let n={},r=l(e,["config"]);return r!=null&&c(n,["config"],_F(t,r,n)),n}function vF(t){let e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);let r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function SF(t){let e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);let r=l(t,["args"]);r!=null&&c(e,["args"],r);let i=l(t,["name"]);if(i!=null&&c(e,["name"],i),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function TF(t){let e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function wF(t){let e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function CF(t,e){let n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);let i=l(t,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let s=l(t,["temperature"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","temperature"],s);let o=l(t,["topP"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","topP"],o);let a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);let d=l(t,["maxOutputTokens"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","maxOutputTokens"],d);let u=l(t,["mediaResolution"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","mediaResolution"],u);let h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],nm(m));let g=l(t,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let _=l(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=l(t,["systemInstruction"]);e!==void 0&&v!=null&&c(e,["setup","systemInstruction"],yF(lt(v)));let w=l(t,["tools"]);if(e!==void 0&&w!=null){let q=Qs(w);Array.isArray(q)&&(q=q.map($=>IF(Zs($)))),c(e,["setup","tools"],q)}let T=l(t,["sessionResumption"]);e!==void 0&&T!=null&&c(e,["setup","sessionResumption"],RF(T));let A=l(t,["inputAudioTranscription"]);e!==void 0&&A!=null&&c(e,["setup","inputAudioTranscription"],A);let G=l(t,["outputAudioTranscription"]);e!==void 0&&G!=null&&c(e,["setup","outputAudioTranscription"],G);let F=l(t,["realtimeInputConfig"]);e!==void 0&&F!=null&&c(e,["setup","realtimeInputConfig"],F);let B=l(t,["contextWindowCompression"]);e!==void 0&&B!=null&&c(e,["setup","contextWindowCompression"],B);let H=l(t,["proactivity"]);if(e!==void 0&&H!=null&&c(e,["setup","proactivity"],H),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function AF(t,e){let n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],ke(t,r));let i=l(e,["config"]);return i!=null&&c(n,["config"],CF(i,n)),n}function bF(t){let e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);let r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=l(t,["executableCode"]);i!=null&&c(e,["executableCode"],i);let s=l(t,["fileData"]);s!=null&&c(e,["fileData"],vF(s));let o=l(t,["functionCall"]);o!=null&&c(e,["functionCall"],SF(o));let a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);let d=l(t,["inlineData"]);d!=null&&c(e,["inlineData"],gF(d));let u=l(t,["text"]);u!=null&&c(e,["text"],u);let h=l(t,["thought"]);h!=null&&c(e,["thought"],h);let m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);let g=l(t,["videoMetadata"]);return g!=null&&c(e,["videoMetadata"],g),e}function RF(t){let e={},n=l(t,["handle"]);if(n!=null&&c(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function IF(t){let e={};if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=l(t,["computerUse"]);n!=null&&c(e,["computerUse"],n);let r=l(t,["fileSearch"]);r!=null&&c(e,["fileSearch"],r);let i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=l(t,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}let o=l(t,["googleMaps"]);o!=null&&c(e,["googleMaps"],TF(o));let a=l(t,["googleSearch"]);a!=null&&c(e,["googleSearch"],wF(a));let d=l(t,["googleSearchRetrieval"]);d!=null&&c(e,["googleSearchRetrieval"],d);let u=l(t,["urlContext"]);return u!=null&&c(e,["urlContext"],u),e}function PF(t){let e=[];for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){let i=Object.keys(r).map(s=>`${n}.${s}`);e.push(...i)}else e.push(n)}return e.join(",")}function xF(t,e){let n=null,r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){let s=r.setup;typeof s=="object"&&s!==null?(t.bidiGenerateContentSetup=s,n=s):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;let i=t.fieldMask;if(n){let s=PF(n);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)s?t.fieldMask=s:delete t.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];i.length>0&&(a=i.map(u=>o.includes(u)?`generationConfig.${u}`:u));let d=[];s&&d.push(s),a.length>0&&d.push(...a),d.length>0?t.fieldMask=d.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}var Op=class extends wn{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=EF(this.apiClient,e);s=Q("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;let d=xF(a,e.config);return i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>u)}}};function kF(t,e){let n={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),n}function NF(t){let e={},n=l(t,["name"]);n!=null&&c(e,["_url","name"],n);let r=l(t,["config"]);return r!=null&&kF(r,e),e}function MF(t){let e={},n=l(t,["name"]);return n!=null&&c(e,["_url","name"],n),e}function OF(t,e){let n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=l(t,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),n}function DF(t){let e={},n=l(t,["parent"]);n!=null&&c(e,["_url","parent"],n);let r=l(t,["config"]);return r!=null&&OF(r,e),e}function UF(t){let e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);let r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=l(t,["documents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),c(e,["documents"],s)}return e}var Dp=class extends wn{constructor(e){super(),this.apiClient=e,this.list=async n=>new gr(mr.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=MF(e);return s=Q("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,r;let i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=NF(e);i=Q("{name}",o._url),s=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=DF(e);return s=Q("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=UF(d),h=new ap;return Object.assign(h,u),h})}}};var Up=class extends wn{constructor(e,n=new Dp(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new gr(mr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=U1(e);return s=Q("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async get(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=q1(e);return s=Q("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,r;let i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=F1(e);i=Q("{name}",o._url),s=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=W1(e);return s=Q("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=J1(d),h=new lp;return Object.assign(h,u),h})}}async uploadToFileSearchStoreInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=z1(e);return s=Q("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=K1(d),h=new up;return Object.assign(h,u),h})}}async importFile(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=H1(e);return s=Q("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{let u=G1(d),h=new cp;return Object.assign(h,u),h})}}};var jw=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return jw=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))},LF=()=>jw();function Lp(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}var Fp=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){let e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};var bt=class extends Error{},Rt=class t extends bt{constructor(e,n,r,i){super(`${t.makeMessage(e,n,r)}`),this.status=e,this.headers=i,this.error=n}static makeMessage(e,n,r){let i=n?.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,r,i){if(!e||!i)return new Ys({message:r,cause:Fp(n)});let s=n;return e===400?new ec(e,s,r,i):e===401?new tc(e,s,r,i):e===403?new nc(e,s,r,i):e===404?new rc(e,s,r,i):e===409?new ic(e,s,r,i):e===422?new sc(e,s,r,i):e===429?new oc(e,s,r,i):e>=500?new ac(e,s,r,i):new t(e,s,r,i)}},ia=class extends Rt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ys=class extends Rt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}},ju=class extends Ys{constructor({message:e}={}){super({message:e??"Request timed out."})}},ec=class extends Rt{},tc=class extends Rt{},nc=class extends Rt{},rc=class extends Rt{},ic=class extends Rt{},sc=class extends Rt{},oc=class extends Rt{},ac=class extends Rt{};var FF=/^[a-z][a-z0-9+.-]*:/i,qF=t=>FF.test(t),qp=t=>(qp=Array.isArray,qp(t)),BF=qp,GF=BF,_w=GF;function HF(t){if(!t)return!0;for(let e in t)return!1;return!0}function VF(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var $F=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new bt(`${t} must be an integer`);if(e<0)throw new bt(`${t} must be a positive integer`);return e},WF=t=>{try{return JSON.parse(t)}catch{return}};var JF=t=>new Promise(e=>setTimeout(e,t));var Ws="0.0.1";function zF(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var KF=()=>{var t,e,n,r,i;let s=zF();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":vw(Deno.build.os),"X-Stainless-Arch":Ew(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":vw((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":Ew((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};let o=YF();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function YF(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:n}of t){let r=n.exec(navigator.userAgent);if(r){let i=r[1]||0,s=r[2]||0,o=r[3]||0;return{browser:e,version:`${i}.${s}.${o}`}}}return null}var Ew=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",vw=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),ku,XF=()=>ku??(ku=KF());function ZF(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function eC(...t){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function QF(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return eC({start(){},async pull(n){let{done:r,value:i}=await e.next();r?n.close():n.enqueue(i)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function tC(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let n=await e.read();return n?.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){let n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function jF(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}let r=t.getReader(),i=r.cancel();r.releaseLock(),await i}var eq=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var nC=()=>{var t;if(typeof File>"u"){let{process:e}=globalThis,n=typeof((t=e?.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Zh(t,e,n){return nC(),new File(t,e??"unknown_file",n)}function tq(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}var nq=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";var rC=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",rq=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&rC(t),iq=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function sq(t,e,n){if(nC(),t=await t,rq(t))return t instanceof File?t:Zh([await t.arrayBuffer()],t.name);if(iq(t)){let i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Zh(await Bp(i),e,n)}let r=await Bp(t);if(e||(e=tq(t)),!n?.type){let i=r.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof i=="string"&&(n=Object.assign(Object.assign({},n),{type:i}))}return Zh(r,e,n)}async function Bp(t){var e,n,r,i,s;let o=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)o.push(t);else if(rC(t))o.push(t instanceof Blob?t:await t.arrayBuffer());else if(nq(t))try{for(var a=!0,d=Tn(t),u;u=await d.next(),e=u.done,!e;a=!0){i=u.value,a=!1;let h=i;o.push(...await Bp(h))}}catch(h){n={error:h}}finally{try{!a&&!e&&(r=d.return)&&await r.call(d)}finally{if(n)throw n.error}}else{let h=(s=t?.constructor)===null||s===void 0?void 0:s.name;throw new Error(`Unexpected data type: ${typeof t}${h?`; constructor: ${h}`:""}${oq(t)}`)}return o}function oq(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}var lc=class{constructor(e){this._client=e}};lc._key=[];function iC(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Sw=Object.freeze(Object.create(null)),aq=(t=iC)=>(function(n,...r){if(n.length===1)return n[0];let i=!1,s=[],o=n.reduce((h,m,g)=>{var _,v,w;/[?#]/.test(m)&&(i=!0);let T=r[g],A=(i?encodeURIComponent:t)(""+T);return g!==r.length&&(T==null||typeof T=="object"&&T.toString===((w=Object.getPrototypeOf((v=Object.getPrototypeOf((_=T.hasOwnProperty)!==null&&_!==void 0?_:Sw))!==null&&v!==void 0?v:Sw))===null||w===void 0?void 0:w.toString))&&(A=T+"",s.push({start:h.length+m.length,length:A.length,error:`Value of type ${Object.prototype.toString.call(T).slice(8,-1)} is not a valid path parameter`})),h+m+(g===r.length?"":A)},""),a=o.split(/[?#]/,1)[0],d=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,u;for(;(u=d.exec(a))!==null;)s.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(s.sort((h,m)=>h.start-m.start),s.length>0){let h=0,m=s.reduce((g,_)=>{let v=" ".repeat(_.start-h),w="^".repeat(_.length);return h=_.start+_.length,g+v+w},"");throw new bt(`Path parameters result in path with invalid segments:
${s.map(g=>g.error).join(`
`)}
${o}
${m}`)}return o}),Nu=aq(iC);var uc=class extends lc{create(e,n){var r;let{api_version:i=this._client.apiVersion}=e,s=Qu(e,["api_version"]);if("model"in s&&"agent_config"in s)throw new bt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in s&&"generation_config"in s)throw new bt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Nu`/${i}/interactions`,Object.assign(Object.assign({body:s},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){let{api_version:i=this._client.apiVersion}=n??{};return this._client.delete(Nu`/${i}/interactions/${e}`,r)}cancel(e,n={},r){let{api_version:i=this._client.apiVersion}=n??{};return this._client.post(Nu`/${i}/interactions/${e}/cancel`,r)}get(e,n={},r){var i;let s=n??{},{api_version:o=this._client.apiVersion}=s,a=Qu(s,["api_version"]);return this._client.get(Nu`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},r),{stream:(i=n?.stream)!==null&&i!==void 0?i:!1}))}};uc._key=Object.freeze(["interactions"]);var cc=class extends uc{};function lq(t){let e=0;for(let i of t)e+=i.length;let n=new Uint8Array(e),r=0;for(let i of t)n.set(i,r),r+=i.length;return n}var Mu;function im(t){let e;return(Mu??(e=new globalThis.TextEncoder,Mu=e.encode.bind(e)))(t)}var Ou;function Tw(t){let e;return(Ou??(e=new globalThis.TextDecoder,Ou=e.decode.bind(e)))(t)}var Xs=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?im(e):e;this.buffer=lq([this.buffer,n]);let r=[],i;for(;(i=uq(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){r.push(Tw(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let s=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,o=Tw(this.buffer.subarray(0,s));r.push(o),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}};Xs.NEWLINE_CHARS=new Set([`
`,"\r"]);Xs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function uq(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function cq(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}var dc={off:0,error:200,warn:300,info:400,debug:500},ww=(t,e,n)=>{if(t){if(VF(dc,t))return t;yt(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(dc))}`)}};function na(){}function Du(t,e,n){return!e||dc[t]>dc[n]?na:e[t].bind(e)}var dq={error:na,warn:na,info:na,debug:na},Cw=new WeakMap;function yt(t){var e;let n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return dq;let i=Cw.get(n);if(i&&i[0]===r)return i[1];let s={error:Du("error",n,r),warn:Du("warn",n,r),info:Du("info",n,r),debug:Du("debug",n,r)};return Cw.set(n,[r,s]),s}var Ni=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var Gp=class t{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let i=!1,s=r?yt(r):console;function o(){return Sn(this,arguments,function*(){var d,u,h,m;if(i)throw new bt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var _=!0,v=Tn(fq(e,n)),w;w=yield ge(v.next()),d=w.done,!d;_=!0){m=w.value,_=!1;let T=m;if(!g)if(T.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield ge(JSON.parse(T.data))}catch(A){throw s.error("Could not parse message into JSON:",T.data),s.error("From chunk:",T.raw),A}}}catch(T){u={error:T}}finally{try{!_&&!d&&(h=v.return)&&(yield ge(h.call(v)))}finally{if(u)throw u.error}}g=!0}catch(T){if(Lp(T))return yield ge(void 0);throw T}finally{g||n.abort()}})}return new t(o,n,r)}static fromReadableStream(e,n,r){let i=!1;function s(){return Sn(this,arguments,function*(){var d,u,h,m;let g=new Xs,_=tC(e);try{for(var v=!0,w=Tn(_),T;T=yield ge(w.next()),d=T.done,!d;v=!0){m=T.value,v=!1;let A=m;for(let G of g.decode(A))yield yield ge(G)}}catch(A){u={error:A}}finally{try{!v&&!d&&(h=w.return)&&(yield ge(h.call(w)))}finally{if(u)throw u.error}}for(let A of g.flush())yield yield ge(A)})}function o(){return Sn(this,arguments,function*(){var d,u,h,m;if(i)throw new bt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var _=!0,v=Tn(s()),w;w=yield ge(v.next()),d=w.done,!d;_=!0){m=w.value,_=!1;let T=m;g||T&&(yield yield ge(JSON.parse(T)))}}catch(T){u={error:T}}finally{try{!_&&!d&&(h=v.return)&&(yield ge(h.call(v)))}finally{if(u)throw u.error}}g=!0}catch(T){if(Lp(T))return yield ge(void 0);throw T}finally{g||n.abort()}})}return new t(o,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],n=[],r=this.iterator(),i=s=>({next:()=>{if(s.length===0){let o=r.next();e.push(o),n.push(o)}return s.shift()}});return[new t(()=>i(e),this.controller,this.client),new t(()=>i(n),this.controller,this.client)]}toReadableStream(){let e=this,n;return eC({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{let{value:i,done:s}=await n.next();if(s)return r.close();let o=im(JSON.stringify(i)+`
`);r.enqueue(o)}catch(i){r.error(i)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}};function fq(t,e){return Sn(this,arguments,function*(){var r,i,s,o;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new bt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new bt("Attempted to iterate over a response with no body");let a=new Hp,d=new Xs,u=tC(t.body);try{for(var h=!0,m=Tn(hq(u)),g;g=yield ge(m.next()),r=g.done,!r;h=!0){o=g.value,h=!1;let _=o;for(let v of d.decode(_)){let w=a.decode(v);w&&(yield yield ge(w))}}}catch(_){i={error:_}}finally{try{!h&&!r&&(s=m.return)&&(yield ge(s.call(m)))}finally{if(i)throw i.error}}for(let _ of d.flush()){let v=a.decode(_);v&&(yield yield ge(v))}})}function hq(t){return Sn(this,arguments,function*(){var n,r,i,s;let o=new Uint8Array;try{for(var a=!0,d=Tn(t),u;u=yield ge(d.next()),n=u.done,!n;a=!0){s=u.value,a=!1;let h=s;if(h==null)continue;let m=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?im(h):h,g=new Uint8Array(o.length+m.length);g.set(o),g.set(m,o.length),o=g;let _;for(;(_=cq(o))!==-1;)yield yield ge(o.slice(0,_)),o=o.slice(_)}}catch(h){r={error:h}}finally{try{!a&&!n&&(i=d.return)&&(yield ge(i.call(d)))}finally{if(r)throw r.error}}o.length>0&&(yield yield ge(o))})}var Hp=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,i]=pq(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}};function pq(t,e){let n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}async function mq(t,e){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:s}=e,o=await(async()=>{var a;if(e.options.stream)return yt(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):Gp.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;let d=n.headers.get("content-type"),u=(a=d?.split(";")[0])===null||a===void 0?void 0:a.trim();return u?.includes("application/json")||u?.endsWith("+json")?await n.json():await n.text()})();return yt(t).debug(`[${r}] response parsed`,Ni({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-s})),o}var Vp=class t extends Promise{constructor(e,n,r=mq){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new t(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var sC=Symbol("brand.privateNullableHeaders");function*gq(t){if(!t)return;if(sC in t){let{values:r,nulls:i}=t;yield*r.entries();for(let s of i)yield[s,null];return}let e=!1,n;t instanceof Headers?n=t.entries():_w(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){let i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let s=_w(r[1])?r[1]:[r[1]],o=!1;for(let a of s)a!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,a])}}var ea=t=>{let e=new Headers,n=new Set;for(let r of t){let i=new Set;for(let[s,o]of gq(r)){let a=s.toLowerCase();i.has(a)||(e.delete(s),i.add(a)),o===null?(e.delete(s),n.add(a)):(e.append(s,o),n.delete(a))}}return{[sC]:!0,values:e,nulls:n}};var Qh=t=>{var e,n,r,i,s,o;if(typeof globalThis.process<"u")return(r=(n=(e=globalThis.process.env)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(o=(s=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||s===void 0?void 0:s.call(i,t))===null||o===void 0?void 0:o.trim()};var oC,fc=class t{constructor(e){var n,r,i,s,o,a,d,{baseURL:u=Qh("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=Qh("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:m="v1beta"}=e,g=Qu(e,["baseURL","apiKey","apiVersion"]);let _=Object.assign(Object.assign({apiKey:h,apiVersion:m},g),{baseURL:u||"https://generativelanguage.googleapis.com"});this.baseURL=_.baseURL,this.timeout=(r=_.timeout)!==null&&r!==void 0?r:t.DEFAULT_TIMEOUT,this.logger=(i=_.logger)!==null&&i!==void 0?i:console;let v="warn";this.logLevel=v,this.logLevel=(o=(s=ww(_.logLevel,"ClientOptions.logLevel",this))!==null&&s!==void 0?s:ww(Qh("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:v,this.fetchOptions=_.fetchOptions,this.maxRetries=(a=_.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(d=_.fetch)!==null&&d!==void 0?d:ZF(),this.encoder=eq,this._options=_,this.apiKey=h,this.apiVersion=m,this.clientAdapter=_.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let n=ea([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return ea([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return ea([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new bt(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ws}`}defaultIdempotencyKey(){return`stainless-node-retry-${LF()}`}makeStatusError(e,n,r,i){return Rt.generate(e,n,r,i)}buildURL(e,n,r){let i=!this.baseURLOverridden()&&r||this.baseURL,s=qF(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return HF(o)||(n=Object.assign(Object.assign({},o),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(i=>Object.assign({method:e,path:n},i)))}request(e,n=null){return new Vp(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var i,s,o;let a=await e,d=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;n==null&&(n=d),await this.prepareOptions(a);let{req:u,url:h,timeout:m}=await this.buildRequest(a,{retryCount:d-n});await this.prepareRequest(u,{url:h,options:a});let g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),_=r===void 0?"":`, retryOf: ${r}`,v=Date.now();if(yt(this).debug(`[${g}] sending request`,Ni({retryOfRequestLogID:r,method:a.method,url:h,options:a,headers:u.headers})),!((s=a.signal)===null||s===void 0)&&s.aborted)throw new ia;let w=new AbortController,T=await this.fetchWithTimeout(h,u,m,w).catch(Fp),A=Date.now();if(T instanceof globalThis.Error){let F=`retrying, ${n} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new ia;let B=Lp(T)||/timed? ?out/i.test(String(T)+("cause"in T?String(T.cause):""));if(n)return yt(this).info(`[${g}] connection ${B?"timed out":"failed"} - ${F}`),yt(this).debug(`[${g}] connection ${B?"timed out":"failed"} (${F})`,Ni({retryOfRequestLogID:r,url:h,durationMs:A-v,message:T.message})),this.retryRequest(a,n,r??g);throw yt(this).info(`[${g}] connection ${B?"timed out":"failed"} - error; no more retries left`),yt(this).debug(`[${g}] connection ${B?"timed out":"failed"} (error; no more retries left)`,Ni({retryOfRequestLogID:r,url:h,durationMs:A-v,message:T.message})),B?new ju:new Ys({cause:T})}let G=`[${g}${_}] ${u.method} ${h} ${T.ok?"succeeded":"failed"} with status ${T.status} in ${A-v}ms`;if(!T.ok){let F=await this.shouldRetry(T);if(n&&F){let L=`retrying, ${n} attempts remaining`;return await jF(T.body),yt(this).info(`${G} - ${L}`),yt(this).debug(`[${g}] response error (${L})`,Ni({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,durationMs:A-v})),this.retryRequest(a,n,r??g,T.headers)}let B=F?"error; no more retries left":"error; not retryable";yt(this).info(`${G} - ${B}`);let H=await T.text().catch(L=>Fp(L).message),q=WF(H),$=q?void 0:H;throw yt(this).debug(`[${g}] response error (${B})`,Ni({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,message:$,durationMs:Date.now()-v})),this.makeStatusError(T.status,q,$,T.headers)}return yt(this).info(G),yt(this).debug(`[${g}] response start`,Ni({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,durationMs:A-v})),{response:T,options:a,controller:w,requestLogID:g,retryOfRequestLogID:r,startTime:v}}async fetchWithTimeout(e,n,r,i){let s=n||{},{signal:o,method:a}=s,d=Qu(s,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());let u=setTimeout(()=>i.abort(),r),h=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,m=Object.assign(Object.assign(Object.assign({signal:i.signal},h?{duplex:"half"}:{}),{method:"GET"}),d);a&&(m.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(u)}}async shouldRetry(e){let n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,i){var s;let o,a=i?.get("retry-after-ms");if(a){let u=parseFloat(a);Number.isNaN(u)||(o=u)}let d=i?.get("retry-after");if(d&&!o){let u=parseFloat(d);Number.isNaN(u)?o=Date.parse(d)-Date.now():o=u*1e3}if(!(o&&0<=o&&o<60*1e3)){let u=(s=e.maxRetries)!==null&&s!==void 0?s:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(n,u)}return await JF(o),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){let s=n-e,o=Math.min(.5*Math.pow(2,s),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,i,s;let o=Object.assign({},e),{method:a,path:d,query:u,defaultBaseURL:h}=o,m=this.buildURL(d,u,h);"timeout"in o&&$F("timeout",o.timeout),o.timeout=(r=o.timeout)!==null&&r!==void 0?r:this.timeout;let{bodyHeaders:g,body:_}=this.buildBody({options:o}),v=await this.buildHeaders({options:e,method:a,bodyHeaders:g,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:v},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&_ instanceof globalThis.ReadableStream&&{duplex:"half"}),_&&{body:_}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(s=o.fetchOptions)!==null&&s!==void 0?s:{}),url:m,timeout:o.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:i}){let s={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),a=ea([s,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),XF()),this._options.defaultHeaders,r,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=ea([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:QF(e)}:this.encoder({body:e,headers:r})}};fc.DEFAULT_TIMEOUT=6e4;var Je=class extends fc{constructor(){super(...arguments),this.interactions=new cc(this)}};oC=Je;Je.GeminiNextGenAPIClient=oC;Je.GeminiNextGenAPIClientError=bt;Je.APIError=Rt;Je.APIConnectionError=Ys;Je.APIConnectionTimeoutError=ju;Je.APIUserAbortError=ia;Je.NotFoundError=rc;Je.ConflictError=ic;Je.RateLimitError=oc;Je.BadRequestError=ec;Je.AuthenticationError=tc;Je.InternalServerError=ac;Je.PermissionDeniedError=nc;Je.UnprocessableEntityError=sc;Je.toFile=sq;Je.Interactions=cc;var Aw="x-goog-api-key",ta="https://www.googleapis.com/auth/cloud-platform",$p=class{constructor(e){if(e.apiKey!==void 0){this.apiKey=e.apiKey;return}let n=yq(e.googleAuthOptions);this.googleAuth=new Rw.GoogleAuth(n)}async addAuthHeaders(e,n){if(this.apiKey!==void 0){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,n)}addKeyHeader(e){if(e.get(Aw)===null){if(this.apiKey===void 0)throw new Error("Trying to set API key header but apiKey is not set");e.append(Aw,this.apiKey)}}async addGoogleAuthHeaders(e,n){if(this.googleAuth===void 0)throw new Error("Trying to set google-auth headers but googleAuth is unset");let r=await this.googleAuth.getRequestHeaders(n);for(let[i,s]of r)e.get(i)===null&&e.append(i,s)}};function yq(t){let e;if(t){if(e=t,e.scopes){if(typeof e.scopes=="string"&&e.scopes!==ta||Array.isArray(e.scopes)&&e.scopes.indexOf(ta)<0)throw new Error(`Invalid auth scopes. Scopes must include: ${ta}`)}else return e.scopes=[ta],e;return e}else return e={scopes:[ta]},e}var Wp=class{async download(e,n){if(e.downloadPath){let r=await _q(e,n);if(r instanceof Di){let i=mO(e.downloadPath);yO.fromWeb(r.responseInternal.body).pipe(i),await _O(i)}else try{await gO(e.downloadPath,r,{encoding:"base64"})}catch(i){throw new Error(`Failed to write file to ${e.downloadPath}: ${i}`)}}}};async function _q(t,e){var n,r,i;let s=rm(t.file);if(s!==void 0)return await e.request({path:`files/${s}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal});if(Dw(t.file)){let o=(i=t.file.video)===null||i===void 0?void 0:i.videoBytes;if(typeof o=="string")return o;throw new Error("Failed to download generated video, Uri or videoBytes not found.")}else if(Uw(t.file)){let o=t.file.videoBytes;if(typeof o=="string")return o;throw new Error("Failed to download video, Uri or videoBytes not found.")}else throw new Error("Unsupported file type")}var Jp=class{create(e,n,r){return new zp(e,n,r)}},zp=class{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new Xh.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};function Eq(t,e){let n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function vq(t,e){let n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function Sq(t,e){let n={},r=l(t,["sdkHttpResponse"]);return r!=null&&c(n,["sdkHttpResponse"],r),n}function Tq(t,e){let n={},r=l(t,["sdkHttpResponse"]);return r!=null&&c(n,["sdkHttpResponse"],r),n}function wq(t,e,n){let r={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=l(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&c(e,["displayName"],i),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let s=l(t,["epochCount"]);e!==void 0&&s!=null&&c(e,["tuningTask","hyperparameters","epochCount"],s);let o=l(t,["learningRateMultiplier"]);if(o!=null&&c(r,["tuningTask","hyperparameters","learningRateMultiplier"],o),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=l(t,["batchSize"]);e!==void 0&&a!=null&&c(e,["tuningTask","hyperparameters","batchSize"],a);let d=l(t,["learningRate"]);if(e!==void 0&&d!=null&&c(e,["tuningTask","hyperparameters","learningRate"],d),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(l(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function Cq(t,e,n){let r={},i=l(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let _=l(t,["validationDataset"]);e!==void 0&&_!=null&&c(e,["supervisedTuningSpec"],bw(_))}else if(i==="PREFERENCE_TUNING"){let _=l(t,["validationDataset"]);e!==void 0&&_!=null&&c(e,["preferenceOptimizationSpec"],bw(_))}let s=l(t,["tunedModelDisplayName"]);e!==void 0&&s!=null&&c(e,["tunedModelDisplayName"],s);let o=l(t,["description"]);e!==void 0&&o!=null&&c(e,["description"],o);let a=l(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let _=l(t,["epochCount"]);e!==void 0&&_!=null&&c(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(a==="PREFERENCE_TUNING"){let _=l(t,["epochCount"]);e!==void 0&&_!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let d=l(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let _=l(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&c(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(d==="PREFERENCE_TUNING"){let _=l(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let u=l(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let _=l(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&c(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(u==="PREFERENCE_TUNING"){let _=l(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&c(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let h=l(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let _=l(t,["adapterSize"]);e!==void 0&&_!=null&&c(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(h==="PREFERENCE_TUNING"){let _=l(t,["adapterSize"]);e!==void 0&&_!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let m=l(t,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);let g=l(t,["beta"]);return e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),r}function Aq(t,e){let n={},r=l(t,["baseModel"]);r!=null&&c(n,["baseModel"],r);let i=l(t,["preTunedModel"]);i!=null&&c(n,["preTunedModel"],i);let s=l(t,["trainingDataset"]);s!=null&&Uq(s);let o=l(t,["config"]);return o!=null&&wq(o,n),n}function bq(t,e){let n={},r=l(t,["baseModel"]);r!=null&&c(n,["baseModel"],r);let i=l(t,["preTunedModel"]);i!=null&&c(n,["preTunedModel"],i);let s=l(t,["trainingDataset"]);s!=null&&Lq(s,n,e);let o=l(t,["config"]);return o!=null&&Cq(o,n,e),n}function Rq(t,e){let n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function Iq(t,e){let n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function Pq(t,e,n){let r={},i=l(t,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let s=l(t,["pageToken"]);e!==void 0&&s!=null&&c(e,["_query","pageToken"],s);let o=l(t,["filter"]);return e!==void 0&&o!=null&&c(e,["_query","filter"],o),r}function xq(t,e,n){let r={},i=l(t,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let s=l(t,["pageToken"]);e!==void 0&&s!=null&&c(e,["_query","pageToken"],s);let o=l(t,["filter"]);return e!==void 0&&o!=null&&c(e,["_query","filter"],o),r}function kq(t,e){let n={},r=l(t,["config"]);return r!=null&&Pq(r,n),n}function Nq(t,e){let n={},r=l(t,["config"]);return r!=null&&xq(r,n),n}function Mq(t,e){let n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);let i=l(t,["nextPageToken"]);i!=null&&c(n,["nextPageToken"],i);let s=l(t,["tunedModels"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>aC(a))),c(n,["tuningJobs"],o)}return n}function Oq(t,e){let n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);let i=l(t,["nextPageToken"]);i!=null&&c(n,["nextPageToken"],i);let s=l(t,["tuningJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>Kp(a))),c(n,["tuningJobs"],o)}return n}function Dq(t,e){let n={},r=l(t,["name"]);r!=null&&c(n,["model"],r);let i=l(t,["name"]);return i!=null&&c(n,["endpoint"],i),n}function Uq(t,e){let n={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=l(t,["examples"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),c(n,["examples","examples"],i)}return n}function Lq(t,e,n){let r={},i=l(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let o=l(t,["gcsUri"]);e!==void 0&&o!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){let o=l(t,["gcsUri"]);e!==void 0&&o!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let s=l(n,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let o=l(t,["vertexDatasetResource"]);e!==void 0&&o!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){let o=l(t,["vertexDatasetResource"]);e!==void 0&&o!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function aC(t,e){let n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);let i=l(t,["name"]);i!=null&&c(n,["name"],i);let s=l(t,["state"]);s!=null&&c(n,["state"],Ow(s));let o=l(t,["createTime"]);o!=null&&c(n,["createTime"],o);let a=l(t,["tuningTask","startTime"]);a!=null&&c(n,["startTime"],a);let d=l(t,["tuningTask","completeTime"]);d!=null&&c(n,["endTime"],d);let u=l(t,["updateTime"]);u!=null&&c(n,["updateTime"],u);let h=l(t,["description"]);h!=null&&c(n,["description"],h);let m=l(t,["baseModel"]);m!=null&&c(n,["baseModel"],m);let g=l(t,["_self"]);return g!=null&&c(n,["tunedModel"],Dq(g)),n}function Kp(t,e){let n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);let i=l(t,["name"]);i!=null&&c(n,["name"],i);let s=l(t,["state"]);s!=null&&c(n,["state"],Ow(s));let o=l(t,["createTime"]);o!=null&&c(n,["createTime"],o);let a=l(t,["startTime"]);a!=null&&c(n,["startTime"],a);let d=l(t,["endTime"]);d!=null&&c(n,["endTime"],d);let u=l(t,["updateTime"]);u!=null&&c(n,["updateTime"],u);let h=l(t,["error"]);h!=null&&c(n,["error"],h);let m=l(t,["description"]);m!=null&&c(n,["description"],m);let g=l(t,["baseModel"]);g!=null&&c(n,["baseModel"],g);let _=l(t,["tunedModel"]);_!=null&&c(n,["tunedModel"],_);let v=l(t,["preTunedModel"]);v!=null&&c(n,["preTunedModel"],v);let w=l(t,["supervisedTuningSpec"]);w!=null&&c(n,["supervisedTuningSpec"],w);let T=l(t,["preferenceOptimizationSpec"]);T!=null&&c(n,["preferenceOptimizationSpec"],T);let A=l(t,["tuningDataStats"]);A!=null&&c(n,["tuningDataStats"],A);let G=l(t,["encryptionSpec"]);G!=null&&c(n,["encryptionSpec"],G);let F=l(t,["partnerModelTuningSpec"]);F!=null&&c(n,["partnerModelTuningSpec"],F);let B=l(t,["customBaseModel"]);B!=null&&c(n,["customBaseModel"],B);let H=l(t,["experiment"]);H!=null&&c(n,["experiment"],H);let q=l(t,["labels"]);q!=null&&c(n,["labels"],q);let $=l(t,["outputUri"]);$!=null&&c(n,["outputUri"],$);let Y=l(t,["pipelineJob"]);Y!=null&&c(n,["pipelineJob"],Y);let L=l(t,["serviceAccount"]);L!=null&&c(n,["serviceAccount"],L);let te=l(t,["tunedModelDisplayName"]);te!=null&&c(n,["tunedModelDisplayName"],te);let oe=l(t,["veoTuningSpec"]);return oe!=null&&c(n,["veoTuningSpec"],oe),n}function Fq(t,e){let n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);let i=l(t,["name"]);i!=null&&c(n,["name"],i);let s=l(t,["metadata"]);s!=null&&c(n,["metadata"],s);let o=l(t,["done"]);o!=null&&c(n,["done"],o);let a=l(t,["error"]);return a!=null&&c(n,["error"],a),n}function bw(t,e){let n={},r=l(t,["gcsUri"]);r!=null&&c(n,["validationDatasetUri"],r);let i=l(t,["vertexDatasetResource"]);return i!=null&&c(n,["validationDatasetUri"],i),n}var Yp=class extends wn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new gr(mr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){let i={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);let s=Object.assign(Object.assign({},n),{preTunedModel:i});return s.baseModel=void 0,await this.tuneInternal(s)}else{let i=Object.assign({},n);return await this.tuneInternal(i)}else{let i=Object.assign({},n),s=await this.tuneMldevInternal(i),o="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?o=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(o=s.name.split("/operations/")[0]),{name:o,state:ep.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=Iq(e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>Kp(h))}else{let u=Rq(e);return a=Q("{name}",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>aC(h))}}async listInternal(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=Nq(e);return a=Q("tuningJobs",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=Oq(h),g=new Wu;return Object.assign(g,m),g})}else{let u=kq(e);return a=Q("tunedModels",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=Mq(h),g=new Wu;return Object.assign(g,m),g})}}async cancel(e){var n,r,i,s;let o,a="",d={};if(this.apiClient.isVertexAI()){let u=vq(e);return a=Q("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=Tq(h),g=new Ju;return Object.assign(g,m),g})}else{let u=Eq(e);return a=Q("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),o.then(h=>{let m=Sq(h),g=new Ju;return Object.assign(g,m),g})}}async tuneInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI()){let a=bq(e,e);return s=Q("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>Kp(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let i,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Aq(e);return s=Q("tunedModels",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let h=u;return h.sdkHttpResponse={headers:d.headers},h})),i.then(d=>Fq(d))}}},lC=1024*1024*8,uC=3,cC=1e3,dC=2,Vr="x-goog-upload-status";async function qq(t,e,n){var r;let i=await fC(t,e,n),s=await i?.json();if(((r=i?.headers)===null||r===void 0?void 0:r[Vr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async function Bq(t,e,n){var r;let i=await fC(t,e,n),s=await i?.json();if(((r=i?.headers)===null||r===void 0?void 0:r[Vr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=Qp(s),a=new Xu;return Object.assign(a,o),a}async function fC(t,e,n){var r,i;let s=0,o=0,a=new Di(new Response),d="upload";for(s=t.size;o<s;){let u=Math.min(lC,s-o),h=t.slice(o,o+u);o+u>=s&&(d+=", finalize");let m=0,g=cC;for(;m<uC&&(a=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(o),"Content-Length":String(u)}}}),!(!((r=a?.headers)===null||r===void 0)&&r[Vr]));)m++,await hC(g),g=g*dC;if(o+=u,((i=a?.headers)===null||i===void 0?void 0:i[Vr])!=="active")break;if(s<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function Gq(t){return{size:t.size,type:t.type}}function hC(t){return new Promise(e=>setTimeout(e,t))}var Xp=class{async stat(e){let n={size:0,type:void 0};if(typeof e=="string"){let r=await pc.stat(e);return n.size=r.size,n.type=this.inferMimeType(e),n}else return await Gq(e)}async upload(e,n,r){return typeof e=="string"?await this.uploadFileFromPath(e,n,r):qq(e,n,r)}async uploadToFileSearchStore(e,n,r){return typeof e=="string"?await this.uploadFileToFileSearchStoreFromPath(e,n,r):Bq(e,n,r)}inferMimeType(e){let n=e.slice(e.lastIndexOf(".")+1);return{aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}[n.toLowerCase()]}async uploadFileFromPath(e,n,r){var i;let s=await this.uploadFileFromPathInternal(e,n,r),o=await s?.json();if(((i=s?.headers)===null||i===void 0?void 0:i[Vr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async uploadFileToFileSearchStoreFromPath(e,n,r){var i;let s=await this.uploadFileFromPathInternal(e,n,r),o=await s?.json();if(((i=s?.headers)===null||i===void 0?void 0:i[Vr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let a=Qp(o),d=new Xu;return Object.assign(d,a),d}async uploadFileFromPathInternal(e,n,r){var i,s;let o=0,a=0,d=new Di(new Response),u="upload",h,m=Iw.basename(e);try{if(h=await pc.open(e,"r"),!h)throw new Error("Failed to open file");for(o=(await h.stat()).size;a<o;){let g=Math.min(lC,o-a);a+g>=o&&(u+=", finalize");let _=new Uint8Array(g),{bytesRead:v}=await h.read(_,0,g,a);if(v!==g)throw new Error(`Failed to read ${g} bytes from file at offset ${a}. bytes actually read: ${v}`);let w=new Blob([_]),T=0,A=cC;for(;T<uC&&(d=await r.request({path:"",body:w,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:n,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(v),"X-Goog-Upload-File-Name":m}}}),!(!((i=d?.headers)===null||i===void 0)&&i[Vr]));)T++,await hC(A),A=A*dC;if(a+=v,((s=d?.headers)===null||s===void 0?void 0:s[Vr])!=="active")break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}finally{h&&await h.close()}}};var Hq="gl-node/",hc=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let n=new Je({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=n.interactions,this._interactions}constructor(e){var n,r,i,s,o,a;if((e.project||e.location)&&e.apiKey)throw new Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=(r=(n=e.vertexai)!==null&&n!==void 0?n:Vq("GOOGLE_GENAI_USE_VERTEXAI"))!==null&&r!==void 0?r:!1;let d=Wq(),u=Oi("GOOGLE_CLOUD_PROJECT"),h=Oi("GOOGLE_CLOUD_LOCATION");if(this.apiKey=(i=e.apiKey)!==null&&i!==void 0?i:d,this.project=(s=e.project)!==null&&s!==void 0?s:u,this.location=(o=e.location)!==null&&o!==void 0?o:h,!this.vertexai&&!this.apiKey)throw new Error("API key must be set when using the Gemini API.");e.vertexai&&(!((a=e.googleAuthOptions)===null||a===void 0)&&a.credentials&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(u||h)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&d?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(u||h)&&d&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),!this.location&&!this.apiKey&&(this.location="global"));let m=TO(e.httpOptions,e.vertexai,Oi("GOOGLE_VERTEX_BASE_URL"),Oi("GOOGLE_GEMINI_BASE_URL"));m&&(e.httpOptions?e.httpOptions.baseUrl=m:e.httpOptions={baseUrl:m}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let g=new $p({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new bp({auth:g,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Hq+process.version,uploader:new Xp,downloader:new Wp}),this.models=new Np(this.apiClient),this.live=new xp(this.apiClient,g,new Jp),this.batches=new _p(this.apiClient),this.chats=new vp(this.models,this.apiClient),this.caches=new Ep(this.apiClient),this.files=new Tp(this.apiClient),this.operations=new Mp(this.apiClient),this.authTokens=new Op(this.apiClient),this.tunings=new Yp(this.apiClient),this.fileSearchStores=new Up(this.apiClient)}};function Oi(t){var e,n,r;return(r=(n=(e=process==null?void 0:process.env)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0}function Vq(t){return $q(Oi(t))}function $q(t){return t===void 0?!1:t.toLowerCase()==="true"}function Wq(){let t=Oi("GOOGLE_API_KEY"),e=Oi("GEMINI_API_KEY");return t&&e&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),t||e||void 0}var sa=new un,Jq=pe.object({prompt:pe.string().min(1,"Prompt is required"),history:pe.array(pe.object({role:pe.enum(["user","model"]),text:pe.string()})).default([]),sessionId:pe.string().optional()}),zq=`You are a helpful AI assistant for FixitHub, a home repair and maintenance platform. 
You help users with:
- DIY repair guidance and step-by-step instructions
- Tool recommendations and usage tips
- Safety advice for home repairs
- When to call a professional vs. DIY
- Cost estimates and project planning
- Material recommendations

Be friendly, practical, and safety-conscious. If a task seems dangerous or requires professional licensing (like major electrical or plumbing work), recommend hiring a professional from our platform.`;sa.post("/",async t=>{try{let e=await t.req.json(),n=Jq.safeParse(e);if(!n.success)throw new xt("Invalid request data",{errors:n.error.flatten().fieldErrors});let{prompt:r,history:i,sessionId:s}=n.data;if(!ht.GEMINI_API_KEY)return Ve.warn("Gemini API key not configured"),xe(t,{text:"I'm currently offline. Please configure the AI service and try again later.",sessionId:s});let o=new hc({apiKey:ht.GEMINI_API_KEY}),a=[{role:"user",parts:[{text:zq}]},{role:"model",parts:[{text:"Understood! I'm ready to help with home repair questions."}]},...i.map(m=>({role:m.role==="user"?"user":"model",parts:[{text:m.text}]})),{role:"user",parts:[{text:r}]}],u=(await o.models.generateContent({model:"gemini-2.0-flash",contents:a})).text||"I'm having trouble thinking of a solution right now. Please try again.";s&&(await as.addMessage(s,"user",r),await as.addMessage(s,"model",u));let h={text:u,sessionId:s};return Ve.debug("AI response generated",{promptLength:r.length,responseLength:u.length,sessionId:s}),xe(t,h)}catch(e){return Ve.error("AI request failed",{error:String(e)}),e instanceof Te?Re(t,e):xe(t,{text:"Sorry, I am currently offline or experiencing high traffic. Please try again later."})}});sa.get("/history/:sessionId",async t=>{try{let e=t.req.param("sessionId"),n=await as.getSessionHistory(e);return xe(t,n)}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});sa.delete("/history/:sessionId",async t=>{try{let e=t.req.param("sessionId");return await as.clearSession(e),xe(t,{message:"Chat history cleared"})}catch(e){return e instanceof Te?Re(t,e):_e.internalError(t)}});function pC(t){t.route("/api/products",kn),t.route("/api/service-profiles",sr),t.route("/api/service-requests",Nt),t.route("/api/ai",sa)}var Wr=new un;Wr.use("*",Mg({origin:"*",allowMethods:["GET","POST","PUT","PATCH","DELETE","OPTIONS"],allowHeaders:["Content-Type","Authorization"]}));Wr.use("*",Ug((t,...e)=>{console.log(JSON.stringify({timestamp:new Date().toISOString(),message:t,details:e}))}));Wr.get("/health",t=>t.json({status:"ok",timestamp:new Date().toISOString(),version:"1.0.0",runtime:"lambda",region:process.env.AWS_REGION}));Wr.get("/",t=>t.json({name:"FitIt Backend API",version:"1.0.0",status:"running",runtime:"lambda"}));pC(Wr);Wr.notFound(t=>_e.notFound(t,"Endpoint"));Wr.onError((t,e)=>(Ve.error("Unhandled error",{message:t.message,stack:t.stack,path:e.req.path,method:e.req.method,requestId:e.req.header("x-amzn-requestid")}),t instanceof Te?Re(e,t):_e.internalError(e,"An unexpected error occurred")));var J2=id(Wr);export{Wr as app,J2 as handler};
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)

@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
//# sourceMappingURL=index.mjs.map
